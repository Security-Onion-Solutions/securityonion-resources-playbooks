name: ET INFO DNS Query for a Suspicious *.cu.cc domain
id: 1204944
description: "Detects DNS queries to .cu.cc domains which may be used for URL shortening, \nfree hosting, or potentially malicious services. May trigger on legitimate \nuse of cu.cc services or applications that resolve these domains automatically.\n"
type: detection
detection_id: 2013172
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What specific .cu.cc domain was queried?
    context: Reveals the exact domain pattern matching the cu.cc TLD detection.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: Does this host normally query .cu.cc domains?
    context: Determines if DNS queries to cu.cc domains are typical for this host.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.query.name|expand: '%dns.query.name%'
        condition: selection
      fields:
        - dns.query.name
  - question: What IP addresses did the .cu.cc domain resolve to?
    context: Identifies the hosting infrastructure behind the queried domain.
    range: +/-15m
    query: "aggregation: false\nlogsource:\n  category: network\n  service: dns\ndetection:\n  selection:\n    community_id|expand: '%community_id%'\n    dns.resolved_ip: \"*\"\n  condition: selection\nfields:\n  - dns.query.name\n  - dns.resolved_ip\n  - dns.query.type_name\n  \n"
  - question: What process initiated the DNS query for the .cu.cc domain?
    context: Identifies the application responsible for the domain resolution.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id|expand: '%community_id%'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: Did the host connect to the resolved IP addresses after the DNS query?
    context: Determines if the DNS resolution led to actual network connections.
    range: +30m
    query: "aggregation: false\nlogsource:\n  category: network\n  service: connection\ndetection:\n  selection:\n    src_ip|expand: '%src_ip%'\n    connection.state: \"established\"\n  condition: selection\nfields:\n  - dst_ip\n  - dst_port\n  - connection.history\n  - network.protocol\n  \n"
  - question: What other external connections occurred from this host?
    context: Identifies additional external communications that may be related.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip|expand: '%public_ip%'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts in the network querying .cu.cc domains?
    context: Determines scope of cu.cc domain usage across the organization.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%public_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category
  - question: What is the timing pattern of .cu.cc queries from this host?
    context: Analyzes whether queries follow automated or manual patterns.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%related_ip%'
          dst_ip|expand: '%related_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol
        - event.duration
        - client.ip_bytes
        - server.ip_bytes
        - connection.state_description
  - question: Did any URL shortening or redirect activity precede this query?
    context: Identifies potential click-through from shortened URLs or redirects.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.status_code:
            - 301
            - 302
            - 307
            - 308
        condition: selection
      fields:
        - http.virtual_host
        - http.uri
        - http.status_code
        - dst_ip