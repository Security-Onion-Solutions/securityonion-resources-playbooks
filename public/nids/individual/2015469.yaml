name: ET WEB_SPECIFIC_APPS Help Center Live file parameter Local File Inclusion vulnerability
id: 1221660
description: |
  Detects attempts to exploit Local File Inclusion vulnerability in Help Center Live 2.0.6 via the file parameter in module.php.
  May trigger on legitimate file access patterns or automated scanning tools testing for this specific vulnerability.
type: detection
detection_id: 2015469
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete HTTP request attempting to exploit the Help Center Live LFI vulnerability?
    context: Reveals the exact file path requested and exploitation method used.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.method
        - http.useragent
        - http.virtual_host
        - http.uri
        - http.status_code
  - question: Does this host normally access Help Center Live applications?
    context: Determines if this represents normal application usage or external reconnaissance.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
  - question: What web application process handled this Help Center Live request?
    context: Identifies the specific web server and application responding to the LFI attempt.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id|expand: '%community_id%'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What other external connections occurred from this host around the same time?
    context: Identifies additional reconnaissance or exploitation attempts.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip|expand: '%public_ip%'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts attempting similar Help Center Live exploits?
    context: Determines scope of scanning campaign targeting this specific vulnerability.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%public_ip%'
        filter:
          src_ip|expand: '%src_ip%'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What files were accessed by the web server process during this timeframe?
    context: Reveals whether the LFI attempt successfully accessed unauthorized files.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          ProcessGuid|expand: '%ProcessGuid%'
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - User
  - question: Did any process attempt to read sensitive system files after this request?
    context: Assesses if the LFI vulnerability was successfully exploited to access protected files.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          file.path|contains:
            - "/etc/passwd"
            - "/etc/shadow"
            - "/etc/hosts"
            - "web.config"
            - "wp-config"
            - ".htaccess"
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
  - question: Are there other LFI or directory traversal attempts targeting this server?
    context: Identifies broader file inclusion attack patterns beyond Help Center Live.
    range: +/-2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        traversal_patterns:
          http.uri|contains:
            - "../"
            - "..%2f"
            - "..%5c"
            - "%2e%2e%2f"
            - "file="
            - "path="
            - "include="
        condition: selection and traversal_patterns
      fields:
        - src_ip
        - http.uri
        - http.user_agent
        - http.method
  - question: What is the pattern of requests to Help Center Live module.php across the network?
    context: Reveals scope of scanning or exploitation attempts targeting this application.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          http.uri|contains: "module.php"
        helpcenter:
          http.uri|contains: "helpcenter"
        condition: selection and helpcenter
      fields:
        - src_ip
        - dst_ip
        - http.uri
        - http.user_agent
        - http.method
  - question: Are there related alerts indicating successful file access or data exfiltration?
    context: Correlates with other security events that may indicate successful exploitation.
    range: +/-2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip|expand: '%related_ip%'
        filter:
          document_id|expand: '%document_id%'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip
  - question: Did any lateral movement occur from hosts involved in this Help Center Live activity?
    context: Assesses whether successful exploitation led to further network compromise.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%private_ip%'
          dst_port:
          - 445    # SMB
          - 139    # NetBIOS
          - 3389   # RDP
          - 5985   # WinRM HTTP
          - 5986   # WinRM HTTPS
          - 22     # SSH
          - 23     # Telnet
          - 135    # RPC
          - 5900   # VNC
        condition: selection
      fields:
        - src_ip
        - src_port
        - dst_ip
        - dst_port
        - network.transport