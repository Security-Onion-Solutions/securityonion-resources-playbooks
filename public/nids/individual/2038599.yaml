name: ET PHISHING Generic Credential Phish Landing Page 2022-08-23
id: 1223968
description: |
  Detects HTTP responses containing specific form elements and scripts commonly used in credential phishing pages.
  May trigger on legitimate banking or financial applications that use similar form field naming conventions.
type: detection
detection_id: 2038599
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete HTTP response containing the phishing page elements?
    context: Reveals the full credential harvesting form structure and associated scripts.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.method
        - http.useragent
        - http.virtual_host
        - http.uri
        - http.status_code
  - question: Does this host normally access financial or banking websites?
    context: Determines if HTTP traffic to sites with financial forms is typical for this user.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
  - question: What DNS queries led to this phishing page being accessed?
    context: Identifies the domain resolution chain that resulted in accessing the malicious content.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: What browser process accessed the page containing DataPost.php and Espera2.html?
    context: Identifies the application that retrieved the credential phishing content.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id|expand: '%community_id%'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: Are other hosts accessing pages with similar credential harvesting forms?
    context: Determines the scope of users potentially exposed to this phishing campaign.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%public_ip%'
        filter:
          src_ip|expand: '%src_ip%'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Did the user submit credentials to DataPost.php after viewing the phishing page?
    context: Assesses whether credential harvesting was successful.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.method: "POST"
          http.uri|contains: "DataPost.php"
        condition: selection
      fields:
        - http.uri
        - http.user_agent
        - http.request.body.length
  - question: What files were downloaded after accessing the phishing page?
    context: Identifies additional malware that may have been delivered alongside credential theft.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%private_ip%'
          file.name|endswith:
          - .exe
          - .dll
          - .bat
          - .cmd
          - .ps1
          - .vbs
          - .js
          - .scr
          - .com
          - .pif
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Are there other alerts related to this phishing infrastructure?
    context: Reveals additional security events associated with the same threat actors.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip|expand: '%related_ip%'
        filter:
          document_id|expand: '%document_id%'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip
  - question: Did this host attempt lateral movement after accessing the phishing page?
    context: Determines if credential theft led to network propagation attempts.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%private_ip%'
          dst_port:
          - 445    # SMB
          - 139    # NetBIOS
          - 3389   # RDP
          - 5985   # WinRM HTTP
          - 5986   # WinRM HTTPS
          - 22     # SSH
          - 23     # Telnet
          - 135    # RPC
          - 5900   # VNC
        condition: selection
      fields:
        - src_ip
        - src_port
        - dst_ip
        - dst_port
        - network.transport
  - question: What other credential harvesting domains is this infrastructure hosting?
    context: Identifies the broader phishing campaign infrastructure.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          file.data|contains:
            - "DataPost.php"
            - "formccn"
            - "credential"
            - "login"
        condition: selection
      fields:
        - http.virtual_host
        - http.uri
        - src_ip
  - question: Were any browser credential stores accessed after viewing the phishing page?
    context: Identifies attempts to harvest locally stored credentials beyond the phishing form.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.path|contains:
            - "Login Data"
            - "Cookies"
            - "Web Data"
            - "passwords.json"
            - "key4.db"
        condition: selection
      fields:
        - file.path
        - Image
        - file.name