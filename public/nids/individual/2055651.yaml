name: ET HUNTING Byte-order mark UTF-EBCDIC
id: 1225573
description: "Detects UTF-EBCDIC byte order marks in HTTP response bodies, which may indicate \nunusual encoding practices or potential evasion techniques. Can also occur in \nlegitimate applications handling legacy mainframe data or specialized encoding.\n"
type: detection
detection_id: 2055651
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-08-30
questions:
  - question: What was the complete HTTP response containing the UTF-EBCDIC byte order mark?
    context: Understanding the full response reveals the context and purpose of the unusual encoding.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.method
        - http.useragent
        - http.virtual_host
        - http.uri
        - http.status_code
  - question: Does this host normally receive HTTP responses with unusual encoding?
    context: Determines if specialized encoding is typical for this application or endpoint.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
  - question: What application initiated the request that received the UTF-EBCDIC response?
    context: Identifies the client application that may be handling legacy or specialized data formats.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id|expand: '%community_id%'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What other external connections occurred from this host around the same time?
    context: Identifies additional communications that may be related to data processing activities.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip|expand: '%public_ip%'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts receiving responses with UTF-EBCDIC byte order marks?
    context: Determines if this encoding pattern is isolated or part of broader organizational activity.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%public_ip%'
        filter:
          src_ip|expand: '%src_ip%'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What files were created after receiving the UTF-EBCDIC encoded response?
    context: Identifies data files that may have been processed or converted from the unusual encoding.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%private_ip%'
          file.name|endswith:
          - .doc
          - .docx
          - .xls
          - .xlsx
          - .pdf
          - .rtf
          - .ppt
          - .pptx
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Did any data conversion or encoding processes execute after this response?
    context: Reveals applications that may be processing the EBCDIC-encoded content.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%private_ip%'
          Image|contains:
          - iconv.exe
          - convert.exe
          - python.exe
          - java.exe
          - powershell.exe
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid
  - question: Are there related alerts involving the same external server?
    context: Identifies other suspicious activities from the same source that sent the encoded response.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip|expand: '%related_ip%'
        filter:
          document_id|expand: '%document_id%'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip
  - question: What is the pattern of communication with the server sending UTF-EBCDIC responses?
    context: Analyzes timing and frequency to distinguish between legitimate data exchange and potential evasion.
    range: +/-2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%related_ip%'
          dst_ip|expand: '%related_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol
        - event.duration
        - client.ip_bytes
        - server.ip_bytes
        - connection.state_description
  - question: Did any mainframe or legacy system connections occur around this time?
    context: Correlates with legitimate business processes that might involve EBCDIC encoding.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: [23, 992, 3270, 5555, 8080, 9443]
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - connection.state