# VALIDATION ERRORS:
# Sigma Query Errors:
#   - Question 9: Invalid logsource category 'authentication'. Valid categories: alert, network, firewall, proxy, webserver, process_creation, file_event, network_connection, dns, registry_event...
#
# ORIGINAL PLAYBOOK CONTENT:
name: ET MALWARE Linux.DDoS Checkin
id: 22019172
description: |
  Detects Linux DDoS botnet checkin traffic with distinctive version string and hacker identifier.
  This signature identifies infected Linux systems communicating with DDoS botnet command and control infrastructure.
  Legitimate software should not contain the specific "VERSONEX" and "Hacker" binary patterns.
type: detection
detection_id: 2019172
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete 1024-byte payload structure in this DDoS botnet checkin?
    context: Analyzing the full payload reveals botnet version, capabilities, and potential commands from the C2 server.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - flow.bytes_toserver
        - flow.bytes_toclient

  - question: Is this internal host normally communicating with external servers on this port?
    context: DDoS bots often use non-standard ports, so understanding normal communication patterns helps identify malicious activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - dst_ip
        - proto
        - service
        - conn_state
        - orig_bytes

  - question: What process on the Linux system initiated this outbound connection?
    context: Identifying the malicious process helps understand the infection vector and persistence mechanisms.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage
        - ProcessGuid

  - question: What other network connections has this host established recently?
    context: DDoS bots often communicate with multiple C2 servers and may perform reconnaissance or lateral movement.
    range: -2h/+2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service
        - conn_state
        - orig_bytes
        - resp_bytes

  - question: Are there other internal hosts communicating with this same C2 server?
    context: DDoS botnets typically involve multiple compromised systems, indicating a broader infection within the network.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - proto
        - conn_state
        - orig_bytes
        - service

  - question: What files were recently created or modified on this Linux system?
    context: DDoS malware often drops additional components, configuration files, or creates persistence mechanisms.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256
        - ProcessName
        - User

  - question: Are there signs of DDoS attack traffic originating from this host?
    context: Infected systems often begin launching attacks shortly after checkin, generating high-volume outbound traffic.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - orig_pkts
        - orig_bytes
        - conn_state

  - question: What DNS queries were made by this host before the C2 communication?
    context: Understanding domain resolution patterns helps identify the infection chain and additional malicious infrastructure.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
        - dns.response_code

  - question: What authentication or privilege escalation events occurred on this Linux system?
    context: DDoS malware often requires elevated privileges and may exploit vulnerabilities or stolen credentials.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: authentication
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - user.name
        - source.ip
        - event.outcome
        - logon.type

  - question: Are there similar Linux DDoS botnet alerts from other systems in the environment?
    context: Botnet infections often spread through the network via shared vulnerabilities or credential reuse.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Linux.DDoS"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.category

  - question: What system resource utilization patterns indicate DDoS capability preparation?
    context: DDoS bots often consume significant CPU and network resources when preparing for or conducting attacks.
    range: -2h/+6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - orig_pkts
        - resp_pkts
        - orig_bytes
        - resp_bytes
        - duration