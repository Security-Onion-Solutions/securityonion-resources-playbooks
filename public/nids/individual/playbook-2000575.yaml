name: ET SCAN ICMP PING IPTools
id: 22000575
description: |
  Detects ICMP ping packets with distinctive IPTools signature pattern.
  IPTools is a network utility suite that may be used for legitimate network testing or reconnaissance.
  May indicate network discovery activity or troubleshooting procedures.
type: detection
detection_id: 2000575
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete ICMP payload containing the IPTools signature pattern?
    context: Understanding the exact ping pattern helps confirm tool identification and scanning methodology.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - icmp.type
        - icmp.code
        - payload
        - payload_printable
  - question: Is this authorized network testing or legitimate troubleshooting activity?
    context: IPTools usage may be part of normal network administration or connectivity testing procedures.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: icmp
        condition: selection
      fields:
        - dst_ip
        - icmp.type
        - icmp.code
  - question: What other hosts has this source IP pinged using IPTools?
    context: Multiple ping targets indicate systematic network discovery requiring assessment of reconnaissance scope.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: icmp
          icmp.type: 8
        condition: selection
      fields:
        - dst_ip
        - icmp.code
        - bytes_toserver
  - question: Did the target hosts respond to the IPTools ping requests?
    context: Ping responses reveal live hosts and network topology information useful for attack planning.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          proto: icmp
          icmp.type: 0
        condition: selection
      fields:
        - icmp.code
        - bytes_toclient
        - community_id
  - question: What was the timing pattern and frequency of IPTools ping activity?
    context: Rapid sequential pings indicate automated scanning versus manual network troubleshooting.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature: "ET SCAN ICMP PING IPTools"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
  - question: Are there signs of follow-up reconnaissance or port scanning after ping discovery?
    context: ICMP discovery often precedes targeted port scanning and service enumeration activities.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "Attempted Information Leak"
            - "Attempted Reconnaissance"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: What other network discovery tools or techniques were used by this source?
    context: Multiple discovery methods indicate comprehensive network reconnaissance requiring enhanced monitoring.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "SCAN"
            - "PING"
            - "Discovery"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Did the IPTools scanning reveal responsive network segments or services?
    context: Successful host discovery may lead to targeted attacks against identified systems and services.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto|contains:
            - tcp
            - udp
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
  - question: Are there indicators of targeted attacks against discovered hosts?
    context: Network discovery often enables subsequent exploitation attempts against identified targets.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "Attempted Administrator Privilege Gain"
            - "Attempted User Privilege Gain"
            - "Web Application Attack"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Is this IPTools scanning activity part of a broader reconnaissance campaign?
    context: Enterprise-wide network discovery indicates systematic threat actor reconnaissance requiring coordinated response.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature: "ET SCAN ICMP PING IPTools"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.name