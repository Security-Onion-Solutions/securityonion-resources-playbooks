name: ET GAMES Guild Wars connection
id: 22002154
description: |
  Detects Guild Wars game client connections to game servers on port 6112.
  This is legitimate gaming traffic but may violate organizational policy regarding games or bandwidth usage.
  The specific byte pattern identifies the Guild Wars protocol handshake.
type: detection
detection_id: 2002154
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete Guild Wars protocol handshake that triggered this detection?
    context: The specific byte sequence confirms this is legitimate Guild Wars traffic versus potential protocol mimicry.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - alert.signature
        - src_ip
        - dst_ip
        - dst_port

  - question: What Guild Wars game servers are being accessed from this client?
    context: Identifying specific game servers helps determine if connections are to official or private servers.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 6112
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
        - count

  # Type 2: Triage Assessment
  - question: Is gaming traffic permitted for this user or system during business hours?
    context: Many organizations have policies restricting gaming applications during work hours or on corporate systems.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains: 'GAMES'
        condition: selection
      fields:
        - alert.signature
        - count

  - question: Is this activity occurring during authorized personal use time?
    context: Some organizations allow personal internet use during breaks or after hours, affecting policy violation assessment.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_port
        - count

  # Type 3: Activity Context
  - question: What other gaming or entertainment applications are being used from this system?
    context: Multiple gaming applications may indicate broader policy violations or personal use of corporate resources.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'GAMES'
            - 'P2P'
        condition: selection
      fields:
        - alert.signature
        - count

  - question: What was the duration and data volume of this gaming session?
    context: Extended gaming sessions or high bandwidth usage may impact business operations and network performance.
    range: -2h/+2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 6112
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
        - duration

  # Type 4: Impact Assessment
  - question: Is this gaming traffic impacting business-critical network resources?
    context: Gaming applications can consume significant bandwidth and affect performance of business applications.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there signs of productivity impact from gaming activity during work hours?
    context: Reduced business application usage during gaming sessions may indicate work productivity concerns.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - count

  # Type 5: Forensic Deep-Dive
  - question: What Guild Wars account or character information can be identified from this traffic?
    context: User account details help identify the individual responsible and assess policy violation scope.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - payload_printable
        - src_port

  - question: What system processes are associated with this Guild Wars client activity?
    context: Identifying the gaming application process helps confirm legitimate client versus potential malware mimicry.
    range: -30m/+30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'gw.exe'
            - 'guild'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  # Type 6: Enterprise Correlation
  - question: How many users across the organization are accessing gaming applications?
    context: Widespread gaming usage may indicate need for policy clarification or enforcement measures.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'GAMES'
        condition: selection
      fields:
        - src_ip
        - alert.signature
        - count

  - question: Are there patterns of gaming activity that suggest coordinated personal use?
    context: Simultaneous gaming by multiple users may indicate organized personal use affecting business operations.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 6112
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - count