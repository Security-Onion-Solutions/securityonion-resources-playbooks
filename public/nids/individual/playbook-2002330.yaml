name: ET INFO Google Talk TLS Client Traffic
id: 22002330
description: |
  Detects Google Talk client traffic over TLS/SSL connections to Gmail servers.
  May indicate legitimate encrypted instant messaging or potential policy violation.
type: detection
detection_id: 2002330
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact TLS client hello content for Google Talk?
    context: Analyzing TLS handshake confirms legitimate Google Talk vs suspicious encrypted traffic.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet_info.length

  - question: Is encrypted instant messaging permitted on this network?
    context: Determines if TLS-encrypted Google Talk violates organizational security policy.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 443
        condition: selection
      fields:
        - dst_ip
        - connection_count
        - bytes_toserver

  - question: What SSL certificate details are being used?
    context: Certificate analysis confirms legitimate Google infrastructure vs suspicious proxies.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number

  - question: How frequently does this user connect to encrypted Google Talk?
    context: Usage patterns reveal if occasional communication or continuous encrypted sessions.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 443
        condition: selection
      fields:
        - dst_ip
        - connection_count
        - bytes_toserver

  - question: What other encrypted messaging services is this user accessing?
    context: Multiple encrypted platforms could indicate circumventing communication monitoring.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          tls.server.certificate.subject|contains:
            - 'google'
            - 'gmail'
            - 'talk'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - dst_ip
        - dst_port

  - question: Is large amounts of data being transmitted via encrypted Google Talk?
    context: High bandwidth usage could indicate file transfers or data exfiltration over encrypted channel.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 443
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: What is the reputation of the TLS endpoints?
    context: Verifying legitimate Google infrastructure vs malicious encrypted proxies.
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 443
        condition: selection
      fields:
        - dst_ip
        - dst_country
        - dst_asn

  - question: Are there signs of malware using encrypted XMPP for command and control?
    context: Advanced malware uses encrypted messaging protocols to evade detection.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - 'ssl'
            - 'tls'
            - 'encrypt'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid

  - question: What application is establishing the encrypted Google Talk connection?
    context: Process identification helps distinguish legitimate clients from suspicious applications.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Are other systems on the network using encrypted Google Talk?
    context: Multiple encrypted sessions could indicate coordinated communication or widespread policy violations.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 443
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - connection_count