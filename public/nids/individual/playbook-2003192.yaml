name: ET VOIP INVITE Message Flood TCP
id: 22003192
description: |
  Detects SIP INVITE message flooding over TCP indicating potential VoIP denial of service attack.
  Triggers when 100+ INVITE messages from same source within 60 seconds exceed normal call setup patterns.
  May trigger during legitimate high-volume call center operations or SIP trunk testing.
type: detection
detection_id: 2003192
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact SIP INVITE message pattern detected in the flood?
    context: Analyzing INVITE message structure reveals attack sophistication and potential VoIP service targets.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - flow_id
        - app_proto
  - question: Is this high-volume SIP traffic part of legitimate business VoIP operations?
    context: Distinguishing between authorized call center activity and malicious DoS attacks.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration
  - question: What is the source and geographic origin of the SIP flood attack?
    context: Understanding attacker infrastructure helps with blocking and attribution efforts.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
  - question: How is the VoIP infrastructure responding to the INVITE flood?
    context: Assessing service impact and determining if DoS attack is successful.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - duration
        - src_port
  - question: Are there other types of SIP attacks occurring simultaneously?
    context: Identifying if this is part of a broader VoIP attack campaign with multiple vectors.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'VOIP'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category
  - question: What legitimate SIP services are being targeted by this flood attack?
    context: Understanding service impact helps prioritize protection and recovery efforts.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - app_proto
        - bytes_toclient
  - question: Has this attack source targeted other VoIP infrastructure in the network?
    context: Assessing campaign scope and identifying additional targeted VoIP systems.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there DNS queries indicating reconnaissance of VoIP infrastructure?
    context: Understanding if the attack was preceded by VoIP service discovery activities.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
  - question: What is the attack pattern and timing of the SIP INVITE flood?
    context: Analyzing attack characteristics helps implement effective mitigation strategies.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there similar VoIP DoS attacks affecting other organizations or networks?
    context: Determining if this is part of a broader campaign targeting VoIP infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'INVITE'
            - 'Flood'
            - 'VOIP'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name