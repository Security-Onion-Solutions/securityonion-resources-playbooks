name: ET VOIP REGISTER Message Flood TCP
id: 22003193
description: |
  Detects SIP REGISTER message flooding over TCP indicating potential VoIP registration DoS attack.
  Triggers when 100+ REGISTER messages from same source within 60 seconds exceed normal registration patterns.
  May trigger during legitimate SIP client reconnection storms or bulk phone provisioning.
type: detection
detection_id: 2003193
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the SIP REGISTER flood pattern and registration details?
    context: Analyzing REGISTER message structure reveals attack methodology and targeted SIP infrastructure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - flow_id
        - app_proto
  - question: Is this high-volume REGISTER traffic part of legitimate SIP client operations?
    context: Distinguishing between normal registration activity and malicious flooding attacks.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration
  - question: What is the source and characteristics of the REGISTER flood attack?
    context: Understanding attacker infrastructure and capabilities for effective blocking measures.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
  - question: How is the SIP registrar responding to the registration flood?
    context: Assessing service impact and determining if the DoS attack is degrading VoIP services.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - duration
        - src_port
  - question: Are there other SIP-based attacks occurring alongside the REGISTER flood?
    context: Identifying multi-vector VoIP attacks that may compound service disruption.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'VOIP'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category
  - question: What legitimate SIP registration services are being targeted?
    context: Understanding business impact on VoIP phone registration and service availability.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - app_proto
        - bytes_toclient
  - question: Has this attack source targeted other SIP registrars in the network?
    context: Assessing campaign scope and identifying additional vulnerable VoIP infrastructure.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there DNS queries indicating SIP infrastructure reconnaissance?
    context: Determining if the attack was preceded by systematic VoIP service discovery.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
  - question: What is the attack timing and registration attempt pattern?
    context: Analyzing attack characteristics helps implement effective registration rate limiting.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there authentication failures associated with this REGISTER flood?
    context: Understanding if the attack is attempting credential brute force alongside DoS.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'Unauthorized'
            - 'Authentication'
            - 'Failed'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category
  - question: How does this REGISTER flood compare to normal registration patterns?
    context: Establishing baseline behavior helps tune detection and identify legitimate bulk operations.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration