name: ET INFO SOCKSv4 Port 5050 Inbound Request Linux Source
id: 22003281
description: |
  Detects inbound SOCKSv4 proxy requests from Linux systems targeting port 5050.
  May indicate legitimate proxy usage or malicious tunneling activity for command and control.
type: detection
detection_id: 2003281
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact SOCKSv4 request structure and target details?
    context: The SOCKS request reveals the intended destination and proxy configuration being used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - payload_printable

  - question: Is this authorized proxy usage for this network segment?
    context: Organizations may legitimately use SOCKS proxies for network access control or privacy.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5050
        condition: selection
      fields:
        - src_ip
        - bytes_in
        - bytes_out

  - question: What process established this SOCKS proxy connection?
    context: Understanding the application helps determine if this is legitimate software or malicious tunneling.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - 'ssh'
            - 'tor'
            - 'proxy'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage

  - question: What other proxy or tunneling activity occurred from this source?
    context: Multiple proxy connections may indicate systematic tunneling or C2 communication.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 1080
            - 8080
            - 9050
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: Has this proxy connection been used for data transfer?
    context: Successful proxy usage may indicate ongoing tunneled communication or data exfiltration.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 5050
        condition: selection
      fields:
        - bytes_in
        - bytes_out
        - duration

  - question: What network traffic patterns follow this SOCKS connection?
    context: Analyzing subsequent traffic reveals what services are being accessed through the proxy.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: What specific proxy software and configuration is being used?
    context: Different proxy implementations have varying security implications and legitimate use cases.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'SOCKS'
            - 'Proxy'
            - 'Tunnel'
        condition: selection
      fields:
        - alert.signature
        - alert.category

  - question: Are there signs of tunneled malicious activity?
    context: SOCKS proxies can be used to tunnel malicious traffic and evade network security controls.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - 'trojan'
            - 'malware'
            - 'command-and-control'
        condition: selection
      fields:
        - alert.signature
        - dst_ip

  - question: What authentication or access control bypasses occurred?
    context: Proxy connections may be used to bypass network access controls or authentication systems.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'Authentication'
            - 'Access'
            - 'Bypass'
        condition: selection
      fields:
        - alert.signature
        - dst_ip

  - question: Are other systems showing similar SOCKS proxy activity?
    context: Coordinated proxy usage may indicate a broader network compromise or policy violation.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'SOCKSv4'
        condition: selection
      fields:
        - src_ip
        - dst_ip

  - question: Is this part of a broader tunneling or evasion campaign?
    context: Understanding the scope helps identify systematic attempts to evade network security controls.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port|contains:
            - 1080
            - 5050
            - 8080
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - bytes_out