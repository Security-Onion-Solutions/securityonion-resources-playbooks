name: ET WEB_SPECIFIC_APPS NetVIOS Portal SQL Injection Attempt -- page.asp NewsID UPDATE
id: 22004163
description: |
  Detects SQL injection attempts targeting NetVIOS Portal's News page via UPDATE statements with SET clause in NewsID parameter.
  May trigger on legitimate content management operations or database maintenance activities involving UPDATE commands.
type: detection
detection_id: 2004163
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SQL UPDATE injection payload in the NewsID parameter?
    context: Understanding the UPDATE statement reveals what data the attacker is attempting to modify.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method

  - question: What specific database fields and values was the attacker attempting to update?
    context: Analyzing the SET clause helps determine if this targets user credentials, content, or system settings.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content

  - question: Is this legitimate content editing or administrative maintenance activity?
    context: Content managers and administrators may legitimately update news articles and database records.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/News/page.asp'
        condition: selection
      fields:
        - src_ip
        - user_agent.original

  - question: What other SQL modification attempts were made from this source IP?
    context: Multiple modification attempts indicate systematic database manipulation rather than isolated testing.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'SQL Injection'
            - 'UPDATE'
            - 'INSERT'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: What was the attack sequence leading to this UPDATE injection attempt?
    context: Understanding prior reconnaissance helps identify if this is targeted data modification or privilege escalation.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.request.method

  - question: Did the UPDATE operation execute successfully based on server responses?
    context: Successful updates may result in compromised content, altered user accounts, or system configuration changes.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.bytes

  - question: Was any critical data successfully modified in the database?
    context: Confirming data modification helps determine incident severity and integrity impact.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - url.full
        - http.response.bytes

  - question: What attack methodology was used for this UPDATE injection?
    context: Understanding attack tools and techniques helps identify threat actor capabilities and attribution.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - user_agent.original
        - http.request.referrer
        - http.request.headers

  - question: Are there signs of privilege escalation through database modification?
    context: UPDATE injections may target user accounts, permissions, or system settings to gain elevated access.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - 'admin'
            - 'user'
            - 'auth'
        condition: selection
      fields:
        - url.full
        - http.response.status_code

  - question: What specific news content or user data was targeted for modification?
    context: Understanding targeted data helps assess business impact and data integrity concerns.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: 'News'
        condition: selection
      fields:
        - url.path
        - url.query

  - question: Are other NetVIOS Portal systems experiencing similar UPDATE injection attacks?
    context: Coordinated modification attempts across multiple systems indicate a broader campaign targeting data integrity.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'NetVIOS Portal SQL Injection'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name