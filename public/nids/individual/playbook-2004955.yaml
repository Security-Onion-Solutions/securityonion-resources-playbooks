name: ET WEB_SPECIFIC_APPS Neuron Blog SQL Injection Attempt -- addcomment2.php comment SELECT
id: 22004955
description: |
  Detects SQL injection attempts targeting Neuron Blog's addcomment2.php script using SELECT statements.
  May trigger on legitimate database queries or security testing of the application.
type: detection
detection_id: 2004955
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SQL injection payload in the comment parameter?
    context: Understanding the exact payload reveals the attacker's intent and sophistication level.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - rule.name

  - question: What other parameters were included in the request to addcomment2.php?
    context: Additional parameters may reveal the attack vector and provide context for the injection attempt.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.method
        - url.query
        - http.request.headers

  - question: Is this part of normal blog commenting activity for this user?
    context: Legitimate users may submit comments containing SQL-like keywords in normal text.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/pages/addcomment2.php'
        condition: selection
      fields:
        - src_ip
        - url.full
        - http.request.method

  - question: Are there other SQL injection attempts from this source IP?
    context: Multiple injection attempts indicate active exploitation rather than accidental triggering.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'SQL Injection'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What was the sequence of requests leading to this injection attempt?
    context: Understanding the attack flow reveals reconnaissance and exploitation patterns.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path
        - http.request.method
        - http.response.status_code

  - question: Did the application respond with database errors or sensitive information?
    context: Error messages in responses can confirm successful injection and reveal database structure.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  - question: Has this Neuron Blog installation been targeted before?
    context: Previous attacks on the same application indicate ongoing targeting or vulnerability scanning.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'Neuron Blog'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the geolocation and reputation of the attacking IP?
    context: IP reputation and location help assess threat level and attribution.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: Are there successful authentication events after this injection attempt?
    context: Successful logins following injection may indicate compromised credentials or admin access.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - '200'
            - '302'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What other web applications on this server are being targeted?
    context: Attackers often scan multiple applications on the same server for vulnerabilities.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path
        - http.request.method

  - question: Are there similar SQL injection attempts across other web servers?
    context: Coordinated attacks may target multiple servers with the same vulnerability.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'SQL Injection'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name