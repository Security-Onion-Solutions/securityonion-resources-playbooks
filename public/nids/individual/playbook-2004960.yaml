name: ET WEB_SPECIFIC_APPS Neuron Blog SQL Injection Attempt -- addcomment2.php comment UPDATE
id: 22004960
description: |
  Detects SQL injection attempts targeting Neuron Blog's addcomment2.php script via UPDATE statements in the comment parameter.
  May trigger on legitimate comment submissions containing SQL-like keywords, but UPDATE statements in user input are typically malicious.
type: detection
detection_id: 2004960
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SQL injection payload in the comment parameter?
    context: Understanding the exact UPDATE statement reveals the attacker's intent and target database structure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method

  - question: What specific database tables or columns were targeted in the UPDATE statement?
    context: Analyzing the SQL syntax helps identify what data the attacker attempted to modify.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content

  # Type 2: Triage Assessment
  - question: Is this normal administrative activity for the Neuron Blog application?
    context: Legitimate blog administration may involve comment management, but UPDATE statements in user input are suspicious.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/pages/addcomment2.php'
        condition: selection
      fields:
        - src_ip
        - http.request.method
        - url.query

  - question: Does the source IP have a history of legitimate blog interactions?
    context: Established users may have different risk profiles than new or anonymous visitors.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 3: Activity Context
  - question: What other web requests occurred from this source IP around the same time?
    context: SQL injection attempts are often part of broader reconnaissance or exploitation campaigns.
    range: -30m/+30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code

  - question: Was this part of automated scanning or manual exploitation?
    context: User-Agent patterns and request timing help distinguish between automated tools and manual attacks.
    range: -15m/+15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.headers.user-agent
        - url.path
        - http.request.method

  # Type 4: Impact Assessment
  - question: Did the SQL injection attempt receive successful HTTP response codes?
    context: HTTP 200 responses may indicate successful injection, while errors suggest failed attempts.
    range: -5m/+5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.body.content

  - question: Were there any follow-up requests indicating successful database modification?
    context: Successful SQL injection may be followed by verification requests or further exploitation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code

  # Type 5: Forensic Deep-Dive
  - question: What SQL injection technique was used in the UPDATE statement?
    context: Different injection techniques indicate varying levels of sophistication and potential impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - http.request.body.content
        - url.query

  - question: Are there indicators of database enumeration or data exfiltration attempts?
    context: Attackers often follow UPDATE injections with SELECT statements to verify changes or extract data.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '.php'
        condition: selection
      fields:
        - url.full
        - http.request.body.content

  # Type 6: Enterprise Correlation
  - question: Are other web servers experiencing similar Neuron Blog SQL injection attempts?
    context: Coordinated attacks may target multiple instances of the same vulnerable application.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Neuron Blog'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this source IP targeting other web applications with SQL injection?
    context: Attackers often use automated tools to target multiple vulnerabilities across an organization.
    range: -6h/+6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'SQL Injection'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path