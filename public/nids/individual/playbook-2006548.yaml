name: ET WEB_SPECIFIC_APPS NetClassifieds Premium Edition SQL Injection Attempt -- ViewCat.php s_user_id UNION SELECT
id: 22006548
description: |
  Detects UNION-based SQL injection attempts targeting NetClassifieds Premium Edition ViewCat.php.
  UNION SELECT attacks are used to extract data from database tables beyond the original query scope.
type: detection
detection_id: 2006548
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete UNION SELECT payload structure?
    context: UNION SELECT syntax reveals the number of columns and data types being targeted for extraction.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - user_agent.original

  - question: Is this part of authorized database testing or penetration testing?
    context: Security assessments may include UNION SELECT tests to identify SQL injection vulnerabilities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - user_agent.original
        - url.path
        - http.request.method

  - question: What other UNION-based injection techniques has this attacker attempted?
    context: Understanding the full scope of SQL injection techniques reveals attacker sophistication.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'SQL'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.path

  - question: Did the application return database schema information or sensitive data?
    context: Successful UNION SELECT attacks often result in large response bodies containing extracted data.
    range: -5m/+5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/ViewCat.php'
          http.response.body.bytes: '>5000'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - url.query

  - question: What database tables are being targeted for data extraction?
    context: Understanding targeted tables helps assess the sensitivity of potentially compromised data.
    range: -30m/+30m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'NetClassifieds'
        condition: selection
      fields:
        - rule.name
        - payload_printable
        - url.query

  - question: Has the attacker successfully enumerated database structure?
    context: UNION SELECT attacks often progress from column counting to schema enumeration to data extraction.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'information_schema'
            - 'table_name'
            - 'column_name'
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - http.response.body.bytes

  - question: What error messages or database information was disclosed?
    context: Database error messages often reveal valuable information about schema and vulnerability details.
    range: -15m/+15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code: 500
        condition: selection
      fields:
        - url.full
        - http.response.body.bytes
        - http.response.status_code

  - question: Are there signs of data exfiltration following the injection attempt?
    context: Successful SQL injection may be followed by bulk data extraction or file downloads.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.body.bytes: '>50000'
        condition: selection
      fields:
        - url.full
        - http.response.body.bytes
        - http.request.method

  - question: What is the attack pattern timeline and progression?
    context: Understanding attack sequence helps determine if this is reconnaissance or active exploitation.
    range: -4h/+4h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category|contains: 'web-application-attack'
        condition: selection
      fields:
        - rule.name
        - url.path
        - timestamp

  - question: Has this vulnerability been exploited by multiple attackers?
    context: Popular vulnerabilities often attract multiple exploitation attempts from different threat actors.
    range: -7d/+7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'NetClassifieds'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - url.query

  - question: Are there other systems in the network running NetClassifieds?
    context: Identifying other potentially vulnerable instances of the same application for proactive protection.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.path|contains: 'ViewCat.php'
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - url.query