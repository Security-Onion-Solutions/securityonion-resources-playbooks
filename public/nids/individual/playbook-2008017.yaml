name: ET MALWARE Philis.J ICMP Sweep (Payload Hello World)
id: 22008017
description: |
  Detects ICMP packets containing "Hello,World" payload characteristic of Philis.J malware reconnaissance.
  May trigger on legitimate network testing tools using similar payloads.
type: detection
detection_id: 2008017
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact ICMP payload content and packet structure?
    context: Analyzing the complete packet helps confirm malware signature versus legitimate network testing.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - icmp.type
        - icmp.code
        - rule.name

  - question: Is this ICMP traffic part of legitimate network diagnostics or monitoring?
    context: Network administrators may use custom ping payloads for connectivity testing or monitoring.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  - question: What is the scope and pattern of ICMP sweep activity from this source?
    context: Malware often performs systematic network sweeps to identify active hosts for infection.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - icmp.type
        - icmp.code

  - question: Are there signs of malware infection or suspicious processes on the source system?
    context: Philis.J malware may exhibit other behavioral indicators beyond ICMP reconnaissance.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'MALWARE'
            - 'TROJAN'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  - question: What responses were received to these ICMP probe attempts?
    context: Response patterns help determine if the sweep successfully identified active targets.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          proto: 'icmp'
        condition: selection
      fields:
        - src_ip
        - icmp.type
        - icmp.code
        - bytes_toclient

  - question: Has this source IP been identified in other malware campaigns or threat intelligence?
    context: Philis.J infected systems may be part of larger botnets or malware distribution networks.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - threat.indicator.ip

  - question: What network services or vulnerabilities exist on systems that responded to the sweep?
    context: Understanding target capabilities helps assess potential for successful malware propagation.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - service

  - question: Are there file system changes or new processes indicating malware installation?
    context: Successful malware propagation may result in file drops or process execution on target systems.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What DNS queries or network connections followed the ICMP reconnaissance?
    context: Malware often performs DNS lookups or establishes C2 connections after host discovery.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Are other systems in the network exhibiting similar ICMP sweep behavior?
    context: Worm propagation may result in multiple infected systems performing reconnaissance activities.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.id: 2008017
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the geographic origin and infrastructure associated with the source IP?
    context: Understanding IP reputation and hosting provider helps assess threat actor attribution and blocking strategies.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - geoip.country_name
        - geoip.city_name
        - geoip.asn