name: ET TFTP Outbound TFTP Read Request
id: 22008120
description: |
  Detects outbound TFTP read requests from internal network to external hosts.
  TFTP is commonly used for legitimate network device configuration but can indicate
  data exfiltration, malware downloads, or unauthorized file transfers.
type: detection
detection_id: 2008120
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What file is being requested via TFTP?
    context: TFTP read requests contain the filename being retrieved, revealing the target asset.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - src_ip
        - dst_ip
        - dst_port

  - question: Is this TFTP request part of authorized network administration?
    context: Legitimate TFTP usage often occurs during scheduled maintenance windows or from known admin systems.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 69
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  - question: What network device or service is the source of this TFTP request?
    context: Identifying the requesting system helps determine if this is expected device behavior.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - app_proto

  - question: Are there other TFTP requests from this source system?
    context: Multiple TFTP requests may indicate bulk file transfer or systematic data exfiltration.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 69
        condition: selection
      fields:
        - dst_ip
        - community_id

  - question: What is the size and duration of the TFTP transfer?
    context: Large or long-duration transfers may indicate significant data movement requiring investigation.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: Has this external TFTP server been contacted before?
    context: New or unusual TFTP destinations may indicate malicious infrastructure or unauthorized services.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - src_ip
        - community_id

  - question: Are there DNS queries for the TFTP server destination?
    context: DNS lookups preceding TFTP requests may reveal domain names associated with the transfer.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - src_ip

  - question: What processes are running on the source system during this timeframe?
    context: Identifying active processes helps determine if TFTP request originated from legitimate software.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Are there file creation events related to TFTP activity?
    context: TFTP downloads typically result in file creation on the requesting system.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  - question: Is this part of a broader pattern of unusual network activity?
    context: TFTP requests may be part of larger attack campaigns involving multiple protocols or destinations.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - alert.category

  - question: Are other internal systems making similar TFTP requests?
    context: Multiple systems performing TFTP transfers may indicate lateral movement or coordinated data exfiltration.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - src_ip
        - bytes_toclient