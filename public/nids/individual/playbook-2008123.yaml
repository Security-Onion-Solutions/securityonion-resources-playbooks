name: ET MALWARE Likely Bot Username in IRC (XP-..)
id: 22008123
description: |
  Detects IRC connections with bot-like usernames starting with "XP-" pattern.
  This naming convention is commonly used by malware for C2 communications.
  May rarely trigger on legitimate IRC clients with similar naming patterns.
type: detection
detection_id: 2008123
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete IRC USER command and associated bot identifier?
    context: The full IRC registration sequence reveals bot family characteristics and configuration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - payload_printable
        - rule.name

  - question: Is this IRC connection from a system that should have IRC access?
    context: Corporate workstations typically should not have outbound IRC connections for business purposes.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 6667
            - 6668
            - 6669
            - 194
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What IRC channels did this bot attempt to join after registration?
    context: Bot IRC channels often reveal the malware family, campaign, or command structure.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 6667
            - 6668
            - 6669
        condition: selection
      fields:
        - community_id
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: What malware process initiated this IRC bot connection?
    context: Identifying the parent process helps determine infection vector and malware family.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "irc"
            - "6667"
            - "bot"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  - question: Are there other bot-related network connections from this system?
    context: Bots often use multiple C2 channels including HTTP, DNS, or other IRC servers.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "MALWARE"
            - "TROJAN"
            - "BOT"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - rule.category

  - question: What commands or files were downloaded via this IRC bot channel?
    context: IRC bots often receive commands to download additional malware or exfiltrate data.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - "\\Temp\\"
            - "\\Downloads\\"
            - ".exe"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  - question: What is the reputation and infrastructure of the IRC server?
    context: Malicious IRC servers often have poor reputation and may be part of bulletproof hosting.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - geoip.country_name
        - threat.indicator.type

  - question: Has this system shown other signs of malware infection recently?
    context: IRC bots are often secondary payloads delivered after initial system compromise.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "EXPLOIT"
            - "MALWARE"
            - "TROJAN"
        condition: selection
      fields:
        - rule.name
        - rule.category
        - count

  - question: Are other systems in the network connecting to the same IRC infrastructure?
    context: Botnet infections often spread laterally, creating multiple infected systems in the same network.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name: "ET MALWARE Likely Bot Username in IRC (XP-..)"
        condition: selection
      fields:
        - src_ip
        - count

  - question: What data exfiltration occurred through this IRC channel?
    context: IRC bots may exfiltrate sensitive data through direct messages or file transfers.
    range: +6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          bytes_toclient|gte: 1048576
        condition: selection
      fields:
        - bytes_toclient
        - duration
        - community_id

  - question: Has this IRC bot pattern been observed across the enterprise?
    context: Coordinated botnet campaigns often use similar naming patterns across multiple organizations.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name: "ET MALWARE Likely Bot Username in IRC (XP-..)"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - geoip.country_name
        - count