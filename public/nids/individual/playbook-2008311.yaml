name: ET SCAN Watchfire AppScan Web App Vulnerability Scanner
id: 22008311
description: |
  Detects IBM Security AppScan (formerly Watchfire) web application vulnerability scanner activity.
  AppScan performs automated security testing by sending specific fingerprinting requests.
  May indicate authorized security testing or unauthorized reconnaissance of web applications.
type: detection
detection_id: 2008311
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete AppScan fingerprinting request detected?
    context: The specific URI pattern confirms AppScan scanner activity and reveals the targeted web application.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.path
        - http.request.headers

  - question: What web server responded to the AppScan fingerprinting attempt?
    context: Server response reveals application details and may indicate successful reconnaissance or blocked scanning.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.headers
        - http.response.body.content
        - url.domain

  # Type 2: Triage Assessment
  - question: Is this AppScan activity from authorized security testing?
    context: Determines if scanning represents legitimate security assessment or unauthorized reconnaissance.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Does the scanning source IP belong to authorized security personnel?
    context: Internal or contracted security team IPs indicate legitimate testing versus external threat reconnaissance.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver

  - question: Is this scanning activity occurring during authorized testing windows?
    context: Scheduled security assessments typically occur during specific maintenance windows or business hours.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: attempted-recon
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port

  # Type 3: Activity Context
  - question: What other reconnaissance activity preceded this AppScan fingerprinting?
    context: Comprehensive scanning campaigns often include port scans and service enumeration before application testing.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver

  - question: Are there DNS queries indicating target enumeration from this source?
    context: Attackers often perform DNS reconnaissance to identify additional targets before focused application scanning.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What other web applications has this scanner targeted?
    context: Multiple application targets may indicate comprehensive security assessment or broad reconnaissance campaign.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path
        - http.request.method

  # Type 4: Impact Assessment
  - question: Did the AppScan fingerprinting reveal sensitive application information?
    context: Successful fingerprinting may expose application versions, technologies, and potential vulnerabilities.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.headers
        - http.response.body.bytes

  - question: Are there signs of follow-up exploitation attempts after fingerprinting?
    context: Successful reconnaissance often leads to targeted vulnerability exploitation requiring immediate response.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - web-application-attack
            - attempted-admin
        condition: selection
      fields:
        - rule.name
        - rule.category
        - url.path

  - question: Has this scanning activity triggered other security alerts?
    context: Multiple alerts from the same source indicate escalating threat activity requiring coordinated response.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  # Type 5: Forensic Deep-Dive
  - question: What is the complete scanning campaign timeline from this source?
    context: Full reconnaissance timeline helps understand attacker methodology and guides defensive improvements.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - attempted-recon
            - web-application-attack
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.path
        - community_id

  - question: What specific AppScan scanning techniques were employed beyond fingerprinting?
    context: Different AppScan modules reveal the comprehensiveness of security testing or reconnaissance scope.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: appscan
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - dst_ip

  # Type 6: Enterprise Correlation
  - question: Are other web applications across the enterprise being scanned by this source?
    context: Enterprise-wide scanning may indicate comprehensive security assessment or broad attack campaign.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: attempted-recon
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.domain

  - question: Is this part of coordinated reconnaissance from multiple sources?
    context: Multiple scanning sources may indicate distributed reconnaissance campaign requiring coordinated blocking.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: AppScan
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.category
        - community_id