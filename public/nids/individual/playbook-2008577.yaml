name: ET SCAN Voiper Fuzzing Scan
id: 22008577
description: |
  Detects Voiper toolkit performing SIP fuzzing attacks with test user agents.
  This tool sends malformed or excessive SIP requests to test service stability.
  Threshold triggers on 5+ attempts within 15 seconds indicating automated fuzzing.
type: detection
detection_id: 2008577
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the specific SIP fuzzing payload and test user agent detected?
    context: Analyzing the fuzzing content reveals the testing methodology and potential exploit attempts.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - app_proto
        - flow.pkts_toserver

  - question: What was the rate and pattern of SIP requests that triggered the threshold?
    context: Understanding fuzzing patterns helps determine tool configuration and testing approach.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - flow.pkts_toserver
        - bytes_toserver

  # Type 2: Triage Assessment
  - question: Is this source conducting authorized SIP stress testing or security assessment?
    context: Voiper fuzzing may be part of legitimate VoIP infrastructure testing or penetration testing.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - conn_state
        - bytes_toserver

  - question: Are there scheduled maintenance or testing activities for this VoIP system?
    context: Distinguishing between authorized testing and malicious denial of service attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - 'SCAN'
            - 'DOS'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - count

  # Type 3: Activity Context
  - question: What other VoIP testing or attack tools were used from this source before the fuzzing?
    context: Fuzzing often follows reconnaissance to target specific vulnerabilities discovered earlier.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'Voiper'
            - 'SIP'
            - 'VOIP'
            - 'SCAN'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.signature_id

  - question: Was this fuzzing attack coordinated with other network-based attacks?
    context: VoIP fuzzing may be part of broader denial of service or infrastructure disruption campaigns.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'DOS'
            - 'DDOS'
            - 'ATTACK'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: How long did the fuzzing campaign continue and what was the total volume?
    context: Extended fuzzing indicates persistent attempts to crash or compromise the SIP service.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - flow.start
        - bytes_toserver
        - flow.pkts_toserver

  # Type 4: Impact Assessment
  - question: Did the SIP service show signs of instability or degraded performance during fuzzing?
    context: Successful fuzzing may cause service crashes, memory exhaustion, or response delays.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - conn_state
        - duration

  - question: Are there indicators of successful exploitation or service compromise following the fuzzing?
    context: Fuzzing may identify vulnerabilities that lead to immediate exploitation attempts.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - 'EXPLOIT'
            - 'TROJAN'
            - 'SHELLCODE'
        condition: selection
      fields:
        - rule.name
        - rule.category

  # Type 5: Forensic Deep-Dive
  - question: What specific SIP vulnerabilities or weaknesses was this fuzzing designed to identify?
    context: Different fuzzing patterns target specific SIP implementation flaws or protocol weaknesses.
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'SIP'
            - 'VOIP'
            - 'overflow'
            - 'buffer'
        condition: selection
      fields:
        - rule.name
        - rule.signature_id

  - question: What is the source infrastructure and attribution profile for this fuzzing attack?
    context: Understanding attacker infrastructure helps assess threat sophistication and potential attribution.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - geoip.country_name
        - geoip.asn
        - geoip.city_name

  # Type 6: Enterprise Correlation
  - question: Are other VoIP systems across our network experiencing similar fuzzing attacks?
    context: Coordinated fuzzing indicates systematic attempts to destabilize communication infrastructure.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.signature_id: 2008577
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - count

  - question: Is this VoIP fuzzing part of broader infrastructure disruption targeting our organization?
    context: VoIP attacks often coincide with other service disruption attempts for maximum impact.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category|contains:
            - 'DOS'
            - 'DDOS'
            - 'SCAN'
          dst_port|contains:
            - 22
            - 80
            - 443
            - 5060
            - 5061
        condition: selection
      fields:
        - src_ip
        - dst_port
        - rule.name