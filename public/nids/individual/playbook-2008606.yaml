name: ET SCAN Enumiax Inter-Asterisk Exchange Protocol Username Scan
id: 22008606
description: |
  Detects Enumiax tool performing username enumeration scans against IAX2 (Inter-Asterisk Exchange) protocol on port 4569.
  This reconnaissance activity attempts to identify valid usernames on Asterisk PBX systems.
  May trigger on legitimate IAX2 registration attempts or administrative testing.
type: detection
detection_id: 2008606
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What specific IAX2 username enumeration pattern was detected?
    context: Understanding the enumeration technique reveals the scope and sophistication of the reconnaissance attempt.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: Is this IAX2 traffic part of legitimate VoIP administration?
    context: Authorized administrators may perform IAX2 configuration testing that could trigger this alert.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 4569
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received
        - network.packets

  - question: What is the pattern and frequency of scanning attempts from this source?
    context: Systematic scanning attempts indicate malicious reconnaissance versus isolated legitimate connections.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 4569
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.packets

  - question: Are there other VoIP-related reconnaissance activities from this source?
    context: Attackers often perform comprehensive VoIP infrastructure reconnaissance beyond just IAX2 enumeration.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 5060
            - 5061
            - 4569
            - 2000
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent

  - question: Has the scanning source attempted authentication against the Asterisk system?
    context: Username enumeration is often followed by password brute-force attacks against discovered accounts.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 4569
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received
        - network.packets

  - question: Are there signs of successful VoIP system compromise or unauthorized access?
    context: Successful enumeration may lead to unauthorized call routing, eavesdropping, or toll fraud.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'SIP'
            - 'IAX'
            - 'VoIP'
            - 'Asterisk'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category

  - question: What is the geographic and reputation profile of the scanning source?
    context: VoIP attacks often originate from specific geographic regions or known malicious infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.resolved_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name

  - question: Are other VoIP systems in the network being targeted by the same source?
    context: Attackers often perform network-wide VoIP reconnaissance to identify all vulnerable systems.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 4569
            - 5060
            - 5061
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent

  - question: Is this part of broader network reconnaissance or port scanning activity?
    context: VoIP enumeration may be part of comprehensive network reconnaissance targeting multiple services.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'SCAN'
            - 'reconnaissance'
            - 'enumeration'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: Are there indicators of automated scanning tools or botnets?
    context: VoIP enumeration attacks are often automated and may originate from compromised systems or botnets.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent