name: ET MALWARE Gimmiv Infection Ping Outbound
id: 22008726
description: |
  Detects Gimmiv malware performing infection validation ping with distinctive payload.
  This trojan uses ICMP pings with specific content to verify successful infection.
  Indicates active malware infection with covert communication channel establishment.
type: detection
detection_id: 2008726
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete ICMP payload containing the Gimmiv infection signature?
    context: Analyzing the distinctive "abcde12345fghij6789" payload confirms Gimmiv malware presence.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - icmp.type
        - icmp.code

  - question: What is the timing and frequency of these infection validation pings?
    context: Understanding the ping pattern reveals the malware's communication schedule and persistence.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - packet_info.length
        - flow.bytes_toserver
        - icmp.id

  # Type 2: Triage Assessment
  - question: Is this ICMP traffic from a known malware analysis or research environment?
    context: Security researchers may intentionally execute Gimmiv malware for analysis purposes.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - "sandbox"
            - "analysis"
            - "vm"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine

  - question: Does the infected system show signs of authorized security testing?
    context: Penetration testers may deploy trojans to demonstrate covert communication capabilities.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  # Type 3: Activity Context
  - question: What process initiated the ICMP ping from the infected system?
    context: Identifying the source process reveals the malware's execution context and parent application.
    range: -5m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "ping"
            - "icmp"
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What network activity preceded this Gimmiv infection ping?
    context: Previous connections may reveal the initial infection vector or C&C communication.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 4: Impact Assessment
  - question: Did the target system respond to the Gimmiv infection ping?
    context: ICMP responses may indicate successful infection validation or C&C server acknowledgment.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          protocol: ICMP
        condition: selection
      fields:
        - icmp.type
        - icmp.code
        - bytes_toclient

  - question: Are there signs of additional malware communication or payload delivery?
    context: Successful infection validation may trigger additional malware downloads or C&C communication.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
            - 8080
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  # Type 5: Forensic Deep-Dive
  - question: What files were created or modified around the time of Gimmiv execution?
    context: Gimmiv installation involves file system changes that reveal persistence and payload mechanisms.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.extension|contains:
            - "exe"
            - "dll"
            - "tmp"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What registry modifications indicate Gimmiv persistence mechanisms?
    context: Trojans typically create registry entries for persistence and configuration storage.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "Run"
            - "RunOnce"
            - "Services"
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: Are there other malware families or attack tools present on this system?
    context: Compromised systems often host multiple malware families or serve as attack platforms.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "A Network Trojan was detected"
            - "Attempted Administrator Privilege Gain"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - alert.severity

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar Gimmiv infection ping patterns?
    context: Enterprise-wide Gimmiv infections indicate coordinated malware campaign or lateral movement.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature_id: 2008726
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature