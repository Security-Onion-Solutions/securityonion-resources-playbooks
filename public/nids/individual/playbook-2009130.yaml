name: ET MALWARE Overtoolbar.net Backdoor ICMP Checkin Request
id: 22009130
description: |
  Detects Overtoolbar.net backdoor sending ICMP checkin request with "Echo This" payload.
  This backdoor uses ICMP for covert command and control communication.
  Indicates active backdoor infection with established covert communication channel.
type: detection
detection_id: 2009130
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete ICMP checkin request payload from the Overtoolbar backdoor?
    context: Analyzing the "Echo This" payload confirms backdoor presence and communication pattern.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - icmp.type
        - icmp.code

  - question: What is the ICMP packet structure and timing of the backdoor checkin?
    context: Understanding packet details reveals the backdoor's communication protocol and scheduling.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - packet_info.length
        - icmp.id
        - icmp.sequence

  # Type 2: Triage Assessment
  - question: Is this ICMP communication from a known malware analysis environment?
    context: Security researchers may intentionally execute Overtoolbar backdoors for analysis purposes.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - "sandbox"
            - "analysis"
            - "research"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine

  - question: Does the infected system show signs of authorized penetration testing?
    context: Penetration testers may use backdoors to demonstrate covert communication capabilities.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  # Type 3: Activity Context
  - question: What process initiated the ICMP checkin from the infected system?
    context: Identifying the source process reveals the backdoor's execution context and installation method.
    range: -5m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "ping"
            - "icmp"
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What network activity preceded this backdoor checkin attempt?
    context: Previous connections may reveal the initial infection vector or C&C infrastructure.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 4: Impact Assessment
  - question: Did the C&C server respond to the Overtoolbar backdoor checkin?
    context: C&C responses may contain commands for data theft, lateral movement, or additional payload delivery.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          protocol: ICMP
        condition: selection
      fields:
        - icmp.type
        - icmp.code
        - bytes_toclient

  - question: Are there signs of command execution or data exfiltration following the checkin?
    context: Active backdoors often receive commands for system reconnaissance or data theft.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  # Type 5: Forensic Deep-Dive
  - question: What files were created or modified during Overtoolbar backdoor installation?
    context: Backdoor installation involves file system changes that reveal persistence mechanisms.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.extension|contains:
            - "exe"
            - "dll"
            - "bat"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What registry modifications indicate backdoor persistence mechanisms?
    context: Backdoors typically create registry entries for persistence and configuration storage.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "Run"
            - "RunOnce"
            - "Services"
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: Are there other backdoors or malware components on this system?
    context: Compromised systems often host multiple malware families or attack tools.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "A Network Trojan was detected"
            - "Attempted Administrator Privilege Gain"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - alert.severity

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar Overtoolbar backdoor ICMP communication?
    context: Enterprise-wide backdoor infections indicate coordinated attack campaign or lateral movement.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature_id: 2009130
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature