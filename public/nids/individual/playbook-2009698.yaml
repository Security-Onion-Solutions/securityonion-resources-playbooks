name: ET VOIP INVITE Message Flood UDP
id: 22009698
description: |
  Detects SIP INVITE message flooding over UDP indicating potential VoIP denial of service attack.
  Triggers when 100+ INVITE messages from same source within 60 seconds exceed normal call patterns.
  May trigger during legitimate high-volume VoIP testing or call center peak operations.
type: detection
detection_id: 2009698
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the UDP SIP INVITE flood pattern and message structure?
    context: Analyzing UDP-based INVITE floods reveals attack methodology and VoIP protocol abuse.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - flow_id
        - app_proto
  - question: Is this UDP SIP traffic consistent with legitimate VoIP call patterns?
    context: Distinguishing between normal UDP SIP usage and malicious flooding attacks.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration
  - question: What is the attack source and infrastructure behind the UDP SIP flood?
    context: Understanding attacker capabilities and infrastructure for blocking and attribution.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
  - question: How is the VoIP system responding to the UDP INVITE flood?
    context: Assessing service degradation and determining attack effectiveness.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - bytes_toserver
        - src_port
        - duration
  - question: Are there concurrent TCP and UDP SIP attacks from the same source?
    context: Identifying multi-protocol attack strategies targeting VoIP infrastructure.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'VOIP'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - app_proto
  - question: What legitimate VoIP services are being impacted by this UDP flood?
    context: Understanding business impact and prioritizing VoIP service protection measures.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - ip_protocol
        - bytes_toclient
  - question: Has this attacker targeted other UDP-based VoIP systems in the network?
    context: Assessing campaign scope and identifying additional vulnerable VoIP infrastructure.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there DNS queries suggesting VoIP infrastructure reconnaissance?
    context: Determining if the attack was preceded by systematic VoIP service discovery.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
  - question: What is the timing and intensity pattern of the UDP SIP flood?
    context: Analyzing attack characteristics helps develop appropriate rate limiting and mitigation.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there other UDP-based VoIP attacks occurring across the enterprise?
    context: Identifying broader VoIP attack campaigns and coordinated infrastructure targeting.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'INVITE'
            - 'UDP'
            - 'VOIP'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
  - question: How does this UDP flood compare to normal VoIP call volume patterns?
    context: Establishing baseline behavior helps tune detection thresholds and reduce false positives.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration