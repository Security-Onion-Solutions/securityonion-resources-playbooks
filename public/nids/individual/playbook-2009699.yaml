name: ET VOIP REGISTER Message Flood UDP
id: 22009699
description: |
  Detects SIP REGISTER message flooding over UDP indicating potential VoIP registration DoS attack.
  Triggers when 100+ REGISTER messages from same source within 60 seconds exceed normal patterns.
  May trigger during legitimate SIP phone reconnection events or bulk device provisioning.
type: detection
detection_id: 2009699
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the UDP SIP REGISTER flood pattern and message content?
    context: Analyzing UDP-based REGISTER floods reveals attack methodology and VoIP protocol abuse.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - flow_id
        - app_proto
  - question: Is this UDP REGISTER traffic consistent with legitimate VoIP phone behavior?
    context: Distinguishing between normal SIP phone registration and malicious flooding attacks.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration
  - question: What is the attack source and infrastructure behind the UDP REGISTER flood?
    context: Understanding attacker capabilities and network infrastructure for blocking efforts.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
  - question: How is the SIP registrar handling the UDP registration flood?
    context: Assessing service impact and determining attack effectiveness against VoIP infrastructure.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - bytes_toserver
        - src_port
        - duration
  - question: Are there concurrent TCP and UDP REGISTER attacks from the same source?
    context: Identifying multi-protocol attack strategies targeting SIP registration services.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'REGISTER'
            - 'VOIP'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - app_proto
  - question: What legitimate VoIP registration services are being impacted?
    context: Understanding business impact on phone registration and VoIP service availability.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - ip_protocol
        - bytes_toclient
  - question: Has this attacker targeted other UDP SIP registrars in the network?
    context: Assessing campaign scope and identifying additional vulnerable VoIP registration points.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there DNS queries suggesting VoIP registrar reconnaissance?
    context: Determining if the attack was preceded by systematic SIP service discovery.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
  - question: What is the timing and intensity pattern of the UDP REGISTER flood?
    context: Analyzing attack characteristics helps implement appropriate UDP rate limiting.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
  - question: Are there authentication responses indicating credential attacks alongside the flood?
    context: Understanding if the attack combines registration DoS with credential brute forcing.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'Unauthorized'
            - 'Authentication'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category
  - question: How does this UDP REGISTER flood compare to normal phone registration volume?
    context: Establishing baseline behavior helps tune detection and accommodate legitimate bulk registrations.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
          ip_protocol: 'UDP'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration