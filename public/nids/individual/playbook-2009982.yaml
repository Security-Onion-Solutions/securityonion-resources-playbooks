name: ET FTP Possible FTP Daemon Username DELETE FROM SQL Injection Attempt
id: 22009982
description: |
  Detects SQL injection attempts targeting FTP daemon username fields using DELETE FROM syntax.
  May indicate attempts to exploit vulnerable FTP applications with database backends for data destruction.
  Could be legitimate testing or malicious exploitation targeting data integrity.
type: detection
detection_id: 2009982
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete DELETE FROM SQL injection payload in the FTP username field?
    context: Understanding the exact deletion syntax reveals attacker intent to destroy or manipulate database records.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - alert.signature
        - flow_id
  - question: Is this authorized database testing or legitimate administrative activity?
    context: DELETE operations may be part of legitimate database maintenance or security testing procedures.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 21
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - flow.state
  - question: What other destructive SQL injection techniques were attempted against this service?
    context: Multiple destructive injection methods indicate systematic data destruction attempts requiring immediate response.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "DELETE"
            - "DROP"
            - "TRUNCATE"
        condition: selection
      fields:
        - alert.signature
        - dst_port
  - question: Did the FTP service respond indicating successful or failed deletion attempts?
    context: Service responses reveal whether destructive SQL injection succeeded and caused data loss.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 21
        condition: selection
      fields:
        - bytes_toclient
        - flow.state
        - community_id
  - question: What was the FTP session context leading to the SQL injection attempt?
    context: Understanding session flow helps determine if injection was targeted or part of broader attack sequence.
    range: -5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 21
        condition: selection
      fields:
        - bytes_toserver
        - flow.state
        - community_id
  - question: Are there signs of successful data deletion or database corruption?
    context: Successful DELETE injection may cause data loss requiring immediate backup restoration and forensic analysis.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "Database"
            - "Error"
            - "Failure"
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_port
  - question: What other applications or databases were targeted with destructive SQL injection?
    context: Multiple targets indicate coordinated data destruction campaign requiring enterprise-wide assessment.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "DELETE"
            - "SQL Injection"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Did the attacker attempt to cover tracks or establish persistence after injection?
    context: Post-exploitation activities indicate sophisticated attack requiring comprehensive incident response.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "Attempted Administrator Privilege Gain"
            - "Trojan Activity"
            - "Policy Violation"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Are there indicators of database backend service disruption or failure?
    context: Successful destructive injection may cause service outages requiring immediate restoration efforts.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          flow.state: "closed"
        condition: selection
      fields:
        - dst_port
        - flow.reason
        - src_ip
  - question: Is this destructive SQL injection part of a coordinated attack campaign?
    context: Enterprise-wide destructive attacks indicate advanced threat actors requiring immediate threat intelligence sharing.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "FTP Daemon Username DELETE FROM SQL Injection"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.name