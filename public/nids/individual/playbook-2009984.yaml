name: ET FTP Possible FTP Daemon Username UPDATE SET SQL Injection Attempt
id: 22009984
description: |
  Detects SQL injection attempts targeting FTP daemon username fields using UPDATE SET syntax.
  May indicate attempts to exploit vulnerable FTP applications with database backends for data modification.
  Could be legitimate testing or malicious exploitation targeting existing records and authentication credentials.
type: detection
detection_id: 2009984
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete UPDATE SET SQL injection payload in the FTP username field?
    context: Understanding the exact update syntax reveals attacker intent to modify existing database records or credentials.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - alert.signature
        - flow_id
  - question: Is this authorized database maintenance or legitimate credential update activity?
    context: UPDATE operations may be part of legitimate database administration or password reset procedures.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 21
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - flow.state
  - question: What other record modification SQL injection techniques were attempted?
    context: Multiple modification methods indicate systematic database manipulation requiring immediate security assessment.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "UPDATE"
            - "ALTER"
            - "SQL Injection"
        condition: selection
      fields:
        - alert.signature
        - dst_port
  - question: Did the FTP service respond indicating successful or failed update attempts?
    context: Service responses reveal whether malicious record modification succeeded and compromised data integrity.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 21
        condition: selection
      fields:
        - bytes_toclient
        - flow.state
        - community_id
  - question: What was the target of the UPDATE operation based on the injection pattern?
    context: Understanding update targets helps determine if passwords, privileges, or other critical data were modified.
    range: -5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 21
        condition: selection
      fields:
        - bytes_toserver
        - flow.state
        - community_id
  - question: Are there signs of successful credential modification or privilege escalation?
    context: Successful UPDATE injection may compromise authentication systems requiring immediate password resets.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "Authentication"
            - "Password"
            - "Administrator"
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_port
  - question: What other systems were targeted with UPDATE-based SQL injection attacks?
    context: Multiple targets indicate coordinated credential compromise campaign requiring enterprise-wide password resets.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "UPDATE"
            - "SQL Injection"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Did the attacker attempt to authenticate with potentially modified credentials?
    context: Post-injection authentication attempts indicate successful credential modification requiring immediate response.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 21
          flow.state: "established"
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - flow.age
  - question: Are there indicators of database backend integrity compromise?
    context: Successful record modification may compromise database consistency requiring forensic analysis and restoration.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "Database"
            - "Integrity"
            - "Corruption"
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_port
  - question: Is this UPDATE injection attempt part of a coordinated credential compromise campaign?
    context: Enterprise-wide credential modification attacks indicate advanced threat actors requiring immediate threat response.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "FTP Daemon Username UPDATE SET SQL Injection"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.name