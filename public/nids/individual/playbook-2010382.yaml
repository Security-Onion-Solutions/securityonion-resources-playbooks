name: ET MALWARE Fake AV GET
id: 22010382
description: |
  Detects fake antivirus (scareware) malware communication via HTTP GET requests.
  This malware displays false security warnings to trick users into purchasing fake software.
  May trigger on legitimate affiliate marketing or analytics platforms using similar parameters.
type: detection
detection_id: 2010382
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete fake AV communication URL with affiliate parameters?
    context: The URL structure reveals the scareware campaign tracking and monetization scheme.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - url.path
        - http.request.method

  - question: What affiliate and sub-affiliate IDs were used in this fake AV campaign?
    context: These parameters identify the specific scareware distribution network and revenue sharing.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.headers
        - http.request.referrer

  - question: Is this system authorized to access affiliate marketing or analytics platforms?
    context: Legitimate marketing tools may use similar parameter structures for tracking.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - "affid"
            - "subid"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path

  - question: What process or browser initiated this fake AV communication?
    context: Understanding the execution context helps determine if this is malware or legitimate activity.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid
        - User

  - question: What network traffic patterns indicate fake AV payload delivery?
    context: Scareware often downloads additional components or fake security software.
    range: -15m/+30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - community_id
        - network.bytes_received

  - question: Has the system downloaded fake antivirus software or related payloads?
    context: Successful downloads indicate active scareware infection requiring user education and cleanup.
    range: -30m/+2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - http.response.body.bytes
        - url.full
        - http.response.mime_type

  - question: What executable files were created that might be fake security software?
    context: Fake AV malware creates executable files masquerading as legitimate security tools.
    range: +15m/+4h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - ".exe"
            - "antivirus"
            - "security"
            - "scanner"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256
        - ProcessGuid

  - question: Are there signs of fake security warnings or pop-ups being displayed?
    context: Scareware displays deceptive security alerts to manipulate users into purchasing fake software.
    range: +15m/+2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "warning"
            - "infected"
            - "virus"
            - "malware"
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What registry modifications indicate fake AV installation or persistence?
    context: Fake antivirus software modifies registry entries to appear legitimate and maintain persistence.
    range: +15m/+2h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "Run"
            - "Uninstall"
            - "Security"
            - "Antivirus"
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessGuid

  - question: Are other systems in the network showing similar fake AV activity?
    context: Scareware campaigns often target multiple users through web browsing or email attachments.
    range: -24h/+1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "Fake AV"
            - "Scareware"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What DNS queries were made to resolve fake AV distribution domains?
    context: DNS patterns help identify the complete scareware distribution infrastructure.
    range: -1h/+1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name