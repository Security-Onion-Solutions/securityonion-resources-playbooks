name: ET WEB_SPECIFIC_APPS ClarkConnect Linux proxy.php XSS Attempt
id: 22010602
description: |
  Detects cross-site scripting (XSS) attempts against ClarkConnect Linux proxy.php script.
  Attackers inject malicious scripts via the url parameter to execute code in victim browsers.
  May trigger during legitimate testing or security scanning of web applications.
type: detection
detection_id: 2010602
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact XSS payload detected in the proxy.php request?
    context: Analyzing the malicious script injection reveals attack sophistication and intended impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method
  - question: Is this XSS attempt part of legitimate security testing or scanning?
    context: Distinguishing between authorized penetration testing and malicious exploitation attempts.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 82
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
  - question: What web browser or tool was used to perform the XSS attack?
    context: Understanding attack tools helps identify automated scanning versus targeted exploitation.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - url.full
        - http.request.method
  - question: How did the ClarkConnect proxy application respond to the XSS attempt?
    context: Assessing if the application is vulnerable and if the attack was successful.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers.content_type
  - question: Are there other web application attacks targeting this ClarkConnect system?
    context: Identifying coordinated attacks against multiple vulnerabilities in the same application.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'WEB_SPECIFIC_APPS'
            - 'ClarkConnect'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - url.path
  - question: What other web applications on this system are being targeted?
    context: Understanding the scope of web application reconnaissance and attack activity.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
  - question: Has this attacker successfully exploited any web vulnerabilities?
    context: Assessing if XSS attempts have led to successful compromise or data theft.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - url.full
        - http.response.body.content
        - http.request.body.content
  - question: Are there signs of session hijacking or credential theft following the XSS?
    context: Determining if successful XSS led to session compromise or further exploitation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.headers.cookie
        - http.request.headers.authorization
        - url.full
  - question: Has this XSS attack source targeted other web applications in the network?
    context: Assessing campaign scope and identifying additional vulnerable web applications.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.request.method
  - question: Are there DNS queries indicating web application reconnaissance?
    context: Understanding if XSS attacks were preceded by systematic web application discovery.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
  - question: What is the geographic and infrastructure origin of this XSS attack?
    context: Understanding attacker infrastructure helps with blocking and attribution efforts.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 82
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient