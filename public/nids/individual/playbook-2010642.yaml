name: ET SCAN Multiple FTP Root Login Attempts from Single Source - Possible Brute Force Attempt
id: 22010642
description: |
  Detects multiple FTP root login attempts from a single source IP within 60 seconds.
  May indicate brute force attacks against FTP services or legitimate administrative access.
  Threshold triggers on 5 or more attempts within the time window.
type: detection
detection_id: 2010642
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact sequence of FTP root login attempts detected?
    context: Understanding the login attempt pattern helps distinguish between brute force attacks and legitimate access issues.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - alert.signature
        - flow_id
  - question: Is this a legitimate administrator attempting to access FTP services?
    context: Root FTP access may be part of normal system administration or automated backup processes.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 21
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient
        - flow.state
  - question: What other FTP servers has this source attempted to access with root credentials?
    context: Multiple target servers indicate systematic brute force campaigns rather than isolated access issues.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 21
        condition: selection
      fields:
        - dst_ip
        - flow.state
        - bytes_toserver
  - question: Were any of the root login attempts successful?
    context: Successful authentication indicates potential compromise and requires immediate response.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 21
          flow.state: "established"
        condition: selection
      fields:
        - bytes_toclient
        - flow.age
        - community_id
  - question: What was the timing pattern and frequency of login attempts?
    context: Rapid automated attempts versus slower manual attempts help identify attack methodology.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: "FTP Root Login"
        condition: selection
      fields:
        - alert.signature
        - flow_id
  - question: Are there signs of successful FTP session activity after login attempts?
    context: Post-authentication activity indicates successful compromise and potential data access.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 21
          bytes_toclient|gte: 1000
        condition: selection
      fields:
        - bytes_toclient
        - bytes_toserver
        - flow.age
  - question: What other brute force or credential attacks originated from this source?
    context: Multiple attack types indicate broader malicious campaign requiring comprehensive response.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "Brute Force"
            - "Login"
            - "Authentication"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Did the FTP server implement any defensive measures against the brute force attempt?
    context: Server response patterns indicate security controls and potential attack success.
    range: +10m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 21
        condition: selection
      fields:
        - flow.state
        - bytes_toclient
        - flow.reason
  - question: Are there indicators of lateral movement or privilege escalation after FTP access?
    context: Successful FTP compromise often leads to further system exploitation and network traversal.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "Attempted Administrator Privilege Gain"
            - "Attempted User Privilege Gain"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port
  - question: Is this brute force activity part of a coordinated campaign across multiple systems?
    context: Enterprise-wide brute force attempts indicate sophisticated threat actors requiring coordinated response.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "FTP Root Login Attempts"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.name