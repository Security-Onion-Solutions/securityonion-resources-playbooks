name: ET SCAN ICMP =XXXXXXXX Likely Precursor to Scan
id: 22010686
description: |
  Detects ICMP ping packets containing the specific pattern "=XXXXXXXX" used for network reconnaissance.
  This pattern is commonly used by scanning tools to identify responsive hosts before launching targeted attacks.
  Legitimate ICMP traffic would not contain this specific reconnaissance marker.
type: detection
detection_id: 2010686
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete ICMP payload containing the scanning pattern?
    context: Understanding the full ICMP packet structure reveals the specific scanning tool and reconnaissance methodology.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - icmp.type
        - icmp.code

  - question: What specific ICMP packet characteristics were used in this reconnaissance probe?
    context: ICMP packet analysis helps identify the scanning tool signature and potential follow-up attack vectors.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - proto
        - orig_bytes
        - resp_bytes

  # Type 2: Triage Assessment
  - question: Is this ICMP traffic from authorized network monitoring or diagnostic tools?
    context: Legitimate network administration tools typically use standard ICMP patterns, not reconnaissance markers.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - orig_bytes
        - resp_bytes
        - conn_state

  - question: Does this scanning activity occur during normal business hours or maintenance windows?
    context: Timing analysis helps distinguish between authorized network diagnostics and malicious reconnaissance.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category: 'network-scan'
        condition: selection
      fields:
        - dst_ip
        - rule.name

  # Type 3: Activity Context
  - question: What other scanning activities originated from this source address?
    context: Additional scanning reveals broader reconnaissance campaign and attack preparation activities.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: 'network-scan'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - rule.name

  - question: Were there port scans against the target host after this ICMP reconnaissance?
    context: Follow-up port scanning confirms this ICMP probe was reconnaissance for targeted attacks.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - conn_state
        - orig_bytes
        - resp_bytes

  - question: What DNS queries were made before this scanning activity?
    context: DNS reconnaissance helps identify targeted network ranges and attack preparation activities.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip

  - question: How many hosts responded to this ICMP reconnaissance probe?
    context: Response patterns reveal the scope of live hosts identified for potential targeting.
    range: -15m/+15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - resp_bytes
        - conn_state

  # Type 4: Impact Assessment
  - question: Were any successful connections established to hosts after this reconnaissance?
    context: Successful connections indicate potential compromise following the initial reconnaissance phase.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          conn_state: 'SF'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - duration
        - orig_bytes
        - resp_bytes

  - question: Are there signs of exploitation attempts against responsive hosts?
    context: Exploitation attempts confirm the reconnaissance was successful in identifying vulnerable targets.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'exploit'
            - 'attack'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - rule.category

  # Type 5: Forensic Deep-Dive
  - question: What is the geographical origin and reputation of the scanning source address?
    context: Source attribution helps determine if this is targeted reconnaissance or opportunistic scanning.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - orig_bytes
        - resp_bytes

  - question: What specific network ranges or subnets were targeted in this reconnaissance campaign?
    context: Target analysis reveals the attacker's network knowledge and potential insider information.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - resp_bytes

  # Type 6: Enterprise Correlation
  - question: Are other external sources conducting similar ICMP reconnaissance against our network?
    context: Multiple scanning sources indicate coordinated reconnaissance or widespread targeting campaigns.
    range: -24h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'ICMP'
          rule.category: 'network-scan'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Have there been any network scanning alerts across the enterprise recently?
    context: Related scanning alerts help assess overall network security posture and attack patterns.
    range: -7d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: 'network-scan'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.category