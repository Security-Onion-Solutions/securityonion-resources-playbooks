name: ET WEB_SPECIFIC_APPS e107 CMS backdoor access admin-access cookie and HTTP POST
id: 22010719
description: |
  Detects HTTP POST requests with admin-access cookie targeting e107 CMS backdoor functionality.
  May trigger on legitimate administrative access with similar cookie patterns.
type: detection
detection_id: 2010719
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the complete HTTP request including headers and POST data?
    context: Analyzing the full request reveals the specific backdoor commands or administrative actions being attempted.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content
        - user_agent.original

  - question: Is this admin-access cookie associated with legitimate e107 CMS administration?
    context: Valid administrators may use similar cookie patterns for legitimate CMS management activities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: 'GET'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user_agent.original

  - question: What is the source and authentication context of this request?
    context: Understanding request origin helps distinguish between authorized admin access and malicious exploitation.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What e107 CMS files or functions are being accessed via this backdoor?
    context: Identifying targeted CMS components helps assess the scope of potential compromise and data access.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - http.response.status_code

  - question: Are there signs of successful backdoor exploitation or data exfiltration?
    context: Successful backdoor access may result in file uploads, database queries, or sensitive data retrieval.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          bytes_toclient|gte: 10000
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - bytes_toserver
        - bytes_toclient

  - question: What other web application attacks or reconnaissance originated from this IP?
    context: Backdoor exploitation often follows broader web application scanning and vulnerability assessment.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'WEB_SPECIFIC_APPS'
            - 'WEB_APPLICATION_ATTACK'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.path

  - question: Has this IP been associated with other CMS exploitation attempts or malware campaigns?
    context: Attackers often target multiple CMS platforms and may be part of broader web application attack campaigns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'CMS'
            - 'backdoor'
            - 'admin'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: What file system changes occurred on the web server following this request?
    context: Successful backdoor access may result in malicious file uploads, configuration changes, or additional backdoor installation.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type
        - User

  - question: Are there process execution events indicating web shell or backdoor activation?
    context: Backdoor exploitation may trigger process execution for system commands or additional malware deployment.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - 'cmd.exe'
            - 'powershell.exe'
            - 'sh'
            - 'bash'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What is the geographic and infrastructure profile of the attacking IP?
    context: Understanding attacker infrastructure helps with attribution and blocking strategies for similar threats.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - geoip.country_name
        - geoip.city_name
        - geoip.asn
        - threat.indicator.ip

  - question: Are other web servers in the organization being targeted with similar backdoor attempts?
    context: Coordinated attacks may target multiple e107 installations or similar CMS platforms across the enterprise.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.id: 2010719
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path