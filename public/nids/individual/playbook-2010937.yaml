name: ET SCAN Suspicious inbound to mySQL port 3306
id: 22010937
description: |
  Detects multiple inbound connection attempts to MySQL database port 3306 from external sources.
  May indicate reconnaissance, brute force attacks, or legitimate database access attempts.
type: detection
detection_id: 2010937
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the exact source IP and connection pattern triggering this alert?
    context: Understanding the connection metadata reveals the nature of the scanning activity.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - rule.name

  - question: How many connection attempts were made in the detection window?
    context: The threshold count indicates the intensity of the MySQL scanning activity.
    range: -2m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 3306
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  # Type 2: Triage Assessment
  - question: Is this source IP authorized to access MySQL databases?
    context: Legitimate applications or database administrators may connect from known sources.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 3306
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - connection_state

  - question: Are there established connections from this source to MySQL?
    context: Successful connections may indicate legitimate access or successful compromise.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 3306
          connection_state: established
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - connection_duration
        - bytes_sent
        - bytes_received

  # Type 3: Activity Context
  - question: What other database ports is this source scanning?
    context: Multi-port scanning indicates reconnaissance activity across database services.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 1433
            - 1521
            - 3306
            - 5432
            - 27017
        condition: selection
      fields:
        - dst_port
        - dst_ip
        - connection_state

  - question: What is the geographic origin and reputation of the source IP?
    context: External scanning often originates from known malicious infrastructure or compromised hosts.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - geoip.country_name
        - threat_intel.indicator_type

  # Type 4: Impact Assessment
  - question: Are there any successful authentication attempts to MySQL from this source?
    context: Successful logins indicate potential compromise of database credentials.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 3306
          connection_state: established
          bytes_received|gt: 1000
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - connection_duration
        - bytes_sent
        - bytes_received

  - question: Has any data been exfiltrated from the MySQL server?
    context: Large outbound data transfers may indicate database compromise and data theft.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_port: 3306
          bytes_sent|gt: 10000
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - bytes_sent
        - connection_duration

  # Type 5: Forensic Deep-Dive
  - question: What is the scanning pattern and timing of connection attempts?
    context: Automated tools show distinct timing patterns compared to manual reconnaissance.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 3306
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - connection_state

  - question: Are there any associated process activities on the target MySQL server?
    context: Successful exploitation may trigger process execution or service manipulation.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - mysql
            - mysqld
            - mysqldump
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are other database servers experiencing similar scanning activity?
    context: Coordinated scanning across multiple database servers indicates a targeted campaign.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "ET SCAN Suspicious inbound"
          dst_port|contains:
            - 1433
            - 1521
            - 3306
            - 5432
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - rule.name

  - question: Is this source IP targeting other services across the enterprise?
    context: Multi-service scanning indicates broader reconnaissance or attack campaign.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection_state