name: ET WEB_SPECIFIC_APPS Yahoo CD Player ActiveX Open Stack Overflow Attempt
id: 22010945
description: |
  Detects exploitation attempts against Yahoo CD Player ActiveX control using the Open method to trigger stack overflow.
  This vulnerability allows remote code execution through buffer overflow. May trigger on legitimate Yahoo CD Player usage.
type: detection
detection_id: 2010945
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete ActiveX object instantiation and Open method parameters?
    context: The full HTML content reveals the malicious payload and buffer overflow trigger mechanism.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - url.full
        - http.response.headers

  - question: Is Yahoo CD Player legitimately installed on client systems?
    context: Legitimate Yahoo CD Player installations may trigger false positives during normal ActiveX operations.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.response.body.content|contains: "5622772D-6C27-11D3-95E5-006008D14F3B"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - http.response.status_code

  - question: What website is hosting the malicious ActiveX exploit?
    context: Identifying the hosting website helps determine the attack vector and potential campaign infrastructure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.domain
        - url.path
        - dst_ip
        - http.request.headers

  - question: What other ActiveX exploitation attempts occurred from this client?
    context: Multiple ActiveX exploits may indicate a systematic attack or exploit kit deployment.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.response.body.content|contains: "classid"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path

  - question: Has the client system shown signs of successful code execution?
    context: Successful stack overflow exploitation results in arbitrary code execution and potential system compromise.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  - question: What network connections were established after the exploitation attempt?
    context: Successful exploitation often results in callback connections to attacker command and control servers.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes
        - network.protocol

  - question: What DNS queries were made before accessing the malicious site?
    context: DNS resolution patterns help identify the attack infrastructure and potential redirection mechanisms.
    range: -5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip

  - question: Are there registry modifications related to ActiveX security controls?
    context: Attackers may modify registry settings to disable ActiveX security features and enable exploitation.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "ActiveX"
            - "5622772D-6C27-11D3-95E5-006008D14F3B"
        condition: selection
      fields:
        - TargetObject
        - Details
        - User

  - question: What files were created or modified on the client system?
    context: Successful exploitation may result in malware installation or system file corruption.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - User
        - ProcessName

  - question: Are other clients in the network accessing the same malicious website?
    context: Multiple clients accessing the same exploit site indicates a broader organizational security incident.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.domain|expand: '%url.domain%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.headers

  - question: What SSL certificate details are available for the attack infrastructure?
    context: Certificate information helps identify the attack infrastructure and potential threat actor attribution.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number