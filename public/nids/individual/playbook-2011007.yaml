name: ET ACTIVEX Microsoft Internet Explorer Tabular DataURL ActiveX Control Memory Corruption Attempt
id: 22011007
description: |
  Detects exploitation attempts targeting CVE-2010-0805 in Internet Explorer's Tabular DataURL ActiveX control.
  This vulnerability allows remote code execution through memory corruption in the DataURL parameter.
  May trigger on legitimate web applications using Tabular Data Control for data binding.
type: detection
detection_id: 2011007
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact ActiveX OBJECT tag and DataURL parameter content?
    context: Understanding the malicious OBJECT tag structure reveals exploitation technique and payload delivery method.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.response.body.content
        - url.full

  - question: What specific CLSID and DataURL values were used in the exploit?
    context: The CLSID 333C7BC4-460F-11D0-BC04-0080C7055A83 identifies the vulnerable Tabular Data Control component.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.response.body.content
        - payload

  - question: What was the complete HTTP request structure delivering the exploit?
    context: HTTP headers and request method provide context for exploit delivery mechanism and targeting.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - http.request.headers
        - url.path
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Is this web application known to use Tabular Data Control legitimately?
    context: Some legacy web applications use TDC for data binding, requiring verification of legitimate usage.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method
        - user_agent.original

  - question: Does the user agent indicate a vulnerable Internet Explorer version?
    context: CVE-2010-0805 affects specific IE versions, helping assess actual vulnerability exposure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - user_agent.original
        - user_agent.name
        - user_agent.version

  # Type 3: Activity Context
  - question: What web browsing activity preceded this ActiveX exploit attempt?
    context: Understanding user browsing patterns helps identify drive-by download campaigns versus targeted attacks.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - url.full
        - http.request.method
        - http.response.status_code

  - question: What was the referrer chain leading to the malicious web page?
    context: Referrer information reveals the attack vector and potential compromise of legitimate websites.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.referrer
        - user_agent.original

  - question: What DNS queries were made around the time of the exploit?
    context: DNS lookups reveal the attack infrastructure and potential command and control domains.
    range: +/-15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 4: Impact Assessment
  - question: Did the client system download additional payloads after the ActiveX exploit?
    context: Successful exploitation often leads to secondary payload downloads and malware installation.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: GET
        condition: selection
      fields:
        - dst_ip
        - url.full
        - http.response.body.bytes
        - http.response.mime_type

  - question: Are there signs of successful code execution following the exploit?
    context: Successful ActiveX exploits may lead to process creation, file downloads, or network connections.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 21
            - 25
            - 80
            - 443
            - 4444
            - 8080
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_out

  # Type 5: Forensic Deep-Dive
  - question: What specific memory corruption technique was used in the DataURL parameter?
    context: CVE-2010-0805 exploits involve specific memory layout manipulation through crafted DataURL values.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - payload
        - payload_printable

  - question: Are there additional ActiveX exploitation attempts from this source or target?
    context: Attackers often attempt multiple ActiveX exploits to increase success probability.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - ActiveX
            - ACTIVEX
        condition: selection
      fields:
        - alert.signature
        - url.full
        - user_agent.original

  # Type 6: Enterprise Correlation
  - question: Are other users in the organization targeted with similar ActiveX exploits?
    context: Drive-by download campaigns often target multiple users within the same organization.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature: "ET ACTIVEX Microsoft Internet Explorer Tabular DataURL ActiveX Control Memory Corruption Attempt"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.full
        - user_agent.original