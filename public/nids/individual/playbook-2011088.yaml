name: ET SCAN Possible DavTest WebDav Vulnerability Scanner Initial Check Detected
id: 22011088
description: |
  Detects DavTest vulnerability scanner performing initial WebDAV reconnaissance using PROPFIND requests.
  May trigger on legitimate WebDAV clients, but specific XML structure indicates scanning activity.
type: detection
detection_id: 2011088
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete PROPFIND request and XML payload structure?
    context: The specific XML namespace and allprop element indicates DavTest scanner fingerprint.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - http.request.body.content
        - url.full
        - user_agent.original

  - question: Is this a legitimate WebDAV client or administrative tool?
    context: Authorized WebDAV usage would have documented business purpose and expected user agents.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: "PROPFIND"
        condition: selection
      fields:
        - user_agent.original
        - url.path
        - http.response.status_code

  - question: What other WebDAV methods has this source attempted?
    context: DavTest scanner progresses through multiple WebDAV methods to test server capabilities.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method|contains:
            - "PROPFIND"
            - "PROPPATCH"
            - "MKCOL"
            - "PUT"
            - "DELETE"
            - "MOVE"
            - "COPY"
        condition: selection
      fields:
        - http.request.method
        - url.path
        - http.response.status_code

  - question: What was the server response to this WebDAV reconnaissance?
    context: Server responses reveal WebDAV capabilities and potential vulnerabilities exposed.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  - question: Has this source performed scanning against other web servers?
    context: Attackers often scan multiple targets to find vulnerable WebDAV implementations.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "PROPFIND"
        condition: selection
      fields:
        - dst_ip
        - url.path
        - user_agent.original

  - question: What file upload attempts followed this reconnaissance?
    context: Successful WebDAV scanning is often followed by malicious file upload attempts.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method|contains:
            - "PUT"
            - "POST"
        condition: selection
      fields:
        - http.request.method
        - url.path
        - http.request.body.content
        - http.response.status_code

  - question: Are there signs of successful WebDAV exploitation or file creation?
    context: Successful exploitation allows attackers to upload web shells or malicious content.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - "201"
            - "204"
        condition: selection
      fields:
        - src_ip
        - http.request.method
        - url.path
        - http.response.status_code

  - question: What other vulnerability scanning activity originated from this source?
    context: WebDAV scanning is often part of broader reconnaissance campaigns.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - "SCAN"
            - "Vulnerability"
            - "Recon"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - rule.category

  - question: Has this WebDAV server been targeted by other scanning sources?
    context: Vulnerable WebDAV servers often attract multiple attackers and scanning attempts.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "WebDav"
        condition: selection
      fields:
        - src_ip
        - rule.name
        - user_agent.original

  - question: Are other web servers in the environment experiencing WebDAV scanning?
    context: Attackers may target multiple WebDAV servers across the organization.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "WebDav"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name