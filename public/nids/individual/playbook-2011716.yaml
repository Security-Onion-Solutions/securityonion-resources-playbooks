name: ET SCAN Sipvicious User-Agent Detected - SIP Reconnaissance Tool
id: 22011716
description: |
  Detects Sipvicious SIP scanning tool with "friendly-scanner" user-agent string.
  May indicate VoIP infrastructure reconnaissance or legitimate security testing.
type: detection
detection_id: 2011716
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SIP message containing the Sipvicious user-agent?
    context: Analyzing the full SIP packet reveals the specific scanning technique and target information.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol

  - question: What SIP methods are being used in the scanning attempts?
    context: Different SIP methods (OPTIONS, INVITE, REGISTER) reveal the reconnaissance objectives.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  # Type 2: Triage Assessment
  - question: Is this scanning activity from an authorized security testing source?
    context: Legitimate penetration testing may use Sipvicious for VoIP security assessments.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains: 'SCAN'
        condition: selection
      fields:
        - alert.signature
        - dst_ip

  - question: Does the scanning source IP belong to known security testing ranges?
    context: Internal security teams or authorized vendors may conduct legitimate VoIP assessments.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol

  # Type 3: Activity Context
  - question: What network reconnaissance preceded this SIP scanning activity?
    context: Port scans or service enumeration often precede targeted VoIP attacks.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - 'SCAN'
            - 'RECON'
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port

  - question: How many SIP servers are being targeted by this scanning source?
    context: Broad targeting indicates automated scanning rather than focused attack on specific systems.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip

  # Type 4: Impact Assessment
  - question: Have any SIP authentication attempts followed the reconnaissance?
    context: Brute force attacks on SIP accounts often follow successful service discovery.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'SIP'
            - 'authentication'
            - 'brute'
        condition: selection
      fields:
        - alert.signature
        - dst_ip

  - question: Are there signs of successful SIP registration or call attempts?
    context: Successful exploitation may result in unauthorized call placement or service hijacking.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          network.bytes_received|gte: 1000
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  # Type 5: Forensic Deep-Dive
  - question: What other VoIP attack tools are being used from this source?
    context: Multiple VoIP tools suggest sophisticated attack campaign against telecommunications infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'SIP'
            - 'VoIP'
            - 'RTP'
        condition: selection
      fields:
        - alert.signature
        - dst_ip

  - question: Are there patterns in the timing and targeting of the SIP scans?
    context: Systematic timing patterns reveal automated tool configuration and campaign scope.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains: 'Sipvicious'
        condition: selection
      fields:
        - dst_ip
        - alert.signature

  # Type 6: Enterprise Correlation
  - question: Are other external sources conducting similar SIP reconnaissance against the organization?
    context: Coordinated VoIP scanning from multiple sources indicates targeted campaign against telecommunications infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'SIP'
          alert.category|contains: 'SCAN'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: What is the geographic distribution of SIP scanning sources targeting the organization?
    context: Understanding attack source geography helps identify coordinated campaigns and threat actor patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains:
            - 'SIP'
            - 'Sipvicious'
          alert.category|contains: 'SCAN'
        condition: selection
      fields:
        - src_ip
        - dst_ip