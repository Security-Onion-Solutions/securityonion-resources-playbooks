name: ET MALWARE Xilcter/Zeus related malware dropper reporting in
id: 22011827
description: |
  Detects Xilcter/Zeus malware family command and control communication via HTTP beaconing.
  May trigger on legitimate applications that use similar parameter patterns for telemetry or analytics.
type: detection
detection_id: 2011827
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What were the exact HTTP parameters used in the malware beacon?
    context: Understanding the complete beacon structure reveals malware variant and configuration details.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method
        - http.request.body.content

  - question: Is this legitimate telemetry or analytics traffic from authorized software?
    context: Some legitimate applications use similar parameter patterns for system reporting and analytics.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - user_agent.original

  - question: What system information was being exfiltrated in the beacon?
    context: Analyzing the subid, br, os, and flg parameters reveals what host information was being reported.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content
        - user_agent.original

  - question: What was the frequency and pattern of command and control communication?
    context: Understanding beacon intervals helps identify malware persistence and communication patterns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - user_agent.original

  - question: Did the command and control server respond with malicious payloads?
    context: C2 servers often respond with additional malware, configuration updates, or commands.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.body.bytes

  - question: What process initiated the malware beacon communication?
    context: Identifying the parent process helps understand the infection vector and malware execution chain.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - ParentImage

  - question: Are there signs of additional malware payload downloads or installations?
    context: Zeus/Xilcter often downloads additional modules or updates after initial beacon contact.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: 'GET'
        condition: selection
      fields:
        - url.full
        - http.response.body.bytes
        - http.response.status_code

  - question: What other malicious network activity originated from this infected host?
    context: Compromised systems often exhibit multiple indicators of malicious activity beyond C2 beacons.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: Did the malware attempt to steal credentials or financial information?
    context: Zeus malware family is known for banking trojans and credential theft capabilities.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - 'login'
            - 'bank'
            - 'auth'
            - 'payment'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.request.body.content

  - question: Are other systems in the network showing similar Zeus/Xilcter infections?
    context: Malware campaigns often target multiple systems within the same network infrastructure.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'Zeus'
            - 'Xilcter'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the reputation and infrastructure of the command and control server?
    context: Understanding C2 infrastructure helps assess the threat actor and potential campaign scope.
    range: -1d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - src_port