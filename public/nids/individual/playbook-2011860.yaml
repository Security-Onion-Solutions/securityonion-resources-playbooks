name: ET WEB_SPECIFIC_APPS Oracle Fusion Middleware BPEL Console Cross Site Scripting
id: 22011860
description: |
  Detects cross-site scripting attempts targeting Oracle Fusion Middleware BPEL Console via CVE-2010-3581.
  May trigger on legitimate administrative activities with complex process names or debugging parameters.
type: detection
detection_id: 2011860
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete XSS payload being injected into the BPEL Console?
    context: Analyzing the full XSS payload reveals attack sophistication and intended malicious actions.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.query
        - url.full
        - http.request.method

  - question: What specific JavaScript events or functions are being exploited?
    context: Understanding the XSS vector helps assess the potential impact and user interaction requirements.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - alert.signature
        - payload_printable
        - http.request.body.content

  # Type 2: Triage Assessment
  - question: Is this user authorized to access the BPEL Console administration interface?
    context: Administrative access patterns help distinguish legitimate usage from unauthorized access attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 7777
          url.path|contains: 'BPELConsole'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user_agent.original
        - http.request.method

  - question: Does this access pattern match normal BPEL administration activities?
    context: Request frequency and timing help identify automated attacks versus legitimate administrative work.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 7777
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 3: Activity Context
  - question: What Oracle Fusion Middleware reconnaissance preceded this XSS attempt?
    context: Scanning activity indicates targeted attack preparation and application enumeration.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 7777
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: Are there other Oracle application vulnerability probes from this source?
    context: Multiple Oracle exploit attempts indicate systematic vulnerability testing.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Oracle'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - alert.severity

  # Type 4: Impact Assessment
  - question: What is the potential data exposure from successful XSS execution?
    context: Understanding accessible data helps assess the risk and required response actions.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 7777
          url.path|contains: 'BPELConsole'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.response.body.bytes

  - question: Are there signs of session hijacking or credential theft?
    context: Post-XSS activity reveals the success and impact of the cross-site scripting attack.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 7777
          url.path|contains: 'BPELConsole'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.headers
        - user_agent.original

  # Type 5: Forensic Deep-Dive
  - question: What specific BPEL processes and data are being targeted?
    context: Understanding targeted business processes reveals attacker intent and potential business impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: 'processLog.jsp'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.body.content
        - http.response.body.content

  - question: Are there attempts to escalate privileges or access other Oracle components?
    context: Privilege escalation attempts indicate sophisticated attack progression beyond initial XSS.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - admin
            - console
            - manager
        condition: selection
      fields:
        - url.path
        - dst_port
        - http.response.status_code

  # Type 6: Enterprise Correlation
  - question: Are other Oracle Fusion Middleware systems experiencing similar XSS attacks?
    context: Enterprise-wide attacks indicate coordinated campaign or automated scanning.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Oracle Fusion'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - alert.severity

  - question: Is this source part of a broader web application attack campaign?
    context: Related web attacks indicate systematic targeting and threat actor capabilities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'Cross Site Scripting'
            - 'XSS'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - alert.severity