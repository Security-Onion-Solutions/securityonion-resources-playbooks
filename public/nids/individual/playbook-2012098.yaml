name: ET ACTIVEX J-Integra ActiveX SetIdentity Buffer Overflow
id: 22012098
description: |
  Detects attempts to exploit J-Integra ActiveX control buffer overflow via SetIdentity method.
  May trigger on legitimate web applications using J-Integra for Java integration.
  Successful exploitation allows remote code execution on client systems.
type: detection
detection_id: 2012098
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete ActiveX object declaration and SetIdentity call?
    context: Analyzing the full HTML/JavaScript payload reveals exploitation intent and technique.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.response.body.content
        - url.full

  - question: Is this web application known to legitimately use J-Integra ActiveX?
    context: Some enterprise applications require J-Integra for Java-COM bridge functionality.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.domain|expand: '%url.domain%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - src_ip

  - question: What web content was delivered alongside the ActiveX exploit?
    context: Understanding the complete attack vector reveals campaign sophistication.
    range: +/-5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - http.response.body.bytes

  - question: Has the client system shown signs of successful code execution?
    context: Post-exploitation activity indicates whether the buffer overflow succeeded.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What is the reputation and hosting details of the exploit server?
    context: Malicious hosting infrastructure patterns help identify campaign attribution.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  - question: Are there other ActiveX exploitation attempts from this source?
    context: Multiple ActiveX exploits indicate systematic client-side attack campaigns.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "ACTIVEX"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.domain

  - question: What browser and plugin versions are running on the target system?
    context: Vulnerable browser configurations determine exploitation success likelihood.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - url.domain

  - question: Has malicious payload been downloaded following the exploit attempt?
    context: Secondary payload downloads indicate successful initial exploitation.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - url.full
        - http.response.body.bytes
        - http.response.headers.content_type

  - question: Are other clients in the network accessing the same malicious content?
    context: Widespread exposure indicates potential enterprise-wide compromise risk.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.domain|expand: '%url.domain%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.response.status_code

  - question: What network connections were established post-exploitation?
    context: Outbound connections reveal command and control or data exfiltration activity.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_in
        - bytes_out