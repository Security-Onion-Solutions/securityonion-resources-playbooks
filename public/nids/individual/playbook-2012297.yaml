name: ET VOIP Possible Inbound VOIP Scan/Misuse With User-Agent Zoiper
id: 22012297
description: |
  Detects potential VoIP scanning or misuse using Zoiper user-agent string, commonly associated with VoIP fraud attempts.
  May trigger on legitimate Zoiper softphone usage, but often indicates unauthorized VoIP access or toll fraud preparation.
type: detection
detection_id: 2012297
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SIP message containing the Zoiper user-agent string?
    context: Full SIP analysis reveals whether this is legitimate softphone usage or malicious scanning activity.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.protocol
        - network.bytes
        - src_port
        - dst_port

  - question: Is this source IP authorized to use VoIP services in this environment?
    context: Authorization status helps distinguish legitimate remote workers from unauthorized access attempts.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_in
        - bytes_out

  - question: What SIP registration attempts are being made from this Zoiper client?
    context: Registration patterns reveal whether this is scanning activity or legitimate softphone configuration.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_out
        - bytes_in

  - question: How many different VoIP extensions or accounts is this client attempting to access?
    context: Multiple account attempts indicate credential stuffing or brute force attacks for VoIP fraud.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip

  - question: What is the frequency and pattern of connection attempts from this Zoiper client?
    context: High-frequency automated patterns indicate scanning tools rather than legitimate softphone usage.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_out

  - question: Has this source successfully authenticated to any VoIP services?
    context: Successful authentication indicates compromised credentials requiring immediate password reset and monitoring.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - bytes_in
        - bytes_out

  - question: Are there any outbound calls or media sessions initiated from this client?
    context: Active call attempts indicate successful compromise and potential toll fraud requiring immediate blocking.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - '5004'
            - '5060'
            - '5061'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: What other VoIP user-agents or tools has this source used?
    context: Multiple tools indicate sophisticated VoIP fraud operation using various evasion techniques.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'VOIP'
        condition: selection
      fields:
        - rule.name
        - dst_ip

  - question: Are other external sources using Zoiper for similar scanning activity?
    context: Coordinated Zoiper usage indicates organized fraud campaign requiring enhanced VoIP security measures.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Zoiper'
        condition: selection
      fields:
        - src_ip
        - dst_ip

  - question: What is the geographic location and reputation of this Zoiper client source?
    context: Geographic analysis helps identify high-risk regions and implement appropriate access controls.
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port

  - question: Has this source attempted any non-VoIP network reconnaissance?
    context: Multi-service scanning indicates broader attack campaign beyond VoIP fraud attempts.
    range: +/-12h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port

  - question: Are there signs of successful VoIP fraud or unauthorized international calls?
    context: Successful fraud attempts require immediate incident response and financial impact assessment.
    range: +24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - '5060'
            - '5061'
        condition: selection
      fields:
        - dst_ip
        - bytes_out