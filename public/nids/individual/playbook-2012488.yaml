name: ET WEB_SPECIFIC_APPS Keynect Ecommerce SQL Injection Attempt - DELETE Statement
id: 22012488
description: |
  Detects SQL injection attempts targeting Keynect Ecommerce using DELETE statements for data destruction.
  Rarely legitimate in URL parameters, DELETE injections pose severe data integrity and availability risks.
type: detection
detection_id: 2012488
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete DELETE statement payload in the ctf parameter?
    context: DELETE injections reveal the attacker's intent to destroy data, requiring immediate containment.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method

  - question: What table and records were targeted for deletion?
    context: Understanding the deletion scope helps assess data loss risk and recovery requirements.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - alert.signature
        - payload_printable

  - question: Is there any legitimate DELETE functionality in this application context?
    context: Products.php typically handles display operations, making DELETE statements extremely suspicious.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path: '/products.php'
          http.request.method|contains:
            - 'DELETE'
            - 'POST'
        condition: selection
      fields:
        - src_ip
        - url.query
        - user_agent.original

  - question: What was the attack progression leading to this DELETE attempt?
    context: DELETE injections often follow successful reconnaissance and data extraction attempts.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'SQL Injection'
        condition: selection
      fields:
        - rule.name
        - url.path
        - alert.signature

  - question: Did the DELETE injection execute successfully?
    context: Successful DELETE operations may cause application errors or unexpected response patterns.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path: '/products.php'
        condition: selection
      fields:
        - http.response.status_code
        - bytes_out
        - url.query

  - question: Are there signs of data destruction or application malfunction?
    context: Successful DELETE attacks may cause application errors, missing content, or service disruption.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - 500
            - 404
            - 503
        condition: selection
      fields:
        - src_ip
        - http.response.status_code
        - url.path

  - question: Has the attacker attempted to cover tracks by deleting logs or audit data?
    context: DELETE injections may target logging or audit tables to hide previous attack activities.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'SQL'
            - 'Log'
            - 'Audit'
        condition: selection
      fields:
        - rule.name
        - url.path
        - alert.signature

  - question: What is the scope of potential data loss from this attack?
    context: Understanding deletion impact helps prioritize recovery efforts and assess business continuity.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - '/products.php'
            - '/catalog'
            - '/inventory'
        condition: selection
      fields:
        - src_ip
        - url.query
        - http.response.status_code

  - question: Are there indicators of a broader destructive campaign?
    context: DELETE attacks may be part of ransomware or data destruction campaigns targeting multiple systems.
    range: +6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'DELETE'
            - 'RANSOMWARE'
            - 'DESTRUCTIVE'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - alert.signature

  - question: Have other critical systems been targeted with DELETE injections?
    context: Attackers may attempt to delete data across multiple applications to maximize damage.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'DELETE'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path