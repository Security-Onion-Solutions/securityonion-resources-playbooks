name: ET WEB_SPECIFIC_APPS eyeOS callback parameter Cross Site Scripting Attempt
id: 22012656
description: |
  Detects cross-site scripting attempts targeting eyeOS qooxdoo framework callback parameter in JSONP endpoint.
  May trigger on legitimate JSONP callback functions or JavaScript framework operations.
type: detection
detection_id: 2012656
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the malicious JavaScript payload in the JSONP callback parameter?
    context: JSONP callback XSS payloads can execute arbitrary JavaScript in victim browsers bypassing same-origin policy.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: Is this legitimate eyeOS or qooxdoo framework development activity?
    context: Development environments may legitimately use qooxdoo SDK testing endpoints with callback parameters.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/devtools/qooxdoo-sdk/'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.headers.referer

  - question: What other JSONP endpoints were targeted for XSS exploitation?
    context: Multiple JSONP attacks indicate systematic exploitation of callback parameter vulnerabilities.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains: 'callback='
        condition: selection
      fields:
        - url.path
        - url.query
        - http.response.status_code

  - question: Was the JSONP XSS payload successfully executed in victim browsers?
    context: Successful JSONP XSS requires the malicious callback to be returned in a valid JSONP response.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers.content_type

  - question: Are there signs of credential theft or session hijacking via the XSS payload?
    context: JSONP XSS can steal authentication tokens and session cookies from eyeOS users.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - 'document.cookie'
            - 'sessionStorage'
            - 'localStorage'
        condition: selection
      fields:
        - url.query
        - dst_ip
        - http.request.method

  - question: What was the browser and JavaScript environment of the attacking client?
    context: Browser capabilities determine XSS payload effectiveness and attack sophistication.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: 'jsonp_primitive.php'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - http.request.headers.accept
        - http.request.headers.accept_language

  - question: Did legitimate eyeOS users access the compromised JSONP endpoint after injection?
    context: User access to XSS-compromised JSONP endpoints indicates potential victim exposure and data theft.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/devtools/qooxdoo-sdk/framework/source/resource/qx/test/jsonp_primitive.php'
        condition: selection
      fields:
        - src_ip
        - http.request.headers.user_agent
        - http.request.headers.referer

  - question: What other eyeOS or qooxdoo framework components were targeted for exploitation?
    context: Multiple component attacks indicate comprehensive exploitation of the web desktop environment.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - '/eyeOS/'
            - '/qooxdoo'
            - '.php'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.response.status_code

  - question: Are there indicators of automated XSS or JSONP vulnerability scanning?
    context: Automated tools often target JSONP endpoints systematically for callback parameter injection.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.headers.user_agent|contains:
            - 'XSSer'
            - 'XSStrike'
            - 'Burp'
            - 'OWASP'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - url.path

  - question: Has the eyeOS installation been compromised or accessed suspiciously?
    context: Post-XSS activity may indicate successful compromise of the web desktop environment.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - '/eyeOS/index.php'
            - '/admin'
            - '/login'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: Are other web desktop or framework installations experiencing similar JSONP XSS attacks?
    context: Coordinated JSONP attacks suggest systematic exploitation of JavaScript framework vulnerabilities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'JSONP'
            - 'callback'
            - 'Cross Site Script'
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - rule.name