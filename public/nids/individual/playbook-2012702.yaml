name: ET WEB_SPECIFIC_APPS eGroupware loaddetails.php script UPDATE SET SQL Injection Attempt
id: 22012702
description: |
  Detects SQL injection attempts targeting eGroupware's loaddetails.php script using UPDATE SET statements.
  This indicates an attacker attempting to modify existing database records, potentially for privilege escalation or data manipulation.
  May trigger on legitimate data update operations if UPDATE statements are processed through the web interface.
type: detection
detection_id: 2012702
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete UPDATE SET payload in the injection attempt?
    context: Understanding the UPDATE statement reveals what data the attacker is trying to modify in the database.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content
        - rule.name

  - question: Which table and columns is the attacker targeting for modification?
    context: Target tables and columns indicate the attacker's objectives, such as privilege escalation or data corruption.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.query
        - http.request.method
        - url.path

  # Type 2: Triage Assessment
  - question: Are there legitimate UPDATE operations through this eGroupware interface?
    context: Some administrative interfaces allow data modification through URL parameters for legitimate purposes.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - 'loaddetails.php'
            - 'edit'
            - 'update'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: Does this source IP have administrative privileges for data modification?
    context: Legitimate administrators may perform data updates through web interfaces during maintenance.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.request.method

  # Type 3: Activity Context
  - question: What user authentication or session activity preceded this UPDATE attempt?
    context: Understanding authentication context helps determine if this is authorized administrative activity.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - 'login'
            - 'auth'
            - 'admin'
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - http.request.method

  - question: Were there SELECT queries to identify target records before the UPDATE?
    context: Attackers often query data first to understand what they want to modify before crafting UPDATE statements.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'SQL'
        condition: selection
      fields:
        - rule.name
        - url.full
        - alert.signature

  # Type 4: Impact Assessment
  - question: Was the UPDATE statement successfully executed based on HTTP response characteristics?
    context: Response codes and content indicate whether the malicious data modification was successful.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.body.content

  - question: Are there subsequent login attempts or privilege escalation activities?
    context: Successful UPDATE injections targeting user accounts often lead to immediate privilege abuse.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - 'login'
            - 'admin'
            - 'user'
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - http.request.method

  # Type 5: Forensic Deep-Dive
  - question: What specific fields is the attacker attempting to modify (passwords, permissions, configuration)?
    context: The nature of modified fields reveals the attacker's persistence strategy and privilege escalation goals.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'UPDATE'
        condition: selection
      fields:
        - rule.name
        - url.full
        - alert.signature

  - question: Are there multiple UPDATE attempts indicating systematic database manipulation?
    context: Multiple UPDATE attempts suggest the attacker is modifying multiple records or testing different approaches.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'UPDATE'
        condition: selection
      fields:
        - rule.name
        - url.path
        - alert.signature

  # Type 6: Enterprise Correlation
  - question: Are other eGroupware installations experiencing similar UPDATE-based attacks?
    context: Coordinated attacks may attempt to modify data across multiple application instances.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'eGroupware'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path

  - question: Is this source conducting a comprehensive SQL injection campaign with multiple techniques?
    context: Advanced attackers use various SQL injection methods to achieve complete database compromise.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'SQL Injection'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - alert.signature