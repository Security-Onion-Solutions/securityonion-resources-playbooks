name: ET WEB_SPECIFIC_APPS Golem Gaming Portal root_path Parameter Remote File Inclusion Attempt
id: 22012795
description: |
  Detects attempts to exploit remote file inclusion vulnerability in Golem Gaming Portal's admin_news_bot.php script.
  The root_path parameter is being manipulated to include remote files via HTTP/HTTPS/FTP protocols.
  This could allow attackers to execute arbitrary code by including malicious remote files.
type: detection
detection_id: 2012795
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact root_path parameter value and remote URL being included?
    context: Understanding the specific payload reveals the attacker's intent and the remote resource being loaded.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content
        - alert.signature

  - question: What protocol scheme was used in the remote file inclusion attempt?
    context: Different protocols (HTTP, HTTPS, FTP, PHP) indicate varying levels of sophistication and attack vectors.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.method
        - url.query
        - url.path

  # Type 2: Triage Assessment
  - question: Is this a legitimate administrative access to the Golem Gaming Portal admin interface?
    context: Authorized administrators may access admin_news_bot.php for legitimate content management purposes.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/admin/'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: Has this source IP accessed other administrative interfaces recently?
    context: Legitimate admins typically access multiple admin functions, while attackers may focus on specific vulnerabilities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - '/admin/'
            - '/administrator/'
            - '/wp-admin/'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.response.status_code

  # Type 3: Activity Context
  - question: What other web application attacks originated from this source IP?
    context: Remote file inclusion attacks are often part of broader web application reconnaissance and exploitation campaigns.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - 'web-application-attack'
            - 'attempted-recon'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.severity

  - question: What was the sequence of HTTP requests leading to this attack?
    context: Understanding the attack chain helps identify reconnaissance activities and attack methodology.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - user_agent.original

  # Type 4: Impact Assessment
  - question: Did the remote file inclusion attempt result in successful code execution?
    context: HTTP response codes and subsequent activity indicate whether the attack was successful.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - 200
            - 302
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.response.body.bytes

  - question: Were there any outbound connections from the target server after the attack?
    context: Successful remote file inclusion may result in reverse shells or command and control communications.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - network.bytes

  # Type 5: Forensic Deep-Dive
  - question: What processes were spawned on the target server following the attack?
    context: Successful remote file inclusion often leads to web shell deployment or system command execution.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - 'cmd.exe'
            - 'powershell.exe'
            - 'sh'
            - 'bash'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  - question: Were any suspicious files created or modified on the web server?
    context: Remote file inclusion attacks may result in web shell uploads or system file modifications.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          TargetFilename|contains:
            - '.php'
            - '.asp'
            - '.jsp'
            - 'shell'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  # Type 6: Enterprise Correlation
  - question: Are other web servers in the environment being targeted with similar remote file inclusion attacks?
    context: Attackers often scan for the same vulnerability across multiple systems in an organization.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Remote File'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - url.path