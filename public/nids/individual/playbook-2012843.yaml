name: ET INFO Cleartext WordPress Login
id: 22012843
description: |
  Detects WordPress login attempts transmitted over unencrypted HTTP connections.
  This is normal behavior for sites not using HTTPS but represents a security risk.
type: detection
detection_id: 2012843
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What were the complete login credentials transmitted in cleartext?
    context: Understanding the exposed credentials helps assess the immediate security impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - http.request.body.content
        - url.full
        - url.query

  - question: What is the username being used for this WordPress login attempt?
    context: Identifying the target account helps determine if administrative credentials are at risk.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - alert.signature
        - http.request.referrer

  - question: Is this a legitimate user accessing their own WordPress site?
    context: Many WordPress sites legitimately operate over HTTP, making this normal but risky behavior.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - "/wp-admin"
            - "/wp-login.php"
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: Are there signs of credential stuffing or brute force attacks?
    context: Multiple login attempts may indicate automated credential attacks rather than legitimate access.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.body.content|contains:
            - "wp-submit="
        condition: selection
      fields:
        - src_ip
        - http.response.status_code
        - url.full

  - question: Was the login attempt successful based on server response?
    context: HTTP response codes and redirects indicate whether the credentials were accepted.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - url.full

  - question: What administrative actions were performed after successful login?
    context: Post-authentication activity reveals the scope of potential compromise or legitimate use.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - "/wp-admin"
            - "/wp-content"
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: Are there signs of malicious plugin installation or file uploads?
    context: Compromised WordPress accounts are often used to install backdoors or malicious plugins.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - "/wp-admin/plugin-install.php"
            - "/wp-admin/upload.php"
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: Were any files created or modified on the WordPress server?
    context: Successful compromise may result in web shell creation or malicious content injection.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  - question: Are other WordPress sites showing similar cleartext login activity?
    context: Coordinated attacks may target multiple WordPress installations with common credentials.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "WordPress Login"
            - "Cleartext"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the geographic origin and reputation of the login source?
    context: Understanding the source helps distinguish between legitimate users and potential attackers.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.bytes

  - question: Has this WordPress site been configured to use HTTPS for secure authentication?
    context: Determining if HTTPS is available helps assess whether this represents a configuration issue.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - tls.server.certificate.subject