name: ET MOBILE_MALWARE SslCrypt Server Communication
id: 22012863
description: |
  Detects SslCrypt mobile malware communicating with command and control servers.
  This Symbian malware sends device information including IMEI to remote servers.
  Legitimate applications may use similar parameters but the combination is suspicious.
type: detection
detection_id: 2012863
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific URI parameters were sent in the SslCrypt communication?
    context: Examining the complete URI reveals device fingerprinting and data exfiltration patterns.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What device identifiers were transmitted to the external server?
    context: IMEI and timing data indicate mobile device compromise and tracking capabilities.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - "id="
            - "imei="
            - "time="
        condition: selection
      fields:
        - url.query
        - http.request.headers
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Is this mobile device authorized to access external services?
    context: Corporate mobile devices may have legitimate reasons for external communication.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out
        - bytes_in

  - question: Does this communication pattern align with normal mobile app behavior?
    context: Legitimate mobile apps typically have predictable communication schedules and endpoints.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - http.request.method
        - user_agent.original

  # Type 3: Activity Context
  - question: What triggered this malware communication session?
    context: Understanding the initiation helps identify infection vector and user activity.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - network.transport

  - question: What other network activity occurred from this mobile device recently?
    context: Correlated activity may reveal additional malware components or data exfiltration.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out
        - network.protocol

  # Type 4: Impact Assessment
  - question: What sensitive device information was potentially transmitted?
    context: IMEI transmission enables device tracking and may indicate broader data theft.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.response.body.content
        - http.response.status_code

  - question: Has the malware established persistent communication channels?
    context: Regular check-ins indicate successful infection and ongoing command and control.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - bytes_out

  # Type 5: Forensic Deep-Dive
  - question: What specific SslCrypt variant characteristics are present?
    context: Different SslCrypt variants have unique communication patterns and capabilities.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - "id="
            - "imei="
        condition: selection
      fields:
        - http.request.headers
        - user_agent.original
        - url.full

  - question: Are there signs of additional payload downloads or updates?
    context: Mobile malware often downloads additional components or configuration updates.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - url.full
        - http.response.body.bytes
        - http.request.method

  # Type 6: Enterprise Correlation
  - question: Are other mobile devices in the network showing similar SslCrypt indicators?
    context: Mobile malware campaigns often target multiple devices within an organization.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - "imei="
            - "time="
        condition: selection
      fields:
        - src_ip
        - url.query
        - user_agent.original