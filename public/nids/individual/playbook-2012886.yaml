name: ET INFO Http Client Body contains passwd= in cleartext
id: 22012886
description: |
  Detects HTTP POST requests containing password fields transmitted in cleartext.
  This may indicate legitimate authentication to web applications or potential credential exposure.
  Policy violation as passwords should be transmitted over encrypted channels.
type: detection
detection_id: 2012886
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete HTTP request containing the cleartext password field?
    context: Analyzing the full request reveals the application and authentication mechanism exposing credentials.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content
        - http.request.headers

  - question: What specific password parameter format was detected in the request body?
    context: Understanding the parameter structure helps identify the application and credential format.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.path

  # Type 2: Triage Assessment
  - question: Is this a known legacy application that legitimately transmits passwords in cleartext?
    context: Determining if this represents expected behavior for older systems versus security policy violation.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - url.path
        - src_ip
        - http.request.method

  - question: Is this authentication occurring over an internal network segment?
    context: Assessing risk level based on network location and potential for credential interception.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol

  # Type 3: Activity Context
  - question: What triggered this authentication attempt?
    context: Understanding the user session context and application workflow leading to credential transmission.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What other authentication-related activity occurred from this source?
    context: Identifying patterns of credential usage and potential credential stuffing or brute force attempts.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.body.content|contains:
            - "password"
            - "passwd"
            - "login"
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.response.status_code

  # Type 4: Impact Assessment
  - question: Was the authentication successful and what access was granted?
    context: Determining if exposed credentials resulted in successful authentication and system access.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - network.bytes

  - question: What sensitive resources were accessed after this authentication?
    context: Assessing the impact of credential exposure by tracking post-authentication activity.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - network.bytes

  # Type 5: Forensic Deep-Dive
  - question: What application or service is accepting cleartext password authentication?
    context: Identifying the specific application helps prioritize remediation and security hardening efforts.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - url.full
        - http.request.headers

  - question: Are there indicators this represents credential theft or unauthorized access?
    context: Distinguishing between policy violations and potential security incidents requiring investigation.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "POLICY"
            - "TROJAN"
            - "MALWARE"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: What is the frequency and pattern of cleartext password transmissions?
    context: Understanding usage patterns helps determine if this is routine operation or anomalous activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "cleartext"
        condition: selection
      fields:
        - dst_ip
        - rule.name

  # Type 6: Enterprise Correlation
  - question: Are other systems or users transmitting credentials in cleartext?
    context: Identifying the scope of cleartext credential usage across the organization for policy enforcement.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "cleartext"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this part of a broader pattern of insecure authentication practices?
    context: Understanding if this represents isolated legacy system or systemic security policy violations.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: "POLICY"
          rule.name|contains:
            - "password"
            - "cleartext"
            - "authentication"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name