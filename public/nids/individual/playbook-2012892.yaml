name: ET MALWARE JKDDOS Bot CnC Phone Home Message
id: 22012892
description: |
  Detects JKDDOS botnet command and control communications with distinctive "Windows" identifier pattern.
  This DDoS bot targets mining industry systems and establishes persistent C2 channels for attack coordination.
  May trigger on legitimate applications sending Windows version information, though the specific byte pattern is highly indicative of JKDDOS.
type: detection
detection_id: 2012892
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete JKDDOS bot phone home message payload?
    context: Analyzing the full C2 message reveals bot identification, system information, and command structure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet_size

  - question: What is the JKDDOS command and control server receiving bot communications?
    context: Identifying the C2 server helps understand botnet infrastructure and enables network blocking.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto

  # Type 2: Triage Assessment
  - question: Is this system authorized to communicate with high-numbered ports on external servers?
    context: Botnet C2 often uses high ports that are unusual for legitimate business applications.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|range:
            gte: 1024
            lte: 65535
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service
        - bytes_toserver

  - question: Does this system normally generate outbound connections to this destination?
    context: New or unusual external connections may indicate botnet enrollment and C2 establishment.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - conn_state
        - duration
        - bytes_toserver

  # Type 3: Activity Context
  - question: What process initiated the JKDDOS bot communication?
    context: Identifying the malware process helps with containment and reveals infection persistence mechanisms.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: When did the JKDDOS bot first establish contact with the C2 server?
    context: Determining initial C2 contact helps understand infection timeline and potential attack window.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - conn_state
        - duration
        - bytes_toserver

  - question: What other network activity occurred around the time of this bot phone home?
    context: Concurrent connections may reveal additional malware components or lateral movement activity.
    range: +/-10m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - service

  # Type 4: Impact Assessment
  - question: Has this infected system participated in DDoS attacks following C2 communication?
    context: Outbound attack traffic confirms the bot is actively participating in coordinated DDoS campaigns.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - conn_state

  - question: What is the frequency and volume of JKDDOS bot communications?
    context: Understanding C2 communication patterns helps assess the bot's activity level and threat impact.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "JKDDOS"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - severity

  # Type 5: Forensic Deep-Dive
  - question: What files has the JKDDOS malware created or modified on the infected system?
    context: File system artifacts reveal persistence mechanisms and potential additional malware components.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  - question: Are there registry modifications indicating JKDDOS persistence mechanisms?
    context: Registry changes reveal how the bot maintains persistence across system reboots.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details

  - question: What specific JKDDOS variant is present based on communication patterns?
    context: Different JKDDOS variants have distinct C2 protocols that reveal the specific threat family version.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "JKDDOS"
            - "DDoS"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - severity

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network infected with the same JKDDOS botnet?
    context: Multiple infections indicate botnet spread requiring coordinated incident response across the enterprise.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "JKDDOS"
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - severity

  - question: What mining industry systems or applications are present that may be specifically targeted?
    context: JKDDOS specifically targets mining industry infrastructure, so identifying related systems helps assess risk.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port|contains:
            - 502
            - 20222
            - 44818
        condition: selection
      fields:
        - dst_ip
        - service
        - src_ip