name: ET INFO Google Music Streaming
id: 22012935
description: |
  Detects Google Music streaming activity through googleusercontent.com domains.
  This is typically legitimate user activity but may violate organizational bandwidth or acceptable use policies.
type: detection
detection_id: 2012935
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific Google Music content is being streamed?
    context: Understanding the stream parameters helps identify the type and volume of media being accessed.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method

  - question: What is the data volume and duration of the streaming session?
    context: Analyzing bandwidth usage helps assess the impact on network resources and policy compliance.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/stream"
        condition: selection
      fields:
        - url.query
        - http.response.body.bytes

  # Type 2: Triage Assessment
  - question: Is this streaming activity during authorized break times or lunch hours?
    context: Personal media streaming might be acceptable during designated break periods per company policy.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|contains: "googleusercontent.com"
        condition: selection
      fields:
        - src_ip
        - url.path
        - network.bytes

  - question: Does this user have authorization for media streaming or entertainment access?
    context: Some roles or departments may have explicit permission for media access during work hours.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|contains: "googleusercontent.com"
        condition: selection
      fields:
        - dst_ip
        - url.path

  # Type 3: Activity Context
  - question: What other entertainment or social media activity preceded this streaming?
    context: Understanding usage patterns helps determine if this is isolated activity or part of broader policy violations.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.request.method

  - question: Is this part of a pattern of personal internet usage during work hours?
    context: Repeated personal use violations may require escalation to human resources or management.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category: "policy-violation"
        condition: selection
      fields:
        - rule.name
        - dst_ip

  # Type 4: Impact Assessment
  - question: What is the bandwidth impact of this streaming on network performance?
    context: High-bandwidth streaming can affect business-critical applications and user productivity.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|contains: "googleusercontent.com"
        condition: selection
      fields:
        - dst_port
        - network.bytes
        - network.packets

  - question: Are there signs of productivity impact or work-related activity disruption?
    context: Assessing concurrent work activity helps determine the business impact of personal streaming.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.path

  # Type 5: Forensic Deep-Dive
  - question: What other Google services is this user accessing simultaneously?
    context: Understanding the full scope of Google service usage helps assess overall policy compliance.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|contains: "google"
        condition: selection
      fields:
        - dst_ip
        - url.path

  - question: Has this user attempted to bypass content filtering or access controls?
    context: Evasion attempts may indicate intentional policy violations requiring disciplinary action.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - "proxy"
            - "bypass"
            - "tunnel"
        condition: selection
      fields:
        - rule.name
        - dst_ip

  # Type 6: Enterprise Correlation
  - question: Are multiple users engaging in similar streaming activity?
    context: Widespread streaming usage may indicate inadequate policy communication or enforcement.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Google Music"
        condition: selection
      fields:
        - src_ip
        - dst_ip

  - question: Is there a pattern of increased personal internet usage across the organization?
    context: Organization-wide trends may require policy review or additional network controls.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: "policy-violation"
        condition: selection
      fields:
        - src_ip
        - rule.name