name: ET WEB_SPECIFIC_APPS SoftMP3 search Parameter SELECT FROM SQL Injection Attempt
id: 22013125
description: |
  Detects SQL injection attempts targeting SoftMP3 application via SELECT FROM statements in search parameter.
  May trigger on legitimate search queries but requires investigation due to external origin and data access potential.
type: detection
detection_id: 2013125
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SELECT FROM payload in the search parameter?
    context: SELECT statements reveal data extraction attempts and database schema reconnaissance.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content
        - rule.name

  - question: What specific tables and columns were targeted for data extraction?
    context: Understanding the target data helps assess the sensitivity and scope of potential exposure.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path: "/minbrowse.php"
        condition: selection
      fields:
        - url.query
        - http.request.method
        - url.full

  - question: Is this normal search functionality for the SoftMP3 application?
    context: Legitimate search operations may generate complex queries that could trigger this rule.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path: "/minbrowse.php"
        condition: selection
      fields:
        - src_ip
        - url.query
        - http.request.method

  - question: What reconnaissance activity preceded this SELECT injection attempt?
    context: Attackers often probe database structure before attempting targeted data extraction.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - http.response.status_code

  - question: Did the SELECT injection successfully extract data from the database?
    context: Successful data extraction may be indicated by large response sizes or structured content.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.body.bytes

  - question: What sensitive data was exposed through the injection response?
    context: SELECT responses may contain user credentials, personal information, or system configuration.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.body.bytes|gt: 500
        condition: selection
      fields:
        - http.response.body.content
        - http.response.body.bytes
        - url.path

  - question: Were system tables or metadata accessed through the injection?
    context: SELECT statements may target system tables to extract database structure or credentials.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.body.content|contains:
            - "information_schema"
            - "mysql"
            - "version"
            - "user"
        condition: selection
      fields:
        - http.response.body.content
        - url.path
        - http.response.status_code

  - question: What database error messages revealed schema information?
    context: SELECT errors can expose table names, column structures, and access permissions.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.response.body.content|contains:
            - "unknown column"
            - "table doesn't exist"
            - "access denied"
            - "syntax error"
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.path

  - question: Was the extracted data used for credential stuffing or further attacks?
    context: Successfully extracted credentials may be used for authentication bypass or lateral movement.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - "login"
            - "auth"
            - "admin"
            - "signin"
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - http.request.method

  - question: Are there patterns of SELECT injection attacks across multiple SoftMP3 installations?
    context: Automated tools may systematically target multiple vulnerable instances for data harvesting.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "SoftMP3"
          rule.name|contains: "SELECT FROM"
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - rule.name

  - question: What is the data access pattern and volume from this attacking source?
    context: Understanding access patterns helps assess the scope of potential data compromise.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient
        - bytes_toserver