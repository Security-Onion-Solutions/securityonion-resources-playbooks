name: ET WEB_SPECIFIC_APPS SoftMP3 search Parameter DELETE FROM SQL Injection Attempt
id: 22013126
description: |
  Detects SQL injection attempts targeting SoftMP3 application via DELETE FROM statements in search parameter.
  May trigger on legitimate data deletion but requires immediate investigation due to destructive potential.
type: detection
detection_id: 2013126
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact DELETE FROM payload in the search parameter?
    context: DELETE statements can cause irreversible data loss and require immediate assessment.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content
        - rule.name

  - question: What tables and conditions were specified in the DELETE statement?
    context: Understanding the scope of deletion helps assess potential data loss and impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path: "/minbrowse.php"
        condition: selection
      fields:
        - url.query
        - http.request.method
        - url.full

  - question: Is this authorized data deletion activity for the SoftMP3 application?
    context: Legitimate administrative operations may involve data cleanup or user account removal.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path: "/minbrowse.php"
        condition: selection
      fields:
        - src_ip
        - url.query
        - http.request.method

  - question: What attack progression led to this destructive injection attempt?
    context: DELETE injections often follow reconnaissance and data extraction phases.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - http.response.status_code

  - question: Did the DELETE injection execute successfully?
    context: Successful deletion may be indicated by specific response codes or confirmation messages.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.body.bytes

  - question: How much data was potentially affected by the deletion attempt?
    context: Assessing the scope of data loss is critical for recovery planning and impact assessment.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.body.content|contains:
            - "deleted"
            - "removed"
            - "affected"
            - "rows"
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.path

  - question: What database error messages indicated deletion constraints or failures?
    context: Constraint violations may have prevented data loss and reveal database structure.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.response.body.content|contains:
            - "foreign key"
            - "constraint"
            - "cannot delete"
            - "referenced"
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.path

  - question: Were critical system or user tables targeted for deletion?
    context: Deletion of user accounts, configuration, or system tables can cause application failure.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.body.content|contains:
            - "user"
            - "admin"
            - "config"
            - "system"
        condition: selection
      fields:
        - http.response.body.content
        - url.path
        - http.response.status_code

  - question: What application functionality was impacted by the deletion attempt?
    context: Successful deletions may cause application errors or unavailable features.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - "500"
            - "404"
            - "503"
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.response.body.content

  - question: Are there coordinated DELETE injection attacks across multiple SoftMP3 instances?
    context: Widespread deletion attempts may indicate a coordinated attack campaign.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "SoftMP3"
          rule.name|contains: "DELETE FROM"
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - rule.name

  - question: What is the attack timeline and methodology of this destructive campaign?
    context: Understanding the attack pattern helps predict next steps and implement countermeasures.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient