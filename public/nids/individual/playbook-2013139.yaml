name: ET MOBILE_MALWARE XML Style POST Of IMSI International Mobile Subscriber Identity
id: 22013139
description: |
  Detects mobile malware exfiltrating International Mobile Subscriber Identity (IMSI) data via XML POST requests.
  IMSI is a unique identifier for mobile subscribers and its exfiltration indicates mobile device compromise.
type: detection
detection_id: 2013139
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete XML payload containing the IMSI data?
    context: Understanding the exact IMSI format and structure reveals the mobile malware's data collection capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.full

  - question: What is the IMSI value being exfiltrated and which mobile network does it belong to?
    context: IMSI structure reveals the mobile country code, network code, and subscriber identity for attribution.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - src_ip
        - dst_ip

  - question: Is this device authorized to transmit IMSI data to external servers?
    context: Legitimate mobile applications may transmit IMSI for carrier verification or network diagnostics.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - http.request.body.content

  - question: What triggered this mobile device to initiate IMSI data transmission?
    context: Understanding the sequence of events helps identify the malware infection vector or trigger mechanism.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What other mobile device identifiers are being transmitted alongside the IMSI?
    context: Mobile malware often collects multiple device identifiers including IMEI, phone numbers, and device IDs.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - dst_ip

  - question: Has the mobile device established persistent connections to the C2 server?
    context: Mobile malware typically maintains persistent connections for ongoing data exfiltration and command reception.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - connection_state
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: What is the reputation and geolocation of the destination server receiving IMSI data?
    context: Mobile malware C2 servers are often hosted in specific geographic regions or known malicious infrastructure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - dst_ip
        - geoip.dst.country_name
        - threat_intel.dst_ip

  - question: Are there signs of additional mobile malware capabilities beyond IMSI theft?
    context: Mobile malware families often include multiple data theft capabilities including contacts, SMS, and location data.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - http.request.body.content
        - url.path
        - http.request.headers

  - question: What mobile applications or processes initiated this network connection?
    context: Identifying the source application helps determine if this is a legitimate app turned malicious or dedicated malware.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - User

  - question: Has this mobile device contacted other known mobile malware C2 infrastructure?
    context: Mobile devices infected with one malware family often become targets for additional malware campaigns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - geoip.dst.country_name

  - question: Are other mobile devices in the network exhibiting similar IMSI exfiltration behavior?
    context: Mobile malware campaigns often target multiple devices within the same network infrastructure.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "IMSI"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name