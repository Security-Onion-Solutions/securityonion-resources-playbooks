name: ET WEB_SPECIFIC_APPS Wordpress plugin Flash Album Gallery pid Parameter DELETE FROM SQL Injection Attempt
id: 22013156
description: |
  Detects SQL injection attempts targeting the WordPress Flash Album Gallery plugin's pid parameter.
  Specifically looks for DELETE FROM SQL statements that could remove database records.
  May trigger on legitimate database administration or plugin updates.
type: detection
detection_id: 2013156
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete DELETE FROM SQL injection payload in the pid parameter?
    context: Analyzing the exact injection reveals the attacker's intent to delete database records.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - url.query
        - http.request.method

  - question: What specific database tables or records were targeted for deletion?
    context: Understanding the DELETE statement structure reveals what data the attacker attempted to remove.
    range: +/-5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-content/plugins/flash-album-gallery/lib/hitcounter.php'
        condition: selection
      fields:
        - url.query
        - http.request.method
        - src_ip

  # Type 2: Triage Assessment
  - question: Is this legitimate WordPress plugin administration or maintenance?
    context: Authorized administrators may access plugin files for legitimate maintenance purposes.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/wp-admin/'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - user_agent.original

  - question: Does this source IP have authenticated WordPress admin access?
    context: Legitimate plugin management requires administrative privileges and proper authentication.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: 'wp-login.php'
        condition: selection
      fields:
        - http.response.status_code
        - http.request.method
        - url.query

  # Type 3: Activity Context
  - question: What WordPress reconnaissance preceded this SQL injection attempt?
    context: Attackers typically enumerate WordPress installations and plugins before launching targeted attacks.
    range: -4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - '/wp-content/'
            - '/wp-includes/'
            - '/wp-admin/'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: What was the server's response to this injection attempt?
    context: Response patterns indicate if the injection was successful or if security measures blocked it.
    range: +/-2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - network.bytes

  # Type 4: Impact Assessment
  - question: Were database records successfully deleted from the WordPress installation?
    context: Successful DELETE injections can cause data loss and compromise website integrity.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-content/plugins/flash-album-gallery/'
        condition: selection
      fields:
        - url.query
        - http.response.status_code
        - network.bytes

  - question: What WordPress administrative functions were accessed after this injection?
    context: Successful exploitation may lead to unauthorized access to WordPress admin functionality.
    range: +6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-admin/'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 5: Forensic Deep-Dive
  - question: What automated WordPress attack tools were used?
    context: User agent strings and request patterns can reveal automated WordPress vulnerability scanners.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - user_agent.original
        - http.request.method
        - url.path

  - question: Are there signs of WordPress plugin enumeration or exploitation campaigns?
    context: Attackers often target multiple WordPress plugins systematically to find vulnerabilities.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-content/plugins/'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user_agent.original

  - question: What other WordPress vulnerabilities were exploited by this attacker?
    context: Successful attackers often exploit multiple vulnerabilities to maintain access and escalate privileges.
    range: +/-48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Wordpress'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - event.created

  # Type 6: Enterprise Correlation
  - question: Are other WordPress installations being targeted with similar SQL injection attacks?
    context: Attackers often target multiple WordPress sites within an organization using the same techniques.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'Wordpress'
            - 'SQL Injection'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path