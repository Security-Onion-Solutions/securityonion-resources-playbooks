name: ET WEB_SPECIFIC_APPS Wordpress plugin Flash Album Gallery pid Parameter UNION SELECT SQL Injection Attempt
id: 22013157
description: |
  Detects SQL injection attempts targeting the Flash Album Gallery WordPress plugin via the pid parameter using UNION SELECT syntax.
  Attackers exploit this vulnerability to extract sensitive data from the database. May trigger on legitimate plugin data queries.
type: detection
detection_id: 2013157
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete UNION SELECT payload used in the SQL injection attempt?
    context: Understanding the UNION SELECT structure reveals what database information the attacker is attempting to extract.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  - question: Which database tables and columns is the attacker attempting to query via UNION SELECT?
    context: UNION SELECT payloads target specific tables and columns, revealing the attacker's knowledge of database structure and objectives.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content
        - url.path

  - question: Is this legitimate Flash Album Gallery plugin functionality accessing database content?
    context: The plugin performs legitimate database queries for displaying albums and galleries that may resemble UNION SELECT patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-content/plugins/flash-album-gallery/"
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - http.response.status_code

  - question: What database schema enumeration preceded this UNION SELECT attack?
    context: UNION SELECT injections require knowledge of column counts and data types, often gathered through prior enumeration.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "hitcounter.php"
        condition: selection
      fields:
        - url.query
        - http.request.method
        - http.response.status_code
        - http.response.body.content

  - question: Did the WordPress database return sensitive information in response to the UNION SELECT?
    context: Successful UNION SELECT attacks return database contents including user credentials, configuration data, or other sensitive information.
    range: +2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  - question: Are there signs of WordPress user credential extraction or administrative data theft?
    context: UNION SELECT attacks often target wp_users table to extract password hashes and administrative account information.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-login.php"
        condition: selection
      fields:
        - http.request.body.content
        - http.response.status_code
        - http.request.headers

  - question: Has the attacker escalated to other WordPress attack vectors following data extraction?
    context: Successful data extraction often leads to credential-based attacks, file uploads, or administrative interface exploitation.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-admin/"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - http.request.headers

  - question: What other SQL injection techniques has this attacker combined with UNION SELECT?
    context: Advanced attackers often combine multiple injection techniques including UNION, INSERT, and UPDATE for comprehensive database compromise.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "Flash Album Gallery"
        condition: selection
      fields:
        - rule.name
        - url.query
        - url.path

  - question: What is the attack origin and threat actor attribution?
    context: UNION SELECT attacks require technical knowledge and often originate from known attack infrastructure or skilled threat actors.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - geoip.src.country_name
        - threat_intel.src_ip

  - question: Are other WordPress sites experiencing similar Flash Album Gallery UNION SELECT attacks?
    context: Automated SQL injection tools often target multiple WordPress installations with the same vulnerability simultaneously.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Flash Album Gallery"
          rule.name|contains: "UNION SELECT"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Has the extracted database information been exfiltrated to external command and control servers?
    context: Successful data extraction is often followed by exfiltration to attacker-controlled infrastructure for further exploitation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - geoip.dst.country_name