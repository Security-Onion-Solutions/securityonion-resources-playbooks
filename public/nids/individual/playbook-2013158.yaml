name: ET WEB_SPECIFIC_APPS Wordpress plugin Flash Album Gallery pid Parameter INSERT INTO SQL Injection Attempt
id: 22013158
description: |
  Detects SQL injection attempts targeting the Flash Album Gallery WordPress plugin via the pid parameter using INSERT INTO syntax.
  Attackers exploit this vulnerability to insert malicious data into the database. May trigger on legitimate plugin data insertion activities.
type: detection
detection_id: 2013158
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SQL injection payload attempting to INSERT data?
    context: Understanding the INSERT INTO statement reveals what malicious data the attacker is trying to add to the database.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  - question: Which database table and what type of data is the attacker attempting to insert?
    context: Identifying the target table and data type helps assess whether this is user creation, content injection, or backdoor installation.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content
        - url.path

  - question: Is this normal Flash Album Gallery plugin functionality for content creation?
    context: The plugin legitimately inserts data for photo albums, galleries, and user interactions which may trigger similar patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-content/plugins/flash-album-gallery/"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - url.query
        - http.response.status_code

  - question: What database enumeration activities preceded this INSERT injection attempt?
    context: INSERT injections often follow reconnaissance to understand database schema and identify injectable parameters.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "hitcounter.php"
        condition: selection
      fields:
        - url.query
        - http.request.method
        - http.response.status_code
        - http.response.body.content

  - question: Did the WordPress database accept the malicious INSERT statement?
    context: Server responses reveal whether the injection succeeded and what data was actually inserted into the database.
    range: +2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  - question: Are there signs of malicious user account creation or privilege escalation?
    context: INSERT injections targeting user tables may create administrative accounts for persistent unauthorized access.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-login.php"
        condition: selection
      fields:
        - http.request.body.content
        - http.response.status_code
        - url.query

  - question: Has the attacker attempted to insert backdoor code or malicious content?
    context: INSERT injections may add malicious PHP code, JavaScript, or other content that enables persistent access or defacement.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.body.content
        - http.request.method

  - question: What other SQL injection techniques has this attacker employed against the same target?
    context: Attackers often use multiple injection techniques to maximize their chances of successful database compromise.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "SQL Injection"
        condition: selection
      fields:
        - rule.name
        - url.path
        - url.query

  - question: What is the attack source reputation and geographic origin?
    context: INSERT injection attacks often originate from known attack infrastructure or compromised hosts in specific regions.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - geoip.src.country_name
        - threat_intel.src_ip

  - question: Are other WordPress installations being targeted with similar Flash Album Gallery INSERT injections?
    context: Automated tools often target multiple WordPress sites with the same vulnerability pattern simultaneously.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Flash Album Gallery"
          rule.name|contains: "INSERT"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Has successful data insertion led to visible changes in the WordPress site content or functionality?
    context: Successful INSERT injections may result in new malicious content, modified galleries, or altered site behavior.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: GET
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - src_ip