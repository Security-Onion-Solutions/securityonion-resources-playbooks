name: ET WEB_SPECIFIC_APPS Wordpress plugin Flash Album Gallery pid Parameter UPDATE SET SQL Injection Attempt
id: 22013159
description: |
  Detects SQL injection attempts targeting the Flash Album Gallery WordPress plugin via the pid parameter using UPDATE SET syntax.
  Attackers exploit this vulnerability to modify database records. May trigger on legitimate plugin updates or maintenance.
type: detection
detection_id: 2013159
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SQL injection payload in the pid parameter?
    context: Understanding the exact UPDATE SET statement reveals what database modifications the attacker is attempting.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  - question: Which database table and columns are being targeted by the UPDATE statement?
    context: Identifying target tables helps assess the potential impact and scope of the database modification attempt.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content
        - url.path

  - question: Is this a legitimate WordPress administrator performing plugin maintenance?
    context: WordPress administrators may trigger similar patterns during plugin updates, database maintenance, or content management.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-content/plugins/"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What reconnaissance activities preceded this SQL injection attempt?
    context: SQL injection attacks typically follow enumeration of vulnerable parameters and database structure discovery.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-content/plugins/flash-album-gallery/"
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - http.response.status_code

  - question: What was the WordPress server's response to the SQL injection attempt?
    context: Server responses indicate whether the injection succeeded, failed, or triggered error messages revealing database structure.
    range: +2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  - question: Are there signs of successful database modification or privilege escalation?
    context: Successful UPDATE injections may lead to user privilege escalation, content modification, or administrative access.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-admin/"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - http.request.headers

  - question: What other WordPress plugins or components has this attacker targeted?
    context: Attackers often enumerate multiple WordPress vulnerabilities as part of comprehensive site compromise attempts.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-content/plugins/"
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method

  - question: Has the attacker attempted to upload files or establish persistent access?
    context: SQL injection vulnerabilities are often chained with file upload attacks to establish persistent backdoors.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - url.path
        - http.request.body.content
        - http.response.status_code

  - question: What is the source IP reputation and attack history?
    context: SQL injection attacks often originate from known malicious infrastructure or compromised hosts used in web application attacks.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - geoip.src.country_name
        - threat_intel.src_ip

  - question: Are other WordPress sites in the network experiencing similar Flash Album Gallery attacks?
    context: Automated scanners often target multiple WordPress installations with the same vulnerability simultaneously.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Flash Album Gallery"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Has this WordPress installation been compromised based on subsequent administrative activities?
    context: Successful SQL injection may lead to unauthorized administrative access and malicious content modifications.
    range: +24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-admin/"
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method
        - http.response.status_code