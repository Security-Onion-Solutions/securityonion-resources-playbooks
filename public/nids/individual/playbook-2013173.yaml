name: ET USER_AGENTS Atomic_Email_Hunter User-Agent Inbound
id: 22013173
description: |
  Detects inbound HTTP requests using the Atomic_Email_Hunter user agent string.
  This tool is commonly used for email harvesting and reconnaissance activities.
  May indicate automated email collection or potential reconnaissance against web services.
type: detection
detection_id: 2013173
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete user agent string and HTTP request details?
    context: Understanding the full user agent and request helps confirm tool identification and target assessment.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.user_agent
        - http.request.method
        - url.full
        - http.request.headers

  - question: What specific web resources were being accessed by this tool?
    context: Identifying target URLs reveals what information or services the tool was attempting to harvest.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.user_agent|contains: "Atomic_Email_Hunter"
        condition: selection
      fields:
        - url.path
        - url.query
        - http.response.status_code
        - http.response.body.bytes

  # Type 2: Triage Assessment
  - question: Is this tool usage authorized for legitimate email marketing or research?
    context: Atomic Email Hunter can be used legitimately for marketing research, requiring validation of business authorization.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.user_agent|contains: "Atomic_Email_Hunter"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - http.request.method

  - question: Does this activity align with documented business processes or marketing activities?
    context: Legitimate use should correlate with business hours and authorized marketing campaigns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.user_agent
        - url.domain
        - dst_port

  # Type 3: Activity Context
  - question: What other reconnaissance or scanning activity occurred from this source?
    context: Email harvesting tools are often part of broader reconnaissance campaigns.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "attempted-recon"
            - "web-application-attack"
            - "policy-violation"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port

  - question: What was the sequence of web requests leading to this detection?
    context: Understanding request patterns helps identify the harvesting methodology and scope.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.request.method
        - url.path
        - http.response.status_code
        - http.user_agent

  # Type 4: Impact Assessment
  - question: What sensitive information or email addresses were potentially harvested?
    context: Determining data exposure helps assess privacy and security impact.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - url.path
        - http.response.body.bytes
        - http.response.mime_type

  - question: Were any contact forms or email-related endpoints successfully accessed?
    context: Successful access to contact pages or forms indicates potential data collection success.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - "contact"
            - "email"
            - "subscribe"
            - "newsletter"
            - "form"
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - dst_ip

  # Type 5: Forensic Deep-Dive
  - question: What is the geographic origin and infrastructure details of the source?
    context: Understanding attacker infrastructure helps with attribution and blocking decisions.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.bytes
        - network.packets

  - question: Are there indicators of automated versus manual tool operation?
    context: Request timing and patterns reveal whether this is automated harvesting or manual research.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.user_agent
        - url.domain
        - http.request.method

  # Type 6: Enterprise Correlation
  - question: Are other internal systems being targeted by similar email harvesting tools?
    context: Coordinated harvesting across multiple systems indicates a broader campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Email_Hunter"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this part of a broader reconnaissance campaign against the organization?
    context: Email harvesting often precedes targeted phishing or social engineering attacks.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "attempted-recon"
            - "policy-violation"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category