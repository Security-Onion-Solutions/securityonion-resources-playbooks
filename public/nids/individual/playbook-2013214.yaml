name: ET MALWARE Gh0st Remote Access Trojan Encrypted Session To CnC Server
id: 22013214
description: |
  Detects Gh0st Remote Access Trojan establishing encrypted communication with command and control servers.
  This signature identifies the distinctive "Gh0st" identifier in network traffic, indicating active RAT communication.
  Legitimate applications would not contain this specific malware identifier.
type: detection
detection_id: 2013214
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact content and size of the Gh0st RAT communication packet?
    context: Understanding the packet structure helps confirm RAT activity and identify communication patterns.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - flow.bytes_toserver
        - flow.bytes_toclient

  - question: What is the complete network flow pattern for this Gh0st RAT session?
    context: RAT communications often follow predictable patterns that help distinguish from legitimate traffic.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - proto
        - conn_state
        - duration

  # Type 2: Triage Assessment
  - question: Is this destination IP associated with known legitimate services for this host?
    context: Helps eliminate false positives by checking if the connection target is expected business infrastructure.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto

  - question: Has this source host exhibited normal business communication patterns recently?
    context: Establishes baseline behavior to determine if RAT activity represents a deviation from normal operations.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto

  # Type 3: Activity Context
  - question: What process initiated this network connection on the source host?
    context: Identifying the parent process helps determine how the RAT was executed and its persistence mechanism.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User
        - ProcessGuid

  - question: What other network connections occurred from this host around the same time?
    context: RAT infections often involve multiple network connections for different malicious purposes.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  # Type 4: Impact Assessment
  - question: Has the RAT established persistent communication channels?
    context: Determines if the malware has successfully established ongoing C2 communication for remote control.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - duration
        - conn_state

  - question: What data volumes have been transferred in this RAT session?
    context: Large data transfers may indicate data exfiltration or additional payload downloads.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - orig_bytes
        - resp_bytes
        - duration

  # Type 5: Forensic Deep-Dive
  - question: Are there indicators of Gh0st RAT file artifacts on the infected system?
    context: Gh0st RAT typically drops specific files and registry entries that confirm the infection.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256

  - question: What registry modifications occurred that might indicate RAT persistence?
    context: Gh0st RAT commonly modifies Windows registry for persistence and configuration storage.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details
        - EventType

  # Type 6: Enterprise Correlation
  - question: Are other hosts in the network communicating with the same C2 server?
    context: RAT campaigns often target multiple systems, indicating broader compromise scope.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - proto

  - question: Has this Gh0st RAT campaign affected multiple enterprise systems?
    context: Identifies the scope of compromise and helps prioritize incident response efforts.
    range: +/-48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Gh0st"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name