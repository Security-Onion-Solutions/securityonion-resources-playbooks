name: ET WEB_SPECIFIC_APPS Nuke Evolution Xtreme pid Parameter DELETE FROM SQL Injection Attempt
id: 22013304
description: |
  Detects SQL injection attempts targeting the Nuke Evolution Xtreme CMS via the pid parameter in the Tutorials module.
  This specific pattern indicates an attempt to execute DELETE FROM SQL commands through the showtutorial function.
  May trigger on legitimate database operations if the application processes user input containing these SQL keywords.
type: detection
detection_id: 2013304
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SQL injection payload in the pid parameter?
    context: Understanding the exact DELETE FROM statement reveals the attacker's intent to remove data from the database.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What specific tutorial ID or database table was targeted in the DELETE statement?
    context: Identifying the targeted table helps assess potential data loss and system impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  # Type 2: Triage Assessment
  - question: Is this server running Nuke Evolution Xtreme CMS legitimately?
    context: Confirming the presence of the vulnerable application helps validate the alert's relevance.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
        condition: selection
      fields:
        - src_ip
        - url.path
        - url.query

  - question: Are there legitimate administrative activities on this CMS around this time?
    context: Scheduled maintenance or content management could explain database-related activity.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  # Type 3: Activity Context
  - question: What other SQL injection attempts preceded this DELETE statement?
    context: Attackers often probe with SELECT statements before attempting destructive operations.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'SELECT'
            - 'UNION'
            - 'INSERT'
            - 'UPDATE'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method

  - question: What was the sequence of requests leading to this SQL injection attempt?
    context: Understanding the attack progression helps identify reconnaissance and exploitation phases.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code

  # Type 4: Impact Assessment
  - question: Did the SQL injection attempt receive a successful HTTP response?
    context: A 200 response code may indicate successful SQL execution and potential data deletion.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - url.full

  - question: Are there signs of data exfiltration following the DELETE attempt?
    context: Attackers may extract data before deletion or verify successful removal.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - bytes_out
        - bytes_in
        - dst_port

  # Type 5: Forensic Deep-Dive
  - question: What database errors or responses indicate successful SQL execution?
    context: Error messages or unusual response patterns can confirm whether the DELETE statement executed.
    range: +10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.full

  - question: Are there additional SQL injection payloads targeting other CMS modules?
    context: Attackers often expand their attack surface once they identify a vulnerable application.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'DELETE'
            - 'DROP'
            - 'TRUNCATE'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method

  # Type 6: Enterprise Correlation
  - question: Are other web servers in the environment experiencing similar SQL injection attempts?
    context: Coordinated attacks may target multiple systems running the same vulnerable CMS.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - 'DELETE FROM'
            - 'modules.php'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - url.query