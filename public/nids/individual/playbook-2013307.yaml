name: ET WEB_SPECIFIC_APPS Nuke Evolution Xtreme pid Parameter UPDATE SET SQL Injection Attempt
id: 22013307
description: |
  Detects SQL injection attempts targeting the Nuke Evolution Xtreme CMS via the pid parameter in the Tutorials module.
  This specific pattern indicates an attempt to execute UPDATE SET SQL commands to modify existing database records.
  May trigger on legitimate database operations if the application processes user input containing these SQL keywords.
type: detection
detection_id: 2013307
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete UPDATE SET payload in the pid parameter?
    context: Understanding the exact UPDATE statement reveals what data the attacker is attempting to modify.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What table, columns, and values are being targeted by the UPDATE SET statement?
    context: Identifying the modification target helps assess potential data corruption or privilege escalation.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains: 'UPDATE'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  # Type 2: Triage Assessment
  - question: Is this server running Nuke Evolution Xtreme CMS with update permissions?
    context: Confirming the vulnerable application and database write access validates the alert's severity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
          url.query|contains: 'name=Tutorials'
        condition: selection
      fields:
        - src_ip
        - url.path
        - url.query

  - question: Are there legitimate administrative updates or content edits on this CMS?
    context: Normal CMS operations like editing tutorials or updating content might generate similar database activity.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
          http.request.method: 'POST'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  # Type 3: Activity Context
  - question: What reconnaissance preceded this UPDATE SET attempt?
    context: Attackers typically gather existing data before modifying records to avoid detection.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'SELECT'
            - 'UNION'
            - 'SHOW'
            - 'DESCRIBE'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.response.status_code

  - question: What was the sequence of SQL injection attempts leading to this UPDATE?
    context: Understanding the attack progression helps identify the attacker's methodology and objectives.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/modules.php'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code

  # Type 4: Impact Assessment
  - question: Did the UPDATE SET statement execute successfully?
    context: Successful execution indicated by 200 responses may mean critical data was modified.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - url.full

  - question: Are there signs of privilege escalation or user account modification?
    context: UPDATE statements may be used to elevate user privileges or modify administrative accounts.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'admin'
            - 'privilege'
            - 'role'
            - 'permission'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  # Type 5: Forensic Deep-Dive
  - question: What specific data modifications are being attempted through the UPDATE statement?
    context: Analyzing the UPDATE payload reveals the attack's purpose and potential system compromise.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains: 'UPDATE SET'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.body.content

  - question: Are there attempts to modify user passwords or authentication credentials?
    context: UPDATE statements targeting authentication fields may indicate account takeover attempts.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'password'
            - 'hash'
            - 'salt'
            - 'auth'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.response.status_code

  - question: What WHERE conditions are being used to target specific records?
    context: Understanding the WHERE clause reveals which users or data records are being targeted.
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains:
            - 'WHERE'
            - 'user_id'
            - 'username'
        condition: selection
      fields:
        - url.query
        - url.full
        - http.request.method

  # Type 6: Enterprise Correlation
  - question: Are other systems experiencing similar UPDATE SET injection attempts?
    context: Coordinated attacks may target multiple vulnerable CMS installations to modify data across the organization.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - 'UPDATE SET'
            - 'modules.php'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - url.query