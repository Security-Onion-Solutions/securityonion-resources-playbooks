name: ET MALWARE FakeAV Landing Page
id: 22013332
description: |
  Detects access to fake antivirus landing pages used in scareware campaigns.
  Identifies specific URI parameter patterns used to track victims and customize fake security warnings.
  Legitimate antivirus vendors do not use this parameter combination for product pages.
type: detection
detection_id: 2013332
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete URI and parameter values in the fake antivirus request?
    context: The exact URI reveals victim tracking data and scareware campaign identifiers.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.path
        - url.query

  - question: What HTTP headers and user agent were used in the scareware communication?
    context: Headers provide insight into the victim's browser and potential targeting criteria.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.headers
        - http.request.user_agent
        - http.request.referrer

  - question: What content was served by the fake antivirus landing page?
    context: Response content reveals the specific scareware tactics and download links used.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  # Type 2: Triage Assessment
  - question: Is this user known to visit legitimate antivirus vendor websites?
    context: Establishes user browsing patterns to distinguish malicious from legitimate AV access.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - "symantec.com"
            - "mcafee.com"
            - "kaspersky.com"
            - "avg.com"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.request.user_agent

  - question: Was this access initiated by the user or through redirection?
    context: Determines if the user intentionally visited the site or was redirected through malicious advertising.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - http.request.referrer
        - http.response.status_code

  # Type 3: Activity Context
  - question: What web browsing activity led to this fake antivirus page?
    context: Identifies the infection vector and user behavior leading to scareware exposure.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.request.referrer
        - http.response.status_code

  - question: Were there any DNS queries for suspicious domains before this access?
    context: Reveals domain resolution patterns and potential malicious advertising networks.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What browser process was active during this scareware encounter?
    context: Identifies the specific browser and any associated processes that may be compromised.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - "chrome.exe"
            - "firefox.exe"
            - "iexplore.exe"
            - "edge.exe"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ParentImage

  # Type 4: Impact Assessment
  - question: Were any files downloaded following this fake antivirus page access?
    context: Determines if the user fell for the scareware and downloaded malicious software.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.extension|contains:
            - exe
            - msi
            - zip
            - scr
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size
        - User

  - question: Did the user execute any suspicious programs after visiting the scareware site?
    context: Identifies if fake antivirus software was installed and executed.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - "antivirus"
            - "security"
            - "cleaner"
            - "optimizer"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ParentImage

  # Type 5: Forensic Deep-Dive
  - question: What specific scareware campaign is indicated by the parameter structure?
    context: Parameter analysis helps identify the scareware family and distribution network.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "FakeAV"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - url.query
        - dst_ip

  - question: What payment or credential harvesting pages were accessed after the initial scareware?
    context: Identifies if the scam progressed to financial fraud or identity theft.
    range: +24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - "payment"
            - "billing"
            - "checkout"
            - "card"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.request.method

  # Type 6: Enterprise Correlation
  - question: Are other users in the network encountering similar fake antivirus pages?
    context: Determines campaign scope and identifies widespread scareware distribution.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "FakeAV"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What other scareware or malvertising activity is present in the network?
    context: Identifies coordinated scareware campaigns and malicious advertising networks.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "Scareware"
            - "FakeAV"
            - "Malvertising"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip