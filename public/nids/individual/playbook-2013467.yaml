name: ET WEB_SPECIFIC_APPS Joomla Community component userid parameter SELECT FROM SQL Injection Attempt
id: 22013467
description: |
  Detects SQL injection attempts targeting the Joomla Community component userid parameter.
  Attackers attempt to extract database information using SELECT FROM statements.
  Legitimate Joomla usage would not contain SQL keywords in userid parameters.
type: detection
detection_id: 2013467
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SQL injection payload in the userid parameter?
    context: Analyzing the full injection payload reveals the attacker's intent and sophistication level.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What specific database tables or columns was the attacker attempting to access?
    context: Understanding the target helps assess what sensitive data may be at risk.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.query|contains: "userid="
        condition: selection
      fields:
        - url.query
        - http.request.body.content

  # Type 2: Triage Assessment
  - question: Is this a legitimate administrative user accessing the Joomla Community component?
    context: Determines if this could be authorized administrative activity or confirmed attack.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "index.php"
        condition: selection
      fields:
        - url.query
        - http.request.method
        - bytes_out

  - question: Has this source IP made other legitimate requests to the Joomla site recently?
    context: Establishes baseline behavior to differentiate between legitimate users and attackers.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 3: Activity Context
  - question: What other SQL injection attempts has this attacker made?
    context: Understanding the attack pattern helps identify the scope of the penetration testing or attack.
    range: +/-2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - "SELECT"
            - "UNION"
            - "INSERT"
            - "UPDATE"
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method

  - question: What was the sequence of requests leading up to this injection attempt?
    context: Understanding the attack progression reveals reconnaissance and exploitation phases.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.response.status_code

  # Type 4: Impact Assessment
  - question: What was the web server's response to the SQL injection attempt?
    context: Server response codes and content reveal if the injection was successful.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - bytes_in

  - question: Are there signs of successful database access or data extraction?
    context: Determines if the attack was successful and what data may have been compromised.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - bytes_in
        - http.response.body.content
        - http.response.status_code

  # Type 5: Forensic Deep-Dive
  - question: What web application vulnerabilities is the attacker systematically testing?
    context: Understanding the attack methodology helps identify other potential vulnerabilities.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - "option=com_"
            - "userid="
            - "id="
        condition: selection
      fields:
        - url.query
        - url.path
        - http.request.method

  - question: What automated tools or scripts is the attacker using?
    context: User-Agent and request patterns reveal if this is manual testing or automated exploitation.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - http.request.method
        - url.path

  - question: What sensitive database information was potentially exposed?
    context: Analyzing response patterns helps understand what data may have been compromised.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          bytes_in|gt: 1000
        condition: selection
      fields:
        - bytes_in
        - http.response.body.content
        - url.query

  # Type 6: Enterprise Correlation
  - question: Are other web applications in the environment being targeted with similar attacks?
    context: Identifies if this is part of a broader campaign against the organization's web infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - "SELECT"
            - "UNION"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path