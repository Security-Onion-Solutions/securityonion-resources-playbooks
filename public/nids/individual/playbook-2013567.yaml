name: ET WEB_SPECIFIC_APPS Pranian Group e107 page Parameter Cross Site Scripting Vulnerability Attempt
id: 22013567
description: |
  Detects cross-site scripting (XSS) attempts targeting the e107 CMS pviewgallery plugin page parameter.
  Identifies malicious JavaScript injection attempts that could lead to session hijacking or credential theft.
  Legitimate gallery navigation does not contain script tags or event handlers in parameters.
type: detection
detection_id: 2013567
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact XSS payload injected into the page parameter?
    context: The specific payload reveals the attacker's intent and sophistication level.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What HTTP headers and user agent were used in the XSS attack?
    context: Headers provide insight into the attack tool and potential automation.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.headers
        - http.request.user_agent
        - http.request.referrer

  - question: How did the web server respond to the XSS injection attempt?
    context: Server response indicates if the XSS payload was successfully reflected or blocked.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.headers

  # Type 2: Triage Assessment
  - question: Is this a legitimate user testing the application or an automated attack?
    context: Determines if this is authorized security testing or malicious exploitation.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.request.user_agent

  - question: Does this source IP show patterns of web application scanning?
    context: Multiple injection attempts indicate automated vulnerability scanning or exploitation.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - "script"
            - "alert"
            - "onload"
            - "onerror"
        condition: selection
      fields:
        - dst_ip
        - url.path
        - url.query

  # Type 3: Activity Context
  - question: What other web application attacks preceded this XSS attempt?
    context: Identifies if this is part of a broader web application attack campaign.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: "web-application-attack"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.path

  - question: What reconnaissance activity occurred before this XSS attack?
    context: Reveals attacker methodology and target identification process.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: GET
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.request.user_agent

  - question: Were there any DNS queries for this target domain before the attack?
    context: Shows attack preparation and potential domain reconnaissance.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|expand: '%url.domain%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 4: Impact Assessment
  - question: Did the XSS payload successfully execute in any user browsers?
    context: Determines if the vulnerability was successfully exploited against real users.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "pviewgallery"
        condition: selection
      fields:
        - src_ip
        - http.request.user_agent
        - http.request.referrer
        - url.query

  - question: Were any cookies or session tokens potentially compromised?
    context: Identifies if the XSS attack could have led to session hijacking.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.headers|contains: "Cookie"
        condition: selection
      fields:
        - dst_ip
        - http.request.headers
        - url.domain

  # Type 5: Forensic Deep-Dive
  - question: What specific e107 CMS version and configuration is running on the target?
    context: Determines vulnerability status and required patching actions.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "e107"
        condition: selection
      fields:
        - http.response.headers
        - http.response.body.content
        - url.path

  - question: What other XSS vulnerabilities exist in this web application?
    context: Identifies additional attack vectors and security weaknesses.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "Cross Site Scripting"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - url.path

  - question: Are there signs of successful payload delivery or data exfiltration?
    context: Determines if the XSS attack progressed to data theft or further compromise.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.request.body.content

  # Type 6: Enterprise Correlation
  - question: Are other web applications in the network under similar XSS attack?
    context: Determines attack campaign scope and identifies additional vulnerable systems.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Cross Site Scripting"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What other web application vulnerabilities are being exploited by this attacker?
    context: Identifies attacker methodology and additional security risks.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: "web-application-attack"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category