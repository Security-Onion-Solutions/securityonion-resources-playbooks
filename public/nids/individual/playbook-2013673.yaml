name: ET WEB_SPECIFIC_APPS WordPress Tune Library Plugin letter parameter SELECT FROM SQL Injection Attempt
id: 22013673
description: |
  Detects SQL injection attempts targeting the WordPress Tune Library Plugin via the letter parameter.
  This specific variant attempts SELECT FROM operations to extract database information.
  May trigger on legitimate queries containing these SQL keywords in user input.
type: detection
detection_id: 2013673
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact SQL injection payload in the letter parameter?
    context: Understanding the complete injection string reveals the attacker's database extraction intent and technique sophistication.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content

  - question: What other parameters were included in this tune-library-ajax.php request?
    context: Additional parameters may reveal the full scope of the injection attempt and potential data being targeted.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.referrer

  - question: Is this WordPress site regularly accessed by this source IP for legitimate purposes?
    context: Determines if this is an external attack or potentially authorized penetration testing activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user_agent.original

  - question: Are there other WordPress admin or plugin access attempts from this IP?
    context: Multiple WordPress-focused requests indicate targeted reconnaissance or attack campaign against the CMS.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - '/wp-admin/'
            - '/wp-content/plugins/'
            - '/wp-login.php'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code

  - question: What preceded this SQL injection attempt in the attack sequence?
    context: Understanding the attack timeline helps identify reconnaissance activities and entry vectors used by the attacker.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: Did the SQL injection attempt receive a successful HTTP response?
    context: Response codes and content length indicate whether the injection was processed and potentially successful.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.body.content

  - question: What database information could be extracted if this injection succeeded?
    context: Successful SELECT FROM injections can reveal database structure, user credentials, and sensitive application data.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/tune-library/'
        condition: selection
      fields:
        - http.response.body.bytes
        - http.response.status_code
        - url.query

  - question: Are there signs of successful data exfiltration following this injection?
    context: Large response sizes or unusual data patterns may indicate successful database content extraction.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - network.bytes
        - network.packets
        - network.protocol

  - question: Has this WordPress plugin vulnerability been exploited on other servers?
    context: Multiple targets suggest an automated attack campaign exploiting this specific WordPress plugin vulnerability.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/tune-library/tune-library-ajax.php'
        condition: selection
      fields:
        - dst_ip
        - url.query
        - http.response.status_code

  - question: Are there other SQL injection patterns being attempted by this attacker?
    context: Multiple injection techniques indicate sophisticated attack methodology and persistent threat actor behavior.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'SQL Injection'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: What is the geographic and network origin of this SQL injection attack?
    context: Attack origin analysis helps determine threat actor attribution and implement appropriate geographic blocking measures.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - source.geo.country_name
        - source.as.organization.name
        - user_agent.original