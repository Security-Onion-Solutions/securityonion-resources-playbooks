name: ET WEB_SPECIFIC_APPS WordPress Tune Library Plugin letter parameter DELETE FROM SQL Injection Attempt
id: 22013674
description: |
  Detects SQL injection attempts targeting the WordPress Tune Library Plugin via the letter parameter.
  This specific variant attempts DELETE FROM operations to remove database records.
  May trigger on legitimate queries containing these SQL keywords in user input.
type: detection
detection_id: 2013674
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact DELETE FROM SQL injection payload in the letter parameter?
    context: Understanding the complete deletion string reveals the attacker's intent to destroy database records and potential data targets.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content

  - question: What database tables or conditions were specified in the DELETE statement?
    context: Specific table names and WHERE conditions indicate which data the attacker intended to destroy or corrupt.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.referrer

  - question: Is this a legitimate database maintenance operation by authorized personnel?
    context: DELETE operations might be part of authorized database cleanup or maintenance activities during business hours.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user_agent.original

  - question: Are there other destructive SQL operations being attempted from this source?
    context: Multiple destructive SQL patterns indicate a coordinated attack aimed at data destruction or database corruption.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'DELETE FROM'
            - 'DROP TABLE'
            - 'TRUNCATE'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: What reconnaissance activity preceded this destructive injection attempt?
    context: Understanding the attack timeline helps identify how the attacker discovered the vulnerability and planned the destruction.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: Did the DELETE injection receive a response indicating successful execution?
    context: Response codes and timing indicate whether the destructive SQL command was processed and potentially executed.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.body.content

  - question: What critical data could be lost if this DELETE injection succeeded?
    context: Successful DELETE operations can permanently destroy user data, configuration settings, and application functionality.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/tune-library/'
        condition: selection
      fields:
        - http.response.body.bytes
        - http.response.status_code
        - url.query

  - question: Are there signs of database corruption or application malfunction following this attempt?
    context: Successful DELETE injections may cause immediate application errors or database integrity issues.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - 500
            - 502
            - 503
        condition: selection
      fields:
        - src_ip
        - http.response.status_code
        - url.path

  - question: Has this destructive attack pattern been attempted against other WordPress sites?
    context: Multiple targets suggest an automated campaign aimed at widespread database destruction or extortion.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/tune-library/tune-library-ajax.php'
        condition: selection
      fields:
        - dst_ip
        - url.query
        - http.response.status_code

  - question: Are there other WordPress plugin vulnerabilities being exploited by this attacker?
    context: Multiple plugin exploits indicate systematic WordPress site compromise and potential for widespread damage.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'WordPress'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: What is the threat actor profile behind this destructive SQL injection campaign?
    context: Attack patterns and infrastructure help identify whether this is ransomware, hacktivism, or competitive sabotage.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - source.geo.country_name
        - source.as.organization.name
        - user_agent.original