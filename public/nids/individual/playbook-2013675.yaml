name: ET WEB_SPECIFIC_APPS WordPress Tune Library Plugin letter parameter UNION SELECT SQL Injection Attempt
id: 22013675
description: |
  Detects SQL injection attempts targeting the WordPress Tune Library Plugin via the letter parameter.
  This specific variant attempts UNION SELECT operations to extract data from multiple database tables.
  May trigger on legitimate queries containing these SQL keywords in user input.
type: detection
detection_id: 2013675
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact UNION SELECT SQL injection payload in the letter parameter?
    context: Understanding the complete UNION statement reveals the attacker's data extraction strategy and targeted database columns.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content

  - question: How many columns and what data types are being extracted via UNION SELECT?
    context: Column count and data types indicate the sophistication of the injection and potential sensitive information targets.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.referrer

  - question: Is this WordPress site regularly accessed by this source for legitimate database queries?
    context: Determines if this is an external attack or potentially authorized database access for development purposes.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user_agent.original

  - question: Are there other advanced SQL injection techniques being used by this attacker?
    context: Multiple advanced injection methods indicate sophisticated database exploitation skills and persistent attack attempts.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'UNION SELECT'
            - 'ORDER BY'
            - 'GROUP BY'
            - 'HAVING'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: What database enumeration preceded this UNION SELECT injection?
    context: Understanding the reconnaissance phase helps identify how the attacker determined the database structure for the UNION attack.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: Did the UNION SELECT injection return data indicating successful extraction?
    context: Response size and content patterns reveal whether the injection successfully bypassed security and extracted database information.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.body.content

  - question: What sensitive information could be exposed through this UNION SELECT attack?
    context: Successful UNION injections can expose user credentials, personal data, and internal application configuration details.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/tune-library/'
        condition: selection
      fields:
        - http.response.body.bytes
        - http.response.status_code
        - url.query

  - question: Are there signs of credential harvesting or privilege escalation following this injection?
    context: Successful data extraction may lead to credential reuse attempts or elevated access to administrative functions.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - '/wp-login.php'
            - '/wp-admin/'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code

  - question: Has this UNION SELECT technique been used against other WordPress installations?
    context: Multiple targets suggest an automated exploitation campaign targeting this specific WordPress plugin vulnerability.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/tune-library/tune-library-ajax.php'
        condition: selection
      fields:
        - dst_ip
        - url.query
        - http.response.status_code

  - question: Are there other data extraction methods being employed by this threat actor?
    context: Multiple extraction techniques indicate comprehensive database compromise attempts and advanced persistent threat behavior.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'SQL Injection'
            - 'Data Extraction'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: What is the technical sophistication level of this UNION SELECT attack campaign?
    context: Attack complexity and infrastructure analysis helps determine threat actor capabilities and potential attribution indicators.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - source.geo.country_name
        - source.as.organization.name
        - user_agent.original