name: ET HUNTING Suspicious HTTP Request for gift.exe
id: 22013780
description: |
  Detects HTTP requests for gift.exe, commonly associated with malware distribution.
  May indicate malware download attempt or legitimate software with suspicious naming.
type: detection
detection_id: 2013780
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete URL requested for gift.exe?
    context: The full URL and hosting domain help identify the malware distribution source.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.request.header.user_agent

  - question: Is this download request part of normal business activity?
    context: Gift.exe may be legitimate software, though the name is commonly used by malware.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - http.request.method
        - http.response.status_code

  - question: Was the gift.exe file successfully downloaded?
    context: Successful download indicates potential malware infection requiring immediate response.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "gift.exe"
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - url.full

  - question: What process or application initiated this download?
    context: Identifying the requesting process helps determine if user-initiated or automated malware behavior.
    range: -15m/+5m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  - question: Are there signs of gift.exe execution on the system?
    context: File execution indicates successful malware deployment requiring containment.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains: "gift.exe"
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What other suspicious downloads occurred from this host?
    context: Multiple suspicious downloads may indicate broader malware campaign or compromised system.
    range: -2h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - ".exe"
            - ".scr"
            - ".bat"
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - dst_ip

  - question: Has this host shown other malware-related activity?
    context: Additional malware indicators help confirm infection and assess campaign scope.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "MALWARE"
            - "TROJAN"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port

  - question: Are there file creation events for gift.exe?
    context: File system activity confirms successful download and potential execution preparation.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.name|contains: "gift.exe"
        condition: selection
      fields:
        - file.path
        - file.hash.md5
        - file.size
        - User

  - question: What is the reputation of the hosting domain?
    context: Domain reputation helps assess if this is known malware infrastructure.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name

  - question: Are other internal systems accessing the same malicious domain?
    context: Multiple internal hosts accessing the same source indicates potential enterprise-wide campaign.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.domain|expand: '%url.domain%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.response.status_code