name: ET INFO Incoming Chromoting Session Response
id: 22013801
description: |
  Detects incoming Google Chrome Remote Desktop (Chromoting) session responses from internal systems to external networks.
  May indicate legitimate remote access sessions but could also represent data exfiltration or unauthorized access.
type: detection
detection_id: 2013801
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete Chromoting protocol signature detected?
    context: Understanding the protocol structure helps confirm legitimate Chrome Remote Desktop traffic versus potential misuse.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: What are the connection characteristics of this outbound Chromoting session?
    context: Connection metadata reveals session patterns, data flow direction, and communication volume.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - conn_state
        - duration

  # Type 2: Triage Assessment
  - question: Is this outbound remote access session authorized for this user or system?
    context: Legitimate outbound Chrome Remote Desktop usage should be documented and approved for business purposes.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains: "chrome"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine

  - question: Does this activity align with expected user behavior and business hours?
    context: Unexpected outbound remote access may indicate compromised systems being used for unauthorized purposes.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - app_proto
        - bytes_toserver

  # Type 3: Activity Context
  - question: What user activity initiated this outbound remote desktop session?
    context: Understanding what triggered the outbound session helps determine legitimacy and purpose.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  - question: Are there signs of system compromise preceding this remote access?
    context: Compromised systems may be used to establish unauthorized outbound remote access channels.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "MALWARE"
            - "EXPLOIT"
            - "TROJAN"
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - dst_ip

  - question: What network connections were established before this remote session?
    context: Prior network activity helps identify if the system was compromised or accessed remotely before initiating outbound connections.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - src_port
        - app_proto
        - bytes_toserver

  # Type 4: Impact Assessment
  - question: What data or files were accessed before this outbound remote session?
    context: File access patterns help determine if sensitive data may have been exposed through the remote connection.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - "Documents"
            - "Desktop"
            - ".doc"
            - ".xls"
            - ".pdf"
        condition: selection
      fields:
        - TargetFilename
        - User
        - ProcessGuid

  - question: Is there evidence of data transfer during this outbound session?
    context: Large outbound data transfers may indicate data exfiltration through the remote access channel.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          bytes_toserver: ">5000000"
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - app_proto

  # Type 5: Forensic Deep-Dive
  - question: What Chrome Remote Desktop configuration was used for this outbound connection?
    context: Configuration details reveal how the outbound remote access was established and authorized.
    range: -48h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains: "Chrome Remote Desktop"
        condition: selection
      fields:
        - TargetObject
        - Details
        - User

  - question: Were any credentials or authentication tokens accessed before the session?
    context: Credential access may indicate how the outbound remote session was authenticated or authorized.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - "credential"
            - "password"
            - "token"
            - ".pfx"
        condition: selection
      fields:
        - TargetFilename
        - User
        - ProcessGuid

  - question: What processes were running during the outbound remote session?
    context: Process activity during the session reveals the purpose and potential malicious use of the remote connection.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are there multiple systems initiating outbound Chromoting sessions to the same destination?
    context: Multiple systems connecting to the same external destination may indicate coordinated data exfiltration or compromise.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: "Chromoting"
        condition: selection
      fields:
        - src_ip
        - alert.signature
        - dst_ip

  - question: Have any other outbound remote access methods been detected across the network?
    context: Multiple outbound remote access channels may indicate systematic data exfiltration or persistent threat activity.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains:
            - "Remote"
            - "RDP"
            - "VNC"
            - "TeamViewer"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature