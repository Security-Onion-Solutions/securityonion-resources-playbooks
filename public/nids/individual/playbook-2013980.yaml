name: ET WEB_SPECIFIC_APPS Tinderbox.mozilla.org showbuilds.cgi Cross Site Scripting Attempt
id: 22013980
description: |
  Detects cross-site scripting (XSS) attempts targeting Mozilla Tinderbox showbuilds.cgi script.
  This alert indicates potential web application exploitation attempting to inject malicious JavaScript.
  Legitimate use of showbuilds.cgi should not contain script tags or event handlers in parameters.
type: detection
detection_id: 2013980
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact XSS payload attempted in the showbuilds.cgi request?
    context: The specific payload reveals the attacker's intent and potential impact of the XSS attempt.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query

  - question: What JavaScript events or script tags were detected in the malicious request?
    context: Different XSS vectors indicate varying levels of sophistication and potential browser exploitation.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.user_agent

  - question: Is this a legitimate Mozilla developer accessing the Tinderbox interface?
    context: Mozilla developers regularly access Tinderbox for build monitoring, but should not trigger XSS patterns.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - "/showbuilds.cgi"
            - "/tinderbox"
        condition: selection
      fields:
        - url.full
        - http.user_agent

  - question: What other web application attacks have originated from this source IP?
    context: XSS attempts often occur as part of broader web application reconnaissance or attack campaigns.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "WEB_APPLICATION_ATTACK"
            - "XSS"
        condition: selection
      fields:
        - rule.name
        - dst_ip

  - question: Has the target web server responded with error codes or successful responses?
    context: Server response codes indicate whether the XSS attempt was successful or blocked by security controls.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes

  - question: Are there signs of successful XSS exploitation or session hijacking?
    context: Successful XSS may result in cookie theft, session manipulation, or additional malicious requests.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.headers
        - url.full

  - question: What is the geographic origin and reputation of the attacking IP address?
    context: XSS attacks often originate from known malicious IP ranges or compromised systems.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dst_port
        - network.bytes

  - question: Has this XSS pattern been attempted against other web applications in the environment?
    context: Attackers often use automated tools to test XSS payloads against multiple web applications.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category: "WEB_APPLICATION_ATTACK"
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: What web application security controls are in place for this target server?
    context: Understanding existing protections helps assess the likelihood of successful exploitation.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.response.headers
        - http.response.status_code

  - question: Are there indicators of automated scanning or manual exploitation attempts?
    context: Request patterns and timing can distinguish between automated tools and targeted manual attacks.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.user_agent