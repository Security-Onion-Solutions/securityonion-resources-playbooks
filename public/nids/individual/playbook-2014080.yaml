name: ET WEB_SPECIFIC_APPS Mambo Zorder zorder Parameter UPDATE SET SQL Injection Vulnerability
id: 22014080
description: |
  Detects SQL injection attempts targeting the Mambo CMS zorder parameter via UPDATE SET statements.
  This vulnerability allows attackers to modify database records through the administrator interface.
  May trigger on legitimate administrative operations involving record ordering or database maintenance.
type: detection
detection_id: 2014080
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SQL UPDATE SET payload in the zorder parameter?
    context: Understanding the injection syntax reveals the specific database modification being attempted.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query

  - question: What specific database fields were targeted in the UPDATE SET operation?
    context: Identifying targeted database columns helps assess the scope of potential data manipulation.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/index2.php'
        condition: selection
      fields:
        - url.query
        - http.request.method
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Is this Mambo CMS administrator interface legitimately accessed by authorized users?
    context: Distinguishing between legitimate administrative access and malicious exploitation attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.response.status_code

  - question: Are there normal zorder operations performed by legitimate administrators?
    context: The zorder parameter is used for content ordering in CMS systems and may have legitimate uses.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.query|contains: 'zorder='
        condition: selection
      fields:
        - src_ip
        - url.query
        - http.response.status_code

  # Type 3: Activity Context
  - question: What authentication or session establishment preceded this administrator access?
    context: SQL injection through admin interfaces often follows authentication bypass or credential compromise.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What other administrator interface parameters were tested before the zorder exploitation?
    context: Attackers typically enumerate multiple parameters before finding exploitable injection points.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/administrator/index2.php'
        condition: selection
      fields:
        - url.query
        - http.response.status_code
        - http.response.body.bytes

  # Type 4: Impact Assessment
  - question: Did the SQL injection attempt successfully modify database records?
    context: HTTP response patterns indicate whether the UPDATE statement was processed by the database.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/index2.php'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.mime_type

  - question: Are there signs of administrative privilege escalation following the injection?
    context: Successful database modification may lead to unauthorized administrative access or privilege changes.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 5: Forensic Deep-Dive
  - question: What other Mambo CMS vulnerabilities has this attacker attempted to exploit?
    context: Understanding the full scope of CMS-targeted attacks reveals attacker methodology and persistence.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Mambo'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: Has this source IP targeted other CMS administrator interfaces across the network?
    context: Coordinated attacks often target administrative interfaces across multiple CMS installations.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.response.status_code

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar Mambo CMS zorder parameter exploitation attempts?
    context: Identifying campaign scope across multiple CMS installations helps understand attack coordination.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Mambo Zorder'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name