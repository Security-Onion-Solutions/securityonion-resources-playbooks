name: ET WEB_SPECIFIC_APPS Planex Mini-300PU & Mini100s Cross-site Scripting Attempt
id: 22014086
description: |
  Detects cross-site scripting (XSS) attempts targeting Planex Mini-300PU and Mini100s devices via the RESTART.HTM page.
  This vulnerability allows injection of malicious scripts through the NDSContext parameter.
  May trigger on legitimate configuration changes if similar parameter patterns are used in device management.
type: detection
detection_id: 2014086
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete XSS payload injected through the NDSContext parameter?
    context: Understanding the script injection reveals the attacker's intent and potential impact on device users.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query

  - question: What specific JavaScript events or HTML elements were targeted in the XSS attempt?
    context: Identifying the XSS vector helps assess the sophistication and potential impact of the attack.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/RESTART.HTM'
        condition: selection
      fields:
        - url.query
        - http.request.method
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Is this Planex device legitimately managed by authorized network administrators?
    context: Distinguishing between legitimate device management and malicious exploitation attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 80
            - 443
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.response.status_code

  - question: Are there normal configuration or restart operations performed on this device?
    context: The RESTART.HTM page is used for device management and may have legitimate administrative uses.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: 'RESTART.HTM'
        condition: selection
      fields:
        - src_ip
        - url.query
        - http.response.status_code

  # Type 3: Activity Context
  - question: What device discovery or web interface enumeration preceded this XSS attempt?
    context: XSS attacks on embedded devices often follow network scanning and web interface discovery.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What other Planex device management pages were accessed before the XSS attempt?
    context: Attackers typically explore device interfaces before attempting specific vulnerability exploitation.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.response.body.bytes

  # Type 4: Impact Assessment
  - question: Did the XSS payload successfully execute in the device's web interface?
    context: HTTP response codes and content indicate whether the malicious script was processed and rendered.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: 'RESTART.HTM'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.mime_type

  - question: Are there signs of credential theft or session hijacking following the XSS attempt?
    context: Successful XSS attacks may lead to credential harvesting or administrative session compromise.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_port
        - network.bytes_sent
        - network.bytes_received

  # Type 5: Forensic Deep-Dive
  - question: What other XSS techniques has this attacker attempted against embedded devices?
    context: Understanding attack patterns helps identify the attacker's methodology and target preferences.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: 'web-application-attack'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: Has this source IP targeted other network devices or embedded systems?
    context: Coordinated attacks often target multiple devices with similar vulnerabilities across the network.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
            - 8080
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.response.status_code

  # Type 6: Enterprise Correlation
  - question: Are other Planex devices in the network showing similar XSS exploitation attempts?
    context: Identifying campaign scope across multiple devices helps understand attack coordination and impact.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Planex'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name