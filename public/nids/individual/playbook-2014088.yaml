name: ET WEB_SPECIFIC_APPS Mambo Zorder zorder Parameter DELETE FROM SQL Injection Vulnerability
id: 22014088
description: |
  Detects SQL injection attempts targeting the Mambo CMS zorder parameter via DELETE FROM statements.
  This vulnerability allows attackers to delete database records through the administrator interface.
  May trigger on legitimate administrative operations involving content removal or database maintenance.
type: detection
detection_id: 2014088
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SQL DELETE FROM payload in the zorder parameter?
    context: Understanding the injection syntax reveals the specific database records being targeted for deletion.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query

  - question: What specific database tables or conditions were targeted in the DELETE statement?
    context: Identifying deletion targets helps assess the scope of potential data destruction and system impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/index2.php'
        condition: selection
      fields:
        - url.query
        - http.request.method
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Is this Mambo CMS administrator interface legitimately accessed by authorized users?
    context: Distinguishing between legitimate administrative deletions and malicious data destruction attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.response.status_code

  - question: Are there normal content deletion operations performed through the zorder parameter?
    context: The zorder parameter may be used for legitimate content management and record removal operations.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.query|contains: 'zorder='
        condition: selection
      fields:
        - src_ip
        - url.query
        - http.response.status_code

  # Type 3: Activity Context
  - question: What authentication or session establishment preceded this administrator access?
    context: SQL injection through admin interfaces often follows authentication bypass or credential compromise.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: What other administrator interface parameters were tested before the zorder exploitation?
    context: Attackers typically enumerate multiple parameters before finding exploitable injection points.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/administrator/index2.php'
        condition: selection
      fields:
        - url.query
        - http.response.status_code
        - http.response.body.bytes

  # Type 4: Impact Assessment
  - question: Did the SQL injection attempt successfully delete database records?
    context: HTTP response codes and patterns indicate whether the DELETE statement was processed by the database.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/index2.php'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - http.response.mime_type

  - question: Are there signs of widespread data destruction or system instability following the injection?
    context: Successful DELETE injection may cause application errors, data loss, or system functionality issues.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/administrator/'
        condition: selection
      fields:
        - http.response.status_code
        - http.request.method
        - url.path

  # Type 5: Forensic Deep-Dive
  - question: What other destructive SQL injection techniques has this attacker employed?
    context: Understanding the full scope of SQL injection attempts reveals attacker methodology and destructive intent.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Mambo'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.full

  - question: Has this source IP attempted to exploit other CMS platforms with similar deletion capabilities?
    context: Coordinated attacks often target multiple CMS installations using similar destructive SQL injection techniques.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: 'web-application-attack'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar Mambo CMS DELETE FROM injection attempts?
    context: Identifying campaign scope across multiple CMS installations helps understand coordinated destruction attempts.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Mambo Zorder'
          rule.name|contains: 'DELETE FROM'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name