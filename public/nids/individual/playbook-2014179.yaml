name: ET WEB_SPECIFIC_APPS Joomla mod_currencyconverter from Cross Site Scripting Attempt
id: 22014179
description: |
  Detects cross-site scripting attempts targeting Joomla Currency Converter module via the 'from' parameter.
  Attackers inject JavaScript code to steal credentials or perform unauthorized actions in user browsers.
type: detection
detection_id: 2014179
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What JavaScript payload was injected via the 'from' parameter?
    context: Understanding the XSS payload reveals the attacker's objective and potential impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method

  - question: Is this a legitimate Joomla site that should be publicly accessible?
    context: Verifies if this is an authorized web application or exposed vulnerability.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: What triggered this XSS attack attempt against the Currency Converter module?
    context: Identifies if this is automated scanning or targeted exploitation of known vulnerability.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - dst_ip

  - question: How did the web application respond to this XSS injection attempt?
    context: Determines if the application is vulnerable and reflected the malicious script.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content

  - question: Has this XSS attack successfully executed in victim browsers?
    context: Confirms if the reflected XSS led to credential theft or session hijacking.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - url.full
        - http.request.headers

  - question: What other Joomla components has this attacker probed for vulnerabilities?
    context: Reveals the scope of reconnaissance against the Joomla installation.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query

  - question: Are there signs of successful administrative access or privilege escalation?
    context: Determines if XSS led to admin session hijacking or account compromise.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - src_ip

  - question: What sensitive data could be accessed through this XSS vulnerability?
    context: Assesses potential data exposure from successful cross-site scripting.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - src_ip

  - question: Has this attacker targeted other web applications with XSS attacks?
    context: Identifies broader cross-site scripting campaign across the environment.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: Cross Site Scripting
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: Are other systems showing similar Joomla XSS exploitation attempts?
    context: Determines if this is part of coordinated attacks against Joomla installations.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: Joomla
          rule.name|contains: Cross Site Scripting
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path