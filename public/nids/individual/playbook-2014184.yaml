name: ET WEB_SPECIFIC_APPS IBBY nouvelles.php id Parameter SELECT FROM SQL Injection Attempt
id: 22014184
description: |
  Detects SQL injection attempts targeting IBBY application's nouvelles.php script via the 'id' parameter.
  Attackers attempt to extract data using SELECT FROM statements to compromise the database.
type: detection
detection_id: 2014184
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SQL injection payload in the 'id' parameter?
    context: Understanding the SQL syntax reveals the attacker's database access intent and skill level.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method

  - question: Is this IBBY application supposed to be accessible from external networks?
    context: Determines if this is an authorized application or exposed database vulnerability.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: What reconnaissance activity preceded this SQL injection attempt?
    context: Identifies if this was targeted exploitation or automated vulnerability scanning.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method

  - question: How did the database application respond to this SQL injection?
    context: Determines if the injection was successful and data was extracted.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content

  - question: Has sensitive database information been successfully extracted?
    context: Confirms if the SQL injection led to data breach or information disclosure.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: What other SQL injection techniques has this attacker attempted?
    context: Reveals the sophistication and persistence of the database attack campaign.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: SQL Injection
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path

  - question: Are there signs of database compromise or unauthorized access?
    context: Identifies if SQL injection led to backend database server compromise.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage

  - question: What database tables or sensitive data could be accessed via this injection?
    context: Assesses potential data exposure from successful SQL injection attack.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.query
        - http.response.body.content

  - question: Has this attacker targeted other web applications with SQL injection?
    context: Determines scope of database-focused attack campaign across the environment.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: SQL Injection
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: Are other systems showing similar IBBY application exploitation attempts?
    context: Identifies coordinated attacks against multiple IBBY installations.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: IBBY
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path