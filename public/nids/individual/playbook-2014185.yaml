name: ET WEB_SPECIFIC_APPS IBBY nouvelles.php id Parameter DELETE FROM SQL Injection Attempt
id: 22014185
description: |
  Detects destructive SQL injection attempts targeting IBBY application's nouvelles.php script via DELETE FROM statements.
  Attackers attempt to delete database records, potentially causing data loss or service disruption.
type: detection
detection_id: 2014185
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete DELETE FROM SQL injection payload?
    context: Understanding the destructive SQL reveals which tables/data the attacker targeted for deletion.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method

  - question: Is this IBBY application authorized for external access?
    context: Verifies if this is a legitimate application or exposed critical vulnerability.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method

  - question: What attack progression led to this destructive SQL injection attempt?
    context: Identifies if this escalated from reconnaissance to deliberate data destruction.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.name
        - url.path

  - question: Was this DELETE FROM injection successfully executed by the database?
    context: Critical to determine if data destruction occurred and assess damage scope.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content

  - question: Has critical database data been deleted or corrupted?
    context: Confirms the impact of destructive SQL injection on data integrity.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - src_ip

  - question: What other destructive SQL operations has this attacker attempted?
    context: Reveals the full scope of potential data destruction and malicious intent.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - DELETE FROM
            - DROP TABLE
            - TRUNCATE
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path

  - question: Are there signs of database server compromise or unauthorized administrative access?
    context: Determines if SQL injection led to backend database server takeover.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage

  - question: What is the business impact of potential data deletion from this attack?
    context: Assesses criticality by understanding what application data could be destroyed.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - src_ip

  - question: Has this attacker launched destructive attacks against other database applications?
    context: Identifies coordinated destructive campaign across multiple database systems.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - DELETE FROM
            - SQL Injection
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: Are other IBBY installations showing similar destructive injection attempts?
    context: Determines if this is part of targeted campaign against IBBY application infrastructure.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: IBBY
          rule.name|contains: DELETE FROM
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.path