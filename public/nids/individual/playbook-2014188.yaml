name: ET WEB_SPECIFIC_APPS IBBY nouvelles.php id Parameter UPDATE SET SQL Injection Attempt
id: 22014188
description: |
  Detects SQL injection attempts targeting the IBBY application's nouvelles.php script via the id parameter.
  This specific pattern indicates attempts to modify database records using UPDATE SET statements.
  Legitimate use would not contain SQL keywords in URL parameters.
type: detection
detection_id: 2014188
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SQL injection payload in the nouvelles.php request?
    context: Analyzing the full injection string reveals the attacker's intent and target database structure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method
        - http.request.headers

  - question: What specific UPDATE SET operation was the attacker attempting?
    context: Understanding the modification attempt helps assess potential data integrity impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method

  # Type 2: Triage Assessment
  - question: Is this a legitimate administrative operation on the IBBY application?
    context: Determining if this represents authorized database maintenance versus malicious injection.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: "/nouvelles.php"
        condition: selection
      fields:
        - url.query
        - http.request.method
        - http.response.status_code

  - question: Does this source IP have authorized access to administrative functions?
    context: Assessing if the request originates from a known administrative user or system.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 3: Activity Context
  - question: What preceded this SQL injection attempt?
    context: Understanding the attack sequence helps identify reconnaissance or exploitation phases.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.method
        - http.response.status_code

  - question: Were there other SQL injection attempts or web application probing from this source?
    context: Identifying broader web application attack patterns and reconnaissance activities.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "WEB_APPLICATION"
            - "SQL_INJECTION"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  # Type 4: Impact Assessment
  - question: Did the web server respond with database error messages or success indicators?
    context: Determining if the SQL injection was successful and database structure was exposed.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - network.bytes

  - question: What was the server's response to this injection attempt?
    context: Assessing whether the attack succeeded and what information may have been disclosed.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - network.bytes

  # Type 5: Forensic Deep-Dive
  - question: What specific database tables or columns was the attacker targeting?
    context: Analyzing injection syntax reveals target database schema and sensitive data locations.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.headers.user_agent

  - question: Are there signs of successful data modification or extraction?
    context: Determining if the injection resulted in unauthorized database changes or data theft.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/nouvelles.php"
        condition: selection
      fields:
        - http.request.method
        - http.response.status_code
        - network.bytes

  - question: What tools or techniques indicate this is part of an automated attack?
    context: Identifying attack automation helps understand threat actor capabilities and scale.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - url.path
        - http.request.method

  # Type 6: Enterprise Correlation
  - question: Are other web applications or servers experiencing similar SQL injection attacks?
    context: Understanding if this represents a targeted attack on IBBY or broader web application compromise.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: "WEB_APPLICATION"
          rule.name|contains: "SQL"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this source IP part of a coordinated attack against multiple targets?
    context: Identifying if this represents an isolated incident or part of a broader campaign.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "WEB_APPLICATION"
            - "EXPLOIT"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - rule.category