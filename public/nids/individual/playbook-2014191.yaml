name: ET MALWARE W32/118GotYourNo Reporting to CnC
id: 22014191
description: |
  Detects W32/118GotYourNo malware reporting to command and control server via HTTP POST.
  The malware sends system information using specific parameter patterns including appTitle, strLink, and timing data.
  Legitimate applications would not use this specific parameter combination.
type: detection
detection_id: 2014191
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What system information was transmitted in the POST request body?
    context: Analyzing the POST data reveals what sensitive information the malware collected from the infected system.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.full

  - question: What specific application and timing data was included in the malware report?
    context: Understanding the payload structure helps identify what system reconnaissance was performed.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path: "/count"
        condition: selection
      fields:
        - http.request.body.content
        - bytes_out

  # Type 2: Triage Assessment
  - question: Is this system authorized to communicate with the destination server?
    context: Determines if this is legitimate business communication or unauthorized malware activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - bytes_out
        - bytes_in

  - question: Has this source made other suspicious POST requests recently?
    context: Identifies if this is part of ongoing malicious communication patterns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "POST"
        condition: selection
      fields:
        - url.domain
        - url.path
        - bytes_out

  # Type 3: Activity Context
  - question: What process initiated this malware communication?
    context: Identifying the parent process reveals the infection vector and execution context.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User

  - question: What other network activity occurred around the time of this C2 communication?
    context: Concurrent network connections help understand the full scope of malware behavior.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out
        - bytes_in

  # Type 4: Impact Assessment
  - question: What response did the command and control server provide?
    context: C2 server responses may contain additional commands or payload instructions.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - bytes_in

  - question: Are there signs of additional malware components being downloaded?
    context: Malware often downloads additional payloads after initial C2 communication.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  # Type 5: Forensic Deep-Dive
  - question: What applications and kill lists were reported by the malware?
    context: The KillList parameter reveals what security tools the malware is attempting to disable.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.body.content|contains: "KillList="
        condition: selection
      fields:
        - http.request.body.content
        - url.full

  - question: What registry modifications indicate malware persistence?
    context: Registry changes reveal how the malware maintains persistence on the infected system.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details
        - EventType

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network infected with the same malware?
    context: Identifies the scope of the W32/118GotYourNo infection across the enterprise.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path: "/count"
          http.request.body.content|contains: "appTitle="
        condition: selection
      fields:
        - src_ip
        - bytes_out

  - question: What other command and control servers are being contacted by infected systems?
    context: Identifies additional C2 infrastructure that may be part of the same campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "POST"
          http.request.body.content|contains: "proFirstTime="
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path