name: ET INFO File Being Uploaded to SendSpace File Hosting Site
id: 22014202
description: |
  Detects file uploads to SendSpace file hosting service which may indicate data exfiltration or unauthorized file sharing.
  Could be legitimate personal use or business file sharing, but warrants investigation in corporate environments.
type: detection
detection_id: 2014202
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What file is being uploaded to SendSpace?
    context: Understanding the file content and size helps determine if this is legitimate sharing or data exfiltration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.bytes
        - http.request.headers

  - question: Is this user authorized to upload files to external hosting services?
    context: Determining if this activity violates organizational data loss prevention policies.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains: "sendspace.com"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.request.body.bytes

  - question: What process initiated this file upload activity?
    context: Identifying the application or user action that triggered the upload to assess legitimacy.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ParentImage

  - question: What was the server's response to the upload attempt?
    context: Determining if the upload was successful and what file sharing URL was provided.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          url.domain|contains: "sendspace.com"
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - url.full

  - question: Were any sensitive files accessed before this upload?
    context: Assessing if this upload follows access to confidential or proprietary information.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.size
        - file.hash.md5
        - User

  - question: What other file hosting services has this user accessed?
    context: Understanding the user's pattern of external file sharing to assess risk level.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - "dropbox.com"
            - "mediafire.com"
            - "rapidshare.com"
            - "4shared.com"
        condition: selection
      fields:
        - url.domain
        - http.request.method
        - url.path

  - question: Is this upload part of a larger data exfiltration pattern?
    context: Identifying if multiple files or large volumes of data are being uploaded externally.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "POST"
          url.domain|contains:
            - "sendspace.com"
            - "filehosting"
        condition: selection
      fields:
        - url.domain
        - http.request.body.bytes
        - url.path

  - question: What is the business justification for this file sharing activity?
    context: Determining if there are legitimate business reasons for external file uploads during this timeframe.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - http.request.method
        - url.path

  - question: Are other users uploading files to external hosting services?
    context: Assessing if this is part of a broader pattern of external file sharing in the organization.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "File Hosting"
        condition: selection
      fields:
        - src_ip
        - url.domain
        - http.request.body.bytes

  - question: What is the frequency and timing pattern of these uploads?
    context: Understanding if uploads occur during business hours or follow suspicious timing patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains: "sendspace.com"
          http.request.method: "POST"
        condition: selection
      fields:
        - url.path
        - http.request.body.bytes