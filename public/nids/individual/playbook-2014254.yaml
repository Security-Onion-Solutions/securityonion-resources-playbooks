name: ET WEB_SPECIFIC_APPS pfile file.php id Parameter DELETE FROM SQL Injection Attempt
id: 22014254
description: |
  Detects SQL injection attempts targeting the pfile application's file.php script via the id parameter using DELETE FROM statements.
  Represents destructive SQL injection that could result in data loss or database corruption.
type: detection
detection_id: 2014254
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What specific DELETE statement was injected into the pfile application?
    context: Understanding the deletion target reveals potential data loss and attacker objectives.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.uri
        - http.request.method
        - url.query
        - http.request.body.content

  - question: Has this source previously performed reconnaissance on the pfile application?
    context: Prior enumeration attempts indicate targeted exploitation rather than random scanning.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/file.php'
        condition: selection
      fields:
        - http.request.method
        - url.query
        - http.response.status_code

  - question: What was the HTTP response to this destructive SQL injection attempt?
    context: Response codes and content indicate whether the deletion was successful or blocked.
    range: +2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.bytes

  - question: Are there other destructive SQL operations attempted by this attacker?
    context: Multiple destructive commands suggest systematic database compromise or sabotage.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'DELETE'
            - 'DROP'
            - 'TRUNCATE'
            - 'SQL Injection'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - http.uri

  - question: What database tables or records might have been targeted for deletion?
    context: Identifying deletion targets helps assess data loss scope and recovery requirements.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.uri
        - url.query
        - alert.signature

  - question: Did the application generate any database error messages revealing schema information?
    context: Error-based information disclosure can reveal database structure for further exploitation.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/file.php'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.query

  - question: Has the attacker attempted to verify successful deletion through subsequent queries?
    context: Verification attempts indicate sophisticated attack methodology and confirm malicious intent.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/file.php'
        condition: selection
      fields:
        - url.query
        - http.response.status_code
        - http.request.method

  - question: Are there signs of privilege escalation attempts following the injection?
    context: Destructive SQL injection may be followed by attempts to gain administrative access.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.query|contains:
            - 'admin'
            - 'root'
            - 'user'
            - 'login'
            - 'auth'
        condition: selection
      fields:
        - dst_ip
        - url.path
        - url.query
        - http.response.status_code

  - question: What is the pattern of pfile exploitation attempts across the enterprise?
    context: Enterprise-wide targeting suggests coordinated campaign requiring organization-level response.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'pfile'
          alert.signature|contains: 'DELETE'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Has this attack source targeted other vulnerable web applications?
    context: Multi-application targeting indicates broader web application security compromise.
    range: -12h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: 'web-application-attack'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - http.uri