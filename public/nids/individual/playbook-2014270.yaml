name: ET MALWARE Backdoor.Win32.RShot Ping Outbound
id: 22014270
description: |
  Detects RShot backdoor malware using ICMP ping packets with specific characteristics for covert communication.
  This signature identifies ping packets with ICMP ID 512, 32-byte payload of all 'A' characters used by RShot for C2 communication.
  Legitimate ping traffic rarely uses this specific pattern combination.
type: detection
detection_id: 2014270
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact ICMP payload pattern detected in this RShot backdoor communication?
    context: The specific payload pattern and ICMP characteristics confirm malicious intent versus legitimate network diagnostics.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - icmp.type
        - icmp.code
        - icmp.id
        - payload
        - payload_printable

  - question: Is this ICMP traffic part of legitimate network diagnostics or monitoring?
    context: Network administrators may use ping for diagnostics, but the specific pattern indicates malicious usage.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          protocol: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - packet_count
        - unique_destinations

  - question: What process generated this suspicious ICMP traffic?
    context: Identifying the source process helps determine if this is malware-generated traffic versus legitimate tools.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - 'ping'
            - 'cmd'
            - 'powershell'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  - question: What other network activity occurred around the time of this ICMP communication?
    context: RShot backdoors often use multiple communication channels and protocols for command and control.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_in
        - bytes_out

  - question: Has the backdoor established persistent communication patterns?
    context: Regular ICMP communication patterns indicate active backdoor operation requiring immediate response.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          protocol: 'icmp'
        condition: selection
      fields:
        - dst_ip
        - packet_count
        - communication_frequency

  - question: What files were accessed or created during the backdoor communication timeframe?
    context: File system activity may reveal additional malware components or data staging for exfiltration.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.path
        - file.name
        - event.action
        - process.name
        - file.hash.md5

  - question: Are there signs of remote command execution or system manipulation?
    context: RShot backdoors enable remote command execution, requiring analysis of suspicious process activity.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - 'cmd'
            - 'powershell'
            - 'wmic'
            - 'net'
            - 'reg'
        condition: selection
      fields:
        - process.command_line
        - process.parent.name
        - user.name

  - question: What DNS queries were made that might reveal additional C2 infrastructure?
    context: DNS activity may expose domain-based command and control channels used alongside ICMP communication.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.question.name
        - dns.resolved_ip
        - dns.question.type

  - question: Has data been exfiltrated through covert ICMP channels or other methods?
    context: Backdoors may use ICMP tunneling for data exfiltration, requiring analysis of traffic patterns and volumes.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - protocol
        - total_bytes_out
        - dst_ip
        - connection_pattern

  - question: Are other systems showing similar RShot backdoor indicators?
    context: Backdoor infections may spread laterally or be part of coordinated campaigns across multiple systems.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'RShot'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert_count

  - question: What is the infection and communication timeline for this backdoor?
    context: Understanding the backdoor's operational timeline helps assess compromise duration and required remediation scope.
    range: -48h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains: 'malware'
        condition: selection
      fields:
        - rule.name
        - severity
        - dst_ip