name: ET WEB_SPECIFIC_APPS WordPress Facebook-Page-Promoter-Lightbox Cross Site Scripting Attempt
id: 22014592
description: |
  Detects Cross-Site Scripting (XSS) attempts targeting WordPress Facebook-Page-Promoter-Lightbox plugin.
  May trigger on legitimate plugin configuration with scripting elements or malicious XSS exploitation.
type: detection
detection_id: 2014592
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete XSS payload in the settings-updated parameter?
    context: Understanding the exact scripting payload reveals the attack vector and intended malicious code execution.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method

  - question: Is this legitimate WordPress plugin administration activity?
    context: Plugin configuration may involve legitimate scripting elements during normal administrative operations.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-admin/"
        condition: selection
      fields:
        - src_ip
        - http.request.method
        - url.path

  - question: What user session initiated this plugin configuration request?
    context: Correlating with authentication logs helps determine if this is authorized administrative activity.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/wp-login.php"
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.response.status_code

  - question: What other WordPress plugin requests occurred from this source?
    context: Multiple plugin interactions may indicate systematic WordPress reconnaissance or exploitation attempts.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: "/wp-content/plugins/"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: Did the XSS payload successfully execute in the browser?
    context: Response analysis reveals if the malicious script was reflected back and potentially executed.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.full

  - question: Are there signs of data exfiltration following the XSS attempt?
    context: Successful XSS attacks may lead to session hijacking or sensitive data theft through subsequent requests.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method|contains:
            - "POST"
            - "PUT"
        condition: selection
      fields:
        - url.full
        - http.request.body.content
        - http.response.status_code

  - question: What specific scripting elements were detected in the payload?
    context: Analyzing the script type helps understand the attack's intended functionality and impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Cross Site Scripting"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - alert.signature
        - http.request.body.content

  - question: Has this WordPress site shown other web application vulnerabilities?
    context: Multiple vulnerabilities may indicate a compromised or poorly maintained WordPress installation.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains: "web-application-attack"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - alert.signature

  - question: Are there concurrent XSS attempts against other WordPress plugins?
    context: Coordinated attacks may target multiple plugin vulnerabilities simultaneously for maximum impact.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "WordPress"
          alert.signature|contains: "Cross Site Scripting"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path

  - question: Is this part of a broader web application attack campaign?
    context: XSS attempts may be part of larger reconnaissance or exploitation campaigns targeting multiple web applications.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "web-application-attack"
            - "exploit-kit"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - alert.signature

  - question: Are other enterprise WordPress installations being targeted similarly?
    context: Enterprise-wide WordPress targeting may indicate coordinated attacks against organizational web assets.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "WordPress"
          alert.signature|contains: "Cross Site Scripting"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name