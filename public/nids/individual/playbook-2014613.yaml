name: ET MALWARE Jembot PHP Webshell File Upload Activity
id: 22014613
description: |
  Detects Jembot PHP webshell access attempts via GET requests containing "jembot" in PHP file paths.
  May indicate compromised web servers with uploaded malicious PHP shells or legitimate files with similar naming.
type: detection
detection_id: 2014613
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete PHP file path and parameters accessed in the Jembot request?
    context: Full URL analysis reveals specific webshell functionality being accessed and potential command parameters.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method

  - question: Is this a legitimate PHP application file with similar naming conventions?
    context: Some legitimate applications may use similar naming patterns that could trigger false positives.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: ".php"
          http.response.status_code: 200
        condition: selection
      fields:
        - url.path
        - src_ip
        - http.request.method

  - question: When was this PHP file likely uploaded to the web server?
    context: Identifying upload timing helps determine compromise timeline and potential attack vectors used.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: "POST"
          http.content_type|contains: "multipart/form-data"
        condition: selection
      fields:
        - src_ip
        - url.path
        - network.bytes_sent

  - question: What commands or parameters are being passed to the webshell?
    context: Webshell parameters reveal attacker intentions and specific system commands being executed remotely.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "jembot"
          url.query: "*"
        condition: selection
      fields:
        - url.query
        - src_ip
        - http.request.body.content

  - question: Has the webshell been used for file system exploration or data access?
    context: Webshells often provide file browsing capabilities that attackers use for reconnaissance and data theft.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "jembot"
        condition: selection
      fields:
        - url.query
        - http.response.status_code
        - network.bytes_received

  - question: Are there signs of privilege escalation or system command execution?
    context: Advanced webshells may execute system commands or attempt to escalate privileges on the compromised server.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - "cmd.exe"
            - "powershell.exe"
            - "sh"
            - "bash"
        condition: selection
      fields:
        - User
        - CommandLine
        - ProcessGuid

  - question: What other PHP files have been accessed from the same source IP?
    context: Attackers often upload multiple webshells or access various PHP files for comprehensive server control.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: ".php"
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: Has this web server shown other compromise indicators or vulnerabilities?
    context: Webshell presence often indicates broader server compromise through various attack vectors.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - "web-application-attack"
            - "trojan-activity"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - alert.signature

  - question: Are there patterns indicating automated webshell scanning or exploitation?
    context: Attackers often use automated tools to discover and exploit webshells across multiple compromised servers.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: ".php"
          http.request.method: "GET"
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.response.status_code

  - question: What data or files have been accessed through the webshell interface?
    context: Webshell activity analysis reveals what sensitive information or system resources attackers have accessed.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  - question: Are other enterprise web servers being targeted with similar webshell attacks?
    context: Coordinated webshell deployment may indicate systematic targeting of organizational web infrastructure.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "webshell"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.path