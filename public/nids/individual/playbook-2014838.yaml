name: ET WEB_SPECIFIC_APPS WordPress PDF and Print Button Joliprint plugin type parameter Cross-Site Scripting Attempt
id: 22014838
description: |
  Detects cross-site scripting (XSS) attempts targeting the WordPress Joliprint plugin type parameter.
  Attackers inject malicious JavaScript to steal credentials or perform unauthorized actions.
  May trigger on legitimate content containing similar patterns in rare cases.
type: detection
detection_id: 2014838
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete XSS payload injected in the type parameter?
    context: Understanding the exact payload reveals the attacker's intent and potential impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What specific JavaScript events or functions were targeted in the injection?
    context: Identifies the attack vector and potential actions the malicious script would perform.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.user_agent
        - http.request.referrer

  # Type 2: Triage Assessment
  - question: Is this a legitimate user accessing the Joliprint plugin upload functionality?
    context: Determines if this could be authorized plugin usage rather than an attack.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/wp-content/plugins/joliprint/'
        condition: selection
      fields:
        - url.path
        - http.user_agent
        - http.response.status_code

  - question: Does the source IP have a history of legitimate WordPress plugin usage?
    context: Helps distinguish between authorized users and potential attackers.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - '/wp-content/plugins/'
            - '/wp-admin/'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user.name

  # Type 3: Activity Context
  - question: What reconnaissance activity preceded this XSS attempt against the Joliprint plugin?
    context: Identifies if the attacker performed plugin enumeration before the attack.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-content/plugins/'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.user_agent

  - question: Were there multiple XSS attempts or other WordPress plugin attacks from this source?
    context: Reveals if this is part of a broader WordPress plugin attack campaign.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'WordPress'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.path

  # Type 4: Impact Assessment
  - question: Did the WordPress server respond with an error or successfully process the XSS request?
    context: Determines if the XSS attempt was successful or blocked by security controls.
    range: +2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - url.path

  - question: Are there signs of successful authentication or session hijacking following this attempt?
    context: Identifies if the XSS attack led to credential theft or unauthorized access.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - '/wp-admin/'
            - '/wp-login.php'
        condition: selection
      fields:
        - src_ip
        - http.response.status_code
        - user.name

  # Type 5: Forensic Deep-Dive
  - question: What is the WordPress version and Joliprint plugin version on the target server?
    context: Determines if the server is running vulnerable versions susceptible to this attack.
    range: -1d
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains:
            - '/wp-'
            - '/joliprint/'
        condition: selection
      fields:
        - http.response.headers
        - http.server
        - url.path

  - question: Has this Joliprint plugin vulnerability been exploited against other WordPress sites?
    context: Identifies if this is part of a campaign targeting multiple WordPress installations.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Joliprint'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.hostname

  # Type 6: Enterprise Correlation
  - question: Are other WordPress sites in the organization being targeted with similar plugin XSS attacks?
    context: Determines scope of the attack campaign across the enterprise WordPress infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'WordPress'
            - 'Cross-Site Scripting'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - host.hostname