name: ET WEB_SPECIFIC_APPS WordPress PDF and Print Button Joliprint plugin opt parameter Cross-Site Scripting Attempt
id: 22014839
description: |
  Detects cross-site scripting (XSS) attempts targeting the WordPress Joliprint plugin opt parameter.
  Attackers inject malicious JavaScript via the WordPress admin options page to steal credentials.
  May trigger on legitimate content containing similar patterns in rare cases.
type: detection
detection_id: 2014839
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete XSS payload injected in the opt parameter?
    context: Understanding the exact payload reveals the attacker's intent and potential impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.query
        - http.request.body.content

  - question: What specific JavaScript events or functions were targeted in the admin panel injection?
    context: Identifies the attack vector and potential administrative actions the malicious script would perform.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.user_agent
        - http.request.referrer

  # Type 2: Triage Assessment
  - question: Is this a legitimate WordPress administrator configuring the Joliprint plugin?
    context: Determines if this could be authorized administrative activity rather than an attack.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: '/wp-admin/options-general.php'
        condition: selection
      fields:
        - url.path
        - http.user_agent
        - http.response.status_code

  - question: Does the source IP have a history of legitimate WordPress administrative access?
    context: Helps distinguish between authorized administrators and potential attackers.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains:
            - '/wp-admin/'
            - '/wp-login.php'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - user.name

  # Type 3: Activity Context
  - question: What administrative reconnaissance preceded this XSS attempt?
    context: Identifies if the attacker performed admin panel enumeration before the attack.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-admin/'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.user_agent

  - question: Were there multiple XSS attempts or other WordPress admin attacks from this source?
    context: Reveals if this is part of a broader WordPress administrative attack campaign.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'WordPress'
          url.path|contains: '/wp-admin/'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.path

  # Type 4: Impact Assessment
  - question: Did the WordPress admin panel respond with an error or successfully process the XSS request?
    context: Determines if the XSS attempt was successful or blocked by security controls.
    range: +2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          url.path|contains: '/wp-admin/'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.bytes
        - url.path

  - question: Are there signs of administrative privilege escalation or unauthorized configuration changes?
    context: Identifies if the XSS attack led to unauthorized administrative actions.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-admin/'
          http.request.method: 'POST'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.response.status_code
        - user.name

  # Type 5: Forensic Deep-Dive
  - question: What administrative privileges does the targeted WordPress account have?
    context: Determines the potential impact if the XSS attack successfully compromises the admin session.
    range: -1d
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: '/wp-admin/'
          http.response.status_code: 200
        condition: selection
      fields:
        - user.name
        - user.roles
        - url.path

  - question: Has this Joliprint admin panel vulnerability been exploited against other WordPress sites?
    context: Identifies if this is part of a campaign targeting multiple WordPress administrative interfaces.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'Joliprint'
            - 'opt parameter'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.hostname

  # Type 6: Enterprise Correlation
  - question: Are other WordPress administrative interfaces in the organization being targeted?
    context: Determines scope of the attack campaign across enterprise WordPress infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'WordPress'
          url.path|contains: '/wp-admin/'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - host.hostname