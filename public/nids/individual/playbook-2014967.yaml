name: ET EXPLOIT_KIT - Landing Page Requested - 15Alpha1Digit.php
id: 22014967
description: |
  Detects HTTP requests to exploit kit landing pages with specific naming pattern (15 lowercase letters followed by 1 digit and .php extension).
  This pattern is commonly used by exploit kits to serve malicious content. May trigger on legitimate applications using similar naming conventions.
type: detection
detection_id: 2014967
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact URL path and parameters of the suspicious PHP request?
    context: Understanding the complete request reveals exploit kit infrastructure and potential payload delivery mechanism.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.path
        - url.query
        - http.request.headers

  - question: What HTTP headers and user agent were sent with this request?
    context: Exploit kit requests often have distinctive user agents or header patterns that indicate automated tools.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - http.request.headers.referer
        - http.request.headers.accept
        - http.request.body.content

  # Type 2: Triage Assessment
  - question: Is this web browsing activity normal for this internal host?
    context: Legitimate users may access PHP applications, but exploit kit patterns are typically automated.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path
        - http.response.status_code

  - question: Does this request align with normal business hours and user activity?
    context: Exploit kit activity often occurs outside business hours or during automated scanning periods.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent
        - network.bytes_received

  # Type 3: Activity Context
  - question: What web activity preceded this exploit kit landing page request?
    context: Understanding the referral chain helps identify how the user reached the malicious landing page.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.full
        - http.request.headers.referer
        - http.response.status_code

  - question: What processes were running on the source host during this timeframe?
    context: Identifying the browser or application making the request helps determine if this was user-initiated or automated.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  # Type 4: Impact Assessment
  - question: Did the server respond with content that could contain exploit code?
    context: Successful exploit kit responses typically return JavaScript or other executable content.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.mime_type
        - network.bytes_received

  - question: Were any files downloaded or processes spawned after this request?
    context: Successful exploit kit exploitation often results in malware downloads or process execution.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.name
        - file.path
        - file.hash.md5
        - file.size
        - process.name

  # Type 5: Forensic Deep-Dive
  - question: What exploit kit family does this landing page pattern match?
    context: The 15-character plus digit pattern is associated with specific exploit kit families and campaigns.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: ".php"
        condition: selection
      fields:
        - url.path
        - url.domain
        - src_ip
        - http.response.status_code

  - question: Are there indicators of successful browser exploitation on the affected host?
    context: Exploit kits target browser vulnerabilities, so checking for suspicious browser behavior is critical.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - "iexplore.exe"
            - "chrome.exe"
            - "firefox.exe"
            - "msedge.exe"
        condition: selection
      fields:
        - process.command_line
        - process.parent.name
        - process.pid
        - user.name

  # Type 6: Enterprise Correlation
  - question: Are other internal hosts accessing similar exploit kit landing pages?
    context: Exploit kit campaigns often target multiple hosts within an organization through watering hole or malvertising attacks.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "ET EXPLOIT_KIT"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.domain
        - rule.name

  - question: Is this part of a broader malicious campaign targeting our organization?
    context: Correlating with other security events helps identify coordinated attack campaigns.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.category
        - rule.name
        - src_ip
        - alert.severity