name: ET WEB_SERVER possible IBM Rational Directory Server (RDS) Help system href browser redirect
id: 22014986
description: |
  Detects potential exploitation attempts against IBM Rational Directory Server Help system via malicious href parameters in deferredView.jsp.
  This vulnerability allows attackers to redirect users to malicious sites. May trigger on legitimate help system usage with external links.
type: detection
detection_id: 2014986
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete URL and href parameter value in this RDS exploit attempt?
    context: The href parameter contains the redirect target, revealing the attacker's intended destination or payload delivery site.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.path
        - url.query
        - http.request.headers.referer
        - http.request.headers.user_agent

  - question: What protocol and destination are specified in the malicious href parameter?
    context: Analyzing the redirect target helps determine if this is credential phishing, malware delivery, or other attack type.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content
        - http.response.status_code
        - http.response.headers.location

  # Type 2: Triage Assessment
  - question: Is this legitimate use of the IBM RDS Help system by authorized users?
    context: The RDS Help system may legitimately reference external documentation or resources in enterprise environments.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/rds-help/"
        condition: selection
      fields:
        - src_ip
        - url.path
        - url.query
        - http.request.headers.user_agent
        - http.response.status_code

  - question: Does this access pattern match normal administrative or development activity?
    context: IBM RDS is typically used in development environments, so activity should align with known development teams and schedules.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.bytes_sent
        - network.bytes_received
        - network.protocol

  # Type 3: Activity Context
  - question: What web browsing activity led to this RDS Help system access?
    context: Understanding how the user reached this page helps determine if this was targeted exploitation or opportunistic scanning.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path
        - http.request.headers.referer
        - http.response.status_code

  - question: What user account and browser initiated this potentially malicious request?
    context: Identifying the user and browser helps assess if this was social engineering or automated exploitation.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - "iexplore.exe"
            - "chrome.exe"
            - "firefox.exe"
            - "msedge.exe"
        condition: selection
      fields:
        - process.name
        - process.command_line
        - user.name
        - process.parent.name

  - question: Were there any scanning or reconnaissance activities targeting this server?
    context: Attackers often scan for vulnerable applications before attempting specific exploits like this RDS vulnerability.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - http.request.headers.user_agent

  # Type 4: Impact Assessment
  - question: Did the server successfully process the redirect request?
    context: Successful exploitation results in user redirection to attacker-controlled sites for credential theft or malware delivery.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.headers.location
        - http.response.body.content
        - network.bytes_received

  - question: Did the user follow the malicious redirect to the attacker's destination?
    context: Successful redirects may lead to credential theft, malware downloads, or further compromise of the user's system.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 5: Forensic Deep-Dive
  - question: What specific IBM RDS version and configuration is running on this server?
    context: Different RDS versions have varying vulnerability levels and exploitation methods for this redirect flaw.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|contains: "/rds-help/"
        condition: selection
      fields:
        - url.path
        - http.response.headers.server
        - http.response.status_code
        - src_ip

  - question: Are there other web application vulnerabilities being exploited on this server?
    context: Attackers often chain multiple vulnerabilities or use this redirect as part of a broader web application attack.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains: "web-application-attack"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - url.path
        - alert.severity

  # Type 6: Enterprise Correlation
  - question: Are other IBM RDS servers in the organization being targeted with similar attacks?
    context: Attackers often target multiple instances of the same vulnerable application across an organization.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.path|contains: "/rds-help/advanced/deferredView.jsp"
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - url.query
        - http.response.status_code

  - question: Is this part of a broader web application attack campaign against our infrastructure?
    context: Correlating with other web attacks helps identify coordinated campaigns targeting multiple applications or servers.
    range: +/-48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "web-application-attack"
            - "exploit"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - url.domain
        - alert.severity