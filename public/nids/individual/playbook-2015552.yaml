name: ET SCAN HTExploit Method
id: 22015552
description: |
  Detects the HTExploit web server vulnerability scanner using the POTATO HTTP method.
  This tool scans for various web server vulnerabilities and misconfigurations.
  Legitimate web traffic does not use the POTATO HTTP method.
type: detection
detection_id: 2015552
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete HTTP request containing the POTATO method?
    context: Full request analysis reveals scanner configuration and targeted vulnerabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - http.request.body.content
        - url.full
        - user_agent.original

  - question: What additional headers were sent with the HTExploit scan?
    context: Scanner headers reveal tool version and configuration settings used by attacker.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.headers
        - http.version
        - payload_printable

  # Type 2: Triage Assessment
  - question: Is this web server configured to accept non-standard HTTP methods?
    context: Servers rejecting unusual methods are less vulnerable to method-based attacks.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - http.request.method
        - http.response.status_code
        - src_ip

  - question: Has this web server been scanned by other vulnerability tools?
    context: Multiple scanning attempts indicate targeted reconnaissance requiring enhanced monitoring.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.category: Scanning
        condition: selection
      fields:
        - src_ip
        - rule.name
        - user_agent.original

  # Type 3: Activity Context
  - question: What port scanning activity preceded this web vulnerability scan?
    context: Port scans often precede targeted application scanning in attack reconnaissance phase.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - proto
        - flow.pkts_toserver
        - flow.start

  - question: What other web applications on this server are being targeted?
    context: Multiple application targets reveal scope of attack and vulnerable services.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 4: Impact Assessment
  - question: Did the HTExploit scan discover any vulnerable endpoints?
    context: Successful vulnerability discovery leads to targeted exploitation attempts.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code|contains:
            - '200'
            - '500'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  - question: Are there follow-up exploitation attempts after the scan?
    context: Post-scan exploitation indicates successful vulnerability identification requiring immediate response.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.category: Exploit
        condition: selection
      fields:
        - rule.name
        - url.path
        - alert.severity

  # Type 5: Forensic Deep-Dive
  - question: What web server software and version is running on the target?
    context: Server identification helps assess vulnerability status and required security patches.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - http.response.headers
        - http.response.status_code
        - url.path

  - question: What specific vulnerabilities is HTExploit configured to detect?
    context: Scanner configuration reveals attacker's target vulnerabilities and exploitation strategy.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - user_agent.original
        - http.request.body.content

  # Type 6: Enterprise Correlation
  - question: Are other web servers in the network being scanned by HTExploit?
    context: Multiple targets indicate coordinated reconnaissance requiring network-wide hardening.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name: "ET SCAN HTExploit Method"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - alert.timestamp

  - question: Is this part of a broader web application attack campaign?
    context: Multiple web scanning tools indicate comprehensive attack requiring coordinated defense.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category: Scanning
          rule.name|contains: web
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - user_agent.original