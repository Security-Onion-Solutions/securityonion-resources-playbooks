name: ET SCAN Brutus Scan Outbound
id: 22015702
description: |
  Detects outbound HTTP requests with Brutus password cracking tool user agent strings.
  Indicates potential unauthorized password brute force attacks against external systems.
type: detection
detection_id: 2015702
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact Brutus user agent string and target being scanned?
    context: Brutus tool signatures reveal the specific version and attack configuration being used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.user_agent
        - url.full
        - dst_ip

  - question: What authentication endpoints or services is Brutus targeting?
    context: Understanding target services helps assess the scope and intent of the brute force attack.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.path
        - dst_port
        - http.request.method

  - question: Is this authorized penetration testing or security assessment activity?
    context: Brutus may be used legitimately during authorized security testing engagements.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.user_agent|contains: "Brutus"
        condition: selection
      fields:
        - dst_ip
        - url.path
        - http.response.status_code

  - question: What user account is running the Brutus scanning tool?
    context: Unauthorized use of attack tools may indicate insider threat or system compromise.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains: "brutus"
        condition: selection
      fields:
        - User
        - CommandLine
        - ProcessGuid
        - ParentImage

  - question: What is the frequency and pattern of these brute force attempts?
    context: Attack patterns reveal the sophistication and persistence of the brute force campaign.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.response.status_code
        - http.request.method

  - question: Are there signs of successful authentication during these brute force attempts?
    context: HTTP 200 responses or session cookies may indicate successful credential compromise.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.response.status_code: 200
        condition: selection
      fields:
        - url.path
        - http.response.headers.set_cookie
        - http.response.body.bytes

  - question: What other attack tools or reconnaissance activities originated from this system?
    context: Brutus usage often part of broader attack toolkit and reconnaissance activities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "attempted-recon"
            - "web-application-attack"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - url.domain

  - question: Has this system downloaded or installed additional attack tools?
    context: Attackers often deploy multiple tools for comprehensive penetration testing or malicious activity.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.extension|contains:
            - "exe"
            - "zip"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  - question: What credentials or wordlists is Brutus configured to use?
    context: Understanding attack dictionaries helps assess the sophistication and potential success rate.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.extension|contains:
            - "txt"
            - "dic"
        condition: selection
      fields:
        - TargetFilename
        - file.size
        - User

  - question: Are multiple systems being targeted in this brute force campaign?
    context: Coordinated attacks across multiple targets indicate systematic reconnaissance or attack campaign.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.user_agent|contains: "Brutus"
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - dst_port

  - question: Has this brute force activity triggered security alerts on target systems?
    context: Successful detection by target systems may indicate defensive measures and attack attribution.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - "attempted-user"
            - "authentication"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category