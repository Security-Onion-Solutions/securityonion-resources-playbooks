name: ET SCAN Nessus Netbios Scanning Detection
id: 22015754
description: |
  Detects Nessus vulnerability scanner performing NetBIOS enumeration scans.
  May indicate authorized security assessment or unauthorized reconnaissance activity.
type: detection
detection_id: 2015754
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete NetBIOS scanning pattern detected?
    context: Understanding the scan signature confirms Nessus tool usage and scan scope.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - src_ip
        - dst_ip
        - dst_port

  - question: Which specific NetBIOS ports were targeted in this scanning activity?
    context: Identifies the scope of SMB/NetBIOS enumeration attempts.
    range: +/-15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 137
            - 138
            - 139
            - 445
        condition: selection
      fields:
        - dst_port
        - network.protocol
        - count

  # Type 2: Triage Assessment
  - question: Is this scanning activity part of authorized vulnerability assessment?
    context: Legitimate security teams use Nessus for authorized network assessments.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "Nessus"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - count

  - question: Does the source IP belong to known security assessment infrastructure?
    context: Authorized scan sources should be documented in security operations.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "attempted-recon"
            - "policy-violation"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - count

  # Type 3: Activity Context
  - question: What network reconnaissance preceded this NetBIOS scanning?
    context: Understanding the scan sequence reveals attacker methodology and targets.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category: "attempted-recon"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port
        - count

  - question: What was the scanning pattern and target selection methodology?
    context: Reveals if this is targeted reconnaissance or broad network enumeration.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 137
            - 138
            - 139
            - 445
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - count

  # Type 4: Impact Assessment
  - question: Were any NetBIOS services successfully enumerated or accessed?
    context: Determines if scanning led to successful information disclosure.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 139
            - 445
          network.bytes: ">1000"
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes
        - count

  - question: Did the scanning activity trigger additional security alerts on target systems?
    context: Successful enumeration may generate authentication or access alerts.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - "attempted-admin"
            - "policy-violation"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - count

  # Type 5: Forensic Deep-Dive
  - question: What specific Nessus plugins or scan policies were executed?
    context: Identifies the assessment scope and potential vulnerability focus areas.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "Nessus"
        condition: selection
      fields:
        - rule.name
        - rule.signature_id
        - dst_ip
        - count

  - question: Are there patterns indicating automated versus manual scanning techniques?
    context: Distinguishes between automated tools and manual reconnaissance activities.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - count

  # Type 6: Enterprise Correlation
  - question: Are other network segments experiencing similar Nessus scanning activity?
    context: Identifies if this is part of comprehensive network assessment or targeted attack.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.signature_id: 2015754
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - count

  - question: Is this scanning correlated with other vulnerability assessment tools across the enterprise?
    context: Comprehensive assessments often use multiple scanning tools and techniques.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: "attempted-recon"
          rule.name|contains:
            - "scan"
            - "probe"
            - "enum"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - count