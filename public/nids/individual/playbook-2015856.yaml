name: ET SNMP Cisco Config Retrieval via TFTP Attempt
id: 22015856
description: |
  Detects attempts to retrieve Cisco device configurations via TFTP using SNMP CISCO-CONFIG-COPY MIB.
  May indicate unauthorized configuration extraction or legitimate network administration.
type: detection
detection_id: 2015856
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete SNMP OID and payload used in this configuration retrieval attempt?
    context: Understanding the CISCO-CONFIG-COPY MIB usage reveals the specific configuration being targeted.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - src_ip
        - dst_ip
        - dst_port

  - question: What TFTP server destination was specified in the configuration copy request?
    context: Identifies where stolen configurations would be transferred and potential attacker infrastructure.
    range: +/-5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - network.protocol

  # Type 2: Triage Assessment
  - question: Is this SNMP activity from authorized network management systems?
    context: Legitimate network administrators use SNMP for configuration management and backups.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 161
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - count

  - question: Does this activity align with documented network maintenance schedules?
    context: Authorized configuration backups typically occur during scheduled maintenance windows.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category: "policy-violation"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - count

  # Type 3: Activity Context
  - question: What SNMP reconnaissance or enumeration preceded this configuration retrieval attempt?
    context: Attackers typically enumerate SNMP services before attempting configuration extraction.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "SNMP"
        condition: selection
      fields:
        - rule.name
        - rule.category
        - count

  - question: What other network devices were targeted for configuration retrieval from this source?
    context: Reveals the scope of network infrastructure compromise attempts.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.signature_id: 2015856
        condition: selection
      fields:
        - dst_ip
        - count

  # Type 4: Impact Assessment
  - question: Was the TFTP transfer of configuration data successful?
    context: Determines if sensitive network device configurations were actually exfiltrated.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port: 69
          network.bytes: ">1000"
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - network.protocol

  - question: Are there signs of credential extraction or privilege escalation following this activity?
    context: Stolen configurations may contain credentials used for lateral movement.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "attempted-admin"
            - "credential-theft"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - count

  # Type 5: Forensic Deep-Dive
  - question: What specific Cisco device models and firmware versions were targeted?
    context: Identifies vulnerable infrastructure and potential exploit targeting specific platforms.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 161
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - count

  - question: Were there attempts to modify configurations after retrieval?
    context: Advanced attackers may alter configurations for persistence or backdoor access.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category: "policy-violation"
        condition: selection
      fields:
        - rule.name
        - count

  # Type 6: Enterprise Correlation
  - question: Are other Cisco devices across the network experiencing similar configuration retrieval attempts?
    context: Identifies if this is part of systematic network infrastructure compromise campaign.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.signature_id: 2015856
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - count

  - question: Is this activity correlated with other network device exploitation attempts enterprise-wide?
    context: Comprehensive infrastructure attacks often target multiple device types and vendors.
    range: +/-12h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: "policy-violation"
          rule.name|contains:
            - "Config"
            - "SNMP"
            - "TFTP"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - count