name: ET TFTP Outbound TFTP Data Transfer with Cisco config
id: 22015857
description: |
  Detects outbound TFTP data transfers containing Cisco configuration information.
  May indicate legitimate network device backup operations or unauthorized configuration exfiltration.
  Could also represent network reconnaissance or data theft targeting network infrastructure.
type: detection
detection_id: 2015857
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific Cisco configuration data was transferred via TFTP?
    context: The configuration content reveals what network device information was accessed or exfiltrated.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - alert.signature

  - question: What was the complete TFTP session flow and data size?
    context: TFTP transfer details indicate the scope of configuration data and transfer method.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - src_port
        - bytes_toserver
        - bytes_toclient
        - duration
        - conn_state

  # Type 2: Triage Assessment
  - question: Is this TFTP transfer part of scheduled network device maintenance?
    context: Legitimate Cisco device backups often occur during maintenance windows with known schedules.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 69
        condition: selection
      fields:
        - dst_ip
        - bytes_toclient

  - question: Is the source system an authorized network management server?
    context: TFTP transfers should originate from known network management systems or authorized administrators.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service

  # Type 3: Activity Context
  - question: What network activity preceded this TFTP configuration transfer?
    context: Understanding the trigger for configuration access helps determine if authorized or malicious.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service
        - conn_state

  - question: Were there any authentication attempts to network devices before this transfer?
    context: Legitimate configuration access typically involves proper authentication to network equipment.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 23
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - conn_state
        - duration

  # Type 4: Impact Assessment
  - question: What sensitive network configuration information was potentially exposed?
    context: Cisco configurations contain network topology, credentials, and security settings that aid attackers.
    range: +/-5m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - payload_printable

  - question: Are there signs of lateral movement following this configuration access?
    context: Stolen network configurations often enable further network compromise and lateral movement.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service

  # Type 5: Forensic Deep-Dive
  - question: What processes on the source system initiated this TFTP transfer?
    context: Process analysis reveals if the transfer was automated, scripted, or manual user activity.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "tftp"
            - "tftpd"
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  - question: Were any files created or modified on the source system related to this transfer?
    context: File operations may reveal where configuration data was stored or how it was processed.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - ".cfg"
            - ".conf"
            - "config"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - event_type

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar TFTP configuration transfers?
    context: Coordinated configuration theft may target multiple network devices across the enterprise.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains:
            - "TFTP"
            - "Cisco config"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Is this part of broader network reconnaissance or data exfiltration activity?
    context: TFTP configuration transfers may be part of larger campaigns targeting network infrastructure.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - "policy-violation"
            - "trojan-activity"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category