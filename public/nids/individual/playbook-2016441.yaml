name: ET MALWARE SEASALT Client Checkin
id: 22016441
description: |
  Detects SEASALT malware client checkin communications containing the signature string "fxftest".
  SEASALT is associated with APT1 operations and indicates active command and control communication.
type: detection
detection_id: 2016441
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete network communication containing the SEASALT "fxftest" signature?
    context: Analyzing the full communication reveals the malware's command and control protocol structure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - http.request.body.content
        - packet.size

  - question: What is the complete network session context surrounding this SEASALT checkin?
    context: SEASALT communications often occur within established sessions that may contain additional commands or data.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_sent
        - bytes_received
        - session_duration
        - connection_state

  # Type 2: Triage Assessment
  - question: Is this communication part of legitimate software that might use similar signatures?
    context: While "fxftest" is highly specific to SEASALT malware, confirming malicious context is critical for response.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection_patterns

  - question: Does this infected system show signs of legitimate user activity alongside the malware communication?
    context: Understanding if the system is actively used helps determine incident response priorities and user notification needs.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - User
        - CommandLine
        - ProcessGuid

  # Type 3: Activity Context
  - question: What process initiated this SEASALT command and control communication?
    context: Identifying the malware process helps understand the infection vector and persistence mechanisms.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What other network connections has this infected system established recently?
    context: SEASALT often communicates with multiple command and control servers and may download additional payloads.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_transferred
        - protocol

  - question: Are there any file system changes or downloads associated with this SEASALT activity?
    context: SEASALT may download additional tools, steal files, or create persistence mechanisms on the infected system.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName
        - file.size

  # Type 4: Impact Assessment
  - question: What data has been exfiltrated through this SEASALT command and control channel?
    context: SEASALT is designed for data theft, so understanding exfiltration scope is critical for damage assessment.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - total_bytes_sent
        - session_count
        - data_volume

  - question: Has this SEASALT infection led to lateral movement or additional system compromises?
    context: APT1 operations typically involve lateral movement to access high-value targets within the network.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - new_connections
        - authentication_attempts

  # Type 5: Forensic Deep-Dive
  - question: What specific SEASALT variant or configuration is active based on communication patterns?
    context: Different SEASALT variants have distinct communication patterns that help identify the specific threat and capabilities.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: SEASALT
        condition: selection
      fields:
        - rule.name
        - communication_frequency
        - payload_patterns

  - question: What persistence mechanisms has SEASALT established on this infected system?
    context: Understanding persistence helps ensure complete malware removal and prevents reinfection.
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: Are there any additional APT1 tools or malware families present on this system?
    context: APT1 operations often deploy multiple tools, so identifying the full malware ecosystem is important for remediation.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - "APT"
            - "MALWARE"
        condition: selection
      fields:
        - rule.name
        - malware_family
        - threat_indicators

  # Type 6: Enterprise Correlation
  - question: Are there other systems in the network showing SEASALT or related APT1 malware activity?
    context: APT1 campaigns typically target multiple systems, so identifying the full scope of compromise is critical.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "SEASALT"
            - "APT1"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - infection_scope
        - campaign_indicators

  - question: What is the timeline and progression of this APT1 campaign across the enterprise?
    context: Understanding the attack timeline helps identify the initial compromise vector and campaign objectives.
    range: -7d
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "APT"
            - "SEASALT"
            - "command-and-control"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - attack_timeline