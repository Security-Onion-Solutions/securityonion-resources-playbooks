name: ET INFO Possible IPMI 2.0 RAKP Remote SHA1 Password Hash Retrieval RAKP message 1 with default BMC usernames
id: 22017120
description: |
  Detects IPMI RAKP authentication attempts using default BMC usernames that can expose password hashes.
  May indicate legitimate IPMI management or potential credential harvesting attacks against BMC interfaces.
type: detection
detection_id: 2017120
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific IPMI RAKP message structure and username was captured?
    context: Understanding the exact RAKP message reveals authentication attempt details and target usernames.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.protocol
        - network.transport
        - src_ip
        - dst_ip
        - dst_port

  - question: Which default BMC username is being targeted in this authentication attempt?
    context: Different default usernames indicate specific BMC vendors and attack sophistication.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 623
        condition: selection
      fields:
        - network.bytes_toserver
        - network.bytes_toclient
        - network.protocol

  # Type 2: Triage Assessment
  - question: Is this system a legitimate BMC or IPMI-enabled server?
    context: Legitimate server management may trigger this alert during normal operations.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 623
        condition: selection
      fields:
        - src_ip
        - network.bytes_toserver

  - question: Is this IPMI access from authorized management networks?
    context: IPMI management should typically originate from dedicated management subnets.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 623
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - network.protocol

  # Type 3: Activity Context
  - question: What network scanning or enumeration preceded this IPMI attempt?
    context: Attackers often scan for IPMI services before attempting credential harvesting.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.protocol
        - network.bytes_toserver

  - question: Are there signs of systematic IPMI service discovery?
    context: Mass scanning for IPMI services indicates potential credential harvesting campaigns.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 623
        condition: selection
      fields:
        - dst_ip
        - network.bytes_toserver

  # Type 4: Impact Assessment
  - question: Did the RAKP authentication attempt succeed or fail?
    context: Successful RAKP responses expose password hashes that can be cracked offline.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_ip|expand: '%src_ip%'
          dst_port: 623
        condition: selection
      fields:
        - network.bytes_toclient
        - network.bytes_toserver
        - network.protocol

  - question: Are there signs of successful BMC compromise or unauthorized access?
    context: Compromised BMCs provide persistent access and can be used for lateral movement.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.bytes_toserver
        - network.protocol

  # Type 5: Forensic Deep-Dive
  - question: What IPMI exploitation tools or techniques are being used?
    context: Professional IPMI exploitation tools have distinct traffic patterns and capabilities.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains: "IPMI"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - alert.category

  - question: Are there patterns suggesting automated IPMI credential harvesting?
    context: Automated tools systematically target multiple IPMI services for credential extraction.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 623
        condition: selection
      fields:
        - dst_ip
        - network.bytes_toserver

  - question: What is the source of this IPMI attack traffic?
    context: Understanding attack origin helps with threat attribution and blocking measures.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol

  # Type 6: Enterprise Correlation
  - question: Are other IPMI-enabled systems being targeted in similar attacks?
    context: Coordinated IPMI attacks may target multiple BMCs across the infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "IPMI"
          alert.signature|contains: "RAKP"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Is this part of broader infrastructure reconnaissance or attack campaign?
    context: IPMI attacks often accompany broader infrastructure compromise attempts.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains: "INFO"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category