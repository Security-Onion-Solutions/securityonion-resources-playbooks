name: ET SCAN SipCLI VOIP Scan - TCP
id: 22017161
description: |
  Detects SipCLI VOIP scanning tool attempting reconnaissance over TCP.
  This tool is used to enumerate SIP services and identify potential vulnerabilities.
  May trigger on legitimate SIP testing tools used by administrators.
type: detection
detection_id: 2017161
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SIP message containing the sipcli user agent?
    context: Analyzing the full SIP packet reveals the scanning methodology and target enumeration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.protocol
        - network.transport
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: What specific SIP methods and headers were used in this scanning attempt?
    context: Different SIP methods reveal the type of reconnaissance being performed.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
          dst_port: 5060
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  - question: Is this authorized SIP testing or penetration testing activity?
    context: Legitimate security testing may use SipCLI for authorized VOIP assessments.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  - question: How many SIP servers has this source attempted to scan?
    context: Multiple targets indicate systematic VOIP infrastructure reconnaissance.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent

  - question: What was the response from the target SIP server to this scan?
    context: Server responses indicate whether the scan was successful and what services were discovered.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          src_port: 5060
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received

  - question: Are there follow-up exploitation attempts against discovered SIP services?
    context: Successful scans are often followed by targeted attacks against identified vulnerabilities.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category

  - question: What other ports or services has this source attempted to scan?
    context: Multi-service scanning indicates broader reconnaissance beyond just VOIP infrastructure.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent

  - question: Are there DNS queries for SIP-related domains from this source?
    context: DNS reconnaissance often precedes direct port scanning to identify VOIP infrastructure.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Has this source attempted authentication against any discovered SIP services?
    context: Authentication attempts following scanning indicate progression to active exploitation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  - question: Are other sources showing similar SipCLI scanning patterns across the network?
    context: Coordinated scanning from multiple sources suggests an organized reconnaissance campaign.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'SipCLI'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name