name: ET SCAN SipCLI VOIP Scan
id: 22017162
description: |
  Detects SipCLI VOIP scanning tool attempting reconnaissance over UDP.
  This tool performs SIP service enumeration to identify potential attack vectors.
  May trigger on legitimate SIP testing tools used by network administrators.
type: detection
detection_id: 2017162
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete SIP message containing the sipcli user agent signature?
    context: Analyzing the full SIP packet reveals scanning techniques and enumeration methods used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.protocol
        - network.transport
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: What specific SIP methods were used in this UDP-based scanning attempt?
    context: Different SIP methods indicate the type of service discovery being performed.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
          dst_port: 5060
          network.transport: 'udp'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  - question: Is this authorized VOIP security testing or legitimate network diagnostics?
    context: Network administrators may use SIP scanning tools for legitimate infrastructure assessment.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          network.transport: 'udp'
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.bytes_received

  - question: How many different SIP servers has this source scanned via UDP?
    context: Multiple targets suggest systematic enumeration of VOIP infrastructure across the network.
    range: -3h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          network.transport: 'udp'
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent

  - question: What responses did the target SIP server provide to this scanning activity?
    context: Server responses reveal whether services were successfully enumerated and what information was disclosed.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          src_port: 5060
          network.transport: 'udp'
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received

  - question: Are there subsequent exploitation attempts following this SIP reconnaissance?
    context: Successful scanning often leads to targeted attacks against identified VOIP vulnerabilities.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category

  - question: What other UDP services has this source attempted to scan or probe?
    context: Multi-protocol scanning indicates broader network reconnaissance beyond VOIP services.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          network.transport: 'udp'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent

  - question: Are there DNS queries for SIP or VOIP-related domains from this source?
    context: DNS reconnaissance typically precedes direct scanning to identify VOIP infrastructure targets.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Has this source attempted SIP registration or authentication after scanning?
    context: Authentication attempts following reconnaissance indicate progression to active exploitation phases.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - dst_ip
        - network.bytes_sent
        - network.bytes_received
        - network.transport

  - question: Are there coordinated SipCLI scanning activities from multiple sources?
    context: Distributed scanning suggests an organized campaign targeting VOIP infrastructure.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'SipCLI'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the geographic and network context of this scanning source?
    context: Understanding source characteristics helps determine threat level and attribution.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_sent