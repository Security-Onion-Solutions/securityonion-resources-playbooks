name: ET WEB_SERVER Mambo.PerlBot Spreader IRC DDOS Attacking Message
id: 22017831
description: |
  Detects IRC communication from compromised web servers announcing DDoS attack initiation.
  This indicates active participation in distributed denial of service attacks coordinated through IRC channels.
type: detection
detection_id: 2017831
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What target is being attacked according to the IRC message?
    context: Identifying the DDoS target helps understand the threat actor's objectives and potential impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - payload_printable
        - flow_id
  - question: Is this web server authorized to participate in network stress testing?
    context: Web servers should not engage in DDoS activities unless part of authorized penetration testing or load testing.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient
  - question: What DDoS attack method is being employed by this botnet member?
    context: Understanding attack vectors helps assess the potential impact and develop appropriate countermeasures.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state
        - flow.bytes_toserver
  - question: How many other systems are participating in this coordinated DDoS attack?
    context: Botnet size indicates the scale of the attack and helps prioritize incident response efforts.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature: 'ET WEB_SERVER Mambo.PerlBot Spreader IRC DDOS Attacking Message'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.timestamp
  - question: What IRC botnet infrastructure is coordinating this attack?
    context: IRC server details help identify command and control infrastructure for blocking and attribution.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration
        - community_id
  - question: Has this compromised server launched the actual DDoS traffic?
    context: Confirming attack execution helps assess the immediate threat and required response actions.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - conn_state
  - question: What webshell variant is responsible for this DDoS capability?
    context: Identifying the specific malware helps understand its full capabilities and find additional indicators.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.name|contains:
            - 'perl'
            - 'bot'
            - 'mambo'
        condition: selection
      fields:
        - file.name
        - file.path
        - file.hash.md5
        - file.size
  - question: Are there signs of additional malicious processes spawned for the attack?
    context: DDoS attacks may spawn multiple processes or threads to maximize impact from each compromised system.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - 'perl'
            - 'attack'
            - 'flood'
            - 'ddos'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What is the network bandwidth impact of this DDoS participation?
    context: Understanding traffic volume helps assess the attack's contribution and network impact.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration
        - proto
  - question: Has the IRC controller issued stop commands for this attack?
    context: Attack duration and control commands help understand the threat actor's operational patterns.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'done'
            - 'stop'
            - 'Attack'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.timestamp