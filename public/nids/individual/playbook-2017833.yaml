name: ET WEB_SERVER Mambo.PerlBot Spreader IRC DDOS PerlBot Version Message
id: 22017833
description: |
  Detects IRC communication from compromised web servers announcing PerlBot version information.
  This indicates active botnet membership and helps identify the specific malware variant for threat intelligence.
type: detection
detection_id: 2017833
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What specific PerlBot version is running on this compromised system?
    context: Version information helps identify malware capabilities, known vulnerabilities, and attribution to specific campaigns.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - payload_printable
        - flow_id
  - question: Is this web server authorized to run Perl-based applications?
    context: Understanding legitimate Perl usage helps differentiate between authorized applications and malicious bots.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'perl'
            - 'perl.exe'
        condition: selection
      fields:
        - User
        - CommandLine
        - ProcessGuid
  - question: When was this PerlBot variant first deployed on the system?
    context: Deployment timeline helps understand the compromise timeline and identify the initial attack vector.
    range: -7d
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.name|contains:
            - 'perl'
            - 'bot'
            - '.pl'
        condition: selection
      fields:
        - file.name
        - file.path
        - file.hash.md5
        - file.event_type
  - question: How many other systems are running the same PerlBot version?
    context: Version distribution analysis helps understand the campaign scope and botnet update mechanisms.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature: 'ET WEB_SERVER Mambo.PerlBot Spreader IRC DDOS PerlBot Version Message'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.timestamp
  - question: What IRC infrastructure is collecting these version reports?
    context: Command and control server analysis helps identify the botnet infrastructure for disruption efforts.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration
        - community_id
  - question: Are there signs of PerlBot updates or modifications?
    context: Bot updates may introduce new capabilities or fix vulnerabilities, affecting the threat landscape.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.name|contains:
            - 'perl'
            - 'bot'
            - 'update'
        condition: selection
      fields:
        - file.name
        - file.path
        - file.hash.md5
        - file.event_type
  - question: What additional capabilities does this PerlBot version possess?
    context: Understanding bot capabilities helps assess the potential threat and required containment measures.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'Mambo'
            - 'PerlBot'
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - alert.timestamp
  - question: Has this bot received version-specific commands from the IRC controller?
    context: Version-targeted commands may indicate selective tasking based on bot capabilities or vulnerabilities.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          src_port|expand: '%dst_port%'
        condition: selection
      fields:
        - bytes_toclient
        - bytes_toserver
        - duration
  - question: What process spawned this PerlBot instance?
    context: Parent process analysis helps understand the infection vector and identify additional compromise indicators.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - 'perl'
            - 'bot'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: Are there other malware families coexisting with this PerlBot?
    context: Multiple malware infections may indicate a compromised system serving as a platform for various threat actors.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - 'trojan'
            - 'malware'
            - 'backdoor'
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - alert.severity
        - alert.timestamp