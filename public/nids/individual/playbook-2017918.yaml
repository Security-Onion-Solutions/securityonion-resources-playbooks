name: ET DOS Possible NTP DDoS Inbound Frequent Un-Authed MON_LIST Requests IMPL 0x02
id: 22017918
description: |
  Detects frequent unauthenticated NTP MON_LIST requests that may indicate DDoS amplification attacks.
  Legitimate NTP monitoring is rare and typically authenticated, while attackers exploit
  public NTP servers to amplify traffic toward victims.
type: detection
detection_id: 2017918
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact NTP MON_LIST request pattern being sent?
    context: The specific request structure reveals the amplification technique being exploited.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.bytes
        - network.packets
        - src_port
        - dst_port

  - question: What is the source IP reputation and geolocation?
    context: DDoS attacks often originate from compromised systems or malicious infrastructure.
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.resolved_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name

  - question: Is this NTP server configured to respond to monitoring requests?
    context: Properly configured NTP servers should disable monitoring to prevent abuse.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - network.bytes
        - network.protocol

  - question: What is the frequency and volume of these MON_LIST requests?
    context: High-frequency requests indicate automated DDoS amplification attempts.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 123
        condition: selection
      fields:
        - network.bytes
        - network.packets

  - question: Are multiple sources targeting this NTP server simultaneously?
    context: Coordinated attacks from multiple sources indicate a distributed DDoS campaign.
    range: -30m/+30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - network.bytes
        - network.packets

  - question: Is the NTP server responding with amplified traffic?
    context: Successful amplification creates large response packets that enable DDoS attacks.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          src_port: 123
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - network.packets

  - question: What other NTP servers are being targeted in similar attacks?
    context: Attackers often probe multiple NTP servers to build amplification botnets.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "NTP DDoS"
        condition: selection
      fields:
        - dst_ip
        - alert.signature

  - question: Are there signs of network performance degradation or congestion?
    context: Successful DDoS attacks cause observable network performance issues.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - network.bytes
        - network.protocol

  - question: What legitimate NTP traffic patterns exist for comparison?
    context: Baseline NTP usage helps distinguish attacks from normal time synchronization.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - network.bytes
        - network.packets

  - question: Are other organizations experiencing similar NTP-based attacks?
    context: NTP amplification attacks often target multiple victims simultaneously.
    range: -1d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "NTP DDoS"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Has this source IP been involved in other amplification attacks?
    context: Attackers often use the same infrastructure for multiple amplification protocols.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains: "DOS"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.severity