name: ET DOS Possible NTP DDoS Multiple MON_LIST Seq 0 Response Spanning Multiple Packets IMPL 0x03
id: 22017921
description: |
  Detects NTP servers sending large MON_LIST responses with implementation version 0x03,
  indicating successful amplification attacks. This variant targets servers with different
  NTP implementations that provide large monitoring responses.
type: detection
detection_id: 2017921
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the specific NTP implementation version and response characteristics?
    context: Different NTP implementations provide varying amplification capabilities to attackers.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.bytes
        - network.packets
        - src_port
        - dst_port

  - question: What was the triggering MON_LIST request for this amplified response?
    context: The original request reveals the attack source and amplification technique used.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - network.bytes
        - network.packets
        - src_port

  - question: Is this NTP server version particularly vulnerable to amplification attacks?
    context: Certain NTP implementations are more susceptible to monitoring command abuse.
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 123
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - network.packets

  - question: What is the pattern and frequency of amplification requests to this server?
    context: Regular amplification abuse indicates the server is being systematically exploited.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - network.bytes
        - network.packets

  - question: What is the geographic distribution of amplification request sources?
    context: Global request sources indicate the server is being used in large-scale DDoS campaigns.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - network.bytes

  - question: How large are the amplified responses compared to the original requests?
    context: High amplification ratios make servers more valuable targets for DDoS attacks.
    range: -10m/+10m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - network.bytes
        - network.direction
        - src_ip
        - dst_ip

  - question: Are there performance impacts from the amplified traffic generation?
    context: Large-scale amplification can degrade the server's performance and network connectivity.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - network.protocol

  - question: What legitimate time synchronization traffic uses this server normally?
    context: Baseline legitimate usage patterns help assess the impact of disabling monitoring.
    range: -14d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - network.bytes
        - network.packets

  - question: Are other NTP servers with similar implementations being targeted?
    context: Attackers often target specific NTP implementation versions for amplification campaigns.
    range: -4h/+4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "NTP DDoS"
          alert.signature|contains: "IMPL 0x03"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Has this server been previously identified in amplification attack campaigns?
    context: Repeated abuse indicates the server needs immediate security configuration changes.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "NTP DDoS"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.severity

  - question: Are there coordinated attacks using multiple amplification protocols?
    context: Sophisticated attackers often combine NTP with other amplification vectors like DNS or SNMP.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          alert.category|contains: "DOS"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category