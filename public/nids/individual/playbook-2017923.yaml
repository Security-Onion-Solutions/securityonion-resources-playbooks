name: ET EXPLOIT MMCS service (Little Endian)
id: 22017923
description: |
  Detects attempts to exploit the MMCS backdoor service on TCP port 32764.
  This backdoor was discovered in various router firmware allowing remote command execution.
  Legitimate traffic to port 32764 is extremely rare in enterprise environments.
type: detection
detection_id: 2017923
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete MMCS command payload sent to the target?
    context: Understanding the full command reveals the attacker's intent and potential system compromise.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - alert.signature

  - question: Is there any legitimate reason for MMCS service communication on this network?
    context: Port 32764 backdoor access should never be legitimate in enterprise environments.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 32764
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  - question: What initiated this connection to the MMCS backdoor service?
    context: Identifying the source helps determine if this is automated scanning or targeted exploitation.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 32764
        condition: selection
      fields:
        - duration
        - bytes_toserver
        - bytes_toclient
        - conn_state

  - question: What other network services were probed by this source IP?
    context: Determines if this is part of broader network reconnaissance or targeted attack.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service
        - conn_state

  - question: Did the target device respond to the MMCS backdoor command?
    context: A response indicates the backdoor is active and potentially compromised.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_toclient
        - conn_state
        - duration

  - question: What commands were executed if the backdoor was successfully accessed?
    context: Reveals the scope of compromise and attacker objectives.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 32764
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: Are there signs of data exfiltration following the MMCS access?
    context: Attackers often use backdoor access to steal configuration or credential data.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - service

  - question: What device type and firmware is running on the compromised target?
    context: Helps identify vulnerability scope and required remediation steps.
    range: -1d
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - http.response.headers.server
        - url.path

  - question: Has this target device made any suspicious outbound connections?
    context: Compromised devices often establish command and control channels.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are other devices on the network vulnerable to MMCS backdoor exploitation?
    context: Identifies the scope of potential compromise across the infrastructure.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "MMCS"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Is this part of a coordinated attack campaign targeting multiple systems?
    context: Determines if this is isolated exploitation or part of broader threat activity.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category: "Exploit"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.severity