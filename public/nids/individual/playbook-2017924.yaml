name: ET EXPLOIT MMCS service (Big Endian)
id: 22017924
description: |
  Detects attempts to exploit the MMCS backdoor service on TCP port 32764 using big-endian encoding.
  This backdoor was discovered in various router firmware allowing remote command execution.
  Big-endian variant suggests targeting of specific device architectures.
type: detection
detection_id: 2017924
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete big-endian MMCS command payload sent?
    context: The big-endian format reveals targeting of specific processor architectures and command intent.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - alert.signature

  - question: Is there legitimate big-endian MMCS communication expected on this network?
    context: Big-endian MMCS traffic is never legitimate and indicates backdoor exploitation attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 32764
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  - question: What type of device architecture is being targeted with big-endian encoding?
    context: Big-endian suggests targeting MIPS or PowerPC-based network devices.
    range: -1d
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.response.headers.server
        - http.request.headers.user_agent
        - url.path

  - question: What reconnaissance activity preceded this targeted exploitation attempt?
    context: Attackers typically fingerprint device architecture before using appropriate encoding.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - service
        - conn_state
        - bytes_toserver

  - question: Did the target device respond to the big-endian MMCS command?
    context: Response indicates successful backdoor access and device compromise.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_toclient
        - conn_state
        - duration

  - question: What post-exploitation activity occurred after successful MMCS access?
    context: Reveals attacker objectives and scope of device compromise.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 32764
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: Are there signs of firmware modification or persistent access installation?
    context: Attackers may install persistent backdoors or modify device firmware.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - service

  - question: What configuration or credential data was potentially accessed?
    context: MMCS backdoor access often leads to configuration theft and credential harvesting.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          bytes_toserver|gte: 1000
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - duration

  - question: Has the compromised device established command and control channels?
    context: Compromised network devices often become part of botnets or attack infrastructure.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are other big-endian architecture devices being targeted in this campaign?
    context: Identifies scope of architecture-specific targeting across the network.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "MMCS"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.severity

  - question: Is this part of coordinated exploitation targeting specific device vendors?
    context: Determines if this is part of broader campaign targeting specific network equipment.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category: "Exploit"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.severity