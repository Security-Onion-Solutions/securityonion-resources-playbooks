name: ET DOS Likely NTP DDoS In Progress MON_LIST Response to Non-Ephemeral Port IMPL 0x02
id: 22017965
description: |
  Detects NTP amplification DDoS attacks where attackers abuse NTP MON_LIST functionality.
  Attackers send spoofed requests to NTP servers causing amplified responses to victims.
  Legitimate NTP MON_LIST responses typically go to ephemeral ports, not well-known ports.
type: detection
detection_id: 2017965
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact NTP MON_LIST response packet structure and amplification ratio?
    context: Understanding packet structure reveals attack sophistication and potential impact volume.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet_info.length

  - question: Is this NTP server legitimately configured to respond to MON_LIST requests?
    context: MON_LIST should be disabled on public NTP servers to prevent DDoS abuse.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 123
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What is the pattern of NTP requests that triggered these amplified responses?
    context: Reveals if this is coordinated DDoS attack with spoofed source addresses.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - bytes_toclient
        - conn_state

  - question: What victim IP addresses are receiving the amplified NTP responses?
    context: Identifies DDoS targets and helps assess attack scope and impact.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 123
          dst_port|lte: 1023
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient
        - conn_state

  - question: What is the total volume of amplified traffic being generated?
    context: Determines attack severity and bandwidth consumption for impact assessment.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 123
        condition: selection
      fields:
        - dst_ip
        - bytes_toclient
        - duration

  - question: Are multiple NTP servers being abused in this DDoS campaign?
    context: Identifies coordinated attack infrastructure and scale of amplification abuse.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "NTP DDoS"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: What legitimate NTP clients are affected by this server's participation in DDoS?
    context: Determines collateral impact on legitimate time synchronization services.
    range: -1d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 123
          src_port|gte: 1024
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - bytes_toclient

  - question: Has this NTP server been compromised or misconfigured for attack abuse?
    context: Determines if server requires immediate reconfiguration or incident response.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 23
            - 80
            - 443
        condition: selection
      fields:
        - src_ip
        - dst_port
        - conn_state
        - bytes_toserver

  - question: What DNS queries are associated with this NTP amplification attack?
    context: Reveals attack coordination and potential botnet command infrastructure.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Are there signs of automated tools or botnets coordinating this attack?
    context: Identifies attack sophistication and potential attribution indicators.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - conn_state

  - question: Is this part of a larger multi-vector DDoS attack campaign?
    context: Determines if NTP amplification is combined with other DDoS methods.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.category: "Attempted Denial of Service"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature
        - alert.severity