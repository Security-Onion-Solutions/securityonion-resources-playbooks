name: ET MALWARE Bozok.RAT checkin
id: 22018325
description: |
  Detects Bozok Remote Access Trojan (RAT) checkin communication to external servers.
  This signature identifies the specific binary pattern used by Bozok RAT for command and control communications.
  Legitimate applications rarely use this specific sequence of null bytes and pipe characters.
type: detection
detection_id: 2018325
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact binary payload pattern that triggered this Bozok RAT detection?
    context: Understanding the specific byte sequence helps confirm RAT communication and rule out false positives.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - src_ip
        - dst_ip
        - dst_port

  - question: Is this connection part of legitimate administrative software or remote access tools?
    context: Some legitimate remote administration tools may trigger similar patterns, requiring verification of authorized usage.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 80
        condition: selection
      fields:
        - dst_ip
        - bytes_out
        - connection_count

  - question: What process initiated this outbound connection on the infected host?
    context: Identifying the parent process helps determine infection vector and persistence mechanism.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 80
        condition: selection
      fields:
        - process.name
        - process.pid
        - process.command_line

  - question: What other network connections were established around the same time?
    context: RAT infections often involve multiple network connections for data exfiltration and command execution.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_in
        - bytes_out

  - question: Has the compromised system successfully established a persistent connection?
    context: Successful RAT communication indicates active compromise requiring immediate containment.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - connection_count
        - total_bytes
        - duration

  - question: What files were accessed or modified during the RAT communication timeframe?
    context: File activity during RAT communication may indicate data theft or additional malware deployment.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.path
        - file.name
        - event.action
        - process.name

  - question: Are there signs of credential harvesting or privilege escalation attempts?
    context: RATs commonly attempt to escalate privileges and steal credentials for lateral movement.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - 'mimikatz'
            - 'procdump'
            - 'lsass'
        condition: selection
      fields:
        - process.command_line
        - process.parent.name
        - user.name

  - question: What DNS queries were made by the infected system?
    context: DNS activity reveals additional C2 infrastructure and potential data exfiltration channels.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.question.name
        - dns.resolved_ip
        - dns.question.type

  - question: Has data been exfiltrated based on unusual outbound traffic patterns?
    context: Large or unusual data transfers may indicate successful data theft by the RAT.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - bytes_out
        - connection_count

  - question: Are other systems in the network showing similar Bozok RAT indicators?
    context: RATs often spread laterally, requiring enterprise-wide threat hunting to identify full compromise scope.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Bozok'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert_count

  - question: What is the timeline of infection based on related security events?
    context: Understanding infection timeline helps determine data exposure window and required remediation scope.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - severity