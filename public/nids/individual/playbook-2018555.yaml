name: ET MALWARE Putter Panda 3PARA RAT initial beacon
id: 22018555
description: |
  Detects initial beacon traffic from Putter Panda 3PARA RAT using specific binary signature.
  This is a targeted APT tool used for espionage and data exfiltration activities.
type: detection
detection_id: 2018555
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact binary beacon pattern transmitted?
    context: The specific signature helps confirm RAT variant and communication protocol.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.payload
        - alert.payload_printable
        - rule.name

  - question: What command and control server is being contacted?
    context: Identifies the APT infrastructure and potential attribution to Putter Panda group.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - src_ip
        - bytes_out

  - question: Is this C2 server known in threat intelligence feeds?
    context: Helps confirm APT attribution and assess threat level based on known indicators.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - first_seen
        - connection_count

  - question: What process is generating this beacon traffic?
    context: Identifies the RAT executable and helps trace infection mechanism.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.executable
        - User

  - question: Are there signs of data staging or collection activities?
    context: 3PARA RAT is used for espionage, indicating potential data theft preparation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.path
        - file.name
        - file.size
        - process.name

  - question: Has the RAT established persistence mechanisms?
    context: Determines if the malware has installed startup mechanisms for long-term access.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          registry.path|contains:
            - "Run"
            - "RunOnce"
            - "Services"
        condition: selection
      fields:
        - registry.path
        - registry.value
        - process.name

  - question: What data is being exfiltrated to the C2 server?
    context: Assesses the scope and type of information being stolen by the APT.
    range: +24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - total_bytes_out
        - session_count
        - avg_bytes_per_session

  - question: Are there additional APT tools or lateral movement attempts?
    context: Putter Panda typically uses multiple tools, indicating broader compromise scope.
    range: +6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 135
            - 139
            - 445
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: How did the RAT initially compromise this system?
    context: Understanding infection vector helps prevent similar compromises.
    range: -4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: Are there other hosts showing similar APT indicators?
    context: Determines if this is part of a broader campaign affecting multiple systems.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Putter Panda"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert_count

  - question: What sensitive data repositories has this host accessed?
    context: Assesses potential data exposure and helps prioritize incident response.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 445
            - 1433
            - 3306
            - 5432
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_in