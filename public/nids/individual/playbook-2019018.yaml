name: ET DOS Possible NTP DDoS Inbound Frequent Un-Authed PEER_LIST_SUM Requests IMPL 0x03
id: 22019018
description: |
  Detects frequent unauthenticated NTP PEER_LIST_SUM requests using implementation 0x03, indicating potential DDoS amplification reconnaissance.
  Legitimate NTP peer summary queries are typically authenticated and performed infrequently by network monitoring systems.
type: detection
detection_id: 2019018
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact NTP PEER_LIST_SUM request packet structure with implementation 0x03?
    context: Understanding the specific packet format and implementation helps identify the attack tools and reconnaissance methods.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: Is this source authorized for NTP infrastructure monitoring and peer summary collection?
    context: Some enterprise monitoring tools legitimately query NTP servers for peer summary information for network health assessment.
    range: -14d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - dst_ip
        - connection_count
        - unique_dst_count
        - bytes_pattern

  - question: What is the frequency and timing pattern of these PEER_LIST_SUM requests?
    context: Attack reconnaissance shows irregular bursts while legitimate monitoring follows consistent schedules.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 123
        condition: selection
      fields:
        - connection_count
        - bytes_in
        - bytes_out
        - time_intervals

  - question: How many NTP servers is this source targeting for peer summary information?
    context: Scanning multiple servers for peer summaries indicates reconnaissance for amplification attack infrastructure mapping.
    range: -3h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - dst_ip
        - connection_count
        - bytes_out
        - server_count

  - question: What is the amplification potential of PEER_LIST_SUM responses from this server?
    context: Large peer summary responses provide significant amplification ratios for DDoS attacks.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_in
        - bytes_out
        - packets_in
        - packets_out
        - response_size

  - question: What other NTP reconnaissance commands has this source attempted?
    context: Multiple NTP command types indicate comprehensive server profiling for attack preparation.
    range: -12h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'NTP'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - alert_count
        - command_types

  - question: Has this NTP server been targeted for amplification attacks in the past?
    context: Historical attack patterns indicate server vulnerability and likelihood of continued exploitation.
    range: -60d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'NTP DDoS'
            - 'NTP amplification'
            - 'PEER_LIST'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - attack_frequency
        - last_attack

  - question: Are there coordinated PEER_LIST_SUM probes from multiple botnet sources?
    context: Distributed reconnaissance from multiple IPs indicates organized botnet activity for DDoS preparation.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'PEER_LIST_SUM'
        condition: selection
      fields:
        - src_ip
        - alert_count
        - unique_sources
        - coordination_pattern

  - question: What is the threat intelligence and reputation status of this source IP?
    context: Known malicious IPs indicate active botnet participation rather than legitimate network monitoring.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.category
        - threat_classification
        - reputation_score
        - malware_family

  - question: Are there follow-up exploitation attempts after this reconnaissance phase?
    context: Successful server profiling typically leads to actual amplification attacks using the discovered vulnerable infrastructure.
    range: +6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'attempted-dos'
            - 'successful-dos'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - attack_volume
        - success_indicators