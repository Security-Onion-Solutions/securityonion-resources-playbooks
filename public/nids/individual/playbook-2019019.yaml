name: ET DOS Possible NTP DDoS Inbound Frequent Un-Authed PEER_LIST_SUM Requests IMPL 0x02
id: 22019019
description: |
  Detects frequent unauthenticated NTP PEER_LIST_SUM requests using implementation 0x02, indicating potential DDoS amplification reconnaissance.
  Legitimate NTP peer summary queries are typically authenticated and performed infrequently by network monitoring systems.
type: detection
detection_id: 2019019
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact NTP PEER_LIST_SUM request packet with implementation 0x02 detected?
    context: Understanding the specific implementation version and packet structure helps identify the reconnaissance tools being used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: Is this source IP part of authorized NTP monitoring infrastructure?
    context: Some network management systems legitimately query NTP servers for peer summary data as part of infrastructure health monitoring.
    range: -21d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - dst_ip
        - connection_count
        - monitoring_pattern
        - authentication_status

  - question: What is the request frequency and temporal distribution pattern?
    context: Attack reconnaissance shows burst patterns while legitimate monitoring demonstrates regular, predictable intervals.
    range: -8h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 123
        condition: selection
      fields:
        - connection_count
        - bytes_in
        - bytes_out
        - request_intervals

  - question: How many different NTP servers is this source probing for peer summaries?
    context: Widespread server scanning indicates systematic reconnaissance for building DDoS amplification infrastructure maps.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 123
        condition: selection
      fields:
        - dst_ip
        - unique_servers
        - response_sizes
        - probe_coverage

  - question: What is the response amplification ratio for PEER_LIST_SUM queries on this server?
    context: High amplification ratios make servers attractive targets for DDoS attacks due to traffic multiplication potential.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_in
        - bytes_out
        - amplification_factor
        - peer_count_estimate

  - question: What additional NTP reconnaissance commands has this source executed?
    context: Multiple NTP command types indicate comprehensive server profiling for optimal attack vector selection.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'NTP'
            - 'PEER_LIST'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - command_variety
        - reconnaissance_scope

  - question: Has this NTP server been exploited for amplification attacks previously?
    context: Historical exploitation patterns indicate persistent vulnerability and ongoing abuse potential.
    range: -90d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category: 'attempted-dos'
          rule.name|contains: 'NTP'
        condition: selection
      fields:
        - src_ip
        - attack_frequency
        - exploitation_history
        - victim_targets

  - question: Are there coordinated PEER_LIST_SUM reconnaissance attempts from multiple sources?
    context: Distributed probing from multiple IPs indicates botnet coordination for large-scale DDoS infrastructure preparation.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'PEER_LIST_SUM'
        condition: selection
      fields:
        - src_ip
        - source_diversity
        - coordination_indicators
        - botnet_signatures

  - question: What is the threat intelligence classification for this reconnaissance source?
    context: Known malicious infrastructure indicates active botnet operations rather than legitimate network monitoring activities.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - threat_category
        - malware_associations
        - botnet_membership
        - attack_history

  - question: Are there subsequent amplification attacks following this reconnaissance activity?
    context: Successful server profiling typically results in exploitation attempts using the identified vulnerable NTP infrastructure.
    range: +8h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - 'attempted-dos'
            - 'successful-dos'
          rule.name|contains: 'amplification'
        condition: selection
      fields:
        - src_ip
        - attack_volume
        - victim_targets
        - success_rate