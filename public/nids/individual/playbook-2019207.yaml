name: ET MALWARE Linux/BillGates Checkin
id: 22019207
description: |
  Detects Linux/BillGates malware checkin communication with command and control servers.
  Identifies specific binary patterns in C2 communication indicating active botnet participation.
  May rarely trigger on legitimate applications using similar binary protocols.
type: detection
detection_id: 2019207
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete binary payload structure of the BillGates checkin?
    context: Analyzing the full binary communication reveals botnet protocol version and capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.bytes_toserver
        - network.protocol
        - flow.bytes_toserver

  - question: What specific command and control server is receiving the checkin?
    context: Identifying C2 infrastructure enables threat intelligence correlation and blocking.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - flow.state

  # Type 2: Triage Assessment
  - question: Is this communication from a known Linux server or workstation?
    context: BillGates typically targets Linux servers, helping prioritize response efforts.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_toserver
        - network.bytes_toclient

  - question: Does this system normally communicate with external servers on this port?
    context: Unusual external connections may indicate compromised system behavior.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - dst_ip
        - network.protocol
        - flow.bytes_toserver

  # Type 3: Activity Context
  - question: What process initiated this BillGates communication?
    context: Identifying the source process reveals the malware location and execution context.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What network activity preceded this checkin communication?
    context: Understanding infection vector helps determine how BillGates was delivered.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_toserver
        - network.bytes_toclient

  # Type 4: Impact Assessment
  - question: Are there signs of DDoS attack coordination following the checkin?
    context: BillGates is primarily a DDoS botnet requiring immediate network protection measures.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.bytes_toserver
        - network.protocol

  - question: What files were created or modified around the time of infection?
    context: BillGates creates persistence files and may download additional payloads.
    range: -30m/+30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  # Type 5: Forensic Deep-Dive
  - question: What specific BillGates variant and capabilities are indicated by the binary pattern?
    context: Different BillGates variants have distinct protocol signatures and attack capabilities.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'BillGates'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - alert.signature_id

  - question: What persistence mechanisms has BillGates established on this system?
    context: Understanding persistence helps with complete malware removal and prevention.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - 'cron'
            - 'systemd'
            - 'init'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are other Linux systems in the environment showing BillGates activity?
    context: BillGates can spread through networks requiring comprehensive threat hunting.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'BillGates'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - alert.signature_id

  - question: What shared infrastructure or attack patterns connect this to broader campaigns?
    context: BillGates infrastructure often overlaps with other malware families and APT groups.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - network.protocol
        - flow.bytes_toserver