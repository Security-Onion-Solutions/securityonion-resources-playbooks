name: ET MALWARE Likely Bot Nick in IRC (Country Code ISO 3166-1 alpha-3)
id: 22019327
description: |
  Detects IRC bot activity using 3-letter country code patterns as nicknames, indicating automated malware communication.
  Legitimate IRC users typically don't use ISO 3166-1 alpha-3 country codes as nicknames systematically.
  This behavior suggests botnet organization using geographic identifiers for command and control.
type: detection
detection_id: 2019327
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific 3-letter country code nickname was used in the IRC registration?
    context: The alpha-3 country code reveals the bot's geographic classification and organizational structure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - src_ip
        - dst_ip

  - question: What was the complete IRC protocol sequence including NICK, USER, and other commands?
    context: Full IRC handshake analysis reveals bot sophistication and communication protocol details.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 6667
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tx_bytes
        - rx_bytes
        - duration
        - connection_state

  # Type 2: Triage Assessment
  - question: Is IRC communication authorized from this system or network segment?
    context: Corporate networks typically restrict IRC protocols, making any IRC traffic highly suspicious.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 6667
            - 6668
            - 6669
            - 194
            - 7000
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection_state
        - tx_bytes

  - question: Has this system been approved for IRC client installation or usage?
    context: Legitimate IRC usage would involve documented approval and authorized client software.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'irc'
            - 'mirc'
            - 'xchat'
            - 'hexchat'
            - 'weechat'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  # Type 3: Activity Context
  - question: What process or event triggered the IRC bot registration sequence?
    context: Understanding the initiation helps identify the malware delivery mechanism and infection vector.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What other IRC-related network activity occurred during the same session?
    context: Comprehensive IRC session analysis reveals bot capabilities and command structure.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'IRC'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - payload_printable

  # Type 4: Impact Assessment
  - question: Has the bot successfully joined IRC channels or received C2 commands?
    context: Channel participation and command reception indicate active botnet membership and operational capability.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'IRC'
            - 'JOIN'
            - 'PRIVMSG'
            - 'NOTICE'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - payload_printable

  - question: What malicious activities has the system performed since IRC registration?
    context: Post-registration activity reveals the bot's operational purpose and potential damage scope.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'trojan'
            - 'malware'
            - 'dos'
            - 'exploit'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  # Type 5: Forensic Deep-Dive
  - question: What specific malware family is responsible for this IRC bot behavior?
    context: Malware identification enables targeted removal procedures and threat intelligence correlation.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'bot'
            - 'trojan'
            - 'malware'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - payload_printable

  - question: What persistence mechanisms has the malware established for IRC connectivity?
    context: Understanding persistence ensures complete malware removal and prevents reinfection.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - 'startup'
            - 'autostart'
            - 'cron'
            - 'init.d'
            - 'systemd'
        condition: selection
      fields:
        - TargetFilename
        - ProcessName
        - file.hash.md5

  - question: What files or registry entries support the IRC bot functionality?
    context: File system analysis reveals malware components and helps with forensic reconstruction.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - '.irc'
            - 'bot'
            - 'config'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  # Type 6: Enterprise Correlation
  - question: Are other systems exhibiting similar IRC bot behavior with alpha-3 country codes?
    context: Coordinated botnet campaigns typically use consistent naming patterns across infected systems.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name: 'ET MALWARE Likely Bot Nick in IRC (Country Code ISO 3166-1 alpha-3)'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - payload_printable

  - question: What IRC servers are being contacted enterprise-wide for potential C2 communication?
    context: Identifying botnet infrastructure enables network-level blocking and threat hunting activities.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port|contains:
            - 6667
            - 6668
            - 6669
            - 194
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - connection_state
        - tx_bytes