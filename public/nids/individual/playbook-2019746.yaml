name: ET INFO Bitmessage Activity
id: 22019746
description: |
  Detects Bitmessage peer-to-peer communication protocol usage on port 8444.
  May indicate legitimate privacy-focused messaging or potential policy violation depending on organizational guidelines.
type: detection
detection_id: 2019746
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact Bitmessage protocol version and handshake data?
    context: Protocol version information reveals client type and potential anonymity tools being used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - network.protocol
        - network.transport
        - src_ip
        - dst_ip
        - dst_port

  - question: What is the complete network handshake sequence for this Bitmessage connection?
    context: Understanding connection establishment helps determine if this is standard Bitmessage usage.
    range: -2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 8444
        condition: selection
      fields:
        - network.bytes_toserver
        - network.bytes_toclient
        - network.protocol

  # Type 2: Triage Assessment
  - question: Is Bitmessage usage authorized for this user or system?
    context: Organizations may have policies restricting anonymous communication tools.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 8444
        condition: selection
      fields:
        - dst_ip
        - network.bytes_toserver

  - question: Is this system typically used for legitimate business communications?
    context: Personal use of anonymity tools on corporate systems may violate acceptable use policies.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol

  # Type 3: Activity Context
  - question: What applications or processes initiated this Bitmessage connection?
    context: Understanding the source application helps determine legitimate versus suspicious usage.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - User

  - question: What other peer-to-peer or anonymity network activity occurred recently?
    context: Multiple anonymity tools may indicate privacy-conscious user or potential data exfiltration.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 9050
            - 9150
            - 8333
            - 18333
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol

  # Type 4: Impact Assessment
  - question: What volume of data is being transmitted through Bitmessage?
    context: Large data transfers may indicate file sharing or potential data exfiltration.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 8444
        condition: selection
      fields:
        - dst_ip
        - network.bytes_toserver
        - network.bytes_toclient

  - question: Are there signs of sensitive data access before Bitmessage usage?
    context: File access patterns may indicate data collection prior to anonymous communication.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.name
        - file.path
        - process.name

  # Type 5: Forensic Deep-Dive
  - question: What Bitmessage client software and version is being used?
    context: Different clients have varying capabilities and may indicate user sophistication level.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - "bitmessage"
            - "PyBitmessage"
        condition: selection
      fields:
        - process.command_line
        - process.executable
        - User

  - question: Are there patterns suggesting automated or scripted Bitmessage usage?
    context: Automated usage may indicate malware command and control or data exfiltration.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 8444
        condition: selection
      fields:
        - dst_ip
        - network.bytes_toserver

  # Type 6: Enterprise Correlation
  - question: Are other systems in the organization using Bitmessage or similar tools?
    context: Widespread anonymity tool usage may indicate policy violations or security concerns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: "Bitmessage"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Is this part of broader privacy tool or cryptocurrency-related activity?
    context: Anonymous communication tools are often used alongside cryptocurrency and privacy applications.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 8333
            - 18333
            - 50001
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol