name: ET MALWARE Volatile Cedar Win32.Explosive CnC Beacon 3
id: 22020809
description: |
  Detects Win32.Explosive malware command and control beacon communications.
  This specific pattern indicates established C2 channel for the Volatile Cedar APT group.
  Legitimate applications would not contain this specific beacon pattern.
type: detection
detection_id: 2020809
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete TCP payload containing the Explosive beacon?
    context: Understanding the full beacon structure reveals C2 protocol specifics and potential data exfiltration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - tcp.payload

  - question: What specific TCP connection parameters were used for this C2 communication?
    context: Connection metadata helps identify the C2 infrastructure and communication patterns.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto
        - conn_state

  # Type 2: Triage Assessment
  - question: Is this outbound connection part of normal business operations for this host?
    context: Legitimate business applications would not communicate using Explosive beacon patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - proto
        - orig_bytes
        - resp_bytes

  # Type 3: Activity Context
  - question: What process initiated this suspicious network connection?
    context: Identifying the parent process helps determine the infection vector and persistence mechanism.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What other network connections occurred from this host around the same time?
    context: Concurrent connections may reveal additional C2 channels or lateral movement attempts.
    range: -30m/+30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  - question: Were there any DNS queries for the C2 server before this connection?
    context: DNS resolution patterns help identify domain generation algorithms or hardcoded C2 domains.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip

  # Type 4: Impact Assessment
  - question: How much data was transmitted in this C2 session?
    context: Data volume helps assess potential information theft and command execution scope.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - orig_bytes
        - resp_bytes
        - duration
        - conn_state

  - question: Are there signs of file system modifications on the infected host?
    context: File changes indicate payload deployment, persistence installation, or data staging.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  # Type 5: Forensic Deep-Dive
  - question: What registry modifications occurred that might indicate persistence mechanisms?
    context: Registry changes reveal how the malware maintains persistence across reboots.
    range: -2h/+2h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details
        - EventType

  - question: What is the complete timeline of malicious activity on this host?
    context: Full activity timeline helps understand attack progression and identify all compromised assets.
    range: -24h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  # Type 6: Enterprise Correlation
  - question: Are other hosts in the network communicating with the same C2 server?
    context: Multiple infected hosts indicate widespread compromise requiring coordinated response.
    range: -24h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - orig_bytes
        - resp_bytes

  - question: Have other Volatile Cedar indicators been detected across the enterprise?
    context: Related APT activity helps understand campaign scope and prioritize containment efforts.
    range: -7d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'Volatile Cedar'
            - 'Explosive'
            - 'Win32.Explosive'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name