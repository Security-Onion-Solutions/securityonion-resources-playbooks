name: ET MALWARE Possible Linux/Moose Telnet CnC Beacon
id: 22021149
description: |
  Detects Linux/Moose malware beacon traffic to command and control servers.
  This IoT botnet targets embedded devices and routers for DDoS attacks.
  May rarely trigger on legitimate telnet applications with similar packet structure.
type: detection
detection_id: 2021149
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact 40-byte payload structure sent to the external server?
    context: The specific byte pattern reveals Linux/Moose beacon characteristics and C2 communication protocol.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - payload
        - src_ip
        - dst_ip
        - dst_port

  - question: Is this device known to run legitimate telnet services or IoT applications?
    context: Embedded devices may have legitimate telnet services that could generate similar traffic patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 23
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What triggered this specific beacon transmission?
    context: Understanding the initiating event helps determine if this is automated malware behavior or user-initiated activity.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  - question: What other network connections occurred from this host around the same time?
    context: Linux/Moose typically establishes multiple C2 connections and may perform reconnaissance activities.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver
        - bytes_toclient

  - question: Has this host established persistent connections to known C2 infrastructure?
    context: Moose malware maintains persistent C2 channels for receiving DDoS commands and updates.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          conn_state: SF
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - duration

  - question: Are there signs of DDoS attack participation from this infected device?
    context: Linux/Moose infected devices participate in coordinated DDoS attacks against targets.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - pkts_toserver
        - bytes_toserver

  - question: What processes are running on this potentially infected system?
    context: Identifying malicious processes helps confirm infection and determine persistence mechanisms.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Are there suspicious file modifications indicating malware installation?
    context: Linux/Moose creates persistence through file system modifications and binary installations.
    range: -6h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  - question: Has this C2 server been contacted by other internal hosts?
    context: Moose infections often spread laterally through network shares and weak credentials.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - conn_state

  - question: Are there other hosts showing similar beacon patterns enterprise-wide?
    context: Identifying the scope of Linux/Moose infection across the network infrastructure.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Linux/Moose"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name