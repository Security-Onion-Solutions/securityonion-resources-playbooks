name: ET DOS Possible Sentinal LM Application attack in progress Outbound (Response)
id: 22021170
description: |
  Detects potential Sentinel License Manager amplification attack responses from internal hosts.
  Sentinel LM uses UDP port 5093 and can be abused for DDoS amplification attacks.
  May trigger on legitimate license server responses during high usage periods.
type: detection
detection_id: 2021170
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact content and size of the amplified response packet?
    context: Large response packets with specific Sentinel LM headers indicate amplification abuse.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet_info.length
        - src_port
        - dst_port

  - question: Is this host running legitimate Sentinel License Manager services?
    context: Authorized license servers would normally respond to client requests on port 5093.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 5093
        condition: selection
      fields:
        - dst_ip
        - bytes_toclient
        - conn_state

  - question: What was the original request that triggered this large response?
    context: Amplification attacks use small requests to generate disproportionately large responses.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          dst_port: 5093
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: How many similar large responses has this host sent recently?
    context: Threshold detection indicates sustained amplification attack participation exceeding normal license server activity.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 5093
          bytes_toclient|gte: 1390
        condition: selection
      fields:
        - dst_ip
        - bytes_toclient
        - pkts_toclient

  - question: Are the response destinations consistent with legitimate license clients?
    context: Amplification attacks target victim IPs, while legitimate responses go to known license clients.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 5093
        condition: selection
      fields:
        - dst_ip
        - bytes_toclient
        - conn_state

  - question: What processes are associated with the Sentinel License Manager service?
    context: Identifying legitimate license manager processes versus potential malware abuse.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - User

  - question: Are there signs of service exploitation or configuration tampering?
    context: Attackers may exploit vulnerable license servers or modify configurations for amplification abuse.
    range: -6h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - "sentinel"
            - "license"
            - "lm"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  - question: Has this license server been targeted by scanning or reconnaissance?
    context: Attackers often scan for vulnerable Sentinel LM services before launching amplification attacks.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 5093
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - conn_state

  - question: Are other internal license servers showing similar amplification patterns?
    context: Coordinated attacks may target multiple Sentinel LM servers simultaneously for maximum amplification.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Sentinal LM"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the amplification ratio and total volume being generated?
    context: Understanding attack scale helps prioritize response and assess infrastructure impact.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          src_port: 5093
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - pkts_toserver
        - pkts_toclient