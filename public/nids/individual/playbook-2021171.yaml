name: ET DOS Possible Sentinal LM Amplification attack (Response) Inbound
id: 22021171
description: |
  Detects large Sentinel License Manager responses indicating potential amplification attack traffic.
  These responses may be directed at victim systems as part of DDoS campaigns.
  Could trigger on legitimate license server responses during software deployment or updates.
type: detection
detection_id: 2021171
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the size and content of the incoming amplified response?
    context: Large Sentinel LM responses with specific headers indicate amplification attack traffic targeting internal systems.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet_info.length
        - src_ip
        - src_port

  - question: Is the destination host running software that legitimately uses Sentinel licensing?
    context: Legitimate license clients would normally receive responses from authorized Sentinel LM servers.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port: 5093
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - conn_state

  - question: Did this internal host initiate any requests to the responding server?
    context: Amplification attacks involve unsolicited responses, while legitimate traffic follows request-response patterns.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          dst_port: 5093
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration
        - conn_state

  - question: How many similar large responses is this host receiving?
    context: Sustained high-volume responses indicate the host is being targeted in an amplification attack.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_port: 5093
          bytes_toclient|gte: 1390
        condition: selection
      fields:
        - src_ip
        - bytes_toclient
        - pkts_toclient

  - question: What is the geographic and network distribution of response sources?
    context: Amplification attacks typically involve responses from multiple distributed Sentinel LM servers.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_port: 5093
        condition: selection
      fields:
        - src_ip
        - bytes_toclient
        - conn_state

  - question: Is this host showing signs of performance degradation or service disruption?
    context: Large volume amplification attacks can overwhelm target systems and degrade network performance.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - bytes_toclient
        - conn_state

  - question: Are there processes on the target host that might be affected by this traffic?
    context: Understanding running applications helps assess the impact of amplification attack traffic.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - User

  - question: Has this attack pattern been observed against other internal hosts?
    context: Amplification attacks often target multiple victims simultaneously or sequentially.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Sentinal LM Amplification"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the total volume and duration of amplification traffic received?
    context: Quantifying attack scale helps determine response priorities and infrastructure protection needs.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_port: 5093
        condition: selection
      fields:
        - bytes_toclient
        - pkts_toclient
        - duration

  - question: Are there indicators of coordinated attack timing with other DDoS vectors?
    context: Amplification attacks are often combined with other DDoS methods for maximum impact.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - "DOS"
            - "DDoS"
            - "Amplification"
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category