name: ET MALWARE Linux/ChinaZ DDoS Bot Checkin 2
id: 22021316
description: |
  Detects Linux/ChinaZ DDoS botnet check-in communications containing system information.
  This malware reports hardware specifications and IP address to command and control servers.
  May rarely trigger on legitimate applications transmitting similar system information patterns.
type: detection
detection_id: 2021316
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What specific system information is being transmitted to the C2 server?
    context: ChinaZ bot check-ins contain CPU MHz, memory MB, and IP address information that reveals infected system characteristics.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - payload
        - src_ip
        - dst_ip
        - dst_port

  - question: Is this system authorized to communicate with the destination server?
    context: Legitimate system monitoring tools may send hardware information, but ChinaZ targets are typically malicious C2 infrastructure.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - bytes_toserver
        - bytes_toclient
        - conn_state

  - question: What process initiated this suspicious system information transmission?
    context: Identifying the parent process helps determine if this is legitimate system monitoring or malware check-in behavior.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - ParentImage
        - User

  - question: What other network connections has this host established recently?
    context: ChinaZ bots typically maintain multiple C2 connections and may download additional payloads or attack instructions.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver
        - bytes_toclient

  - question: Has this bot received DDoS attack commands or targets?
    context: After check-in, ChinaZ bots typically receive instructions for participating in coordinated DDoS attacks.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient
        - pkts_toserver

  - question: Are there signs of malware persistence mechanisms on this system?
    context: ChinaZ establishes persistence through various methods including file system modifications and service installation.
    range: -6h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size
        - file.mime_type

  - question: What registry modifications might indicate ChinaZ installation?
    context: The malware may modify Windows registry for persistence, startup, or configuration storage.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details
        - EventType

  - question: Has this C2 server been contacted by other internal hosts?
    context: ChinaZ campaigns often involve multiple infected systems within the same network infrastructure.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - conn_state

  - question: Are there other ChinaZ botnet indicators across the enterprise?
    context: Identifying the full scope of ChinaZ infection helps prioritize containment and remediation efforts.
    range: +/-12h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "ChinaZ"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the timing pattern of check-in communications?
    context: Understanding check-in frequency helps predict future C2 communications and potential attack timing.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - duration
        - conn_state

  - question: Are there indicators of lateral movement or credential harvesting?
    context: ChinaZ infections may lead to further compromise through credential theft and lateral movement capabilities.
    range: +6h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "net user"
            - "net group"
            - "whoami"
            - "ipconfig"
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - User