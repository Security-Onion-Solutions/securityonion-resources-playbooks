name: ET MALWARE Linux/ChinaZ 2.0 DDoS Bot Checkin 3
id: 22021526
description: |
  Detects Linux/ChinaZ 2.0 DDoS botnet command and control communication.
  This malware performs system reconnaissance and sends hardware information to C2 servers.
  Legitimate software would not send system specs in this specific binary format.
type: detection
detection_id: 2021526
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What system information was transmitted in the botnet checkin?
    context: The payload contains hardware specifications that reveal compromised system details.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - src_ip
        - dst_ip

  - question: What is the complete binary pattern that triggered this detection?
    context: Understanding the exact C2 protocol helps identify other infected systems.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - flow_id
        - proto

  # Type 2: Triage Assessment
  - question: Is this system known to run legitimate remote monitoring software?
    context: Some system monitoring tools may send hardware information, though not in this format.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
            - 8080
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: Has this source IP shown other suspicious network behavior recently?
    context: Compromised systems often exhibit multiple malicious activities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - dst_ip

  # Type 3: Activity Context
  - question: What process initiated this network connection?
    context: Identifying the parent process helps determine infection vector and persistence.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  - question: What other network connections occurred from this system around the same time?
    context: Botnet infections often involve multiple C2 servers and download additional payloads.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 4: Impact Assessment
  - question: Has the infected system received commands or downloaded additional malware?
    context: DDoS bots typically receive attack commands and may download updates or additional tools.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - src_port
        - bytes_toclient

  - question: Are there signs of DDoS attack participation from this system?
    context: Active botnet participation indicates successful compromise and ongoing threat.
    range: +24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - tx_bytes
        - connection_count

  # Type 5: Forensic Deep-Dive
  - question: What files were created or modified around the time of infection?
    context: Malware persistence mechanisms and downloaded payloads leave filesystem artifacts.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.path
        - file.name
        - file.hash.md5
        - process.name

  - question: What registry modifications occurred that might indicate persistence mechanisms?
    context: Windows variants of this malware family often establish registry-based persistence.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - registry.key
        - registry.value.name
        - registry.value.data
        - process.name

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network communicating with the same C2 server?
    context: Botnet infections often spread laterally or target multiple systems simultaneously.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - connection_count

  - question: Have other systems triggered similar malware detection rules recently?
    context: Coordinated infections or worm-like spreading behavior indicates broader compromise.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains:
            - "ChinaZ"
            - "DDoS Bot"
            - "Botnet"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature