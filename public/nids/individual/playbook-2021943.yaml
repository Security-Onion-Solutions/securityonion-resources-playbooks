name: ET WEB_CLIENT Proxy - Fiddler Proxy Certificate Seen
id: 22021943
description: |
  Detects Fiddler proxy certificate in TLS traffic, indicating web debugging or security testing activity.
  May represent legitimate web development debugging, security testing, or malicious traffic interception.
  Fiddler is commonly used for web application debugging, API testing, and HTTP/HTTPS traffic analysis.
type: detection
detection_id: 2021943
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What are the complete Fiddler certificate details for this proxy connection?
    context: Certificate analysis reveals Fiddler configuration and helps determine if this represents legitimate debugging or malicious interception.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.not_valid_after
        - tls.server.certificate.serial_number

  - question: What was the specific TLS handshake pattern for this Fiddler proxy session?
    context: Understanding TLS negotiation confirms proxy interception and identifies the scope of web traffic analysis.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.version
        - tls.cipher_suite
        - payload_printable

  # Type 2: Triage Assessment
  - question: Is this Fiddler activity occurring during authorized development or testing periods?
    context: Legitimate web debugging typically occurs during development cycles or scheduled testing windows.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          tls.server.certificate.issuer|contains: "Fiddler"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: Is the source system associated with authorized development or testing personnel?
    context: Distinguishes between legitimate web debugging tools and unauthorized traffic interception activities.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto

  # Type 3: Activity Context
  - question: What web applications are being debugged through this Fiddler proxy session?
    context: Identifies the scope of web debugging or potential traffic interception to assess legitimate business purpose.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - user_agent.original

  - question: What triggered the initiation of this Fiddler proxy-intercepted session?
    context: Understanding session origin helps determine if this is legitimate debugging or unauthorized traffic interception.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  # Type 4: Impact Assessment
  - question: What sensitive web applications or data have been accessed through this Fiddler proxy?
    context: Determines if critical systems or sensitive data were exposed to debugging tools or potential interception.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code
        - http.response.body.bytes

  - question: Has this Fiddler session established persistent web traffic interception?
    context: Ongoing proxy sessions indicate comprehensive debugging or potential sustained traffic interception.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - duration
        - orig_bytes
        - resp_bytes

  # Type 5: Forensic Deep-Dive
  - question: What specific Fiddler debugging techniques or traffic modifications were performed?
    context: Detailed analysis reveals whether this is basic debugging or advanced traffic manipulation for malicious purposes.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.body.content
        - user_agent.original
        - url.query

  - question: Are there indicators of Fiddler software installation or execution on the source system?
    context: Confirms local Fiddler installation versus traffic routing through external debugging infrastructure.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          Image|contains:
            - "fiddler"
            - "Fiddler"
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  # Type 6: Enterprise Correlation
  - question: Are multiple systems across the network using Fiddler proxies simultaneously?
    context: Coordinated Fiddler usage may indicate organized debugging efforts or distributed traffic interception campaign.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.issuer|contains: "Fiddler"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: Is this part of broader web debugging or proxy tool usage patterns in the enterprise?
    context: Helps determine if this represents authorized development activities or coordinated traffic interception campaign.
    range: +/-48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "Proxy"
            - "Fiddler"
            - "BurpSuite"
            - "ZAP"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name