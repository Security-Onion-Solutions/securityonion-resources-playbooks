name: ET MALWARE Possible Chimera Ransomware - Bitmessage Activity
id: 22022075
description: |
  Detects potential Chimera ransomware communication using the Bitmessage protocol on port 8080.
  Chimera ransomware uses Bitmessage for anonymous communication with victims and operators.
  May trigger on legitimate Bitmessage usage, but this protocol is uncommon in enterprise environments.
type: detection
detection_id: 2022075
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific Bitmessage protocol elements were detected in the traffic?
    context: Analyzing the Bitmessage version and protocol structure confirms ransomware communication.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - payload_printable
        - src_ip
        - dst_ip
        - dst_port

  - question: What are the connection details for this Bitmessage communication?
    context: Understanding connection metadata reveals the communication pattern and data volume.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - orig_bytes
        - resp_bytes
        - duration

  # Type 2: Triage Assessment
  - question: Is Bitmessage usage authorized or expected in this environment?
    context: Bitmessage is rarely used legitimately in corporate environments, making this highly suspicious.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 8080
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - service

  - question: Are there any legitimate applications that might use port 8080 from this system?
    context: Distinguishing between web applications and Bitmessage protocol usage.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - java
            - tomcat
            - jetty
            - bitmessage
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  # Type 3: Activity Context
  - question: What process initiated this Bitmessage communication?
    context: Identifying the parent process helps determine if this is malware or legitimate software.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - ParentImage
        - User

  - question: What file system changes occurred before this network activity?
    context: Ransomware typically modifies files before establishing C2 communication.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - ProcessImage
        - file.hash.md5

  - question: Are there signs of file encryption or ransomware notes being created?
    context: Chimera ransomware creates ransom notes and encrypts files before Bitmessage communication.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - .txt
            - .html
            - DECRYPT
            - RANSOM
        condition: selection
      fields:
        - TargetFilename
        - ProcessImage

  # Type 4: Impact Assessment
  - question: How many files have been encrypted or modified on this system?
    context: Assessing the scope of file encryption to determine recovery requirements.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - ProcessImage

  - question: Are there signs of lateral movement or network share encryption?
    context: Chimera ransomware can spread to network shares and other accessible systems.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 445
            - 139
            - 135
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service

  - question: What critical business data or systems might be affected?
    context: Identifying impact on critical business functions for incident response prioritization.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - database
            - backup
            - .sql
            - .bak
        condition: selection
      fields:
        - TargetFilename
        - ProcessImage

  # Type 5: Forensic Deep-Dive
  - question: What is the complete ransomware execution timeline and infection vector?
    context: Understanding initial infection helps prevent future incidents and assess scope.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - malware
            - exploit
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - event.severity

  - question: Are there any backup or shadow copy deletion activities?
    context: Ransomware typically deletes backups to prevent recovery without payment.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - vssadmin
            - wbadmin
            - shadow
            - backup
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar Bitmessage or ransomware activity?
    context: Determining if this is an isolated incident or part of a broader ransomware campaign.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - ransomware
            - chimera
            - bitmessage
        condition: selection
      fields:
        - src_ip
        - rule.name
        - dst_ip

  - question: What other indicators of this ransomware campaign appear enterprise-wide?
    context: Correlating related IOCs across the environment to understand campaign scope.
    range: +/-12h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category