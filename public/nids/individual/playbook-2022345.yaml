name: ET MALWARE Win32/Bulta CnC Beacon
id: 22022345
description: |
  Detects Win32/Bulta malware command and control beacon communications.
  The malware uses specific binary signatures for C2 channel establishment and data exfiltration.
  May trigger on legitimate applications using similar binary protocols or encryption patterns.
type: detection
detection_id: 2022345
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact binary signature detected in the Bulta C2 beacon?
    context: The specific 14-byte pattern identifies the Bulta malware variant and its communication protocol.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - rule.name
        - alert.signature

  - question: What C2 server infrastructure is the Bulta malware communicating with?
    context: Identifying command and control servers helps understand the threat actor's infrastructure.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - src_ip
        - bytes_toserver
        - bytes_toclient

  # Type 2: Triage Assessment
  - question: Is this outbound traffic from an authorized business application?
    context: Some legitimate applications may use binary protocols that could trigger similar signatures.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - connection_state
        - bytes_toserver
        - frequency

  - question: Does this system have documented remote access or monitoring tools?
    context: Legitimate remote administration tools may generate similar network patterns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 3389
            - 5900
            - 443
            - 8080
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection_state

  # Type 3: Activity Context
  - question: What process initiated this malicious C2 communication?
    context: Identifying the parent process reveals the malware's execution method and persistence.
    range: -30m/+15m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What initial infection vector led to the Bulta malware deployment?
    context: Understanding the compromise method helps prevent similar attacks and assess impact.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "EXPLOIT"
            - "TROJAN"
            - "MALWARE"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: What file system modifications occurred during malware installation?
    context: File changes reveal malware installation paths and potential persistence mechanisms.
    range: -2h/+30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessImage
        - file.mime_type

  # Type 4: Impact Assessment
  - question: What data is being exfiltrated through the C2 channel?
    context: High-volume outbound traffic indicates potential data theft or system information collection.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          bytes_toserver: ">100000"
        condition: selection
      fields:
        - bytes_toserver
        - connection_state
        - duration
        - dst_port

  - question: Has the malware established persistence on the infected system?
    context: Registry modifications indicate the malware's ability to survive reboots and maintain access.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "\\Run"
            - "\\RunOnce"
            - "\\Services"
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessImage

  # Type 5: Forensic Deep-Dive
  - question: What commands or payloads has the malware received from the C2 server?
    context: Analyzing C2 communications reveals the attacker's objectives and capabilities.
    range: -1h/+4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          bytes_toclient: ">1000"
        condition: selection
      fields:
        - bytes_toclient
        - connection_state
        - src_port
        - duration

  - question: Are there indicators of additional malware families or tools deployed?
    context: Bulta infections often coincide with other malware for comprehensive system compromise.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "MALWARE"
            - "TROJAN"
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  - question: What system information has been collected and transmitted?
    context: Information gathering activities reveal the scope of system compromise and data at risk.
    range: -30m/+2h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "systeminfo"
            - "whoami"
            - "net user"
            - "ipconfig"
        condition: selection
      fields:
        - CommandLine
        - Image
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network infected with Bulta or similar malware?
    context: Coordinated malware infections indicate organized threat actor operations.
    range: -4h/+4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Bulta"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this part of a broader data exfiltration campaign across the enterprise?
    context: Multiple systems communicating with the same C2 infrastructure indicate campaign scope.
    range: -24h/+4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - "MALWARE"
            - "C2"
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category