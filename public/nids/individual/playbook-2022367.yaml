name: ET MALWARE ELF.STD.ddos Checkin
id: 22022367
description: |
  Detects ELF.STD.ddos malware checkin communications with command and control servers.
  This malware typically performs DDoS attacks and maintains persistent communication with C2 infrastructure.
  Legitimate applications should not generate this specific 28-byte pattern.
type: detection
detection_id: 2022367
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact 28-byte payload that triggered this ELF.STD.ddos detection?
    context: The specific payload pattern confirms malware variant and communication protocol.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - dsize

  - question: Is this network connection part of legitimate system administration or software updates?
    context: Eliminates false positives from authorized remote management tools or system processes.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_port
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What process initiated this outbound connection to the suspected C2 server?
    context: Identifying the source process helps determine infection vector and scope.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User

  - question: Are there other systems communicating with this same C2 infrastructure?
    context: Determines if this is isolated infection or part of broader compromise.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - bytes_toclient

  - question: What is the communication frequency and pattern with this C2 server?
    context: Regular beaconing patterns confirm active malware infection and C2 communication.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_port
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Has this infected system made connections to other suspicious external IPs?
    context: Identifies additional C2 infrastructure and potential data exfiltration channels.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there signs of DDoS attack preparation or execution from this system?
    context: ELF.STD.ddos malware is designed to participate in distributed denial of service attacks.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - proto

  - question: What files were recently created or modified on the infected system?
    context: Identifies malware persistence mechanisms and additional payloads.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256
        - file.size

  - question: Are there other systems in the environment showing similar ELF malware indicators?
    context: Determines scope of infection and identifies potential lateral movement.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "ELF"
            - "ddos"
            - "MALWARE"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.category