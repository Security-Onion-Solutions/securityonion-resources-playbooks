name: ET EXPLOIT Possible CVE-2016-0777 Server Advertises Suspicious Roaming Support
id: 22022369
description: |
  Detects SSH servers advertising suspicious roaming support that may indicate CVE-2016-0777 exploitation attempts.
  This vulnerability allows information disclosure through malicious SSH servers.
  Legitimate SSH servers may advertise roaming but should not use suspicious resume addresses.
type: detection
detection_id: 2022369
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact SSH roaming advertisement content that triggered this detection?
    context: The specific roaming message reveals exploitation attempt details and server configuration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - ssh.server.software_version

  - question: Is this SSH server part of legitimate infrastructure or known to be compromised?
    context: Determines if this is authorized SSH service or potentially malicious server.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 22
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  - question: What SSH client attempted to connect to this suspicious server?
    context: Identifies potentially compromised client systems or users at risk.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 22
        condition: selection
      fields:
        - src_ip
        - src_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there successful SSH authentications to this potentially malicious server?
    context: Confirms if exploitation was successful and credentials may be compromised.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          dst_port: 22
        condition: selection
      fields:
        - src_ip
        - duration
        - bytes_toserver
        - bytes_toclient

  - question: What is the SSH server software version and configuration?
    context: Determines if server is vulnerable to CVE-2016-0777 and other SSH exploits.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "SSH"
        condition: selection
      fields:
        - ssh.server.software_version
        - ssh.client.software_version
        - rule.name

  - question: Are there other systems connecting to SSH servers with similar roaming advertisements?
    context: Identifies scope of potential CVE-2016-0777 exploitation campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "CVE-2016-0777"
            - "roaming"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Has sensitive information been potentially disclosed through this SSH connection?
    context: CVE-2016-0777 can lead to information disclosure including private keys.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          dst_port: 22
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: Are there file access events on systems that connected to this SSH server?
    context: Identifies potential data exfiltration or system compromise following SSH exploitation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: Is this part of a broader SSH-based attack campaign in the environment?
    context: Determines if this is isolated incident or coordinated attack against SSH infrastructure.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "SSH"
            - "EXPLOIT"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.category