name: ET EXPLOIT Possible CVE-2016-1287 Invalid Fragment Size Inbound 3
id: 22022516
description: |
  Detects third variant of CVE-2016-1287 exploitation attempts targeting IPSec/IKE implementations.
  This variant uses another distinct byte pattern for the same fragmentation vulnerability.
  May trigger on legitimate IPSec traffic with specific implementation-dependent fragmentation.
type: detection
detection_id: 2022516
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What unique byte sequence characterizes this third CVE-2016-1287 variant?
    context: Understanding the specific pattern helps identify the exploitation tool or technique used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_ip
        - payload_printable

  - question: How do all three CVE-2016-1287 variants compare in their byte patterns?
    context: Pattern analysis across variants reveals exploitation methodology and tool sophistication.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: 'CVE-2016-1287'
        condition: selection
      fields:
        - src_ip
        - alert.signature

  # Type 2: Triage Assessment
  - question: Is this the final variant in a systematic CVE-2016-1287 testing sequence?
    context: Multiple variants suggest comprehensive exploitation attempts rather than accidental triggers.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: 'CVE-2016-1287'
        condition: selection
      fields:
        - alert.signature
        - alert.severity

  - question: Are there legitimate reasons for this specific IPSec fragmentation pattern?
    context: Some IPSec implementations may legitimately generate patterns similar to this variant.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 500
          connection_state: 'established'
        condition: selection
      fields:
        - src_ip
        - duration
        - bytes_toserver
        - bytes_toclient

  # Type 3: Activity Context
  - question: What was the timing interval between different CVE-2016-1287 variant attempts?
    context: Timing patterns reveal whether this is automated scanning or manual testing methodology.
    range: -4h/+1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: 'CVE-2016-1287'
        condition: selection
      fields:
        - alert.signature

  - question: What other IPSec service enumeration occurred before this variant testing?
    context: Service fingerprinting often precedes systematic vulnerability exploitation attempts.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 500
        condition: selection
      fields:
        - connection_state
        - bytes_toserver
        - duration

  # Type 4: Impact Assessment
  - question: Which CVE-2016-1287 variant, if any, successfully impacted the IPSec service?
    context: Different variants may have varying success rates depending on the specific implementation.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 500
        condition: selection
      fields:
        - src_ip
        - connection_state
        - duration

  - question: Are there signs of service degradation or unavailability after variant testing?
    context: Successful CVE-2016-1287 exploitation typically results in denial of service conditions.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 500
        condition: selection
      fields:
        - src_ip
        - connection_state
        - bytes_toserver

  # Type 5: Forensic Deep-Dive
  - question: What exploitation tool or framework generates this complete variant set?
    context: The presence of multiple systematic variants suggests specific exploitation tooling.
    range: -4h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains: 'EXPLOIT'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category

  - question: Are there indicators of custom exploitation code versus known public exploits?
    context: Variant patterns and timing may indicate custom exploit development or known tool usage.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'SCAN'
            - 'EXPLOIT'
        condition: selection
      fields:
        - dst_ip
        - alert.signature

  # Type 6: Enterprise Correlation
  - question: Are all three CVE-2016-1287 variants being tested across multiple enterprise targets?
    context: Enterprise-wide variant testing indicates sophisticated threat actor with comprehensive methodology.
    range: -6h/+6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'CVE-2016-1287'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: What other infrastructure vulnerabilities is this attacker systematically testing?
    context: Comprehensive vulnerability testing across multiple CVEs indicates advanced persistent threat behavior.
    range: -24h/+4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'CVE-'
            - 'EXPLOIT'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category