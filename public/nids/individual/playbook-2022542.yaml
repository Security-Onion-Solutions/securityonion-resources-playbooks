name: ET EXPLOIT Possible CVE-2015-7547 PoC Server Response
id: 22022542
description: |
  Detects DNS responses matching known proof-of-concept exploits for CVE-2015-7547.
  This glibc vulnerability allows remote code execution via crafted DNS responses.
  Legitimate DNS servers would not send responses with these specific PoC patterns.
type: detection
detection_id: 2022542
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific PoC pattern was detected in the DNS response?
    context: Identifying the exact exploit pattern helps determine attack sophistication and payload.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - dns.response_code
        - dns.answers

  - question: What domain name was queried that resulted in this malicious response?
    context: The target domain reveals attack vector and may indicate compromised DNS infrastructure.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.id
        - dns.flags

  # Type 2: Triage Assessment
  - question: Is this DNS server part of the organization's approved resolver list?
    context: Unauthorized DNS servers providing PoC responses indicate malicious infrastructure.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.response_code
        - unique_clients

  - question: Has this client system been configured to use this DNS server?
    context: Unexpected DNS server usage may indicate DNS hijacking or malware modification.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dns.query.name
        - query_frequency

  # Type 3: Activity Context
  - question: What application initiated the DNS query that received this PoC response?
    context: Understanding the target application helps assess vulnerability and exploitation success.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.pid
        - user.name

  - question: Were there sequential DNS queries suggesting a coordinated exploitation attempt?
    context: CVE-2015-7547 exploitation often requires multiple crafted responses to trigger the overflow.
    range: +/-10m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.response_code
        - sequence_count

  - question: What network connections were established immediately after this DNS response?
    context: Successful exploitation may trigger callback connections or additional payload downloads.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - connection_state

  # Type 4: Impact Assessment
  - question: Did the target application crash or terminate after receiving this response?
    context: Buffer overflow exploitation often causes application crashes indicating successful trigger.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - process.name
        - event.action
        - process.exit_code

  - question: Were any suspicious processes spawned after the DNS response was received?
    context: Successful code execution may result in malware deployment or system compromise.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  # Type 5: Forensic Deep-Dive
  - question: What files were created or modified following the exploitation attempt?
    context: Successful exploitation may result in backdoor installation or system file corruption.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - file.path
        - file.name
        - file.hash.md5
        - event.action

  - question: Are there signs of privilege escalation or lateral movement after the attack?
    context: Remote code execution may be leveraged for further system compromise.
    range: +24h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - process.command_line
        - user.name
        - process.parent.name
        - event.action

  # Type 6: Enterprise Correlation
  - question: Are other systems receiving similar PoC responses from this DNS server?
    context: Coordinated attacks may target multiple vulnerable systems simultaneously.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "CVE-2015-7547"
            - "PoC Server Response"
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - target_count

  - question: Have other CVE-2015-7547 related alerts been triggered across the network?
    context: Multiple exploitation attempts indicate active threat campaign targeting glibc vulnerability.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains:
            - "CVE-2015-7547"
            - "glibc"
            - "DNS buffer overflow"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature
        - alert.severity