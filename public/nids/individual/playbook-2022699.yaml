name: ET EXPLOIT Quanta LTE Router UDP Backdoor Activation Attempt
id: 22022699
description: |
  Detects attempts to activate a hardcoded backdoor in Quanta LTE routers using the "HELODBG" command on UDP port 39889.
  This backdoor provides administrative access without authentication to vulnerable router firmware.
  Should not trigger on legitimate network traffic as this is a specific backdoor activation sequence.
type: detection
detection_id: 2022699
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact backdoor activation command sent to the router?
    context: Analyzing the complete payload confirms backdoor exploitation attempt and potential follow-up commands.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - alert.signature

  - question: What router model and firmware version is being targeted?
    context: Identifying the specific Quanta router model helps assess vulnerability scope and required patching.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 80
            - 443
            - 23
            - 22
        condition: selection
      fields:
        - src_ip
        - dst_port
        - service

  # Type 2: Triage Assessment
  - question: Is this router part of the organization's managed network infrastructure?
    context: Determining if this is an internal asset requiring immediate patching or an external target.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - service

  - question: Are there legitimate administrative connections to this router?
    context: Establishing baseline administrative access patterns to differentiate from exploitation attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 80
            - 443
            - 22
            - 23
        condition: selection
      fields:
        - src_ip
        - dst_port

  # Type 3: Activity Context
  - question: What network reconnaissance preceded this backdoor activation attempt?
    context: Understanding the attack sequence helps identify how the attacker discovered this vulnerable router.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - service
        - bytes_toserver

  - question: Were there port scans or service enumeration attempts from this source IP?
    context: Identifying broader reconnaissance activities that led to backdoor discovery.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service

  # Type 4: Impact Assessment
  - question: Did the router respond to the backdoor activation command?
    context: Determining if the backdoor was successfully activated and administrative access was gained.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 39889
        condition: selection
      fields:
        - dst_port
        - bytes_toclient
        - service

  - question: What follow-up commands or configuration changes were attempted after backdoor activation?
    context: Assessing the scope of unauthorized access and potential configuration modifications.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - service
        - bytes_toserver

  # Type 5: Forensic Deep-Dive
  - question: What router configuration or credentials were accessed through the backdoor?
    context: Understanding what sensitive information was compromised through backdoor access.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 80
            - 443
            - 23
        condition: selection
      fields:
        - dst_port
        - service
        - bytes_toserver
        - bytes_toclient

  - question: Were there attempts to use the router as a pivot point for lateral movement?
    context: Assessing if the compromised router was used to attack other network infrastructure.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service

  # Type 6: Enterprise Correlation
  - question: Are other Quanta routers in the network receiving similar backdoor activation attempts?
    context: Determining if this is part of a broader campaign targeting vulnerable router infrastructure.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains: 'Quanta'
        condition: selection
      fields:
        - dst_ip
        - alert.signature

  - question: Is this attacker targeting other network infrastructure devices or IoT equipment?
    context: Understanding the full scope of infrastructure targeting and potential compromise.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 23
            - 80
            - 443
            - 161
            - 502
            - 39889
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - service