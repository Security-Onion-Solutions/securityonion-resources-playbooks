name: ET EXPLOIT CVE-2016-1287 Public Exploit ShellCode
id: 22022820
description: |
  Detects exploitation attempts targeting CVE-2016-1287, a buffer overflow vulnerability in Cisco ASA Software.
  This rule identifies specific shellcode patterns used in public exploits targeting IKE protocol on UDP port 500.
  May trigger on legitimate IKE traffic with similar byte patterns, though this is extremely unlikely.
type: detection
detection_id: 2022820
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete UDP payload containing the exploit shellcode?
    context: Examining the full payload reveals the exact exploitation technique and confirms malicious intent.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet

  - question: What is the source and destination of this IKE exploitation attempt?
    context: Understanding the attack vector helps identify the threat actor's location and target infrastructure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - proto

  # Type 2: Triage Assessment
  - question: Is this system a known Cisco ASA device that would be vulnerable to CVE-2016-1287?
    context: Confirming the target is actually a vulnerable Cisco ASA helps validate this is a real attack versus false positive.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 500
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - bytes_toclient

  - question: Has this source IP attempted IKE connections to other internal systems?
    context: Multiple IKE connection attempts may indicate scanning for vulnerable Cisco ASA devices.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 500
          proto: UDP
        condition: selection
      fields:
        - dst_ip
        - conn_state
        - duration

  # Type 3: Activity Context
  - question: What network reconnaissance preceded this exploitation attempt?
    context: Attackers often scan for IKE services before launching CVE-2016-1287 exploits.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - proto
        - conn_state
        - service

  - question: What was the timing pattern of connections from this source?
    context: Rapid successive connections may indicate automated exploitation tools.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  # Type 4: Impact Assessment
  - question: Did the target system respond to the exploitation attempt?
    context: Response patterns help determine if the exploit was successful or blocked.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - conn_state
        - duration

  - question: Are there signs of successful compromise following this exploit attempt?
    context: Successful CVE-2016-1287 exploitation may lead to command execution or backdoor installation.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - service

  # Type 5: Forensic Deep-Dive
  - question: What specific variant of CVE-2016-1287 exploit was used based on shellcode analysis?
    context: Different exploit variants have distinct shellcode signatures that reveal the attack tool used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "CVE-2016-1287"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - payload_printable
        - severity

  - question: Are there other CVE-2016-1287 exploitation attempts from this source?
    context: Multiple exploitation attempts indicate persistent targeting and confirm malicious intent.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "CVE-2016-1287"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - severity

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network being targeted with similar IKE exploits?
    context: Enterprise-wide IKE exploitation attempts suggest coordinated attacks against VPN infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "CVE-2016-1287"
            - "IKE"
            - "Cisco ASA"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - severity