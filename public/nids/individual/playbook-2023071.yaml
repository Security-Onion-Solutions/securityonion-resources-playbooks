name: ET EXPLOIT Equation Group ExtraBacon Cisco ASA AAAADMINAUTH Disable
id: 22023071
description: |
  Detects ExtraBacon exploit attempting to disable AAAADMINAUTH on Cisco ASA devices.
  This variant bypasses AAA authentication mechanisms on vulnerable ASA devices.
type: detection
detection_id: 2023071
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact ExtraBacon AAAADMINAUTH disable payload detected?
    context: The specific shellcode pattern identifies the AAAADMINAUTH disable variant of ExtraBacon.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - snmp.version
        - snmp.community

  - question: How does this payload differ from other ExtraBacon variants?
    context: Different ExtraBacon variants target specific authentication mechanisms.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "ExtraBacon"
        condition: selection
      fields:
        - rule.name
        - payload

  # Type 2: Triage Assessment
  - question: Is this authorized SNMP management activity on the ASA device?
    context: Legitimate SNMP management may generate similar traffic patterns to network devices.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 161
          network.protocol: udp
        condition: selection
      fields:
        - dst_ip
        - network.bytes
        - network.packets

  - question: Does the timing correlate with scheduled maintenance windows?
    context: ASA maintenance activities may involve SNMP configuration changes.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 161
            - 443
            - 22
        condition: selection
      fields:
        - src_ip
        - dst_port
        - network.bytes

  # Type 3: Activity Context
  - question: What reconnaissance activity preceded this AAAADMINAUTH bypass attempt?
    context: ExtraBacon deployment typically follows network enumeration and device identification.
    range: -3h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.protocol
        - network.bytes

  - question: Were there previous authentication failures before the exploit attempt?
    context: Failed authentication may precede exploitation as attackers exhaust normal access methods.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 22
            - 23
            - 443
        condition: selection
      fields:
        - dst_port
        - network.bytes
        - network.packets

  # Type 4: Impact Assessment
  - question: Did the AAAADMINAUTH disable exploit succeed in bypassing authentication?
    context: Successful exploitation enables unauthorized administrative access to the ASA device.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 22
            - 23
            - 443
        condition: selection
      fields:
        - dst_port
        - network.bytes
        - network.packets

  - question: Are there signs of configuration changes following the exploit?
    context: Post-exploitation activity may include firewall rule modifications or user account creation.
    range: +3h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.protocol
        - network.bytes

  # Type 5: Forensic Deep-Dive
  - question: What specific AAA authentication mechanisms were targeted?
    context: Understanding targeted authentication helps assess the scope of security bypass.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 161
        condition: selection
      fields:
        - network.bytes
        - network.packets

  - question: Are there indicators of persistent access mechanisms being established?
    context: Sophisticated attackers establish persistence after successful exploitation.
    range: +6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.protocol
        - network.bytes

  # Type 6: Enterprise Correlation
  - question: Are other network security devices being targeted with similar exploits?
    context: ExtraBacon campaigns often target multiple network infrastructure devices.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - "ExtraBacon"
            - "Cisco"
            - "ASA"
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: Is this attack part of a broader APT campaign against the organization?
    context: ExtraBacon usage indicates nation-state level threats requiring comprehensive response.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "Equation"
            - "APT"
            - "Cisco"
            - "Infrastructure"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.category