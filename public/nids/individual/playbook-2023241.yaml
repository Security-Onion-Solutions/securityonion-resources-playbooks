name: ET MALWARE LuminosityLink - Inbound Data Channel CnC Delimiter
id: 22023241
description: |
  Detects inbound LuminosityLink RAT command and control traffic containing the distinctive "8_=_8" delimiter pattern.
  This signature indicates an active C2 session where the attacker's server is sending commands or data to the compromised system.
  Legitimate applications would not use this specific delimiter pattern in small TCP payloads.
type: detection
detection_id: 2023241
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete inbound payload containing the LuminosityLink delimiter?
    context: Understanding the full command structure reveals attacker instructions and malware capabilities being utilized.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_length
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: What TCP connection characteristics define this LuminosityLink C2 session?
    context: Analyzing connection metadata helps identify the communication pattern and session persistence.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - connection_state
        - bytes_toserver
        - bytes_toclient
        - duration

  # Type 2: Triage Assessment
  - question: Is this system authorized to receive connections from external high-numbered ports?
    context: Eliminates false positives from legitimate remote administration or business applications.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_port|contains:
            - 1024
            - 8080
            - 9999
        condition: selection
      fields:
        - src_ip
        - src_port
        - connection_state

  - question: Does this system normally accept inbound connections during this time period?
    context: Unusual timing patterns may indicate compromise versus legitimate remote access.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - connection_state

  # Type 3: Activity Context
  - question: What process on the target system is receiving these inbound commands?
    context: Identifies the malware executable and helps understand infection persistence mechanisms.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What outbound communications preceded this inbound C2 traffic?
    context: LuminosityLink typically sends beacons before receiving commands, revealing infection timeline.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_port
        - dst_port
        - bytes_toserver
        - connection_state

  # Type 4: Impact Assessment
  - question: What commands or data are being transmitted in subsequent C2 communications?
    context: Determines attacker objectives and potential data theft or system manipulation activities.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - connection_state

  - question: Are there indicators of data exfiltration or file transfers from the compromised system?
    context: LuminosityLink commonly steals files and credentials through the established C2 channel.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - connection_state

  # Type 5: Forensic Deep-Dive
  - question: What file system artifacts indicate LuminosityLink installation and persistence?
    context: LuminosityLink creates specific files and registry entries for persistence and configuration.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  - question: What registry modifications suggest LuminosityLink configuration or persistence?
    context: Identifies malware configuration storage and autostart mechanisms for complete remediation.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network receiving commands from the same C2 server?
    context: Identifies the scope of LuminosityLink campaign and additional compromised systems.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - src_port

  - question: Have similar LuminosityLink patterns been detected across the enterprise?
    context: Reveals coordinated attack campaign and helps prioritize incident response across affected systems.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'LuminosityLink'
            - 'Luminosity'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name