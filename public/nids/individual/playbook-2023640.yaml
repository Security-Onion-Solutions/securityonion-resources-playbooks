name: ET INFO Noction IRP Probe
id: 22023640
description: |
  Detects Noction Intelligent Routing Platform (IRP) network probes sent to UDP port 33434.
  These are legitimate network optimization probes but may indicate reconnaissance if unexpected.
  Normal behavior for networks using Noction IRP services for traffic optimization.
type: detection
detection_id: 2023640
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact Noction IRP probe content and structure?
    context: Understanding the probe format helps distinguish legitimate Noction traffic from potential spoofing attempts.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - proto
        - flow.pkts_toserver

  - question: What TCP connection characteristics were observed for this probe?
    context: Connection flags and timing help validate legitimate Noction IRP behavior versus suspicious activity.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - conn_state
        - duration

  # Type 2: Triage Assessment
  - question: Is this organization using Noction IRP services for network optimization?
    context: Legitimate Noction customers would expect these probes as part of normal service operation.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: 33434
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: Does the source IP belong to known Noction infrastructure?
    context: Legitimate probes should originate from documented Noction IP ranges and infrastructure.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  # Type 3: Activity Context
  - question: What other network activity occurred from this source IP around the same time?
    context: Legitimate Noction probes typically occur in isolation, while malicious activity may include additional reconnaissance.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  - question: Are there any DNS queries associated with this source IP?
    context: Malicious actors may perform DNS reconnaissance before or after port probing activities.
    range: +/-15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip

  # Type 4: Impact Assessment
  - question: Was the probe successful and did the target system respond?
    context: Response patterns help determine if the probe achieved its intended purpose or revealed system information.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - orig_bytes
        - resp_bytes
        - conn_state

  - question: Are there signs of follow-up exploitation attempts after this probe?
    context: Malicious probes may be followed by exploitation attempts if vulnerabilities are discovered.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - dst_port

  # Type 5: Forensic Deep-Dive
  - question: What is the frequency and pattern of these probes from this source?
    context: Legitimate Noction probes follow predictable patterns, while malicious activity may be irregular or excessive.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Noction IRP'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Are there any unusual characteristics in the probe that deviate from standard Noction behavior?
    context: Attackers may attempt to mimic legitimate Noction probes while including malicious modifications.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 33434
        condition: selection
      fields:
        - orig_bytes
        - resp_bytes
        - duration
        - conn_state

  # Type 6: Enterprise Correlation
  - question: Are multiple systems in the network receiving similar Noction probes?
    context: Legitimate Noction services may probe multiple endpoints, while targeted attacks focus on specific systems.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Noction IRP'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - alert.signature

  - question: What other reconnaissance or probing activity is occurring enterprise-wide?
    context: This probe may be part of broader network reconnaissance if occurring alongside other scanning activities.
    range: +/-6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.category|contains:
            - 'reconnaissance'
            - 'probe'
            - 'scan'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature