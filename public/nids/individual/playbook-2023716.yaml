name: ET MALWARE Linux/Venom CnC Beacon
id: 22023716
description: |
  Detects Linux/Venom malware command and control beacon traffic containing specific binary signatures.
  This signature identifies malicious communication used for data exfiltration over C2 channels on Linux systems.
  Unlikely to trigger false positives due to unique binary pattern specific to Venom malware.
type: detection
detection_id: 2023716
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete Venom beacon payload and binary signature detected?
    context: Understanding the exact C2 beacon structure reveals malware variant and communication protocol specifics.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - flow.bytes_toserver
        - flow.bytes_toclient

  - question: What TCP connection details were observed for this Linux/Venom C2 communication?
    context: Connection metadata helps identify the malware's network footprint and C2 infrastructure characteristics.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto
        - conn_state

  # Type 2: Triage Assessment
  - question: Is this communication from a known Linux server or development system?
    context: Linux systems may occasionally generate binary traffic patterns, though Venom signatures are highly specific.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: Does this activity align with normal system administration or application behavior?
    context: Legitimate Linux applications rarely generate the specific binary patterns associated with Venom malware.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  # Type 3: Activity Context
  - question: What process initiated this network connection on the Linux host?
    context: Identifying the parent process helps determine how the Venom malware was executed and gained persistence.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ParentImage

  - question: What other network connections were established from this Linux host around the same time?
    context: Venom malware often establishes multiple connections for different C2 functions or data exfiltration purposes.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - conn_state

  - question: Were there any suspicious file operations or system modifications preceding this C2 activity?
    context: Understanding the infection vector helps determine the scope of compromise and cleanup requirements.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessImage

  # Type 4: Impact Assessment
  - question: How much data was transmitted in this Venom C2 session?
    context: Large data volumes may indicate successful data exfiltration rather than just beacon traffic.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - orig_bytes
        - resp_bytes
        - duration

  - question: Are there signs of sensitive data collection or staging on the compromised Linux system?
    context: Venom malware often collects system information and sensitive files before exfiltration over C2 channels.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - '/etc/'
            - '/var/log/'
            - '/home/'
            - '/root/'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessImage

  # Type 5: Forensic Deep-Dive
  - question: What specific Linux/Venom malware variant characteristics are present?
    context: Different Venom variants have unique C2 patterns that help identify the specific threat and its capabilities.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - 'Venom'
            - 'Linux'
        condition: selection
      fields:
        - alert.signature
        - alert.category
        - dst_ip

  - question: Are there any persistence mechanisms established by this Linux malware?
    context: Understanding persistence helps determine cleanup requirements and reinfection risk on Linux systems.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - '/etc/init.d/'
            - '/etc/systemd/'
            - '/etc/cron'
            - '/etc/rc'
        condition: selection
      fields:
        - TargetFilename
        - ProcessImage
        - file.hash.md5

  - question: What system configuration changes were made during the Venom infection?
    context: Linux malware often modifies system configurations to maintain persistence and evade detection.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - '/etc/passwd'
            - '/etc/shadow'
            - '/etc/hosts'
            - '/etc/ssh/'
        condition: selection
      fields:
        - TargetFilename
        - ProcessImage
        - file.hash.md5

  # Type 6: Enterprise Correlation
  - question: Are other Linux systems in the network showing similar Venom C2 activity?
    context: Linux malware may spread through shared credentials, SSH keys, or exploiting common vulnerabilities.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Linux/Venom'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: What other Linux-targeted threats or indicators appear across the enterprise?
    context: Venom infections may be part of broader Linux-focused campaigns using multiple malware families.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains:
            - 'Linux'
            - 'Unix'
          alert.category|contains:
            - 'malware'
            - 'trojan'
        condition: selection
      fields:
        - src_ip
        - alert.signature
        - alert.category