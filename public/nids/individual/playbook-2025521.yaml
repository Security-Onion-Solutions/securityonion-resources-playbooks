name: ET EXPLOIT Cisco Smart Install Exploitation Tool - ChangeConfig
id: 22025521
description: |
  Detects Smart Install exploitation attempts using tools like SIET to modify device configurations.
  This pattern indicates malicious configuration changes to compromise network infrastructure.
  Legitimate configuration management uses authorized tools and different protocol patterns.
type: detection
detection_id: 2025521
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the specific Smart Install ChangeConfig command structure?
    context: Analyzing the command reveals what configuration changes are being attempted on the target device.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - flow_id

  - question: What URL or configuration source was specified in the ChangeConfig command?
    context: The referenced URL reveals where malicious configuration data is being sourced from.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - http.url
        - dst_ip
        - src_ip

  # Type 2: Triage Assessment
  - question: Is this configuration change targeting a device under our administrative control?
    context: Determines whether this is an attack on our infrastructure or external scanning activity.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 4786
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - duration

  - question: Has this source conducted legitimate network management activities previously?
    context: Helps distinguish between authorized network administrators and malicious actors.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 23
            - 161
            - 162
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  # Type 3: Activity Context
  - question: What network scanning or enumeration preceded this configuration change attempt?
    context: Attackers typically perform reconnaissance before attempting device configuration modifications.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 4786
            - 161
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: What DNS queries were made to resolve configuration source locations?
    context: DNS activity may reveal the infrastructure used to host malicious configuration files.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 4: Impact Assessment
  - question: Did the configuration change command result in successful device modification?
    context: Successful configuration changes may compromise device security and network integrity.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 4786
        condition: selection
      fields:
        - src_ip
        - bytes_toclient
        - bytes_toserver
        - duration

  - question: Are there signs of unauthorized access or control following the configuration change?
    context: Modified configurations may enable persistent access or privilege escalation.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 22
            - 23
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  # Type 5: Forensic Deep-Dive
  - question: What specific configuration parameters were targeted for modification?
    context: Understanding the configuration changes reveals the attacker's objectives and potential impact.
    range: +/-5m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: 'Smart Install'
        condition: selection
      fields:
        - alert.signature
        - payload_printable
        - flow_id

  - question: What external resources were accessed to retrieve malicious configuration data?
    context: Configuration sources may be part of broader attack infrastructure requiring additional investigation.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 80
            - 443
            - 21
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient

  # Type 6: Enterprise Correlation
  - question: Are multiple network devices experiencing similar configuration change attempts?
    context: Coordinated configuration changes across devices indicate systematic network compromise.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Smart Install'
          alert.signature|contains: 'ChangeConfig'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Is this configuration attack part of a broader network infrastructure compromise campaign?
    context: Smart Install configuration attacks often occur alongside other network device exploitation attempts.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - 'exploit'
            - 'trojan'
            - 'bad-unknown'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category