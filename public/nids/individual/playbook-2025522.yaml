name: ET EXPLOIT Cisco Smart Install Exploitation Tool - GetConfig
id: 22025522
description: |
  Detects Smart Install exploitation attempts using tools like SIET to extract device configurations.
  This pattern indicates malicious configuration theft for reconnaissance or credential harvesting.
  Legitimate configuration backups use authorized management systems with different access patterns.
type: detection
detection_id: 2025522
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the specific Smart Install GetConfig command structure and copy operation?
    context: Analyzing the command reveals what configuration data is being extracted from the target device.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - flow_id

  - question: What copy command parameters were specified in the configuration extraction attempt?
    context: The copy command details reveal the source and destination for stolen configuration data.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload_printable
        - dst_ip
        - src_ip
        - dst_port

  # Type 2: Triage Assessment
  - question: Is this configuration extraction targeting a device under our management?
    context: Confirms whether this is an attack on our infrastructure or external reconnaissance activity.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 4786
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - bytes_toclient

  - question: Has this source IP conducted authorized network management operations before?
    context: Distinguishes between legitimate administrators and malicious configuration theft attempts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 23
            - 161
            - 162
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - duration

  # Type 3: Activity Context
  - question: What device enumeration or scanning preceded this configuration extraction?
    context: Attackers typically scan for vulnerable devices before attempting configuration theft.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 4786
            - 161
            - 80
            - 443
            - 23
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: What DNS resolution activity occurred to identify target devices or exfiltration destinations?
    context: DNS queries may reveal reconnaissance methods or data exfiltration infrastructure.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 4: Impact Assessment
  - question: Was configuration data successfully extracted from the target device?
    context: Successful extraction may expose sensitive network information, credentials, and topology.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - duration
        - dst_port

  - question: What volume of data was transmitted from the device following the GetConfig command?
    context: Large outbound transfers indicate successful configuration extraction and potential data theft.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port: 4786
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration

  # Type 5: Forensic Deep-Dive
  - question: What specific configuration files or data types were targeted for extraction?
    context: Understanding the targeted data reveals the attacker's intelligence gathering objectives.
    range: +/-5m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains: 'Smart Install'
        condition: selection
      fields:
        - alert.signature
        - payload_printable
        - flow_id

  - question: Where was the stolen configuration data being copied or transmitted?
    context: Exfiltration destinations reveal attack infrastructure and data collection methods.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 21
            - 22
            - 80
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: Are there signs of credential harvesting or password extraction from the stolen configuration?
    context: Device configurations often contain credentials that enable further network compromise.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 23
            - 161
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  # Type 6: Enterprise Correlation
  - question: Are multiple network devices being targeted for configuration extraction across the enterprise?
    context: Systematic configuration theft indicates comprehensive network reconnaissance and mapping.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Smart Install'
          alert.signature|contains: 'GetConfig'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: Is this configuration theft part of a broader network infrastructure reconnaissance campaign?
    context: Configuration extraction often precedes targeted attacks using gathered intelligence.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - 'exploit'
            - 'trojan'
            - 'bad-unknown'
        condition: selection
      fields:
        - dst_ip
        - alert.signature
        - alert.category