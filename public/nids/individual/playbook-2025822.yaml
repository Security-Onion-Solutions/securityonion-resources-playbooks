name: ET SCAN HID VertX and Edge door controllers discover
id: 22025822
description: |
  Detects reconnaissance attempts targeting HID VertX and Edge door controllers via UDP discovery packets.
  May trigger on legitimate network discovery tools or administrative scans of access control systems.
type: detection
detection_id: 2025822
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact UDP payload content that triggered this discovery scan?
    context: Understanding the discovery packet structure reveals targeting of specific door controller models.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - packet_info.length

  - question: What specific door controller ports and protocols were targeted?
    context: Identifying the complete scope of controller discovery attempts across different ports.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 4070
            - 4050
            - 4369
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol

  # Type 2: Triage Assessment
  - question: Is this source IP authorized to perform access control system discovery?
    context: Legitimate security administrators may scan for door controllers during maintenance.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 3389
            - 443
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: Does this discovery activity align with scheduled maintenance windows?
    context: Physical security system scans often occur during planned maintenance periods.
    range: -1d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 4070
        condition: selection
      fields:
        - src_ip
        - timestamp
        - duration

  # Type 3: Activity Context
  - question: What other network discovery activity preceded this door controller scan?
    context: Attackers often perform broad network reconnaissance before targeting specific IoT devices.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'SCAN'
            - 'Nmap'
            - 'Port Scan'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port

  - question: What was the timing pattern of this discovery attempt?
    context: Automated tools often show consistent timing patterns while manual scans vary.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          protocol: UDP
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - timestamp

  # Type 4: Impact Assessment
  - question: Did any door controllers respond to the discovery packets?
    context: Successful discovery indicates vulnerable controllers that may be targeted for exploitation.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          src_port: 4070
        condition: selection
      fields:
        - bytes_toclient
        - duration
        - conn_state

  - question: Are there signs of follow-up exploitation attempts against discovered controllers?
    context: Discovery scans are often followed by targeted exploitation of identified systems.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'EXPLOIT'
            - 'CVE'
            - 'RCE'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_port

  # Type 5: Forensic Deep-Dive
  - question: What specific HID controller models were targeted based on discovery patterns?
    context: Different controller models respond to specific discovery packets, revealing attacker knowledge.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 4070
            - 4050
            - 4369
            - 1024
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Does the source show characteristics of automated scanning tools?
    context: Identifying whether this is automated reconnaissance or targeted manual probing.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - duration

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network experiencing similar door controller discovery attempts?
    context: Coordinated scanning across multiple network segments indicates organized reconnaissance.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name: 'ET SCAN HID VertX and Edge door controllers discover'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.ip