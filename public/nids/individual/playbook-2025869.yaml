name: ET WEB_SPECIFIC_APPS ELF file magic plain Inbound Web Servers Likely Command Execution 12
id: 22025869
description: |
  Detects another variant of plain ELF file magic bytes with escaped hex encoding.
  Indicates sophisticated attempts to bypass detection while uploading Linux executables.
  May be triggered by legitimate binary content or development activities.
type: detection
detection_id: 2025869
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact hex-escaped ELF payload in this transmission?
    context: Analyzing the specific encoding method reveals the attacker's evasion techniques.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.full
        - http.request.body.bytes
        - content_type

  - question: Is this hex-escaped content part of legitimate development or testing?
    context: Development environments may legitimately transfer encoded binaries for testing purposes.
    range: -14d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          url.path|expand: '%url.path%'
        condition: selection
      fields:
        - src_ip
        - user_agent.original
        - http.request.method
        - http.response.status_code

  - question: What session activity preceded this hex-encoded binary transmission?
    context: Understanding the attack chain helps identify initial compromise vectors and techniques.
    range: -45m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.request.method
        - url.path
        - url.query
        - http.response.status_code
        - user_agent.original

  - question: What system processes executed after this hex-encoded payload was received?
    context: Successful payload delivery typically results in malicious process execution on the target.
    range: +90m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ParentCommandLine
        - User
        - ProcessGuid

  - question: Were any executable files created with suspicious characteristics?
    context: Hex-encoded payloads often decode to malicious executables written to the filesystem.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256
        - file.extension
        - file.mime_type

  - question: What outbound network activity originated from the target after this alert?
    context: Compromised systems typically establish reverse shells or exfiltration channels post-infection.
    range: +8h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - network.bytes_sent
        - network.bytes_received

  - question: How many different ELF encoding techniques has this source attempted?
    context: Persistent attackers often cycle through multiple evasion techniques to achieve success.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "ELF file magic"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - alert.signature_id
        - alert.severity

  - question: What is the geographic origin and threat intelligence profile of this attacker?
    context: Source analysis helps determine threat actor sophistication and campaign attribution.
    range: +/-12h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - geoip.country_name
        - geoip.asn.organization
        - threat.indicator.type
        - threat.indicator.first_seen

  - question: Which specific web application functionality was exploited for this upload?
    context: Understanding the attack vector helps prioritize vulnerability remediation efforts.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.path
        - url.query
        - dst_port
        - http.request.referrer
        - http.request.headers

  - question: Did the target system show evidence of successful command execution?
    context: Confirming successful exploitation helps determine incident severity and response requirements.
    range: +3h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - 'bash'
            - 'sh'
            - 'python'
            - 'perl'
            - 'nc'
        condition: selection
      fields:
        - CommandLine
        - ParentImage
        - User
        - ProcessId

  - question: Are there coordinated hex-encoded attacks across multiple enterprise systems?
    context: Understanding campaign breadth helps identify all affected systems and coordinate response.
    range: +/-96h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "ELF file magic plain"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - alert.severity

  - question: What security controls detected or blocked this hex-encoded attack attempt?
    context: Analyzing detection effectiveness helps improve security posture and response capabilities.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - "Command Execution"
            - "ELF file magic"
        condition: selection
      fields:
        - rule.name
        - alert.action
        - alert.signature_id
        - alert.severity