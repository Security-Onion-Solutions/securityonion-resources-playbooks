name: ET MALWARE [PTsecurity] Remcos RAT Checkin 26
id: 22026004
description: |
  Detects Remcos RAT performing initial checkin communication with command and control server.
  This specific pattern indicates the malware is establishing C2 connectivity after infection.
  All instances should be considered malicious as Remcos is primarily used by threat actors.
type: detection
detection_id: 2026004
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete Remcos checkin payload transmitted?
    context: Analyzing the full payload reveals RAT configuration and potential victim identification data.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - flow_id
        - packet_info

  - question: What network connection was used for this Remcos RAT checkin?
    context: Connection details help identify C2 infrastructure and communication patterns.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - proto
        - orig_bytes
        - resp_bytes

  # Type 2: Triage Assessment
  - question: Is this system typically used for remote administration that might explain RAT-like behavior?
    context: Legitimate remote access tools exist, but Remcos signatures are highly specific to malware.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'teamviewer'
            - 'vnc'
            - 'rdp'
            - 'remote'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessId

  # Type 3: Activity Context
  - question: What process initiated this Remcos checkin communication?
    context: Identifying the malware process helps understand infection vector and persistence.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage
        - ProcessId

  - question: What other Remcos RAT activity has occurred on this system?
    context: RATs typically perform multiple activities including data collection and system reconnaissance.
    range: -4h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Remcos'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - alert.signature

  - question: What was the initial infection vector for this Remcos deployment?
    context: Understanding how the RAT was delivered helps prevent future infections.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'Malware'
            - 'Trojan'
            - 'Phishing'
            - 'Exploit'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - alert.signature

  # Type 4: Impact Assessment
  - question: Has the C2 server responded with commands after this checkin?
    context: Server response indicates active threat actor engagement and potential for further malicious activity.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - orig_bytes
        - resp_bytes
        - conn_state
        - duration

  - question: What data has been collected or exfiltrated since the checkin?
    context: Successful RAT deployment often leads to data theft and further system compromise.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          orig_bytes|gte: 1000
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - orig_bytes
        - resp_bytes
        - conn_state

  # Type 5: Forensic Deep-Dive
  - question: What persistence mechanisms has Remcos established on the infected system?
    context: RATs typically create persistence through registry, scheduled tasks, or startup folders.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - 'Run'
            - 'RunOnce'
            - 'Services'
            - 'Winlogon'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName
        - event.action

  - question: What files has Remcos created or modified on the system?
    context: Understanding file system changes helps assess malware capabilities and data at risk.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          event.action|contains:
            - 'created'
            - 'modified'
        condition: selection
      fields:
        - TargetFilename
        - ProcessName
        - file.size
        - file.hash.md5

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network infected with Remcos RAT?
    context: RAT campaigns often target multiple systems for lateral movement and data collection.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Remcos'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this part of a broader malware campaign targeting the organization?
    context: Understanding campaign scope helps prioritize incident response and containment efforts.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - orig_bytes
        - resp_bytes