name: ET MALWARE [PTsecurity] Remcos RAT Checkin 69
id: 22026509
description: |
  Detects Remcos RAT command and control communication using specific binary signature.
  This signature indicates an infected host checking in with its C2 server.
  No legitimate use cases exist for this specific binary pattern.
type: detection
detection_id: 2026509
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact binary signature pattern detected in the network traffic?
    context: Understanding the specific Remcos RAT variant helps identify the malware family and potential capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
        - community_id

  - question: Is this system known to have legitimate remote administration tools installed?
    context: Confirms whether this could be authorized remote access software versus malicious RAT activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          Image|contains:
            - 'TeamViewer'
            - 'VNC'
            - 'RDP'
            - 'LogMeIn'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What process initiated this network connection on the infected host?
    context: Identifying the parent process reveals how the RAT was executed and potential infection vector.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_port
        - protocol
        - bytes_toserver
        - bytes_toclient

  - question: What other network connections has this host made recently?
    context: Reveals additional C2 infrastructure and scope of compromise.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_toserver

  - question: Has this external IP been contacted by other internal hosts?
    context: Determines if this is part of a broader campaign affecting multiple systems.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What processes were created on this host around the time of the RAT communication?
    context: Identifies potential malicious payloads or commands executed by the RAT.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Are there signs of data exfiltration or file access on the compromised system?
    context: Assesses the impact and determines what sensitive data may have been accessed.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetFilename|contains:
            - '.doc'
            - '.pdf'
            - '.xls'
            - '.zip'
            - '.rar'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What registry modifications occurred on this system recently?
    context: Identifies persistence mechanisms and configuration changes made by the RAT.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetObject|contains:
            - 'Run'
            - 'RunOnce'
            - 'Services'
            - 'CurrentVersion'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: Has this Remcos RAT signature been detected on other hosts in the network?
    context: Determines the scope of the infection across the enterprise.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Remcos RAT'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What DNS queries were made by this host to resolve the C2 server?
    context: Reveals domain-based IOCs and potential DNS tunneling or DGA activity.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name