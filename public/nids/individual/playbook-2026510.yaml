name: ET MALWARE [PTsecurity] Remcos RAT Checkin 70
id: 22026510
description: |
  Detects Remcos RAT command and control communication using specific binary signature variant 70.
  This signature indicates an infected host checking in with its C2 server.
  No legitimate use cases exist for this specific binary pattern.
type: detection
detection_id: 2026510
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact binary signature pattern detected in this Remcos variant?
    context: Understanding the specific variant helps identify the malware family version and potential capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
        - community_id

  - question: Is this host showing signs of authorized remote administration activity?
    context: Eliminates false positives by checking for legitimate remote access tools.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          Image|contains:
            - 'mstsc.exe'
            - 'TeamViewer'
            - 'VNC'
            - 'RemoteDesktop'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What network connection details characterize this RAT communication?
    context: Understanding connection patterns helps identify the communication protocol and frequency.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_port
        - protocol
        - bytes_toserver
        - bytes_toclient

  - question: What other suspicious network activity has this host exhibited?
    context: Reveals additional malicious infrastructure and scope of compromise.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_toserver

  - question: Are other internal hosts communicating with this same C2 server?
    context: Determines if this is part of a coordinated attack affecting multiple systems.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What processes were executing when the RAT communication occurred?
    context: Identifies the infection vector and any payloads delivered by the RAT.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Has sensitive data been accessed or modified on this compromised system?
    context: Assesses the potential impact and data exposure risk.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetFilename|contains:
            - 'Documents'
            - 'Desktop'
            - '.txt'
            - '.docx'
            - 'passwords'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What persistence mechanisms has the RAT established on this system?
    context: Identifies how the malware maintains access and survives reboots.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetObject|contains:
            - 'HKLM\Software\Microsoft\Windows\CurrentVersion\Run'
            - 'HKCU\Software\Microsoft\Windows\CurrentVersion\Run'
            - 'Services'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: How widespread is this Remcos RAT campaign across the network?
    context: Determines the enterprise-wide scope of the infection.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Remcos RAT Checkin'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What domain resolution activity preceded this C2 communication?
    context: Reveals domain-based indicators and potential DNS-based command channels.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name