name: ET MALWARE [PTsecurity] Remcos RAT Checkin 71
id: 22026511
description: |
  Detects Remcos RAT command and control communication using specific binary signature variant 71.
  This signature indicates an infected host checking in with its C2 server.
  No legitimate use cases exist for this specific binary pattern.
type: detection
detection_id: 2026511
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the specific binary signature detected for this Remcos RAT variant?
    context: Analyzing the exact signature helps classify the malware variant and potential threat level.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
        - community_id

  - question: Does this system have any authorized remote access software that could explain this activity?
    context: Rules out legitimate remote administration tools that might generate similar network patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          Image|contains:
            - 'anydesk'
            - 'teamviewer'
            - 'chrome-remote'
            - 'vnc'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What are the characteristics of the network connection used for this RAT communication?
    context: Understanding connection metadata helps profile the C2 communication pattern.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_port
        - protocol
        - bytes_toserver
        - bytes_toclient

  - question: What other external connections has this compromised host established?
    context: Reveals additional malicious infrastructure and potential secondary payloads.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_toserver

  - question: How many other hosts have contacted this same C2 server?
    context: Assesses whether this is an isolated incident or part of a broader campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What processes were active on this system during the RAT communication timeframe?
    context: Identifies potential malicious executables and command execution by the RAT.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What files have been accessed or created on this compromised system?
    context: Determines potential data theft, file encryption, or additional malware deployment.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetFilename|contains:
            - '.exe'
            - '.dll'
            - '.bat'
            - '.ps1'
            - '.vbs'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What registry changes indicate RAT persistence or configuration?
    context: Identifies how the malware maintains persistence and its operational configuration.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetObject|contains:
            - 'Run'
            - 'Startup'
            - 'Service'
            - 'Policy'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: Are there other Remcos RAT detections across the enterprise network?
    context: Maps the full scope of the RAT campaign and identifies all compromised systems.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Remcos RAT'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What DNS queries were made to resolve the C2 server address?
    context: Provides domain-based IOCs and reveals potential DNS tunneling or DGA activity.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What SSL/TLS certificates were observed in connections from this host?
    context: Identifies encrypted C2 channels and potential certificate-based IOCs.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.fingerprint_sha1