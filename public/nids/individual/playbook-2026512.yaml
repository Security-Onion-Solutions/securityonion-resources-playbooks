name: ET MALWARE [PTsecurity] Remcos RAT Checkin 72
id: 22026512
description: |
  Detects Remcos RAT command and control communication using specific binary signature variant 72.
  This signature indicates an infected host checking in with its C2 server.
  No legitimate use cases exist for this specific binary pattern.
type: detection
detection_id: 2026512
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact binary signature pattern for this Remcos RAT variant 72?
    context: Analyzing the specific signature helps identify the malware build and potential capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
        - community_id

  - question: Is there any legitimate remote access software running on this system?
    context: Eliminates false positives by checking for authorized remote administration tools.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          Image|contains:
            - 'rdp'
            - 'remote'
            - 'vnc'
            - 'team'
            - 'logmein'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What network connection parameters characterize this C2 communication?
    context: Understanding the connection profile helps identify the communication protocol and behavior.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_port
        - protocol
        - bytes_toserver
        - bytes_toclient

  - question: What other suspicious network connections has this host initiated?
    context: Reveals additional C2 infrastructure and potential multi-stage attack components.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_toserver

  - question: Are other internal systems also communicating with this C2 server?
    context: Determines if this is part of a coordinated attack affecting multiple endpoints.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What processes were executing around the time of RAT communication?
    context: Identifies the infection vector and any commands or payloads executed by the RAT.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What file system activity indicates malicious operations on this host?
    context: Assesses potential data theft, additional malware deployment, or system modification.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetFilename|contains:
            - 'temp'
            - 'appdata'
            - '.tmp'
            - '.log'
            - 'system32'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What registry modifications suggest RAT persistence or configuration changes?
    context: Identifies persistence mechanisms and configuration settings used by the RAT.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetObject|contains:
            - 'CurrentVersion\Run'
            - 'Winlogon'
            - 'Services'
            - 'Policies'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: What is the scope of Remcos RAT infections across the enterprise?
    context: Maps the full campaign reach and identifies all potentially compromised systems.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Remcos RAT Checkin'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What DNS resolution activity preceded this C2 connection?
    context: Provides domain-based indicators and reveals DNS-based command and control channels.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What TLS certificate information is associated with encrypted C2 communications?
    context: Identifies certificate-based IOCs and encrypted command channels used by the RAT.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.fingerprint_sha1