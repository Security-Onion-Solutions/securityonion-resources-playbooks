name: ET MALWARE [PTsecurity] Remcos RAT Checkin 73
id: 22026513
description: |
  Detects Remcos RAT command and control communication using specific binary signature variant 73.
  This signature indicates an infected host checking in with its C2 server.
  No legitimate use cases exist for this specific binary pattern.
type: detection
detection_id: 2026513
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the specific binary signature detected for Remcos RAT variant 73?
    context: Understanding the exact signature helps classify the malware build and assess threat capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
        - community_id

  - question: Are there any legitimate remote access applications on this system?
    context: Verifies whether this could be authorized remote administration versus malicious RAT activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          Image|contains:
            - 'mstsc'
            - 'TeamViewer'
            - 'AnyDesk'
            - 'Chrome Remote'
            - 'VNC'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What are the network connection characteristics of this RAT communication?
    context: Analyzing connection metadata helps understand the C2 protocol and communication frequency.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - src_port
        - protocol
        - bytes_toserver
        - bytes_toclient

  - question: What other external network connections has this compromised host made?
    context: Reveals additional malicious infrastructure and potential secondary infection components.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_toserver

  - question: How many other hosts are communicating with this same C2 infrastructure?
    context: Determines the scale of the infection and whether this is part of a broader campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: What processes were running when the RAT established its C2 communication?
    context: Identifies the infection vector and any malicious commands executed by the RAT.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          Hostname|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What file operations suggest malicious activity on this compromised system?
    context: Assesses potential data exfiltration, malware deployment, or system compromise indicators.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetFilename|contains:
            - 'Downloads'
            - 'Documents'
            - '.exe'
            - '.scr'
            - '.zip'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What registry changes indicate RAT persistence or operational configuration?
    context: Identifies how the malware maintains access and its configuration settings.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          Hostname|expand: '%src_ip%'
          TargetObject|contains:
            - 'Run'
            - 'RunOnce'
            - 'Service'
            - 'Shell'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessName

  - question: What is the enterprise-wide scope of this Remcos RAT campaign?
    context: Maps all affected systems and assesses the full impact of the malware campaign.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Remcos RAT'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What DNS queries were made to resolve C2 server addresses?
    context: Provides domain-based IOCs and reveals potential DNS-based command channels.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What SSL certificates were used in encrypted communications from this host?
    context: Identifies certificate-based indicators and encrypted C2 channels used by the RAT.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.fingerprint_sha1