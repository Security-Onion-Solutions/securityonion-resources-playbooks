name: ET MALWARE JavaRAT Requesting Screen Size
id: 22026586
description: |
  Detects JavaRAT malware requesting screen size information from infected host.
  The "SC.OP_packet_" pattern indicates remote desktop or screen capture functionality activation.
  Legitimate applications would not use this specific packet structure for screen operations.
type: detection
detection_id: 2026586
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact content of the JavaRAT screen size request packet?
    context: Analyzing packet structure reveals malware capabilities and confirms remote access functionality.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - rule.name

  - question: What process is handling the screen size request on the infected host?
    context: Identifying responsible process reveals infection persistence and helps with containment strategy.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid
        - User

  - question: Is this screen capture request part of authorized remote administration?
    context: Determining legitimacy helps differentiate between malware and approved remote access tools.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          Image|contains:
            - 'TeamViewer'
            - 'VNC'
            - 'RDP'
            - 'LogMeIn'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What other JavaRAT functionality has been activated on this host?
    context: Correlating malware capabilities reveals full scope of compromise and threat actor intentions.
    range: -2h/+2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'JavaRAT'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category

  - question: Has screen capture or remote desktop activity actually occurred?
    context: Confirming successful screen access indicates active surveillance and escalates response priority.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: What sensitive information could be visible on the target screen?
    context: Understanding potential data exposure helps assess impact and determine breach notification needs.
    range: -30m/+30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: Are there signs of data exfiltration following the screen size request?
    context: Large outbound transfers after screen requests may indicate screenshot or video capture theft.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration

  - question: What files related to screen capture have been created on the system?
    context: Screenshot files or video recordings indicate successful surveillance and data theft.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          TargetFilename|contains:
            - '.png'
            - '.jpg'
            - '.bmp'
            - '.avi'
            - '.mp4'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size

  - question: Has the threat actor attempted remote control beyond screen capture?
    context: Additional remote access attempts reveal full extent of compromise and attacker capabilities.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User

  - question: Are other hosts receiving similar screen size requests?
    context: Multiple targets indicate coordinated surveillance campaign requiring broader response measures.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'JavaRAT Requesting Screen Size'
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: What is the timing pattern of screen capture requests?
    context: Understanding surveillance schedule reveals threat actor behavior and operational security practices.
    range: -24h/+4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: 'JavaRAT'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip

  - question: What network infrastructure supports this remote access capability?
    context: Understanding C2 infrastructure helps with attribution and supports network blocking decisions.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - geoip.country_name
        - geoip.city_name