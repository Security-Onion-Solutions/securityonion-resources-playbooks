name: ET MALWARE Mirai Variant Checkin Response
id: 22027366
description: |
  Detects Mirai botnet variant checkin response containing "LOLNOBYE" signature from C2 server.
  This specific response pattern indicates successful bot registration with Mirai command infrastructure.
  Legitimate IoT device communications would not contain this distinctive malware signature.
type: detection
detection_id: 2027366
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete Mirai checkin response packet content?
    context: Full packet analysis reveals botnet variant and confirms malware family identification.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - rule.name

  - question: What IoT device received this Mirai botnet registration confirmation?
    context: Identifying compromised device type helps assess capabilities and determine containment approach.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Is this IoT device authorized to communicate with external servers?
    context: Determining network policy compliance helps validate true positive and assess security posture.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - proto
        - bytes_toserver

  - question: What was the initial Mirai infection vector for this device?
    context: Understanding attack method helps prevent similar compromises and assess security controls.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - 'Brute Force'
            - 'Default Password'
            - 'Telnet'
            - 'SSH'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category

  - question: Has this compromised IoT device received botnet commands?
    context: Confirming command reception indicates active bot participation in malicious activities.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - bytes_toserver
        - bytes_toclient
        - duration

  - question: What malicious activities has this Mirai bot performed?
    context: Identifying bot actions reveals campaign purpose and helps assess network impact.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - proto

  - question: Are there signs of DDoS attack participation from this bot?
    context: DDoS activity confirmation helps assess threat severity and potential legal implications.
    range: +6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: What other IoT devices are communicating with this Mirai C2 server?
    context: Identifying botnet scope reveals campaign size and helps prioritize remediation efforts.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient

  - question: Has this device attempted to spread Mirai to other systems?
    context: Lateral propagation attempts indicate worm behavior and expand incident scope.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 22
            - 23
            - 2323
            - 80
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: What is the operational status of the Mirai command and control infrastructure?
    context: C2 server analysis helps understand botnet resilience and supports takedown efforts.
    range: -4h/+4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - geoip.country_name

  - question: Are there indicators of additional malware families on this compromised device?
    context: Multiple infections indicate device vulnerability and may require different remediation approaches.
    range: -4h/+4h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category

  - question: What network segmentation exists to contain this compromised IoT device?
    context: Understanding network topology helps assess blast radius and containment effectiveness.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - proto