name: ET MALWARE ELF/Emptiness v1.1 CnC Checkin
id: 22027835
description: |
  Detects ELF/Emptiness v1.1 botnet command and control communication via base64-encoded "ilove26" string.
  This is an evolved version of the Linux botnet that uses base64 encoding. No legitimate use case exists.
type: detection
detection_id: 2027835
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What does the base64-encoded payload decode to?
    context: Confirming the decoded content validates this is the Emptiness v1.1 beacon pattern.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - alert.signature

  - question: Is this system authorized to send base64-encoded data to external servers?
    context: Eliminates false positives from legitimate applications using base64 encoding.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          bytes_toserver|gte: 10
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - connection_state

  - question: What process initiated this encoded communication?
    context: Identifying the malware binary helps with containment and forensic analysis.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid
        - User

  - question: What other encoded communications occurred from this host?
    context: Reveals additional C2 channels or evolution of the malware communication protocol.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          bytes_toserver|gte: 10
          bytes_toserver|lte: 50
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Has the malware received commands or updates from the C2 server?
    context: Determines if the bot is actively receiving instructions for attacks.
    range: +4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          bytes_toclient|gte: 1
        condition: selection
      fields:
        - bytes_toclient
        - bytes_toserver
        - connection_state
        - duration

  - question: What files with suspicious characteristics were created recently?
    context: Identifies the malware binary and any additional payloads or configuration files.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          event_type: create
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256
        - file.size
        - Image

  - question: Are there indicators of DDoS attack coordination from this host?
    context: Emptiness v1.1 is used for coordinated DDoS attacks against targets.
    range: +12h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection_state
        - bytes_toserver

  - question: What DNS resolution activity preceded this connection?
    context: Reveals C2 domain infrastructure and potential domain generation algorithms.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name
        - dns.response_code

  - question: Has this evolved Emptiness variant been detected elsewhere in the network?
    context: Determines the scope of infection and potential lateral movement.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature|contains: 'Emptiness v1.1'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature
        - alert.severity

  - question: What is the infrastructure profile of the C2 server?
    context: Provides threat intelligence for blocking and attribution purposes.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - geoip.country_name
        - geoip.asn
        - threat_intel.indicators