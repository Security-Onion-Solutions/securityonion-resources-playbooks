name: ET EXPLOIT HiSilicon DVR - Default Telnet Root Password Inbound
id: 22027973
description: |
  Detects attempts to use default root password "xc3511" on HiSilicon DVR systems via Telnet.
  This indicates exploitation attempts against IoT devices with unchanged default credentials.
  Legitimate access would use changed passwords, not default manufacturer credentials.
type: detection
detection_id: 2027973
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact authentication attempt pattern detected?
    context: Understanding the specific credential pattern confirms HiSilicon DVR exploitation and helps identify attack tools.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - payload
        - src_ip
        - dst_ip

  - question: What Telnet session details were captured during this authentication attempt?
    context: Session information reveals the attacker's interaction patterns and potential automation tools.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 23
        condition: selection
      fields:
        - community_id
        - bytes_in
        - bytes_out

  # Type 2: Triage Assessment
  - question: Is this DVR system supposed to have Telnet access enabled?
    context: Legitimate DVR management might not require Telnet, helping distinguish between authorized and malicious access.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 23
        condition: selection
      fields:
        - src_ip
        - bytes_in
        - bytes_out

  - question: Are there any documented maintenance windows or authorized access from this source IP?
    context: Confirms whether this could be legitimate (but poor security practice) administrative access.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - community_id

  # Type 3: Activity Context
  - question: What other IoT devices has this source IP attempted to access?
    context: Multiple IoT access attempts indicate automated scanning for vulnerable devices with default credentials.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 23
            - 22
            - 80
            - 443
            - 554
        condition: selection
      fields:
        - dst_ip
        - dst_port

  - question: Was this attack preceded by port scanning or reconnaissance activity?
    context: Understanding the attack sequence helps identify whether this is targeted or opportunistic exploitation.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port

  - question: What was the duration and pattern of this Telnet session?
    context: Session characteristics help determine if authentication was successful and what actions were taken.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_in
        - bytes_out
        - duration

  # Type 4: Impact Assessment
  - question: Was the default password authentication successful?
    context: Successful authentication indicates compromised device requiring immediate security response.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 23
        condition: selection
      fields:
        - bytes_in
        - bytes_out
        - duration

  - question: Are there signs of command execution or configuration changes on the DVR?
    context: Post-authentication activity indicates the extent of compromise and potential system modifications.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_out

  # Type 5: Forensic Deep-Dive
  - question: What specific commands or actions were performed during the Telnet session?
    context: Understanding attacker actions helps assess damage and implement appropriate remediation measures.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_in
        - bytes_out

  - question: Has the DVR been configured to participate in botnet activity?
    context: Compromised DVRs are often recruited into botnets for DDoS attacks or cryptocurrency mining.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  # Type 6: Enterprise Correlation
  - question: Are other HiSilicon DVR systems in the network being targeted with similar attacks?
    context: Multiple DVR compromise attempts indicate coordinated IoT botnet recruitment campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'HiSilicon'
            - 'DVR'
            - 'Default'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this source IP part of a broader IoT exploitation campaign?
    context: Understanding campaign scope helps prioritize response and identify other potentially vulnerable devices.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains:
            - 'Default'
            - 'IoT'
            - 'Telnet'
        condition: selection
      fields:
        - dst_ip
        - rule.name