name: ET JA3 Hash - Possible Malware - Boleto Malspam
id: 22028364
description: |
  Detects TLS connections with alternate JA3 fingerprint associated with Boleto banking malware from malspam campaigns.
  Indicates potential financial malware communication using different TLS configuration.
type: detection
detection_id: 2028364
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the exact JA3 hash and banking malware destination?
    context: Confirms the specific alternate TLS fingerprint and command and control server for banking malware.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.ja3
        - dst_ip
        - dst_port
        - src_ip

  - question: Is this system using multiple Boleto malware JA3 variants?
    context: Determines if the banking malware is using different TLS configurations for evasion.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          tls.ja3|contains:
            - "4f635262ad3fb6e634daee798082c788"
            - "e9273590c7875d6367325f8714890790"
        condition: selection
      fields:
        - tls.ja3
        - dst_ip
        - dst_port

  - question: What malspam delivery method was used for this variant?
    context: Different Boleto variants may use different delivery mechanisms or attachment types.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.name
        - file.path
        - file.hash.md5
        - process.parent.name

  - question: What process characteristics distinguish this variant?
    context: Identifies unique execution patterns or capabilities of this banking malware variant.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  - question: What banking targets are specific to this malware variant?
    context: Different variants may target different financial institutions or regions.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What data exfiltration patterns are unique to this variant?
    context: Assesses differences in data theft methods between Boleto malware variants.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port|expand: '%dst_port%'
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received
        - network.protocol

  - question: Are there different credential harvesting techniques used?
    context: Determines if this variant uses different methods to capture banking credentials.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - user.name

  - question: What web injection capabilities does this variant possess?
    context: Assesses the man-in-the-browser capabilities specific to this malware variant.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - http.request.body.content

  - question: How does the distribution of this variant compare to others?
    context: Identifies the relative prevalence and targeting of different Boleto variants.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.ja3: "e9273590c7875d6367325f8714890790"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: What is the infrastructure relationship between Boleto variants?
    context: Determines if different variants share command and control infrastructure.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.ja3|contains:
            - "4f635262ad3fb6e634daee798082c788"
            - "e9273590c7875d6367325f8714890790"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: Are both Boleto variants part of the same malspam campaign?
    context: Assesses whether different JA3 variants represent evolution of the same campaign.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.ja3|contains:
            - "4f635262ad3fb6e634daee798082c788"
            - "e9273590c7875d6367325f8714890790"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - network.community_id

  - question: Is this variant targeting the same financial institutions enterprise-wide?
    context: Determines the scope and coordination of banking malware across the organization.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.query.name|contains:
            - "bank"
            - "financial"
            - "credit"
        condition: selection
      fields:
        - src_ip
        - dns.query.name
        - dns.resolved_ip