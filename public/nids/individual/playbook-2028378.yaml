name: ET JA3 Hash - Possible Malware - Neutrino (Hash 51b5c918558a4bfb50ce1ab1d5fddff7)
id: 22028378
description: |
  Detects TLS connections with JA3 fingerprint associated with Neutrino malware.
  JA3 hashes can occasionally collide with legitimate applications using similar TLS configurations.
type: detection
detection_id: 2028378
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the complete TLS certificate chain for this connection?
    context: Certificate details help distinguish between legitimate and malicious TLS usage.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number
        - tls.server.certificate.not_after

  - question: Is this JA3 hash commonly seen from this source IP?
    context: Repeated usage patterns help determine if this is normal client behavior.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          tls.client.ja3: "51b5c918558a4bfb50ce1ab1d5fddff7"
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - event.count

  - question: What process initiated this TLS connection?
    context: Process context helps determine if connection is from legitimate software or malware.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  - question: Are there other connections to the same destination IP?
    context: Multiple connections may indicate C2 communication patterns or legitimate service usage.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - network.protocol
        - network.bytes

  - question: What DNS queries preceded this connection?
    context: DNS resolution patterns reveal how the destination was discovered.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.question.name
        - dns.question.type
        - dns.response_code

  - question: Has this source IP exhibited other suspicious TLS behavior?
    context: Multiple malicious JA3 hashes from same source indicates compromised system.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "JA3 Hash"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - event.count

  - question: What is the timing pattern of connections to this destination?
    context: Regular intervals suggest automated malware communication rather than user-driven activity.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - network.bytes
        - event.count

  - question: Are there file creation events around the time of this connection?
    context: New files may indicate malware payload downloads or persistence mechanisms.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          event.action: "created"
        condition: selection
      fields:
        - file.path
        - file.name
        - file.hash.md5
        - process.name

  - question: Is this destination IP associated with known malicious infrastructure?
    context: Threat intelligence correlation helps confirm malicious intent.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.category
        - rule.name
        - src_ip
        - event.count

  - question: Are other systems in the network connecting to this destination?
    context: Multiple infected systems may indicate lateral movement or widespread compromise.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - network.bytes
        - event.count