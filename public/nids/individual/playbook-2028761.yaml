name: ET JA3 Hash - [Abuse.ch] Possible Gootkit
id: 22028761
description: |
  Detects TLS connections with JA3 hash associated with Gootkit malware.
  JA3 fingerprinting identifies TLS client behavior patterns. May trigger on legitimate applications using similar TLS configurations.
type: detection
detection_id: 2028761
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the complete TLS handshake fingerprint for this connection?
    context: JA3 hash identifies specific TLS client behavior patterns used by Gootkit malware.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.ja3
        - tls.ja3_hash
        - tls.server.certificate.subject
        - tls.server.certificate.issuer

  - question: Is this TLS configuration typical for applications on this host?
    context: Legitimate applications may occasionally use similar TLS client configurations.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - tls.ja3_hash
        - dst_ip
        - dst_port

  - question: What process established this TLS connection?
    context: Identifying the source process helps determine if connection is malicious or legitimate.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - process.name
        - process.pid
        - process.command_line

  - question: What destination was contacted in this connection?
    context: Gootkit typically connects to command and control servers for instructions and data exfiltration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - dst_ip
        - tls.server.certificate.subject
        - url.domain

  - question: Are there other network connections indicating banking trojan activity?
    context: Gootkit is a banking trojan that monitors web traffic and steals financial credentials.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out
        - bytes_in

  - question: Has this host accessed banking or financial websites?
    context: Gootkit monitors and intercepts banking sessions to steal credentials.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What files were created or modified during the infection timeframe?
    context: Gootkit drops additional modules and creates persistence mechanisms.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.path
        - file.hash.md5
        - file.mime_type
        - process.name

  - question: Are there signs of browser manipulation or injection activity?
    context: Gootkit injects malicious code into browser processes to steal credentials.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          process.name|contains:
            - 'chrome.exe'
            - 'firefox.exe'
            - 'iexplore.exe'
            - 'edge.exe'
        condition: selection
      fields:
        - process.command_line
        - process.parent.name
        - User

  - question: Has this JA3 hash been observed on other systems?
    context: Gootkit campaigns often target multiple hosts within an organization.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.ja3_hash: 'c5235d3a8b9934b7fbbd204d50bc058d'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - tls.server.certificate.subject

  - question: Are there indicators of credential theft or data exfiltration?
    context: Gootkit steals banking credentials and other sensitive information.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 80
            - 443
            - 8080
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: Have there been registry modifications for persistence?
    context: Gootkit often modifies registry keys to maintain persistence on infected systems.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - registry.path
        - registry.value.name
        - registry.value.data
        - process.name