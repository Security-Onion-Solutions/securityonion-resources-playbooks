name: ET MALWARE Platinum APT - Titanium Payload CnC Checkin (x86)
id: 22028957
description: |
  Detects command and control communications from Titanium malware used by the Platinum APT group.
  The x86 variant uses specific URI patterns for C2 checkins. This indicates active malware infection
  and ongoing APT campaign activity. Legitimate traffic to confirm.gif resources is extremely rare.
type: detection
detection_id: 2028957
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete HTTP request structure for the Titanium C2 checkin?
    context: Understanding the full request reveals the malware's communication protocol and potential data exfiltration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.headers
        - http.request.body.content

  - question: What specific confirm.gif parameters were used in the x86 variant communication?
    context: The f=1 parameter identifies this as x86 architecture, revealing the infected system type.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.query
        - url.path
        - http.request.method

  # Type 2: Triage Assessment
  - question: Is there any legitimate business reason for this system to access confirm.gif resources?
    context: The URI pattern is highly specific to Titanium malware and extremely unlikely in legitimate traffic.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: "confirm.gif"
        condition: selection
      fields:
        - dst_ip
        - url.full
        - http.response.status_code

  - question: Does this system have documented administrative or development activities that could generate similar traffic?
    context: Confirming whether this is an authorized system helps rule out false positives.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  # Type 3: Activity Context
  - question: What process initiated this C2 communication on the infected system?
    context: Identifying the parent process helps understand the infection vector and persistence mechanism.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What network activity preceded this C2 checkin attempt?
    context: Understanding the infection timeline helps identify the initial compromise vector.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_in
        - bytes_out

  - question: What was the timing pattern of C2 communications from this infected system?
    context: C2 beacon intervals reveal malware configuration and operational tempo.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.path
        - http.request.method
        - http.response.status_code

  # Type 4: Impact Assessment
  - question: Did the C2 server respond with commands or additional payloads?
    context: Successful C2 communication may result in additional malware deployment or data exfiltration commands.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - bytes_in

  - question: What data was potentially exfiltrated during these C2 communications?
    context: Titanium malware is known for data theft capabilities and may exfiltrate sensitive information.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - bytes_out
        - duration
        - protocol

  # Type 5: Forensic Deep-Dive
  - question: What files were created or modified around the time of C2 communication?
    context: Titanium may drop additional payloads or create persistence mechanisms during active C2 sessions.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessGuid

  - question: Are there indicators of lateral movement or privilege escalation following C2 establishment?
    context: Platinum APT typically uses initial access for broader network compromise and privilege escalation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are other systems showing similar Titanium C2 communication patterns?
    context: Platinum APT campaigns typically target multiple systems within an organization.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Titanium"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this part of a broader Platinum APT campaign targeting the organization?
    context: Correlating with other Platinum indicators helps understand the full scope of the compromise.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "PLATINUM"
            - "Titanium"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name