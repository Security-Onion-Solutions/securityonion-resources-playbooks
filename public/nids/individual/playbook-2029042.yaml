name: ET MALWARE ELF/Roboto - Communicating with Hardcoded Peer 1
id: 22029042
description: |
  Detects ELF/Roboto malware communicating with hardcoded P2P peer using specific binary protocol.
  Legitimate applications rarely use this exact 69-byte binary pattern for UDP communication.
type: detection
detection_id: 2029042
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete 69-byte binary payload being sent to the hardcoded Roboto peer?
    context: Binary protocol analysis reveals P2P communication structure and botnet command protocols.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - protocol

  - question: What is the destination IP address and port for this hardcoded Roboto peer communication?
    context: Hardcoded peer information reveals botnet infrastructure and C2 communication endpoints.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 2: Triage Assessment
  - question: Is this system authorized to use UDP communication on non-standard ports?
    context: Legitimate applications may use UDP for P2P protocols, but specific binary patterns are suspicious.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          protocol: udp
          dst_port|gte: 1024
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there signs of legitimate P2P applications or services on this system?
    context: BitTorrent, gaming, or other P2P software may generate similar UDP traffic patterns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'torrent'
            - 'p2p'
            - 'peer'
            - 'bittorrent'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid

  # Type 3: Activity Context
  - question: What process initiated this UDP communication with the hardcoded Roboto peer?
    context: Process identification reveals the malware executable and its execution context.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid
        - ParentImage

  - question: What network activity preceded this P2P communication attempt?
    context: Prior network activity reveals infection vector and initial C2 establishment.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - protocol
        - bytes_toserver

  - question: Were there any DNS queries before establishing this P2P connection?
    context: DNS resolution patterns may reveal domain-based C2 communication before P2P establishment.
    range: -10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 4: Impact Assessment
  - question: How frequently is this system communicating with hardcoded Roboto peers?
    context: Communication frequency indicates level of botnet participation and command execution activity.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          protocol: udp
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there signs of successful P2P command execution or payload delivery?
    context: Bidirectional communication and file system changes indicate active botnet participation.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type

  # Type 5: Forensic Deep-Dive
  - question: What other hardcoded peers is this Roboto malware attempting to communicate with?
    context: Multiple peer connections reveal the full scope of P2P botnet infrastructure.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Roboto - Communicating with Hardcoded Peer'
        condition: selection
      fields:
        - dst_ip
        - rule.name

  - question: Are there indicators of cryptocurrency mining or other malicious payloads?
    context: Roboto botnet is commonly used for cryptojacking and other monetization activities.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - 'xmrig'
            - 'monero'
            - 'stratum'
            - 'mining'
            - 'cryptonight'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid

  - question: What persistence mechanisms has the Roboto malware established?
    context: Persistence analysis reveals how the malware maintains presence and survives reboots.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - '/etc/init'
            - '/etc/systemd'
            - '/etc/cron'
            - '.bashrc'
            - '.profile'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network communicating with the same hardcoded Roboto peers?
    context: Multiple infected systems indicate widespread botnet participation requiring coordinated response.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          protocol: udp
        condition: selection
      fields:
        - src_ip
        - bytes_toserver
        - bytes_toclient

  - question: What is the scope of Roboto botnet activity across the enterprise network?
    context: Enterprise-wide analysis reveals campaign scope and infrastructure reuse patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: 'Roboto'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name