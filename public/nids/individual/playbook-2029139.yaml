name: ET MALWARE AZORult v3.2 Server Response M1
id: 22029139
description: |
  Detects AZORult v3.2 malware command and control server response pattern M1.
  AZORult is an information stealer that harvests credentials, browser data, and system information.
  This signature identifies encrypted C2 communication from the older v3.2 variant of the malware.
type: detection
detection_id: 2029139
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete HTTP response containing the AZORult v3.2 M1 signature pattern?
    context: Analyzing the full server response reveals C2 communication structure specific to the v3.2 variant.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - http.response.headers

  - question: What was the HTTP request that triggered this v3.2 M1 response pattern?
    context: Different versions of AZORult may use different communication protocols and request structures.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - http.request.method
        - url.full
        - http.request.body.content

  # Type 2: Triage Assessment
  - question: Is this v3.2 M1 pattern from a legitimate application?
    context: Eliminates false positives from software that might use similar binary communication patterns.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.bytes

  # Type 3: Activity Context
  - question: What process initiated this v3.2 M1 pattern HTTP connection?
    context: Identifying the process helps understand the infection vector and malware deployment method.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - user.name

  - question: Are there other AZORult v3.2 communications from this infected system?
    context: Understanding the complete v3.2 communication pattern helps assess infection completeness.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "AZORult v3.2"
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  # Type 4: Impact Assessment
  - question: Has this v3.2 M1 communication resulted in successful data exfiltration?
    context: v3.2 variants may have different data theft capabilities requiring specific response measures.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received
        - dst_port

  - question: What sensitive data was accessed during the v3.2 M1 pattern timeframe?
    context: Correlates v3.2 M1 pattern timing with potential credential or browser data theft activities.
    range: -30m/+30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.path|contains:
            - "\\AppData\\Local\\Google\\Chrome"
            - "\\AppData\\Roaming\\Mozilla\\Firefox"
            - "\\Login Data"
            - "\\Cookies"
        condition: selection
      fields:
        - file.path
        - file.name
        - process.name

  # Type 5: Forensic Deep-Dive
  - question: What are the specific differences between v3.2 and v3.3 AZORult infections on this system?
    context: Understanding version differences helps identify malware evolution and capabilities.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "AZORult"
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  - question: Are there signs of v3.2 specific malware persistence mechanisms?
    context: Different AZORult versions may use different persistence techniques requiring specific removal procedures.
    range: -2h/+1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          registry.path|contains:
            - "\\Run\\"
            - "\\RunOnce\\"
            - "\\Services\\"
        condition: selection
      fields:
        - registry.path
        - registry.value
        - process.name

  # Type 6: Enterprise Correlation
  - question: Are other systems infected with AZORult v3.2 variant?
    context: Identifies the scope of v3.2 variant infections compared to v3.3 across the enterprise.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "AZORult v3.2"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the distribution of AZORult versions (v3.2 vs v3.3) enterprise-wide?
    context: Understanding version distribution helps identify attack campaign characteristics and threat actor preferences.
    range: -7d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "AZORult"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.category