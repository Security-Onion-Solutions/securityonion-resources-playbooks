name: ET MALWARE Observed Malicious SSL Cert (Sidewinder APT CnC)
id: 22029182
description: |
  Detects Sidewinder APT group command and control infrastructure based on specific SSL certificate subject.
  Sidewinder is an advanced persistent threat group targeting government and military organizations.
  This signature identifies connections to confirmed malicious C2 infrastructure using distinctive certificates.
type: detection
detection_id: 2029182
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What are the complete details of the malicious Sidewinder SSL certificate?
    context: Certificate details reveal C2 infrastructure characteristics and may indicate shared hosting or certificate reuse.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number
        - tls.server.certificate.not_after

  - question: What TLS handshake characteristics accompany this malicious certificate?
    context: TLS implementation details can reveal malware family and help identify additional campaign infrastructure.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.version
        - tls.ja3
        - tls.ja3s
        - tls.cipher

  - question: What is the network context of this C2 connection?
    context: Connection metadata reveals communication patterns and helps assess the scope of C2 activity.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 2: Triage Assessment
  - question: Is this connection to ap1-acl.net from authorized business activity?
    context: Determines if the Sidewinder C2 contact represents actual compromise or authorized security testing.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - proto
        - bytes_toserver

  - question: Does this system typically establish connections to this geographic region?
    context: Unusual geographic connections may indicate compromise, while regular patterns suggest legitimate business.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 3: Activity Context
  - question: What initiated the connection to the Sidewinder C2 infrastructure?
    context: Understanding the triggering process helps identify the initial compromise vector and infected application.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          ProcessGuid|expand: '%ProcessGuid%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage
        - ParentCommandLine

  - question: What network reconnaissance preceded this C2 connection?
    context: Sidewinder often performs network scanning and DNS enumeration before establishing persistent C2 channels.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Were there any file modifications or downloads around the time of C2 establishment?
    context: Sidewinder often downloads additional payloads or updates tools after initial C2 contact.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size
        - ProcessGuid

  # Type 4: Impact Assessment
  - question: What sensitive data has been accessed since the C2 connection was established?
    context: Sidewinder targets government and military data, requiring assessment of classified information exposure.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - .doc
            - .pdf
            - .xls
            - classified
            - confidential
        condition: selection
      fields:
        - TargetFilename
        - ProcessGuid
        - file.hash.md5

  - question: Has data exfiltration occurred following the C2 connection?
    context: Large outbound transfers indicate successful data theft requiring immediate containment and breach notification.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          bytes_toserver: ">50000"
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - proto

  - question: Are there signs of lateral movement from this compromised system?
    context: Sidewinder uses compromised systems as pivot points for broader network infiltration.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 22
            - 3389
            - 445
            - 135
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto

  # Type 5: Forensic Deep-Dive
  - question: What is the complete Sidewinder campaign timeline on this system?
    context: Full APT timeline analysis reveals persistence mechanisms and helps determine complete compromise scope.
    range: -30d
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: Sidewinder
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip
        - community_id

  - question: What persistence mechanisms has Sidewinder established on this system?
    context: Registry and service modifications reveal how the APT maintains long-term access for continued operations.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - Run
            - RunOnce
            - Services
            - CurrentVersion
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are other systems showing connections to Sidewinder infrastructure?
    context: APT campaigns target multiple systems simultaneously, requiring coordinated enterprise-wide response.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: Sidewinder
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - rule.category
        - community_id

  - question: Is this part of a broader APT campaign affecting the organization?
    context: Multiple APT indicators may represent coordinated nation-state activity requiring executive notification.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category|contains:
            - domain-c2
            - command-and-control
            - apt
        condition: selection
      fields:
        - src_ip
        - rule.name
        - dst_ip