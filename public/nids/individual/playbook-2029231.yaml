name: ET MALWARE Zeoticus Ransomware CnC Activity
id: 22029231
description: |
  Detects HTTP command and control communication from Zeoticus ransomware using the distinctive URI pattern "supersecretstring?babyDontHeartMe=" and user agent "DxD".
  This signature indicates active ransomware infection with established CnC communication for key exchange or command retrieval.
  No legitimate applications would use these specific patterns.
type: detection
detection_id: 2029231
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete HTTP request URI and parameters sent to the CnC server?
    context: The full URI reveals the specific command or data exchange between the ransomware and its controller.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.path
        - url.query
        - http.request.method

  - question: What additional HTTP headers were present in the ransomware communication?
    context: HTTP headers can reveal system information, encryption capabilities, or victim identification data.
    range: +/-2m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.headers
        - http.response.headers
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Has this system shown any prior suspicious network activity?
    context: Establishes whether this is an isolated incident or part of ongoing malicious activity.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip

  - question: Is this HTTP traffic occurring during expected system operation hours?
    context: Ransomware often operates outside business hours to avoid detection and interference.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - dst_ip
        - url.domain

  # Type 3: Activity Context
  - question: What process initiated this HTTP connection to the CnC server?
    context: Identifies the specific executable or process responsible for the ransomware communication.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - process.name
        - process.command_line
        - process.parent.name
        - User

  - question: What file system activity preceded this network communication?
    context: Ransomware typically encrypts files before establishing CnC communication for key exchange.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - file.name
        - file.extension
        - process.name
        - file.hash.md5

  - question: What other network connections has this system established recently?
    context: Reveals the initial infection vector and any lateral movement attempts by the ransomware.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.transport

  # Type 4: Impact Assessment
  - question: What files have been encrypted or modified on this system?
    context: Determines the scope of file encryption and potential data loss from the ransomware attack.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.extension|contains:
            - ".encrypted"
            - ".locked"
            - ".zeoticus"
        condition: selection
      fields:
        - file.path
        - file.name
        - file.size
        - process.name

  - question: Has a ransom note been created on the system?
    context: Confirms successful ransomware deployment and identifies the specific ransom demands.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          file.name|contains:
            - "README"
            - "RANSOM"
            - "DECRYPT"
            - "RECOVERY"
        condition: selection
      fields:
        - file.path
        - file.name
        - process.name

  # Type 5: Forensic Deep-Dive
  - question: What persistence mechanisms has the Zeoticus ransomware established?
    context: Identifies how the ransomware maintains access and prevents system recovery.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "\\Run"
            - "\\RunOnce"
            - "\\Services"
        condition: selection
      fields:
        - TargetObject
        - Details
        - process.name

  - question: What shadow copy or backup deletion activity has occurred?
    context: Ransomware typically deletes backups and shadow copies to prevent recovery.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "vssadmin"
            - "wbadmin"
            - "bcdedit"
            - "shadow"
        condition: selection
      fields:
        - CommandLine
        - process.name
        - process.parent.name

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network showing Zeoticus ransomware indicators?
    context: Determines if this is an isolated infection or part of a broader ransomware campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Zeoticus"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What lateral movement activity is associated with this ransomware campaign?
    context: Identifies how the ransomware is spreading across the network infrastructure.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 445
            - 139
            - 3389
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.transport