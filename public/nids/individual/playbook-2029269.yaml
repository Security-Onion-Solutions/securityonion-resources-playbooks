name: ET MALWARE Satan/5ss5c Ransomware CnC Activity
id: 22029269
description: |
  Detects Satan/5ss5c ransomware communicating with command and control servers.
  This pattern indicates active ransomware infection reporting encryption status and requesting additional instructions.
  Legitimate applications do not use this specific parameter structure for file status reporting.
type: detection
detection_id: 2029269
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What specific file encryption status is being reported to the ransomware C2 server?
    context: The URL parameters reveal which files are being encrypted and the current status of the ransomware operation.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.full
        - url.query
        - http.request.method
        - http.request.headers

  - question: What is the keyhash value being transmitted to identify this ransomware victim?
    context: The keyhash parameter uniquely identifies this victim to the ransomware operators for payment tracking.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - dst_ip
        - dst_port

  - question: Has this system shown previous signs of Satan ransomware file encryption activity?
    context: Ransomware typically encrypts files before reporting to C2, so file system activity should precede this communication.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - ".encrypted"
            - ".locked"
            - ".satan"
            - ".5ss5c"
        condition: selection
      fields:
        - TargetFilename
        - Image
        - User

  - question: What processes were executing during the timeframe leading up to this C2 communication?
    context: Satan ransomware execution would generate process activity before reporting encryption status to C2.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage
        - ProcessGuid

  - question: Are there signs of the Satan ransomware dropping ransom notes on this system?
    context: Ransomware typically creates ransom note files after encryption and before C2 communication.
    range: -2h/+30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - "README"
            - "DECRYPT"
            - "RANSOM"
            - ".txt"
            - ".html"
        condition: selection
      fields:
        - TargetFilename
        - Image
        - User

  - question: What was the initial infection vector that led to this Satan ransomware deployment?
    context: Understanding the infection vector helps prevent future incidents and identify other potentially compromised systems.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "powershell"
            - "cmd.exe"
            - ".exe"
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  - question: Has this ransomware attempted to delete system backups or shadow copies?
    context: Satan ransomware typically deletes backups to prevent recovery, which would appear in process logs.
    range: -4h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "vssadmin"
            - "wbadmin"
            - "bcdedit"
            - "shadow"
            - "delete"
        condition: selection
      fields:
        - CommandLine
        - Image
        - User
        - ProcessGuid

  - question: What network shares or mapped drives might have been encrypted by this ransomware?
    context: Satan ransomware often targets network shares, which would generate additional network activity.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 445
        condition: selection
      fields:
        - dst_ip
        - bytes_in
        - bytes_out

  - question: Are there indicators of data exfiltration before the encryption process began?
    context: Modern ransomware often exfiltrates data before encryption for double extortion tactics.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          bytes_out|gte: 1000000
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out

  - question: Has this Satan ransomware infection spread to other systems in the network?
    context: Ransomware often spreads laterally before encryption to maximize impact across the organization.
    range: -4h/+1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "Satan"
            - "5ss5c"
            - "Ransomware"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the scope of Satan ransomware activity across the enterprise?
    context: Understanding the full scope of infection helps prioritize recovery efforts and containment measures.
    range: -24h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.query|contains:
            - "keyhash="
            - "file="
            - "status="
        condition: selection
      fields:
        - src_ip
        - url.full
        - dst_ip