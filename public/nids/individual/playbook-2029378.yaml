name: ET WEB_CLIENT Observed Malicious SSL Cert (Charming Kitten Phishing Domain unirsd.com)
id: 22029378
description: |
  Detects SSL certificate containing the malicious domain "unirsd.com" associated with Charming Kitten APT group phishing campaigns.
  This domain appears to impersonate academic or research institutions to deceive victims. Legitimate universities would use official .edu domains.
type: detection
detection_id: 2029378
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete SSL certificate subject containing the academic impersonation domain?
    context: Examining the full certificate subject reveals the exact phishing domain and certificate details used by attackers.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number

  - question: What SSL certificate details were observed for this academic impersonation connection?
    context: Certificate metadata helps identify the infrastructure used by Charming Kitten for this institutional impersonation campaign.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.server.certificate.not_valid_before
        - tls.server.certificate.not_valid_after
        - tls.server.certificate.fingerprint_sha256
        - tls.server.certificate.subject_alternative_names

  # Type 2: Triage Assessment
  - question: Has this client previously accessed legitimate academic or research institutions?
    context: Comparing with legitimate university connections helps distinguish between targeted phishing and normal academic browsing.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 443
            - 80
        condition: selection
      fields:
        - dst_ip
        - server_name
        - connection_count

  - question: Is this user typically accessing academic or research resources?
    context: Understanding user behavior patterns helps assess if this fits normal academic browsing or represents targeted phishing.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|contains:
            - '.edu'
            - 'university'
            - 'research'
            - 'academic'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - query_count

  # Type 3: Activity Context
  - question: What DNS queries preceded this academic impersonation SSL connection?
    context: DNS resolution patterns reveal how the user reached the malicious domain and potential academic targeting methods.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|contains:
            - 'unirsd.com'
            - 'university'
            - 'research'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What email or academic referral activity led to this fake institutional domain?
    context: Understanding how users reached the fake academic site helps identify the attack vector and targeting of researchers or students.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - http.request.referrer

  # Type 4: Impact Assessment
  - question: Was any academic credentials or research data submitted to this fake institution?
    context: POST requests to phishing domains often indicate credential harvesting or research data theft attempts by the attacker.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: 'POST'
        condition: selection
      fields:
        - url.path
        - http.request.body.content
        - http.response.status_code

  - question: What sensitive academic data was transmitted over this SSL connection?
    context: Analyzing connection metadata reveals the scope of potential research data exfiltration to the phishing infrastructure.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - bytes_sent
        - bytes_received
        - duration
        - connection_state

  # Type 5: Forensic Deep-Dive
  - question: What process initiated this connection to the fake academic domain?
    context: Identifying the originating process helps determine if this was user-initiated academic browsing or malware-driven activity.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'browser'
            - 'chrome'
            - 'firefox'
            - 'edge'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Are there indicators of research data theft or academic credential compromise?
    context: Charming Kitten campaigns often target academic institutions for intellectual property theft and credential harvesting.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - 'research'
            - 'academic'
            - 'paper'
            - 'credential'
            - 'login'
        condition: selection
      fields:
        - TargetFilename
        - ProcessGuid
        - file.hash.md5

  # Type 6: Enterprise Correlation
  - question: Are other researchers or academic staff connecting to this fake institutional infrastructure?
    context: APT campaigns often target multiple members of academic institutions simultaneously for research theft.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.subject|contains: 'unirsd.com'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - connection_count
        - unique_hosts

  - question: What other academic impersonation domains appear across the enterprise?
    context: Correlating with other institutional impersonation indicators helps assess campaign scope and targeting of academic users.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.query.name|contains:
            - 'university'
            - 'research'
            - 'academic'
            - '.edu'
        condition: selection
      fields:
        - src_ip
        - dns.query.name
        - dns.resolved_ip
        - query_count