name: ET MALWARE Observed Malicious SSL Cert (Get2 CnC)
id: 22029537
description: |
  Detects SSL certificates associated with Get2 malware command and control infrastructure.
  Get2 is a malware family that uses HTTPS for C2 communication with specific certificate patterns.
  May trigger on legitimate certificates if domains are compromised or typosquatted.
type: detection
detection_id: 2029537
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What are the complete details of the malicious SSL certificate?
    context: Certificate details reveal the C2 infrastructure and help identify related campaigns.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number

  - question: What is the complete SSL certificate chain for this connection?
    context: Full certificate analysis helps identify the certificate authority and validation status.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.not_valid_after
        - tls.server.certificate.fingerprint.sha1

  - question: Is this certificate or domain legitimately used by business applications?
    context: Determining if the certificate belongs to legitimate business services helps avoid false positives.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.subject|contains: mays-ltd.com
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port

  - question: What initiated the connection to this malicious certificate?
    context: Identifying the source process helps determine if Get2 malware is actively running.
    range: -15m/+15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: Are there other network connections from the affected host?
    context: Get2 malware may establish multiple C2 channels or perform additional malicious activities.
    range: -1h/+1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_in
        - bytes_out

  - question: Has this host made DNS queries for the malicious domain?
    context: DNS resolution patterns help confirm malware activity and identify additional C2 domains.
    range: -2h/+1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dns.query.name|contains: mays-ltd.com
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Are there signs of Get2 malware installation on the system?
    context: Get2 malware creates specific files and registry entries for persistence.
    range: -24h/+30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessImage

  - question: Has the malware established persistence mechanisms?
    context: Get2 typically modifies registry or creates scheduled tasks for persistence.
    range: -24h/+30m
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessImage

  - question: What data is being transmitted over the encrypted C2 channel?
    context: While content is encrypted, connection metadata reveals communication patterns.
    range: -1h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%src_ip%'
          src_ip|expand: '%dst_ip%'
          dst_port: 443
        condition: selection
      fields:
        - bytes_in
        - bytes_out
        - duration

  - question: Are other hosts in the network connecting to this malicious certificate?
    context: Identifies the scope of Get2 infections across the organization.
    range: -24h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.subject|contains: mays-ltd.com
        condition: selection
      fields:
        - dst_ip
        - src_ip
        - dst_port

  - question: What is the timeline of malicious SSL certificate alerts across the enterprise?
    context: Understanding certificate-based C2 patterns helps identify related malware campaigns.
    range: -7d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: SSL_Malicious_Cert
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name