name: ET MALWARE Observed Malicious SSL Cert (Get2 CnC)
id: 22029555
description: |
  Detects SSL certificate associated with Get2 malware command and control infrastructure.
  This indicates communication with known malicious servers used by Get2 malware family.
  Legitimate services do not use certificates with the rdmsom.com common name.
type: detection
detection_id: 2029555
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What are the complete details of the malicious SSL certificate?
    context: Understanding the full certificate details reveals the C2 infrastructure and campaign attribution.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number

  - question: What SSL certificate chain and validation details were observed?
    context: Analyzing the certificate chain reveals the infrastructure setup and potential attribution.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.server.certificate.fingerprint
        - tls.server.certificate.not_before
        - tls.server.certificate.not_after
        - tls.version

  # Type 2: Triage Assessment
  - question: Is this system known to be infected with Get2 malware?
    context: Confirming if this is new malware communication or ongoing C2 activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'Get2'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - rule.category

  - question: Are there legitimate reasons for this system to connect to rdmsom.com?
    context: Determining if this could be false positive from legitimate business activity.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          dns.query.name|contains: 'rdmsom.com'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 3: Activity Context
  - question: What processes initiated the connection to the Get2 C2 server?
    context: Identifying the malware process responsible for the C2 communication.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - ProcessGuid

  - question: What network activity preceded this malicious SSL connection?
    context: Understanding the sequence of events that led to C2 communication.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - network.bytes

  # Type 4: Impact Assessment
  - question: What data was transmitted to the Get2 C2 server?
    context: Assessing potential data exfiltration and command reception from malware.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - network.bytes
        - network.protocol
        - dst_port
        - network.direction

  - question: Has the Get2 malware downloaded additional payloads or updates?
    context: Determining if secondary infections or malware updates occurred.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - 'temp'
            - 'downloads'
            - '.exe'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.size
        - ProcessGuid

  - question: What system information has been collected by the Get2 malware?
    context: Assessing the scope of system reconnaissance and data gathering.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'systeminfo.exe'
            - 'whoami.exe'
            - 'net.exe'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessGuid

  # Type 5: Forensic Deep-Dive
  - question: What persistence mechanisms has the Get2 malware established?
    context: Understanding how the malware maintains access for complete remediation.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - 'Run'
            - 'RunOnce'
            - 'Services'
        condition: selection
      fields:
        - TargetObject
        - Details
        - ProcessGuid

  - question: What additional C2 infrastructure is the Get2 malware using?
    context: Identifying the complete command and control network for blocking and attribution.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - dst_port

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network communicating with Get2 C2 servers?
    context: Determining the scope of Get2 malware infections across the organization.
    range: -1d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.subject|contains: 'rdmsom.com'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - tls.server.certificate.subject

  - question: Is this part of a broader malware campaign targeting the organization?
    context: Understanding if this is isolated or part of coordinated attack against multiple systems.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'Get2'
            - 'SSL_Malicious_Cert'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name