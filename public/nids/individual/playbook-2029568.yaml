name: ET MALWARE Observed Malicious SSL Cert (Get2 CnC)
id: 22029568
description: |
  Detects SSL certificates associated with Get2 malware command and control infrastructure.
  The certificate CN=into-box.com has been observed in Get2 malware campaigns.
  May trigger on legitimate certificates if domain is compromised or reused.
type: detection
detection_id: 2029568
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete SSL certificate subject and issuer information?
    context: Full certificate details help identify the specific malware campaign and infrastructure.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.serial_number
        - tls.server.certificate.fingerprint_sha1

  - question: What SSL/TLS connection details were observed?
    context: Connection metadata reveals the scope and nature of the malicious SSL session.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - tls.version
        - tls.cipher_suite
        - tls.server.certificate.not_after
        - tls.server.certificate.not_before

  # Type 2: Triage Assessment
  - question: Is this certificate commonly seen in the environment?
    context: Legitimate business connections would show consistent patterns over time.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.subject|contains: "into-box.com"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - tls.server.certificate.subject

  - question: Are there other systems connecting to this certificate?
    context: Multiple infected systems would show similar SSL connections to the same infrastructure.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - tls.server.certificate.subject

  # Type 3: Activity Context
  - question: What network connections preceded this SSL session?
    context: Understanding the connection sequence helps identify the initial infection vector.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection.state
        - network.bytes_sent

  - question: What processes initiated network connections around this time?
    context: Identifying the source process helps determine if this is malware execution.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User

  # Type 4: Impact Assessment
  - question: What data was transmitted over this SSL connection?
    context: Volume and frequency of data transfer indicates potential data exfiltration.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - network.bytes_sent
        - network.bytes_received
        - connection.duration

  - question: Are there signs of persistent connections or reconnection attempts?
    context: Persistent C2 connections indicate active malware presence requiring immediate response.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - connection.state
        - dst_port

  # Type 5: Forensic Deep-Dive
  - question: What other Get2 malware indicators are present on this system?
    context: Get2 malware typically exhibits specific behavioral patterns and file artifacts.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256

  - question: Are there DNS queries for known Get2 infrastructure?
    context: Malware often performs DNS lookups before establishing SSL connections.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|contains: "into-box.com"
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  # Type 6: Enterprise Correlation
  - question: Are other systems in the environment showing similar Get2 SSL certificates?
    context: Enterprise-wide correlation reveals the scope of potential Get2 malware infections.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          tls.server.certificate.subject|contains: "into-box.com"
        condition: selection
      fields:
        - src_ip
        - dst_ip