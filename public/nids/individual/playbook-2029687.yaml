name: ET PHISHING Successful Generic Credit Card Information Phish 2020-02-21
id: 22029687
description: |
  Detects successful credit card phishing attempts using abbreviated form fields (cc, mm, cvv).
  Identifies POST requests containing credit card number, month, and CVV in compact form format.
  May trigger on legitimate abbreviated payment forms but typically indicates phishing activity.
type: detection
detection_id: 2029687
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What credit card information was submitted using these abbreviated field names?
    context: Abbreviated fields (cc=, mm=, cvv=) often indicate streamlined phishing kits designed for quick data harvesting.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.full
        - http.request.headers.content_type

  - question: Is this destination a known legitimate payment processor using abbreviated field names?
    context: Some legitimate payment services use shortened field names, requiring validation against known processors.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: "POST"
        condition: selection
      fields:
        - url.domain
        - url.path
        - src_ip
        - http.request.body.content

  - question: What was the complete user session leading to this credential submission?
    context: Understanding the full browsing session reveals how users were directed to the phishing form.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.request.headers.referer
        - http.response.status_code

  - question: Are there DNS queries indicating the user was redirected through malicious domains?
    context: Phishing campaigns often use domain redirection chains to evade detection and tracking.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Have other users submitted similar abbreviated form data to this destination?
    context: Multiple victims using the same phishing site indicates an active campaign requiring immediate response.
    range: -12h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: "POST"
          http.request.body.content|contains: "cc="
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.body.content

  - question: What TLS certificate is being used by this phishing domain?
    context: Certificate analysis can reveal phishing infrastructure patterns and help track related campaigns.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject.common_name
        - tls.server.certificate.issuer.common_name
        - tls.server.certificate.serial_number
        - tls.server.certificate.fingerprint_sha256

  - question: Are there indicators of additional malicious content served from this domain?
    context: Phishing sites often serve multiple attack vectors including malware, requiring comprehensive analysis.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - file.mime_type
        - http.response.body.content

  - question: What device and browser information was exposed in the phishing attempt?
    context: User-agent and header analysis reveals victim system details and potential targeting criteria.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - http.request.headers.accept_language
        - http.request.headers.x_forwarded_for

  - question: Has this compromised user exhibited other suspicious network behaviors?
    context: Phishing victims often show additional compromise indicators requiring broader investigation.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip
        - dst_port

  - question: Are there similar phishing alerts across the enterprise using these field patterns?
    context: Coordinated phishing campaigns often use consistent form structures across multiple targets.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - "PHISHING"
            - "Credit Card"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - url.domain

  - question: What hosting infrastructure and ASN is associated with this phishing domain?
    context: Infrastructure analysis helps identify phishing-as-a-service operations and threat actor patterns.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_as.organization_name
        - dst_as.number
        - dst_geo.country_name
        - dst_geo.city_name