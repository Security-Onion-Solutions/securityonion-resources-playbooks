name: ET PHISHING Successful Generic Credit Card Information Phish 2020-02-21
id: 22029688
description: |
  Detects successful credit card phishing using verbose field names (cardnumber, month, year, CVV).
  Identifies POST requests with detailed form fields commonly used in professional phishing kits.
  May trigger on legitimate payment forms but verbose naming often indicates phishing attempts.
type: detection
detection_id: 2029688
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What complete credit card details were submitted using these verbose field names?
    context: Verbose field naming (cardnumber=, month=, year=) suggests sophisticated phishing kits designed to appear legitimate.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.full
        - http.request.headers.content_length

  - question: Is this a legitimate e-commerce site using standard payment field naming conventions?
    context: Established e-commerce platforms often use descriptive field names, requiring verification against known merchants.
    range: -14d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: "POST"
        condition: selection
      fields:
        - url.domain
        - url.path
        - src_ip
        - http.request.body.content

  - question: How did the user navigate to this payment form submission?
    context: Analyzing the browsing path reveals whether users were legitimately shopping or directed through phishing.
    range: -45m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.request.headers.referer
        - http.response.status_code

  - question: What domain resolution activity preceded this credit card submission?
    context: DNS queries can reveal malicious redirections or typosquatting domains used in phishing campaigns.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Are multiple users submitting payment information to this same endpoint?
    context: Multiple payment submissions to unauthorized sites indicates an active phishing campaign requiring immediate action.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: "POST"
          http.request.body.content|contains: "cardnumber="
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.body.content

  - question: What SSL certificate characteristics does this payment site exhibit?
    context: Certificate analysis reveals whether the site uses legitimate commercial certificates or suspicious alternatives.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject.common_name
        - tls.server.certificate.subject.organization_name
        - tls.server.certificate.issuer.common_name
        - tls.server.certificate.validity_period

  - question: Has this phishing site delivered additional malicious content to victims?
    context: Phishing operations often combine credential theft with malware delivery for maximum impact.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.full
        - http.response.status_code
        - file.mime_type
        - http.response.body.content

  - question: What client system and browser details were exposed during the phishing attempt?
    context: Browser and system information helps assess victim environment and potential for further compromise.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.headers.user_agent
        - http.request.headers.accept_language
        - http.request.headers.accept_encoding
        - http.request.headers.cookie

  - question: Are there other security alerts associated with this compromised user?
    context: Phishing victims often trigger multiple alerts as attackers exploit their compromised credentials.
    range: -8h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip
        - dst_port

  - question: What other phishing campaigns are using similar verbose field naming patterns?
    context: Consistent field naming across campaigns can indicate shared phishing kit infrastructure or threat actors.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "PHISHING"
          http.request.body.content|contains: "cardnumber="
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.domain
        - rule.name

  - question: What hosting provider and geographic location serves this phishing infrastructure?
    context: Infrastructure analysis helps identify phishing service providers and may reveal threat actor attribution.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_as.organization_name
        - dst_as.number
        - dst_geo.country_name
        - dst_geo.region_name