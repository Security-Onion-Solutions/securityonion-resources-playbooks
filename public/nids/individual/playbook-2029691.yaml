name: ET PHISHING Successful Generic Credit Card Information Phish 2020-02-25
id: 22029691
description: |
  Detects successful credit card information phishing attempts where users submit financial data.
  Indicates potential credential theft and financial fraud in progress.
  May trigger on legitimate payment processing or financial applications.
type: detection
detection_id: 2029691
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What credit card information was submitted in this phishing attempt?
    context: Understanding the exact data submitted helps assess the scope of credential theft.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.full

  - question: What is the destination domain and server receiving the stolen credentials?
    context: Identifying the phishing infrastructure helps with threat intelligence and blocking.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.domain
        - dst_ip
        - dest.geo.country_name
        - http.response.status_code

  - question: Is this a legitimate payment processing website?
    context: Distinguishing between phishing sites and legitimate financial services is critical.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.domain|expand: '%url.domain%'
          http.request.method: POST
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.user_agent

  - question: How did the user reach this phishing site?
    context: Understanding the attack vector helps identify the initial compromise method.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: GET
        condition: selection
      fields:
        - url.full
        - http.request.headers.referer
        - http.user_agent

  - question: Are there other users from this organization submitting data to the same phishing site?
    context: Determines if this is part of a targeted campaign against the organization.
    range: -24h/+2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.body.bytes

  - question: What email or communication led to this phishing attempt?
    context: Identifying the phishing email helps understand the attack campaign and block similar messages.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - mail
            - webmail
            - outlook
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.user_agent

  - question: Has this user accessed other suspicious websites recently?
    context: Users who fall for phishing may visit multiple malicious sites or be targeted repeatedly.
    range: -48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - phishing
            - credential-theft
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - rule.name

  - question: Are there signs of additional malware infection on this host?
    context: Phishing attacks may be followed by malware installation or further compromise.
    range: -2h/+4h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User

  - question: What DNS queries were made to resolve the phishing domain?
    context: DNS resolution patterns help identify the phishing infrastructure and potential DGA usage.
    range: -2h/+1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|expand: '%url.domain%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Are there other phishing attempts targeting this organization?
    context: Understanding the scope of phishing campaigns helps prioritize response efforts.
    range: -7d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category: credential-theft
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the timeline of credential theft alerts across the enterprise?
    context: Correlating phishing attempts helps identify coordinated campaigns and affected users.
    range: -30d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: PHISHING
        condition: selection
      fields:
        - src_ip
        - url.domain
        - rule.name