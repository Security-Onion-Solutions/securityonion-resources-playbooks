name: ET PHISHING UK GOV Identity Verification Phishing Landing
id: 22029702
description: |
  Detects phishing pages impersonating UK government identity verification services with suspicious form submissions to need.php.
  May trigger on legitimate government websites, but the specific content pattern and form action are indicative of credential harvesting.
type: detection
detection_id: 2029702
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete HTML content of the phishing page?
    context: The full page content reveals the social engineering tactics and credential fields being harvested.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.full

  - question: What specific form fields are being collected by the need.php endpoint?
    context: Understanding harvested fields helps assess the scope of credential theft and identity fraud risk.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          url.path|contains: "need.php"
        condition: selection
      fields:
        - http.request.body.content
        - http.request.method
        - url.query

  # Type 2: Triage Assessment
  - question: Is this user accessing legitimate UK government services during business hours?
    context: Confirms whether this is authorized government service access or phishing site interaction.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - ".gov.uk"
            - ".service.gov.uk"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.response.status_code

  - question: Has this external server been previously categorized as malicious?
    context: Determines if this is a known phishing infrastructure or newly identified threat.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 3: Activity Context
  - question: How did the user arrive at this phishing page?
    context: Identifying the referrer helps trace the attack vector, whether email, malicious ads, or compromised sites.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.referrer
        - url.domain
        - url.path

  - question: What email activity preceded this phishing site access?
    context: Phishing sites are often accessed via malicious email links, helping identify the initial attack vector.
    range: -4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 25
            - 110
            - 143
            - 993
            - 995
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 4: Impact Assessment
  - question: Did the user submit credentials to the phishing form?
    context: Successful credential submission indicates compromised accounts requiring immediate password resets.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: "POST"
          url.path|contains: "need.php"
        condition: selection
      fields:
        - http.request.body.content
        - http.response.status_code
        - url.query

  - question: Are there signs of additional account compromise attempts?
    context: Harvested credentials may be immediately used for unauthorized access to legitimate services.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - ".gov.uk"
            - "login"
            - "signin"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.response.status_code

  # Type 5: Forensic Deep-Dive
  - question: What is the complete phishing infrastructure behind this campaign?
    context: Mapping the full infrastructure helps identify related domains and IP addresses for blocking.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.resolved_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - src_ip

  - question: Are there other phishing pages hosted on the same infrastructure?
    context: Phishing operations often host multiple fake sites on the same infrastructure to maximize victim reach.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - url.path
        - url.domain
        - http.response.status_code

  # Type 6: Enterprise Correlation
  - question: Have other users in the organization accessed this phishing site?
    context: Identifies the scope of potential credential compromise across the enterprise.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there similar phishing attempts targeting other government services?
    context: Determines if this is part of a broader phishing campaign targeting government service users.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          http.response.body.content|contains:
            - "government"
            - "identity"
            - "verification"
          url.path|contains: "need.php"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.domain