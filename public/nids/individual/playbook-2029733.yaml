name: ET WEB_CLIENT Microsoft Tech Support Scam 2020-03-24
id: 22029733
description: |
  Detects fake Microsoft tech support scam pages using official-looking titles.
  These pages trick users into calling fake support numbers or installing malware.
  No legitimate Microsoft support pages use this specific title format.
type: detection
detection_id: 2029733
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What is the complete HTML content of the fake Microsoft support page?
    context: Understanding the full scam page helps identify social engineering techniques and contact information.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - file.data
        - http.response.status_code

  - question: What domain is hosting this fake Microsoft support page?
    context: Identifying the scam domain helps track threat actor infrastructure and block future access.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.domain
        - url.full
        - dst_ip
        - http.request.referrer

  # Type 2: Triage Assessment
  - question: Is this user known to frequently visit legitimate Microsoft support resources?
    context: Understanding user behavior helps determine if this was intentional or accidental access.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - 'microsoft.com'
            - 'support.microsoft.com'
            - 'docs.microsoft.com'
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.response.status_code

  - question: Does this appear to be part of normal business IT support activities?
    context: Legitimate IT support may involve Microsoft resources, helping distinguish authorized activity.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|contains:
            - 'support'
            - 'help'
            - 'troubleshoot'
        condition: selection
      fields:
        - url.domain
        - user_agent.original
        - http.request.referrer

  # Type 3: Activity Context
  - question: How did the user arrive at this fake support page?
    context: Understanding the delivery mechanism helps identify if this was email-based or search result manipulation.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - http.request.referrer
        - url.full
        - user_agent.original

  - question: What search terms or links led to this scam page?
    context: Identifying search patterns helps understand how users are being directed to scam sites.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          dns.query.name|contains:
            - 'google'
            - 'bing'
            - 'search'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip

  - question: Were there any system errors or issues that might have prompted support seeking?
    context: Users often search for support after experiencing technical problems, making them vulnerable to scams.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - 'error'
            - 'crash'
            - 'exception'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ProcessName

  # Type 4: Impact Assessment
  - question: Did the user interact with or download anything from the scam page?
    context: Determining if malware was downloaded or contact information provided guides response actions.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName
        - file.size

  - question: Was any contact information or personal data submitted to the scammers?
    context: Understanding data exposure helps determine if users need to be warned about follow-up scam attempts.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.domain|expand: '%url.domain%'
          http.request.method: 'POST'
        condition: selection
      fields:
        - http.request.body.content
        - network.bytes_sent
        - url.path

  # Type 5: Forensic Deep-Dive
  - question: What other scam-related domains are hosted on the same infrastructure?
    context: Tech support scammers often host multiple fake sites on the same servers.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.domain
        - url.path
        - src_ip
        - http.response.status_code

  - question: What SSL certificate details are associated with this scam domain?
    context: Certificate information helps track scammer infrastructure and identify related campaigns.
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - tls.server.certificate.subject
        - tls.server.certificate.issuer
        - tls.server.certificate.not_after

  # Type 6: Enterprise Correlation
  - question: Have other users in the organization accessed this or similar scam domains?
    context: Understanding campaign scope helps identify if this is a targeted attack or opportunistic scamming.
    range: +/-7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.domain|expand: '%url.domain%'
        condition: selection
      fields:
        - src_ip
        - user_agent.original
        - http.request.referrer

  - question: Are there other tech support scam attempts targeting the organization?
    context: Multiple scam attempts may indicate coordinated campaigns or vulnerable user populations.
    range: +/-30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'Tech Support'
            - 'Microsoft'
            - 'Support Scam'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name