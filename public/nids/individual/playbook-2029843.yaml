name: ET HUNTING Suspicious Zipped Filename in Outbound POST Request (Hardware.txt)
id: 22029843
description: |
  Detects outbound POST requests containing zipped files with suspicious filenames like "Hardware.txt".
  This pattern may indicate data exfiltration attempts where system information is being transmitted.
  Could also be legitimate system monitoring or inventory tools uploading hardware information.
type: detection
detection_id: 2029843
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete POST request content and destination URL?
    context: Understanding the full request reveals the target service and data being transmitted.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method
        - http.request.headers

  - question: What specific content was contained within the Hardware.txt file in the ZIP?
    context: Analyzing the zipped content helps determine if legitimate system data or sensitive information is being exfiltrated.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.request.body.bytes

  # Type 2: Triage Assessment
  - question: Is this system authorized to upload hardware inventory data to external services?
    context: Legitimate system management tools may upload hardware information for inventory purposes.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - http.request.body.content

  - question: Does this activity align with scheduled maintenance or monitoring windows?
    context: Hardware inventory uploads often occur during scheduled system maintenance periods.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - timestamp
        - dst_ip
        - url.domain

  # Type 3: Activity Context
  - question: What process initiated this HTTP POST request?
    context: Understanding the source process helps distinguish between legitimate tools and malicious activity.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What other network connections occurred from this source around the same time?
    context: Concurrent connections may reveal broader data exfiltration or command and control activity.
    range: +/-30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_out
        - connection_state

  # Type 4: Impact Assessment
  - question: How much data was transmitted in this and related POST requests?
    context: Data volume helps assess the scope of potential information disclosure.
    range: +/-1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - dst_ip
        - http.request.body.bytes
        - url.domain

  - question: Are there signs of successful data exfiltration based on server responses?
    context: HTTP response codes and content indicate whether data transmission was successful.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - http.response.body.bytes

  # Type 5: Forensic Deep-Dive
  - question: What system hardware information was potentially exposed in the transmission?
    context: Understanding exposed hardware details helps assess information disclosure impact.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - alert.metadata

  - question: Are there file creation events for Hardware.txt or related files on the source system?
    context: File creation events reveal how the data was collected and prepared for transmission.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - Hardware.txt
            - hardware
        condition: selection
      fields:
        - TargetFilename
        - Image
        - ProcessGuid

  # Type 6: Enterprise Correlation
  - question: Are other systems in the network exhibiting similar hardware data exfiltration patterns?
    context: Multiple systems with similar activity may indicate a coordinated data collection campaign.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - src_ip
        - url.domain
        - http.request.body.content

  - question: Is this destination IP or domain associated with other suspicious activities across the enterprise?
    context: The destination may be part of a broader malicious infrastructure used for data collection.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category