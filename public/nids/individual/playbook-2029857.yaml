name: ET WEB_CLIENT Tech Support Scam 2020-04-10
id: 22029857
description: |
  Detects tech support scam websites using "Windows_Official_Support" in the title to impersonate Microsoft support.
  These sites typically trick users into calling fake support numbers or installing remote access tools.
  Legitimate Microsoft support pages use different title formats and official domains.
type: detection
detection_id: 2029857
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the complete HTML content and URL structure of the tech support scam page?
    context: Full page analysis reveals the scam tactics, phone numbers, and social engineering techniques used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - url.full
        - http.response.headers

  - question: What specific fake support phone numbers or contact methods were displayed to victims?
    context: Contact information helps identify the scam operation and can be used for threat intelligence sharing.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.body.content
        - url.domain

  # Type 2: Triage Assessment
  - question: Did the user interact with or navigate away from this scam page immediately?
    context: User behavior analysis helps determine if the victim was deceived or recognized the scam attempt.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - http.request.method
        - http.response.status_code

  - question: Was this page accessed through legitimate search results or suspicious redirects?
    context: Understanding the access vector helps determine if this was targeted or opportunistic social engineering.
    range: -5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - http.request.headers
        - http.request.referrer

  # Type 3: Activity Context
  - question: What browser or application was used to access this tech support scam site?
    context: Browser identification helps understand user susceptibility and potential for further exploitation.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - chrome.exe
            - firefox.exe
            - msedge.exe
            - iexplore.exe
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What sequence of web browsing led the user to this scam page?
    context: Understanding the browsing path reveals how users are being directed to these fraudulent sites.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.domain
        - http.request.referrer
        - timestamp

  # Type 4: Impact Assessment
  - question: Did the user download any files or software from this scam site?
    context: File downloads from scam sites often contain remote access tools or malware for further compromise.
    range: +15m
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.response.headers|contains:
            - application/octet-stream
            - application/zip
            - application/exe
        condition: selection
      fields:
        - url.full
        - http.response.body.bytes
        - http.response.headers

  - question: Are there signs of remote access tool installation following this scam exposure?
    context: Tech support scams often lead to installation of legitimate remote access tools for fraudulent purposes.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          Image|contains:
            - teamviewer
            - anydesk
            - logmein
            - chrome_remote_desktop
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  # Type 5: Forensic Deep-Dive
  - question: What social engineering tactics and fake error messages were used in this scam?
    context: Understanding scam techniques helps improve user awareness training and detection capabilities.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - alert.metadata

  - question: Are there file system changes indicating potential malware installation from this scam interaction?
    context: File modifications may reveal malware deployment following successful social engineering.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - Image
        - ProcessGuid
        - file.hash.md5

  - question: Did the user provide any sensitive information through forms on this scam site?
    context: Form submissions may indicate credential theft or personal information disclosure to scammers.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          http.request.method: POST
        condition: selection
      fields:
        - http.request.body.content
        - url.full

  # Type 6: Enterprise Correlation
  - question: Are other users in the organization being exposed to similar tech support scam sites?
    context: Multiple exposures indicate a broader social engineering campaign targeting the organization.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Tech Support Scam"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.domain

  - question: Is this scam domain part of a larger fraudulent infrastructure observed across the enterprise?
    context: The scam site may be one of many domains used in coordinated social engineering campaigns.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - rule.category