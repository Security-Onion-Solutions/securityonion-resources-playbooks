name: ET WEB_CLIENT MINI MO Webshell Accessed on External Compromised Server
id: 22029875
description: |
  Detects internal clients accessing MINI MO webshells on external compromised servers.
  This indicates either internal compromise leading to external webshell access or
  legitimate security research. MINI MO is a lightweight webshell with basic functionality.
type: detection
detection_id: 2029875
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What is the complete MINI MO webshell interface being accessed?
    context: The full response reveals webshell capabilities and available functions.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.status_code
        - url.full

  - question: What specific commands or parameters are being sent to the webshell?
    context: Request parameters reveal how the attacker is interacting with the webshell.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - url.query
        - http.request.body.content
        - http.request.method
        - url.path

  - question: Is this access part of authorized security testing or research?
    context: Legitimate webshell access would be documented and from authorized security personnel.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - url.domain
        - http.request.method

  - question: How did the internal client discover this external webshell?
    context: Prior activity may reveal reconnaissance, malware communication, or threat intelligence gathering.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - url.full
        - http.request.method
        - http.response.status_code
        - http.request.headers

  - question: What information is the webshell revealing about the external server?
    context: Webshell responses contain valuable intelligence about the compromised external system.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.response.body.content
        - http.response.headers
        - url.full

  - question: Is the internal client compromised and being used maliciously?
    context: Compromised internal systems may be used to access external webshells for cybercriminal activities.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ParentImage

  - question: What data is being transferred through the webshell connection?
    context: Data transfer patterns reveal potential file uploads, downloads, or command execution.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - network.bytes
        - network.packets
        - dst_port

  - question: Are there signs of broader malware activity or command and control?
    context: Webshell access may be part of larger malware infrastructure or botnet operations.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - network.bytes

  - question: What files or malware are being downloaded through the webshell?
    context: File downloads may indicate malware distribution or data theft operations.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.mime_type
        - ProcessImage

  - question: Are other internal clients accessing external webshells?
    context: Multiple internal clients accessing webshells may indicate widespread compromise or coordinated attack.
    range: -1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains:
            - 'MINI MO'
            - 'webshell'
            - 'WEB_CLIENT'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What is the pattern of external webshell access across the organization?
    context: Enterprise-wide webshell access patterns reveal campaign scope and threat actor capabilities.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.category|contains:
            - 'web-application-attack'
            - 'trojan-activity'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name
        - rule.severity