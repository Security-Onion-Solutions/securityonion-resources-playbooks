name: ET MOBILE_MALWARE Android Trojan MSO.PJApps checkin 1
id: 22029932
description: |
  Detects Android MSO.PJApps trojan performing check-in activity with device information.
  May trigger on legitimate applications that collect similar device identifiers but typically indicates malicious mobile malware.
type: detection
detection_id: 2029932
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific device information was transmitted in this check-in?
    context: Understanding the payload reveals what sensitive data the malware is exfiltrating.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.body.content
        - url.full
        - http.request.method
        - url.query

  - question: What is the complete URI structure of the malware communication?
    context: Analyzing the full URI helps identify the C2 infrastructure and communication protocol.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - url.path
        - url.query
        - http.request.headers
        - http.response.status_code

  # Type 2: Triage Assessment
  - question: Is this mobile device authorized for corporate network access?
    context: Legitimate corporate mobile devices may have documented network access policies.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver
        - bytes_toclient

  - question: Does this communication pattern match known legitimate mobile applications?
    context: Some legitimate apps may use similar URI patterns for device registration or analytics.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: "/push/"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.request.method

  # Type 3: Activity Context
  - question: What network activity preceded this malware check-in?
    context: Understanding how the device was infected helps identify the attack vector.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver
        - bytes_toclient

  - question: Are there signs of application installation or update activity?
    context: Mobile malware often installs through malicious apps or updates to legitimate apps.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.response.status_code
        - http.response.body.content

  - question: What was the timing pattern of this check-in activity?
    context: Malware often follows predictable check-in schedules or responds to specific triggers.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          url.path|contains: "/push/androidxml/"
        condition: selection
      fields:
        - url.domain
        - http.request.method
        - url.query

  # Type 4: Impact Assessment
  - question: What sensitive device information was successfully exfiltrated?
    context: Confirming data exfiltration helps assess privacy and security impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
          http.response.status_code: 200
        condition: selection
      fields:
        - http.response.body.content
        - http.response.headers
        - bytes_toclient

  - question: Are there signs of additional malicious payloads being downloaded?
    context: Mobile trojans often download additional modules or updates after initial check-in.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          http.request.method: "GET"
        condition: selection
      fields:
        - url.domain
        - url.path
        - http.response.status_code
        - bytes_toclient

  # Type 5: Forensic Deep-Dive
  - question: What is the reputation and infrastructure of the C2 server?
    context: Analyzing the command and control infrastructure helps understand the threat actor's capabilities.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there other malware families communicating with the same infrastructure?
    context: Threat actors often reuse infrastructure across multiple malware campaigns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_port
        - proto
        - bytes_toserver

  # Type 6: Enterprise Correlation
  - question: Are other mobile devices in the network showing similar malware behavior?
    context: Mobile malware campaigns often target multiple devices within the same organization.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          url.path|contains: "/push/androidxml/"
          url.query|contains:
            - "sim="
            - "tel="
            - "imsi="
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.domain

  - question: Is this part of a broader mobile malware distribution campaign?
    context: Understanding campaign scope helps assess organizational risk and implement appropriate countermeasures.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - url.path
        - http.request.method