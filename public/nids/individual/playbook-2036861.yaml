name: ET MALWARE Gh0st RAT Backdoor Checkin
id: 22036861
description: |
  Detects Gh0st RAT backdoor check-in communication via distinctive HTTP GET pattern.
  Gh0st RAT is a popular remote access trojan used in targeted attacks and cybercrime.
  May trigger on legitimate applications using similar URL parameters but pattern indicates malicious C2.
type: detection
detection_id: 2036861
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact HTTP GET request pattern and ocid parameter detected?
    context: Understanding the specific URL structure confirms Gh0st RAT variant and victim identification method.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.method
        - url.full
        - url.path
        - url.query

  - question: What is the complete HTTP request structure including headers and payload size?
    context: Full request analysis reveals RAT configuration and potential victim fingerprinting data.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - http.request.headers
        - http.request.body.content
        - dsize
        - flow.state

  # Type 2: Triage Assessment
  - question: Is this HTTP GET request part of legitimate web application traffic?
    context: Distinguishes between normal web browsing and Gh0st RAT C2 communication disguised as HTTP.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.request.method
        - url.path
        - http.response.status_code
        - http.request.headers

  - question: Are there authorized applications on this system that make HTTP requests with ocid parameters?
    context: Validates if legitimate software explains the specific URL parameter pattern.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          CommandLine|contains:
            - "http"
            - "curl"
            - "wget"
            - "browser"
        condition: selection
      fields:
        - User
        - Image
        - CommandLine

  # Type 3: Activity Context
  - question: What process initiated the HTTP GET request containing the Gh0st RAT pattern?
    context: Identifies the malware executable or compromised application establishing backdoor communication.
    range: -15m
    query: |
      aggregation: true
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  - question: What network activity preceded this Gh0st RAT check-in attempt?
    context: Understanding initial infection vector and malware deployment activities.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  - question: Are there multiple Gh0st RAT check-in attempts to different C2 servers?
    context: Reveals backup C2 infrastructure and persistence of backdoor communication attempts.
    range: -2h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature_id: 2036861
        condition: selection
      fields:
        - dst_ip
        - url.full
        - alert.signature

  # Type 4: Impact Assessment
  - question: Has the Gh0st RAT successfully established backdoor communication with C2 server?
    context: Determines if attacker has active remote access capability for response prioritization.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - http.response.status_code
        - http.response.body.content
        - bytes_toclient

  - question: What commands or data have been transmitted over the Gh0st RAT channel?
    context: Assesses potential remote control activities or data exfiltration performed via the backdoor.
    range: +6h
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - http.request.body.content
        - http.response.body.content
        - bytes_toserver
        - bytes_toclient

  # Type 5: Forensic Deep-Dive
  - question: What specific Gh0st RAT variant and configuration are indicated by the ocid parameter?
    context: Parameter analysis reveals RAT capabilities and potential attribution to specific threat actors.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - url.query
        - http.request.headers
        - app_proto
        - proto

  - question: Are there file system artifacts indicating Gh0st RAT installation or persistence?
    context: Identifies malware files and persistence mechanisms for complete system remediation.
    range: -4h/+4h
    query: |
      aggregation: true
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - ".exe"
            - ".dll"
            - ".scr"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - file.hash.sha256

  - question: What registry modifications indicate Gh0st RAT persistence or configuration storage?
    context: Registry analysis reveals persistence mechanisms and backdoor configuration details.
    range: -4h/+4h
    query: |
      aggregation: true
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "Run"
            - "RunOnce"
            - "Service"
        condition: selection
      fields:
        - TargetObject
        - Details
        - EventType

  # Type 6: Enterprise Correlation
  - question: Are other systems showing Gh0st RAT backdoor communication patterns?
    context: Identifies scope of RAT deployment and potential lateral movement across the enterprise.
    range: -24h/+24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature_id: 2036861
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - url.full
        - alert.signature

  - question: Is this Gh0st RAT activity part of a broader APT campaign or targeted attack?
    context: Correlates with other malware indicators to understand attack campaign scope and objectives.
    range: -7d/+1d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.category|contains:
            - "trojan-activity"
            - "command-and-control"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature