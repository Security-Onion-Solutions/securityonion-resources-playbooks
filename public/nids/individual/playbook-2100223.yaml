name: GPL VOIP EXPLOIT SIP UDP Softphone Overflow Attempt (CVE-2006-0189)
id: 22100223
description: |
  Detects buffer overflow exploitation attempts targeting SIP softphone applications via malformed SDP parameters.
  May indicate targeted attacks against VoIP clients or legitimate SIP traffic with unusual formatting.
type: detection
detection_id: 2100223
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact SIP SDP payload that triggered this overflow detection?
    context: Understanding the malformed SDP content helps confirm exploitation intent and identify the specific vulnerability being targeted.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
  - question: Is this normal SIP softphone communication for this user?
    context: Legitimate VoIP applications may generate SDP parameters that could trigger false positives during normal operation.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
          protocol: "udp"
        condition: selection
      fields:
        - src_ip
        - bytes_sent
        - bytes_received
        - duration
  - question: What SIP session establishment activity preceded this overflow attempt?
    context: Understanding the SIP call setup sequence helps determine if this is part of a legitimate call or targeted attack.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - protocol
        - bytes_sent
        - bytes_received
        - connection_state
  - question: Has this source attempted other VoIP exploits recently?
    context: Correlating with other VoIP attacks helps identify persistent threat actors targeting softphone vulnerabilities.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "VOIP"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port
  - question: What VoIP softphone applications are running on the targeted system?
    context: Identifying specific softphone software helps assess vulnerability to CVE-2006-0189 and similar buffer overflow attacks.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
          connection_state: "established"
        condition: selection
      fields:
        - src_ip
        - bytes_sent
        - bytes_received
        - duration
  - question: Are there successful SIP communications from this source?
    context: Legitimate VoIP users may trigger overflow detections during normal softphone usage or configuration.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 5060
          protocol: "udp"
          connection_state: "established"
        condition: selection
      fields:
        - dst_ip
        - duration
        - bytes_sent
        - bytes_received
  - question: What network reconnaissance preceded this softphone attack?
    context: Attackers often perform VoIP enumeration before targeting specific softphone vulnerabilities.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - protocol
        - connection_state
        - bytes_sent
  - question: Has this softphone exploitation attempt been successful?
    context: Determining exploitation success helps assess immediate threat and potential system compromise.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 5060
        condition: selection
      fields:
        - bytes_sent
        - bytes_received
        - duration
        - connection_state
  - question: Are there signs of post-exploitation activity following this VoIP attack?
    context: Successful softphone exploitation may lead to system compromise, credential theft, or lateral movement.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - protocol
        - bytes_sent
        - bytes_received
  - question: Are other VoIP systems in the network being targeted with similar overflow attacks?
    context: Identifying enterprise-wide VoIP exploitation attempts helps understand campaign scope and implement coordinated defenses.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "SIP UDP Softphone overflow"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - community_id