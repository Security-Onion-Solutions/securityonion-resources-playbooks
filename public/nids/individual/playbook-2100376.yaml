name: GPL ICMP PING Microsoft Windows
id: 22100376
description: |
  Detects ICMP ping packets with Microsoft Windows default signature pattern.
  This is typically generated by Windows ping utility but could indicate reconnaissance.
  Standard Windows ping commands will generate this traffic during normal operations.
type: detection
detection_id: 2100376
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact ICMP payload pattern that identified this as Windows ping?
    context: Confirming the specific Windows ping signature helps validate the detection accuracy.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - icmp.type
        - payload_printable
        - src_ip
        - dst_ip

  - question: Is this ping activity originating from an authorized Windows workstation?
    context: Legitimate Windows systems may ping for connectivity testing or network troubleshooting.
    range: -1d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol

  - question: What is the frequency and timing pattern of these Windows pings?
    context: Automated or scripted pings may indicate reconnaissance, while sporadic pings suggest manual testing.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "Windows"
          icmp.type: 8
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Are there multiple destinations being pinged from this Windows source?
    context: Systematic pinging of multiple hosts may indicate network discovery or reconnaissance activity.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          network.protocol: icmp
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - icmp.type

  - question: What processes or users initiated network activity on the source system?
    context: Understanding what triggered the ping helps determine if it's legitimate troubleshooting or malicious reconnaissance.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  - question: Has this source system exhibited other suspicious network behavior?
    context: Correlating with other alerts helps determine if the ping is part of broader malicious activity.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip
        - severity

  - question: Are there DNS queries preceding these ping attempts?
    context: Legitimate troubleshooting often involves DNS resolution before connectivity testing.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What network services are accessible on the ping destination?
    context: Understanding target services reveals what information the pinging system might be gathering.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - src_ip

  - question: Are there signs of automated ping sweeps across the network?
    context: Multiple Windows systems pinging in coordination may indicate malware or coordinated reconnaissance.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Windows"
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Have there been any recent file modifications or process executions on the source system?
    context: Recent malware installation might explain unusual pinging behavior from Windows systems.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - User
        - Image

  - question: Is this Windows ping activity part of a broader pattern across the enterprise?
    context: Enterprise-wide Windows pinging may indicate legitimate network testing or coordinated malicious activity.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "PING Microsoft Windows"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name