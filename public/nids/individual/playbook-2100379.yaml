name: GPL ICMP PING Pinger Windows
id: 22100379
description: |
  Detects ICMP ping packets with Pinger Windows signature pattern containing null bytes.
  This tool signature could indicate legitimate network testing or potential reconnaissance.
  Pinger utilities are commonly used for network diagnostics and connectivity testing.
type: detection
detection_id: 2100379
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact Pinger Windows signature pattern with null bytes detected?
    context: Confirming the specific null byte pattern helps validate if this is legitimate Pinger tool usage.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - icmp.type
        - payload_printable
        - src_ip
        - dst_ip

  - question: Is this source system authorized to run network ping utilities?
    context: Pinger tools are typically used by administrators for legitimate network connectivity testing.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol

  - question: What is the frequency and timing pattern of these Pinger Windows pings?
    context: Automated or scripted pinging may indicate reconnaissance, while sporadic pings suggest manual testing.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "Pinger Windows"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Are multiple network hosts being pinged by this Pinger utility?
    context: Systematic pinging of multiple hosts may indicate network discovery or mapping activity.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          network.protocol: icmp
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - icmp.type

  - question: What processes or users initiated network activity on the source system?
    context: Understanding what triggered the Pinger activity helps determine if it's legitimate troubleshooting.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%src_ip%'
        condition: selection
      fields:
        - User
        - Image
        - CommandLine
        - ProcessGuid

  - question: Has this source system exhibited other suspicious network scanning behavior?
    context: Correlating with other alerts helps determine if the pinging is part of broader malicious activity.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - rule.name
        - rule.category
        - dst_ip
        - severity

  - question: Are there DNS queries preceding these Pinger attempts?
    context: Legitimate network testing often involves DNS resolution before connectivity testing.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: What network services are accessible on the ping destination systems?
    context: Understanding target services reveals what information the pinging system might be gathering.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - src_ip

  - question: Are there signs of coordinated Pinger activity across multiple sources?
    context: Multiple systems using Pinger tools simultaneously may indicate legitimate testing or coordinated reconnaissance.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "Pinger Windows"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Have there been recent installations of ping utilities or network tools?
    context: Recent tool installation might explain the activity, while unexpected presence could indicate compromise.
    range: -24h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetFilename|contains:
            - "ping"
            - "pinger"
            - "network"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - User
        - Image

  - question: Are there any registry modifications related to network utilities on the source system?
    context: Network tools may create registry entries for configuration or may indicate malicious persistence.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: registry_event
      detection:
        selection:
          host.ip|expand: '%src_ip%'
          TargetObject|contains:
            - "ping"
            - "network"
        condition: selection
      fields:
        - TargetObject
        - Details
        - User

  - question: What is the baseline ICMP ping activity pattern for this network segment?
    context: Understanding normal ping patterns helps determine if this Pinger activity is anomalous for the environment.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "PING"
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name