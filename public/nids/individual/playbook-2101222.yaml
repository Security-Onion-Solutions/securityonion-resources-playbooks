name: GPL TFTP MISC TFTP32 Get Format String Attempt
id: 22101222
description: |
  Detects format string exploitation attempts against TFTP32 server via malformed GET requests.
  May indicate buffer overflow attempts or legitimate TFTP operations with unusual patterns.
type: detection
detection_id: 2101222
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact TFTP payload pattern that triggered this format string detection?
    context: Understanding the specific format string pattern helps confirm exploitation intent versus legitimate TFTP operations.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - src_ip
        - dst_ip
        - dst_port
  - question: Is this normal TFTP usage for this system?
    context: Legitimate TFTP operations may occasionally trigger format string detections during firmware updates or configuration transfers.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
          protocol: "udp"
        condition: selection
      fields:
        - src_ip
        - bytes_sent
        - bytes_received
        - duration
  - question: What TFTP activity preceded this format string attempt?
    context: Understanding the sequence of TFTP operations helps determine if this is part of a legitimate transfer or exploitation attempt.
    range: -30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 69
          protocol: "udp"
        condition: selection
      fields:
        - dst_ip
        - bytes_sent
        - bytes_received
        - connection_state
  - question: Has this source attempted other TFTP exploits recently?
    context: Correlating with other TFTP attacks helps identify persistent exploitation attempts.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "TFTP"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port
  - question: What legitimate TFTP services are running on the targeted system?
    context: Understanding legitimate TFTP services helps distinguish between attacks and normal operations.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
          protocol: "udp"
          connection_state: "established"
        condition: selection
      fields:
        - src_ip
        - bytes_sent
        - bytes_received
  - question: Are there successful TFTP transfers from this source?
    context: Legitimate TFTP clients may trigger false positives during normal file transfers.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 69
          protocol: "udp"
        condition: selection
      fields:
        - dst_ip
        - bytes_sent
        - bytes_received
        - duration
  - question: What network reconnaissance preceded this TFTP attack?
    context: Attackers often perform port scanning before targeting specific TFTP vulnerabilities.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - protocol
        - connection_state
  - question: Has this TFTP exploitation attempt been successful?
    context: Determining exploitation success helps assess immediate threat and required response actions.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - bytes_sent
        - bytes_received
        - duration
        - connection_state
  - question: Are there signs of post-exploitation activity following this TFTP attack?
    context: Successful TFTP exploitation may lead to file uploads, downloads, or lateral movement.
    range: +30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - protocol
        - bytes_sent
        - bytes_received
  - question: Are other TFTP servers in the network being targeted with similar attacks?
    context: Identifying enterprise-wide TFTP exploitation attempts helps understand campaign scope and implement coordinated defenses.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name|contains: "TFTP32 Get Format"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - community_id