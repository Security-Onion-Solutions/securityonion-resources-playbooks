name: GPL TFTP GET Admin.dll
id: 22101289
description: |
  Detects TFTP requests for Admin.dll file, potentially indicating administrative backdoor deployment.
  May trigger on legitimate administrative file transfers or malicious backdoor installation.
type: detection
detection_id: 2101289
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact TFTP GET request for Admin.dll?
    context: The TFTP request structure reveals the specific file being retrieved and transfer method.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - tftp.filename

  - question: What was the complete TFTP transaction including response?
    context: TFTP responses indicate whether the file transfer was successful and reveal file size.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - proto
        - bytes_toserver
        - bytes_toclient
        - conn_state

  # Type 2: Triage Assessment
  - question: Is this source authorized to retrieve administrative files via TFTP?
    context: Legitimate system administrators may use TFTP for configuration and administrative file transfers.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 69
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - bytes_toclient

  - question: Does this TFTP activity align with documented administrative procedures?
    context: Scheduled administrative tasks should show predictable patterns and authorized sources.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "TFTP"
            - "tftp"
        condition: selection
      fields:
        - alert.signature
        - dst_ip

  # Type 3: Activity Context
  - question: What other files were requested via TFTP from this source?
    context: Multiple TFTP requests may indicate systematic file retrieval or backdoor deployment.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "TFTP"
            - "tftp"
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - tftp.filename

  - question: What network activity preceded this TFTP request?
    context: TFTP requests often follow initial system compromise or reconnaissance activity.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_port
        - proto
        - service
        - conn_state

  # Type 4: Impact Assessment
  - question: Was the Admin.dll file successfully transferred?
    context: Successful file transfer indicates potential backdoor installation requiring immediate response.
    range: +10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          dst_port: 69
        condition: selection
      fields:
        - bytes_toclient
        - conn_state
        - duration

  - question: Are there signs of Admin.dll execution or installation?
    context: Administrative backdoors typically execute immediately after transfer for persistence.
    range: +1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          alert.category|contains:
            - "trojan"
            - "backdoor"
            - "successful-admin"
        condition: selection
      fields:
        - alert.signature
        - alert.severity

  # Type 5: Forensic Deep-Dive
  - question: What specific administrative functionality does this Admin.dll provide?
    context: Different Admin.dll variants have varying backdoor capabilities and persistence mechanisms.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - tftp.opcode
        - tftp.mode
        - packet_info

  - question: Are there indicators of known administrative backdoor families?
    context: Admin.dll may be associated with specific malware families or attack campaigns.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "admin"
            - "backdoor"
            - "trojan"
        condition: selection
      fields:
        - alert.signature
        - alert.category

  - question: What persistence mechanisms were established after file transfer?
    context: Administrative backdoors typically establish multiple persistence mechanisms for long-term access.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          alert.category|contains:
            - "policy-violation"
            - "trojan-activity"
        condition: selection
      fields:
        - alert.signature
        - alert.severity

  # Type 6: Enterprise Correlation
  - question: Are other systems being targeted for Admin.dll deployment?
    context: Administrative backdoor campaigns often target multiple systems for widespread access.
    range: -4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature_id: 2101289
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature