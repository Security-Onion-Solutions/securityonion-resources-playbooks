name: GPL DNS Named Version Enumeration Attempt
id: 22101616
description: |
  Detects attempts to enumerate BIND DNS server version information through specific queries.
  May trigger on legitimate network monitoring or DNS troubleshooting activities.
type: detection
detection_id: 2101616
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What specific DNS query was used to enumerate the BIND version?
    context: Version enumeration queries use distinctive patterns like 'version.bind' or 'authors.bind' to extract server information.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.query.class
        - src_ip
        - dst_ip

  - question: What DNS response revealed the server version information?
    context: Successful version queries return specific server details that attackers use for vulnerability assessment.
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dns.response_code
        - dns.answers
        - dns.flags

  # Type 2: Triage Assessment
  - question: Is this source authorized to perform DNS server diagnostics?
    context: Network administrators and monitoring systems legitimately query DNS server versions for inventory and health checks.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.type_name
        - dns.response_code

  - question: Are there scheduled network monitoring activities from this source?
    context: Legitimate monitoring tools often perform regular DNS health checks including version queries.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|contains:
            - 'version'
            - 'hostname'
            - 'id.server'
        condition: selection
      fields:
        - dst_ip
        - dns.query.name

  # Type 3: Activity Context
  - question: What DNS reconnaissance preceded this version enumeration?
    context: Attackers typically perform broad DNS enumeration before targeting specific server information.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.response_code

  - question: What other DNS servers has this source fingerprinted?
    context: Systematic version enumeration across multiple DNS servers indicates reconnaissance campaign.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dns.query.name|contains:
            - 'version'
            - 'bind'
        condition: selection
      fields:
        - dst_ip
        - dns.query.name

  # Type 4: Impact Assessment
  - question: What DNS server version information was successfully extracted?
    context: Exposed version information helps attackers identify vulnerable DNS servers for targeted exploitation.
    range: +5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          dns.query.name|contains:
            - 'version'
            - 'bind'
        condition: selection
      fields:
        - dns.answers.rdata
        - dns.response_code

  - question: Are there subsequent vulnerability scans targeting the identified DNS server?
    context: Version enumeration is often followed by targeted vulnerability scanning against specific DNS software versions.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - 'scan'
            - 'exploit'
        condition: selection
      fields:
        - rule.name
        - dst_port

  # Type 5: Forensic Deep-Dive
  - question: What automated DNS enumeration tools are being used?
    context: Different tools leave distinctive fingerprints in query patterns and timing.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dst_ip

  - question: Are there DNS cache poisoning or spoofing attempts following enumeration?
    context: DNS server version information helps attackers craft targeted cache poisoning or spoofing attacks.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: 'DNS'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dns.query.name

  - question: What DNS exploitation attempts target the enumerated server version?
    context: Specific BIND versions have known vulnerabilities that attackers exploit after version identification.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category|contains: 'exploit'
        condition: selection
      fields:
        - rule.name
        - rule.cve
        - dst_port

  # Type 6: Enterprise Correlation
  - question: Are other DNS servers experiencing similar version enumeration attempts?
    context: Coordinated DNS fingerprinting across multiple servers indicates systematic infrastructure reconnaissance.
    range: +/-4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name: 'GPL DNS named version attempt'
        condition: selection
      fields:
        - src_ip
        - dst_ip

  - question: Is this part of broader network infrastructure reconnaissance?
    context: DNS version enumeration often occurs alongside other infrastructure fingerprinting activities.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - 'scan'
            - 'recon'
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port