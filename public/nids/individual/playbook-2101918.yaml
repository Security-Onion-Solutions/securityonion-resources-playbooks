name: GPL SCAN SolarWinds IP scan attempt
id: 22101918
description: |
  Detects network scanning attempts using SolarWinds network management tools.
  This identifies ICMP packets containing "SolarWinds.Net" strings used for network discovery.
  May trigger on legitimate SolarWinds network monitoring and management activities.
type: detection
detection_id: 2101918
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact ICMP payload content containing SolarWinds signatures?
    context: Understanding the ICMP payload reveals the specific SolarWinds tool and scanning methodology used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - icmp_type
        - icmp_code

  - question: What ICMP packet characteristics were observed in the scan?
    context: ICMP type and code values help identify the specific scanning technique and tool configuration.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - icmp_type
        - icmp_code
        - packet_length
        - ttl

  # Type 2: Triage Assessment
  - question: Is SolarWinds network monitoring authorized in this environment?
    context: Many organizations use SolarWinds for legitimate network management, requiring verification of authorization.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 161
            - 162
            - 8080
            - 17778
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto

  - question: Does the source IP match known SolarWinds management servers?
    context: Legitimate SolarWinds scanning should originate from authorized management infrastructure.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - proto
        - bytes_in
        - bytes_out

  # Type 3: Activity Context
  - question: What network scanning pattern preceded this SolarWinds detection?
    context: Understanding the scanning sequence helps identify if this is part of broader reconnaissance.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - scan
            - recon
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port

  - question: What was the timing and scope of the ICMP scanning activity?
    context: Automated tools show consistent timing patterns while manual scans are more irregular.
    range: -30m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          proto: icmp
        condition: selection
      fields:
        - dst_ip
        - icmp_type
        - packet_length

  - question: What network ranges were targeted in the scanning activity?
    context: Understanding target scope reveals if this is internal network mapping or external reconnaissance.
    range: +/-15m
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - scan
            - SolarWinds
        condition: selection
      fields:
        - dst_ip
        - alert.signature

  # Type 4: Impact Assessment
  - question: Did target systems respond to the SolarWinds ICMP probes?
    context: Response patterns indicate live hosts and network topology discovery success.
    range: +5m
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          dst_ip|expand: '%src_ip%'
          proto: icmp
        condition: selection
      fields:
        - icmp_type
        - icmp_code
        - packet_length

  - question: Are there signs of follow-up exploitation attempts after the scan?
    context: Scanning often precedes targeted attacks against discovered services and vulnerabilities.
    range: +2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.category|contains:
            - exploit
            - attack
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - dst_port

  # Type 5: Forensic Deep-Dive
  - question: What specific SolarWinds product signature was embedded in the ICMP payload?
    context: Different SolarWinds products have distinct signatures that reveal the tool and version used.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - alert.signature

  - question: Are there additional network management tool signatures from this source?
    context: Attackers may use multiple network discovery tools to map infrastructure comprehensively.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - scan
            - discovery
            - probe
        condition: selection
      fields:
        - alert.signature
        - dst_ip
        - proto

  # Type 6: Enterprise Correlation
  - question: Are other network segments experiencing similar SolarWinds scanning activity?
    context: Network-wide scanning may indicate comprehensive infrastructure reconnaissance or legitimate monitoring expansion.
    range: +/-2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature: "GPL SCAN SolarWinds IP scan attempt"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - proto