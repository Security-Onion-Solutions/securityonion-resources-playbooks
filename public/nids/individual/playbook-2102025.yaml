name: GPL RPC yppasswd username overflow attempt UDP
id: 22102025
description: |
  Detects potential buffer overflow attempts against the yppasswd RPC service via oversized username parameters.
  May exploit CVE-2001-0779 in vulnerable NIS implementations.
type: detection
detection_id: 2102025
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact size and content of the oversized username parameter?
    context: The specific username length and content reveals the nature of the buffer overflow attempt.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - src_ip
        - dst_ip
        - src_port
        - dst_port

  - question: Is this yppasswd request from an authorized NIS client?
    context: Legitimate NIS password changes should come from known client systems within the domain.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver

  - question: What NIS enumeration activity preceded this overflow attempt?
    context: Attackers typically discover NIS services before attempting exploitation.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "NIS"
            - "ypbind"
            - "ypserv"
            - "RPC"
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_ip
        - alert.severity

  - question: What is the current state of the yppasswd service after the attack?
    context: Buffer overflow attempts may crash the service or cause instability.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 111
            - 834
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver
        - bytes_toclient

  - question: Are there signs of successful code execution on the NIS server?
    context: CVE-2001-0779 exploitation may lead to arbitrary code execution with root privileges.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          User|contains:
            - "root"
            - "daemon"
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessId
        - ParentImage

  - question: What network connections were established from the NIS server after the exploit?
    context: Successful exploitation may result in reverse shells or backdoor installations.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto
        - bytes_toserver
        - bytes_toclient

  - question: Has the NIS password database been compromised or modified?
    context: Successful yppasswd exploitation may allow unauthorized password changes or database access.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          TargetFilename|contains:
            - "passwd"
            - "shadow"
            - "/var/yp/"
        condition: selection
      fields:
        - TargetFilename
        - ProcessName
        - User

  - question: Are there attempts to access other NIS maps following the exploit?
    context: Compromised NIS servers may be used to access sensitive directory information.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          alert.signature|contains:
            - "NIS"
            - "ypcat"
            - "ypmatch"
        condition: selection
      fields:
        - alert.signature
        - src_ip
        - dst_ip
        - alert.severity

  - question: Has this source IP targeted other NIS servers in the network?
    context: Attackers may systematically target all NIS infrastructure in the environment.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          alert.signature|contains:
            - "yppasswd"
            - "NIS"
            - "RPC"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature

  - question: What NIS clients are currently active in the domain?
    context: Understanding NIS client activity helps assess the scope of potential compromise.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 111
            - 834
            - 835
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - proto

  - question: Are there coordinated yppasswd overflow attempts across multiple NIS servers?
    context: Worm-like propagation may indicate automated exploitation of CVE-2001-0779.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          alert.signature: "GPL RPC yppasswd username overflow attempt UDP"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - alert.signature