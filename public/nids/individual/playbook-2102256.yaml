name: GPL RPC sadmind Query with Root Credentials Attempt UDP
id: 22102256
description: |
  Detects attempts to query sadmind (Solaris Administration Daemon) using root credentials.
  This may indicate unauthorized privilege escalation attempts on Solaris systems.
  Could trigger on legitimate administrative tools or security assessments.
type: detection
detection_id: 2102256
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete RPC request attempting root credential access?
    context: Analyzing the RPC payload reveals the specific sadmind function and credential parameters being exploited.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - rule.name

  - question: Is this a legitimate sadmind administration request?
    context: Authorized system administrators may use sadmind for legitimate Solaris system management.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          proto: "UDP"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - bytes_toserver

  - question: What other RPC services are being targeted from this source?
    context: Multiple RPC attacks suggest systematic enumeration or exploitation of Unix/Linux services.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "rpc"
            - "misc-attack"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port

  - question: Is the target system running Solaris with sadmind service?
    context: Confirming the target OS and service availability determines actual vulnerability exposure.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          dst_port|contains:
            - 111
            - 32771
            - 32772
        condition: selection
      fields:
        - dst_port
        - proto
        - app_proto

  - question: Did the sadmind exploitation attempt succeed?
    context: Successful exploitation may result in privileged process execution or system compromise.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          User|contains:
            - "root"
            - "daemon"
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: What network reconnaissance preceded this sadmind attack?
    context: Port scans or RPC enumeration may indicate systematic targeting of Unix/Linux systems.
    range: -1h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.category|contains:
            - "scan"
            - "recon"
        condition: selection
      fields:
        - rule.name
        - dst_port
        - proto

  - question: Are there signs of privilege escalation following the sadmind attack?
    context: Root access may enable installation of backdoors, rootkits, or system modifications.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
          TargetFilename|contains:
            - "/etc/"
            - "/root/"
            - "/usr/bin/"
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What outbound connections were made after the sadmind exploitation?
    context: Network connections may indicate backdoor installation or data exfiltration activities.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient
        - bytes_toserver

  - question: Has this sadmind attack pattern been detected across other Unix systems?
    context: Enterprise-wide detection suggests coordinated campaign targeting Unix/Linux infrastructure.
    range: -6h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.sid: 2102256
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.name

  - question: What DNS queries were made from the target system after sadmind exploitation?
    context: DNS lookups may reveal command and control infrastructure or data exfiltration destinations.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name

  - question: Are there indicators of lateral movement from the compromised Unix system?
    context: Additional attacks originating from the target suggest successful compromise and network propagation.
    range: +4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
          rule.category|contains:
            - "attack"
            - "exploit"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - dst_port