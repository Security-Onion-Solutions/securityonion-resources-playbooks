name: GPL SHELLCODE x86 0x71FB7BAB NOOP Detection
id: 22102312
description: |
  Detects x86 shellcode containing specific NOOP sled pattern 0x71FB7BAB.
  May indicate buffer overflow exploitation or legitimate security testing.
  Pattern could appear in network traffic during penetration testing or actual attacks.
type: detection
detection_id: 2102312
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete payload containing the shellcode pattern?
    context: Analyzing the full payload reveals the exploitation method and target vulnerability.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - payload
        - payload_printable
        - rule.name

  - question: What application or service was targeted by this shellcode?
    context: Identifying the destination service helps determine the attack vector and potential impact.
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id|expand: '%community_id%'
        condition: selection
      fields:
        - dst_port
        - proto
        - app_proto

  - question: Is this part of authorized penetration testing or security assessment?
    context: Legitimate security testing may generate similar shellcode patterns during vulnerability assessments.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "shellcode"
            - "exploit"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: What was the source of this shellcode delivery?
    context: Understanding the delivery mechanism helps identify the initial attack vector.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - src_port
        - dst_port
        - bytes_toserver

  - question: Did the shellcode execution succeed on the target system?
    context: Process creation events indicate successful shellcode execution and system compromise.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User

  - question: What other exploitation attempts occurred from this source?
    context: Multiple exploit attempts suggest coordinated attack campaign or vulnerability scanning.
    range: -2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.category|contains:
            - "exploit"
            - "shellcode"
            - "attack"
        condition: selection
      fields:
        - rule.name
        - dst_ip
        - dst_port

  - question: Are there signs of successful system compromise following this shellcode?
    context: File modifications, registry changes, or network connections indicate successful exploitation.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - TargetFilename
        - file.hash.md5
        - ProcessName

  - question: What network connections were established after the shellcode detection?
    context: Outbound connections may indicate command and control communication or data exfiltration.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toclient
        - bytes_toserver

  - question: Has this shellcode pattern been detected across other systems?
    context: Enterprise-wide detection indicates worm behavior or coordinated attack campaign.
    range: -24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.sid: 2102312
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - host.name

  - question: What DNS queries were made from the target system after shellcode detection?
    context: DNS lookups may reveal command and control domains or data exfiltration destinations.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
        - dns.query.type_name