name: GPL NETBIOS SMB RemoteActivation Little Endian DCOM Attempt
id: 22103414
description: |
  Detects attempts to exploit DCOM RemoteActivation functionality using little endian byte ordering via SMB.
  This targets DCOM interfaces with specific endianness requirements for exploitation bypass.
  May trigger on legitimate DCOM applications using little endian implementations or cross-platform compatibility layers.
type: detection
detection_id: 2103414
detection_category:
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  # Type 1: Artifact Analysis
  - question: What was the exact little endian DCOM RemoteActivation payload structure?
    context: Understanding the endian-specific DCOM parameters reveals sophisticated exploitation targeting byte order protections.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          document_id|expand: '%document_id%'
        condition: selection
      fields:
        - rule.name
        - payload
        - payload_printable
        - src_ip
        - dst_ip

  - question: How does this little endian DCOM variant differ from standard RemoteActivation attempts?
    context: Comparing byte ordering patterns reveals evasion techniques and exploitation methodology sophistication.
    range: -1h/+1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "RemoteActivation"
        condition: selection
      fields:
        - rule.name
        - payload
        - dce_rpc.interface_uuid

  # Type 2: Triage Assessment
  - question: Is this source known to use little endian DCOM implementations legitimately?
    context: Cross-platform applications or legacy systems may require little endian DCOM operations for compatibility.
    range: -30d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port: 139
        condition: selection
      fields:
        - dst_ip
        - bytes_toserver
        - duration

  - question: Does the target system architecture require endian-specific DCOM operations?
    context: System architecture and DCOM implementation may legitimately require specific byte ordering for interoperability.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains: "DCOM"
        condition: selection
      fields:
        - src_ip
        - rule.name

  # Type 3: Activity Context
  - question: What DCOM interface enumeration preceded this endian-specific activation?
    context: Little endian DCOM exploits require detailed interface reconnaissance to determine byte order requirements.
    range: -15m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - "DCOM"
            - "DCE"
            - "RPC"
        condition: selection
      fields:
        - rule.name
        - dce_rpc.interface_uuid
        - dce_rpc.operation

  - question: What system fingerprinting occurred before this architecture-specific DCOM attack?
    context: Attackers using endian-specific DCOM exploits typically perform detailed system reconnaissance first.
    range: -2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_port|contains:
            - 135
            - 139
            - 445
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - bytes_toserver
        - bytes_toclient

  # Type 4: Impact Assessment
  - question: Did the little endian DCOM activation bypass system protections successfully?
    context: Endian-specific DCOM exploits may succeed where standard attempts fail, indicating successful component instantiation.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip|expand: '%dst_ip%'
        condition: selection
      fields:
        - Image
        - CommandLine
        - User
        - ProcessGuid

  - question: Are there signs of DCOM-based lateral movement following the endian-specific exploit?
    context: Successful little endian DCOM exploits may achieve component access that standard attempts cannot.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - "lateral"
            - "movement"
            - "persistence"
        condition: selection
      fields:
        - rule.name
        - src_ip
        - severity

  # Type 5: Forensic Deep-Dive
  - question: What specific little endian DCOM exploitation technique was employed?
    context: Detailed analysis of byte patterns reveals advanced DCOM exploitation methodology and threat actor sophistication.
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          community_id|expand: '%community_id%'
          rule.name|contains: "little endian"
        condition: selection
      fields:
        - rule.name
        - payload
        - dce_rpc.interface_uuid

  - question: Are there indicators of custom DCOM exploit frameworks or tools being used?
    context: Little endian DCOM exploits often indicate use of specialized or custom exploitation frameworks.
    range: +15m
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          dst_ip|expand: '%dst_ip%'
          rule.name|contains:
            - "exploit"
            - "backdoor"
            - "trojan"
        condition: selection
      fields:
        - rule.name
        - payload_printable

  # Type 6: Enterprise Correlation
  - question: Are other systems experiencing similar endian-specific DCOM attacks?
    context: Coordinated use of architecture-specific DCOM exploits indicates advanced persistent threat activity.
    range: -4h/+4h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          rule.name: "GPL NETBIOS SMB RemoteActivation little endian andx attempt"
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - rule.name

  - question: Is this part of a targeted campaign using multiple DCOM exploitation variants?
    context: Use of both standard and endian-specific DCOM exploits suggests thorough target reconnaissance and persistent attempts.
    range: -6h/+2h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          src_ip|expand: '%src_ip%'
          rule.name|contains: "RemoteActivation"
        condition: selection
      fields:
        - dst_ip
        - rule.name
        - severity