name: ET WEB_SPECIFIC_APPS Consona Products n6plugindestructor.asp Cross Site Scripting Attempt
id: 1223390
description: |
  Detects Cross Site Scripting (XSS) attempts targeting Consona Products n6plugindestructor.asp with JavaScript or event handlers in the backurl parameter.
  May trigger on legitimate content management or security scanning tools testing for XSS vulnerabilities.
type: detection
detection_id: 2011152
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete XSS payload in the request to n6plugindestructor.asp?
    context: Reveals the specific script content and injection technique used in the attack attempt.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - http.method
        - http.useragent
        - http.virtual_host
        - http.uri
        - http.status_code
  - question: Does this host normally access Consona web applications?
    context: Determines if HTTP requests to this application are typical for this source.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip: '{destination.ip}'
        condition: selection
      fields:
        - dst_ip
  - question: What process or application initiated this XSS request?
    context: Identifies whether the request came from a browser, script, or automated tool.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id: '{network.community_id}'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What DNS queries preceded this request to the Consona application?
    context: Shows how the host discovered or was directed to the vulnerable application.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip: '{source.ip}'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: What other web applications were accessed from this host?
    context: Identifies additional applications that may have been targeted for XSS attacks.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip: '{network.public_ip}'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts attempting XSS attacks against the same Consona application?
    context: Determines if this is part of a coordinated attack against the web application.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        filter:
          src_ip: '{source.ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What script files were created or modified on this host?
    context: Identifies potential payloads or tools used for the XSS attack.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip: '{network.private_ip}'
          file.name|endswith:
          - .py
          - .pl
          - .sh
          - .php
          - .asp
          - .aspx
          - .js
          - .vbs
          - .ps1
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Did this host attempt XSS attacks against other web applications?
    context: Reveals broader XSS attack patterns or vulnerability scanning activity.
    range: +/-4h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip: '{source.ip}'
          http.uri|contains:
            - "script"
            - "javascript"
            - "onmouse"
            - "onkey"
            - "onload"
            - "onclick"
        condition: selection
      fields:
        - http.virtual_host
        - http.uri
        - http.user_agent
        - dst_ip
  - question: Are there related XSS alerts across the organization?
    context: Identifies coordinated XSS campaign activity or automated vulnerability scanning.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip: '{related.ip}'
        filter:
          document_id: '{soc_id}'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip
  - question: What was the response from the Consona application to this XSS attempt?
    context: Determines if the application successfully filtered the XSS attempt or was vulnerable.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id: '{network.community_id}'
          http.uri|contains: "n6plugindestructor.asp"
        condition: selection
      fields:
        - http.status_code
        - http.response.body.length
        - http.method
        - http.uri