name: ET MALWARE Possible Linux.Mirai Login Attempt (anko)
id: 1241507
description: |
  Detects attempts to login to telnet services using the credentials "anko" which is associated with Mirai botnet activity.
  May trigger on legitimate administration using these credentials or security testing tools.
type: detection
detection_id: 2023436
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete telnet login sequence containing the "anko" credentials?
    context: Reveals the exact authentication attempt pattern used by the Mirai botnet.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
  - question: Does this host normally receive telnet connections from external sources?
    context: Determines if telnet access from this source is typical for this device.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{destination.ip}'
        condition: selection
      fields:
        - dst_ip
  - question: What other external connections occurred from this host after the login attempt?
    context: Identifies potential command and control communications following successful authentication.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip: '{network.public_ip}'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts receiving similar Mirai login attempts?
    context: Determines the scope of the botnet scanning activity across the organization.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        filter:
          src_ip: '{source.ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What is the pattern of connection attempts to this telnet service?
    context: Analyzes the timing and frequency of authentication attempts for brute force patterns.
    range: +/-2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{related.ip}'
          dst_ip: '{related.ip}'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol
        - event.duration
        - client.ip_bytes
        - server.ip_bytes
        - connection.state_description
  - question: Did any successful telnet sessions occur from this source IP?
    context: Determines if the Mirai credentials resulted in successful device compromise.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
          dst_ip: '{destination.ip}'
          dst_port: [23, 2323]
          connection.state: "SF"
        condition: selection
      fields:
        - connection.state_description
        - connection.history
        - connection.duration
  - question: Are there similar credential-based attacks targeting other IoT device ports?
    context: Identifies broader IoT-focused attack campaigns beyond telnet services.
    range: +/-12h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
          dst_port: [22, 23, 80, 81, 443, 2323, 8080, 8081, 9000]
        condition: selection
      fields:
        - dst_port
        - connection.state
        - connection.duration
  - question: What is the geographic and network origin of these Mirai login attempts?
    context: Provides attribution context for the botnet activity source.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
          dst_port: [23, 2323]
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
  - question: Did any lateral movement occur from this host after the telnet activity?
    context: Assesses whether successful compromise led to network propagation.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{network.private_ip}'
          dst_port:
          - 445    # SMB
          - 139    # NetBIOS
          - 3389   # RDP
          - 5985   # WinRM HTTP
          - 5986   # WinRM HTTPS
          - 22     # SSH
          - 23     # Telnet
          - 135    # RPC
          - 5900   # VNC
        condition: selection
      fields:
        - src_ip
        - src_port
        - dst_ip
        - dst_port
        - network.transport
  - question: Are there related Mirai botnet alerts across the organization?
    context: Identifies coordinated botnet activity targeting multiple devices.
    range: +/-48h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category