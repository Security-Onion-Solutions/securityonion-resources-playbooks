name: ET PHISHING Request for Possible Outlook Phishing Hosted on Github.io
id: 1229382
description: |
  Detects TLS connections to github.io domains containing "outlook" in the hostname.
  May trigger on legitimate GitHub Pages sites using "outlook" in their domain name or legitimate Microsoft documentation hosted on GitHub.
type: detection
detection_id: 2027246
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the exact github.io domain accessed that contains "outlook"?
    context: Reveals the specific hostname that may be hosting phishing content.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - ssl.server_name
        - ssl.version
        - ssl.cipher
        - hash.ja3
  - question: Does this host normally access github.io domains?
    context: Determines if GitHub Pages access is typical for this user or system.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip: '{source.ip}'
          ssl.server_name|contains: github.io
        condition: selection
      fields:
        - src_ip
        - ssl.server_name
  - question: What process initiated the connection to the github.io domain?
    context: Identifies the application responsible for accessing the potential phishing site.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id: '{network.community_id}'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What DNS queries preceded this connection to the github.io domain?
    context: Shows the DNS resolution chain that led to accessing the potential phishing site.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip: '{source.ip}'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: What other external connections occurred from this host?
    context: Identifies additional web browsing or communication that may be related.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip: '{network.public_ip}'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts connecting to the same github.io domain?
    context: Determines scope of potential phishing campaign targeting multiple users.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        filter:
          src_ip: '{source.ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What files were downloaded or created after accessing the github.io domain?
    context: Identifies potential malware or phishing-related files that may have been downloaded.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip: '{network.private_ip}'
          file.name|endswith:
          - .exe
          - .dll
          - .bat
          - .cmd
          - .ps1
          - .vbs
          - .js
          - .scr
          - .com
          - .pif
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Are there similar connections to other github.io domains with suspicious patterns?
    context: Reveals broader phishing infrastructure hosted on GitHub Pages.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          ssl.server_name|contains:
            - ".github.io"
          ssl.server_name|contains:
            - "microsoft"
            - "office"
            - "login"
            - "signin"
            - "auth"
            - "secure"
        condition: selection
      fields:
        - ssl.server_name
        - src_ip
        - dst_ip
  - question: Did this host attempt to access legitimate Microsoft or Office 365 services after the github.io connection?
    context: Identifies potential credential theft attempts or user confusion following phishing exposure.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: ssl
      detection:
        selection:
          src_ip: '{source.ip}'
          ssl.server_name|contains:
            - "microsoft.com"
            - "office.com"
            - "outlook.com"
            - "office365.com"
            - "microsoftonline.com"
        condition: selection
      fields:
        - ssl.server_name
        - dst_ip
  - question: Are there related phishing alerts across the organization?
    context: Determines if this is part of a coordinated phishing campaign.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category