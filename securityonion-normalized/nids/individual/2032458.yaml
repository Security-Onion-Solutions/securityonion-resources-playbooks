name: ET PHISHING Tectite Web Form Submission - Possible Successful Phish
id: 1203285
description: |
  Detects HTTP POST requests to PHP scripts containing Tectite web form parameters that may indicate successful phishing data collection.
  May trigger on legitimate Tectite FormMail usage or similar web form processing applications.
type: detection
detection_id: 2032458
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete POST request containing the Tectite form parameters?
    context: Reveals the full phishing form submission including recipient data and redirection URLs.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - http.method
        - http.useragent
        - http.virtual_host
        - http.uri
        - http.status_code
  - question: Does this host normally submit data to PHP forms on external sites?
    context: Determines if HTTP POST activity to external PHP scripts is typical for this host.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip: '{destination.ip}'
        condition: selection
      fields:
        - dst_ip
  - question: What process initiated the connection to submit the form data?
    context: Identifies the application or browser responsible for the form submission.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id: '{network.community_id}'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What DNS queries preceded this form submission?
    context: Shows how the user navigated to the phishing site hosting the form.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip: '{source.ip}'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: What other external connections occurred from this host around the same time?
    context: Identifies additional sites accessed that may be part of the phishing campaign.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip: '{network.public_ip}'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts submitting data to the same PHP form?
    context: Determines if multiple users have fallen victim to the same phishing campaign.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        filter:
          src_ip: '{source.ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What files were accessed before this form submission occurred?
    context: Identifies documents that may have contained the phishing link leading to form submission.
    range: -1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip: '{network.private_ip}'
          file.name|endswith:
          - .doc
          - .docx
          - .xls
          - .xlsx
          - .pdf
          - .rtf
          - .ppt
          - .pptx
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Are there similar phishing form submissions across the organization?
    context: Reveals the scope of the phishing campaign affecting multiple users.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category
  - question: Did this host access other Tectite FormMail installations?
    context: Identifies additional phishing sites using the same web form software.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip: '{source.ip}'
          http.method: "POST"
          http.uri|contains: ".php"
        tectite_params:
          http.request_body|contains:
            - "bad_url="
            - "good_url="
            - "recipients="
            - "env_report="
        condition: selection and tectite_params
      fields:
        - dst_ip
        - http.virtual_host
        - http.uri
        - http.user_agent
  - question: What credentials or sensitive data were included in the form submission?
    context: Assesses the type and value of information compromised through the phishing form.
    range: +/-15m
    query: "aggregation: false\nlogsource:\n  category: network\n  service: http\ndetection:\n  selection:\n    community_id: '{network.community_id}'\n    http.method: \"POST\"\n  credential_indicators:\n    http.request_body|contains:\n      - \"password\"\n      - \"username\" \n      - \"email\"\n      - \"ssn\"\n      - \"social\"\n      - \"account\"\n  condition: selection and credential_indicators\nfields:\n  - http.request.body.length\n  - http.user_agent\n  - http.virtual_host\n"
  - question: What was the timing pattern of form submissions to this phishing site?
    context: Reveals the success rate and timeline of the phishing campaign.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{related.ip}'
          dst_ip: '{related.ip}'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol
        - event.duration
        - client.ip_bytes
        - server.ip_bytes
        - connection.state_description