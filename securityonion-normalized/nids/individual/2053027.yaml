name: ET EXPLOIT_KIT ZPHP Domain in TLS SNI (1kt8j .com)
id: 1245443
description: |
  Detects TLS connections to 1kt8j.com domain which has been associated with fake browser update campaigns.
  May indicate compromise through malicious browser updates or could represent legitimate access to compromised infrastructure.
type: detection
detection_id: 2053027
detection_category: ''
detection_type: nids
contributors:
- SecurityOnionSolutions
created: 2024-05-29
questions:
- question: What was the complete TLS connection attempt to 1kt8j.com?
  context: Reveals the full SSL/TLS handshake details and connection metadata.
  range: +/-15m
  query: |
    aggregation: false
    logsource:
      category: network
      service: ssl
    detection:
      selection:
        community_id: '{network.community_id}'
      condition: selection
    fields:
      - ssl.server_name
      - ssl.version
      - ssl.cipher
      - hash.ja3
- question: Does this host normally access domains associated with browser updates?
  context: Determines if SSL connections to update-related domains are typical for this host.
  range: -7d
  query: |
    aggregation: true
    logsource:
      category: network
      service: ssl
    detection:
      selection:
        src_ip: '{source.ip}'
        ssl.server_name|contains: 1kt8j
      condition: selection
    fields:
      - src_ip
      - ssl.server_name
- question: What browser or application initiated the connection to 1kt8j.com?
  context: Identifies the process responsible for establishing the TLS connection.
  range: +/-15m
  query: |
    aggregation: false
    logsource:
      category: network
    detection:
      selection:
        community_id: '{network.community_id}'
      filter:
        Image|exists: true
      condition: selection and filter
    fields:
      - hostname
      - User
      - Image
      - CommandLine
      - ProcessGuid
- question: What DNS queries preceded the connection to 1kt8j.com?
  context: Shows how the domain was resolved and any related DNS activity.
  range: -5m
  query: |
    aggregation: false
    logsource:
      category: network
      service: dns
    detection:
      selection:
        src_ip: '{source.ip}'
      condition: selection
    fields:
      - dns.query.name
      - dns.query.type_name
      - dns.resolved_ip
- question: What other external connections occurred from this host around the same time?
  context: Identifies additional external communications that may be part of the same campaign.
  range: +/-10m
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        src_ip: '{source.ip}'
      private:
        dst_ip|cidr:
          - '10.0.0.0/8'
          - '127.0.0.0/8'
          - '172.16.0.0/12'
          - '192.168.0.0/16'
          - '169.254.0.0/16'
      filter:
        dst_ip: '{network.public_ip}'
      condition: selection and not (private or filter)
    fields:
      - dst_ip
      - dst_port
      - network.transport
      - connection.state_description
- question: Are other hosts connecting to 1kt8j.com or related infrastructure?
  context: Determines the scope of potential fake browser update campaign impact.
  range: +/-24h
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        dst_ip: '{network.public_ip}'
      filter:
        src_ip: '{source.ip}'
      condition: selection and not filter
    fields:
      - src_ip
      - dst_port
      - network.transport
      - connection.state_description
- question: What executable files were created after the connection to 1kt8j.com?
  context: Identifies downloaded files that may contain malicious browser updates.
  range: +1h
  query: |
    aggregation: false
    logsource:
      category: file_event
    detection:
      selection:
        host.ip: '{network.private_ip}'
        file.name|endswith:
        - .exe
        - .dll
        - .bat
        - .cmd
        - .ps1
        - .vbs
        - .js
        - .scr
        - .com
        - .pif
      condition: selection
    fields:
      - file.path
      - file.name
      - Image
      - ProcessGuid
      - User
- question: Did any lateral movement occur from this host after the connection?
  context: Assesses whether the host was compromised and used for internal network access.
  range: +2h
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        src_ip: '{network.private_ip}'
        dst_port:
        - 445    # SMB
        - 139    # NetBIOS
        - 3389   # RDP
        - 5985   # WinRM HTTP
        - 5986   # WinRM HTTPS
        - 22     # SSH
        - 23     # Telnet
        - 135    # RPC
        - 5900   # VNC
      condition: selection
    fields:
      - src_ip
      - src_port
      - dst_ip
      - dst_port
      - network.transport
- question: What is the timing pattern of connections to 1kt8j.com?
  context: Analyzes communication frequency and patterns typical of C2 activity.
  range: +/-6h
  query: |
    aggregation: false
    logsource:
      category: network
      service: connection
    detection:
      selection:
        src_ip: '{related.ip}'
        dst_ip: '{related.ip}'
      condition: selection
    fields:
      - src_ip
      - dst_ip
      - dst_port
      - network.protocol
      - event.duration
      - client.ip_bytes
      - server.ip_bytes
      - connection.state_description
- question: Are there related alerts involving the same domain or campaign indicators?
  context: Identifies coordinated activity across the organization matching this campaign.
  range: +/-24h
  query: |
    aggregation: true
    logsource:
      category: alert
    detection:
      selection:
        dst_ip: '{network.public_ip}'
      condition: selection
    fields:
      - src_ip
      - rule.name
      - rule.category
- question: What IP addresses did 1kt8j.com resolve to during this timeframe?
  context: Maps the infrastructure behind the fake browser update campaign.
  range: +/-2h
  query: |-
    aggregation: false
    detection:
      condition: selection
      selection:
        dns.query.name|contains: 1kt8j
    fields:
    - dns.query.name
    - dns.resolved_ip
    - src_ip
    logsource:
      category: network
      service: dns
- question: Did this host download any browser-related files or updates?
  context: Identifies files that may be fake browser updates delivered through the campaign.
  range: +2h
  query: |-
    aggregation: false
    detection:
      browser_files:
        file.name|contains:
        - update
        - browser
        - chrome
        - firefox
        - edge
        - .exe
        - .msi
      condition: selection and browser_files
      selection:
        host.ip: '{source.ip}'
    fields:
    - file.path
    - file.name
    - Image
    - ProcessGuid
    logsource:
      category: file_event
