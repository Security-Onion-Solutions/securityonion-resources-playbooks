name: ET FILE_SHARING Observed DNS Query to Abused File Sharing Domain in DNS Lookup (filebin .net)
id: 1230759
description: |
  Detects DNS queries to filebin.net, a file sharing service that can be used for legitimate file sharing but is also commonly abused for data exfiltration and malware distribution.
  May trigger on legitimate business use of file sharing services or personal use during breaks.
type: detection
detection_id: 2061028
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2025-01-27
questions:
  - question: What was the exact DNS query made to filebin.net?
    context: Reveals the specific subdomain or full domain name that was queried.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: Does this host normally query file sharing services?
    context: Determines if DNS queries to file sharing platforms are typical for this host.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: dns
      detection:
        selection:
          dns.query.name: '{dns.query_name}'
        condition: selection
      fields:
        - dns.query.name
  - question: What process initiated the DNS query to filebin.net?
    context: Identifies the application or service responsible for the file sharing access.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id: '{network.community_id}'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: What DNS queries were made before this filebin.net lookup?
    context: Shows the sequence of DNS activity leading to the file sharing access.
    range: -5m
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip: '{source.ip}'
        condition: selection
      fields:
        - dns.query.name
        - dns.query.type_name
        - dns.resolved_ip
  - question: What other external connections occurred from this host?
    context: Identifies additional external communications that may be related to data movement.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip: '{network.public_ip}'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts querying filebin.net or similar file sharing domains?
    context: Determines scope of file sharing service usage across the organization.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        filter:
          src_ip: '{source.ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What files were created or modified around the time of this DNS query?
    context: Identifies files that may have been downloaded from or prepared for upload to the file sharing service.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip: '{network.private_ip}'
          file.name|endswith:
          - .doc
          - .docx
          - .xls
          - .xlsx
          - .pdf
          - .rtf
          - .ppt
          - .pptx
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Did this host query other file sharing or paste services?
    context: Reveals broader patterns of external file sharing platform usage.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: dns
      detection:
        selection:
          src_ip: '{source.ip}'
          dns.query.name|contains:
            - pastebin
            - paste
            - hastebin
            - ghostbin
            - justpaste
            - controlc
            - dropbox
            - wetransfer
            - sendspace
            - mediafire
        condition: selection
      fields:
        - dns.query.name
        - dns.resolved_ip
  - question: Are there related alerts involving the same IP addresses?
    context: Identifies other suspicious activities involving the same infrastructure or hosts.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip: '{related.ip}'
        filter:
          document_id: '{soc_id}'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip