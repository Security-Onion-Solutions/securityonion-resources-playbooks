name: GPL EXPLOIT Oracle Web Cache TRACE overflow attempt
id: 1249021
description: |
  Detects HTTP TRACE requests with unusually long content that may exploit buffer overflow vulnerabilities in Oracle Web Cache.
  May trigger on legitimate HTTP testing tools or applications using extended TRACE methods.
type: detection
detection_id: 2102555
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete TRACE request that triggered this alert?
    context: Reveals the exact payload and structure of the potential buffer overflow attempt.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - http.method
        - http.useragent
        - http.virtual_host
        - http.uri
        - http.status_code
  - question: Does this host normally receive HTTP TRACE requests?
    context: Determines if TRACE method usage is typical for this web service.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: http
      detection:
        selection:
          dst_ip: '{destination.ip}'
        condition: selection
      fields:
        - dst_ip
  - question: What web server process handled this TRACE request?
    context: Identifies the specific web service that may be vulnerable to buffer overflow.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          community_id: '{network.community_id}'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - hostname
        - User
        - Image
        - CommandLine
        - ProcessGuid
  - question: Were any additional HTTP methods attempted from the same source?
    context: Reveals whether this is part of broader web application reconnaissance.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: http
      detection:
        selection:
          src_ip: '{source.ip}'
          dst_ip: '{destination.ip}'
          dst_port: '{destination.port}'
        condition: selection
      fields:
        - http.method
        - http.uri
        - http.status_code
        - http.user_agent
  - question: What other external connections occurred from the requesting host?
    context: Identifies additional network activity that may indicate scanning or exploitation tools.
    range: +/-10m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
        private:
          dst_ip|cidr:
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
        filter:
          dst_ip: '{network.public_ip}'
        condition: selection and not (private or filter)
      fields:
        - dst_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: Are other hosts attempting similar TRACE requests against web services?
    context: Determines if this represents coordinated scanning for Oracle Web Cache vulnerabilities.
    range: +/-24h
    query: |
      aggregation: true
      logsource:
        category: alert
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        condition: selection
      fields:
        - src_ip
        - rule.name
        - rule.category
  - question: Were any files created on the web server after the TRACE request?
    context: Assesses whether the buffer overflow attempt resulted in code execution.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip: '{network.private_ip}'
          file.name|endswith:
          - .exe
          - .dll
          - .bat
          - .cmd
          - .ps1
          - .vbs
          - .js
          - .scr
          - .com
          - .pif
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Did the web server establish any new outbound connections after this request?
    context: Identifies potential reverse shells or data exfiltration following exploitation.
    range: +30m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{destination.ip}'
          dst_port: [80, 443, 53, 8080, 8443]
        filter:
          dst_ip: '{network.private_ip}'
        condition: selection and not filter
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - network.transport
  - question: Are there other alerts involving the same source IP targeting web services?
    context: Reveals broader attack patterns against web infrastructure.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip: '{related.ip}'
        filter:
          document_id: '{soc_id}'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip
  - question: What is the pattern of connections to port 7777-7778 from external sources?
    context: Analyzes traffic patterns to Oracle Web Cache service ports.
    range: +/-6h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_port: [7777, 7778]
        filter:
          src_ip: '{network.private_ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_ip
        - connection.state
        - network.bytes
