name: GPL SQL sys.dbms_repcat_conf.drop_priority buffer overflow attempt
id: 1247898
description: |
  Detects attempts to exploit Oracle database sys.dbms_repcat_conf.drop_priority procedure with oversized parameters.
  May trigger on legitimate database administration activities or automated database management tools.
type: detection
detection_id: 2102894
detection_category: ''
detection_type: nids
contributors:
  - SecurityOnionSolutions
created: 2024-01-15
questions:
  - question: What was the complete Oracle database request containing the sys.dbms_repcat_conf.drop_priority call?
    context: Reveals the exact SQL payload and parameter structure used in the exploitation attempt.
    range: +/-15m
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          community_id: '{network.community_id}'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
  - question: Does this client normally connect to Oracle database services?
    context: Determines if database access from this source represents typical usage patterns.
    range: -7d
    query: |
      aggregation: true
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{destination.ip}'
        condition: selection
      fields:
        - dst_ip
  - question: What other Oracle database connections occurred from this client?
    context: Identifies additional database activity that may be part of the same session or attack.
    range: +/-30m
    query: |
      aggregation: false
      logsource:
        category: network
      detection:
        selection:
          host.ip: '{related.ip}'
        filter:
          Image|exists: true
        condition: selection and filter
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.transport
        - Image
        - ProcessGuid
        - User
        - CommandLine
  - question: Are other clients attempting similar Oracle database exploits?
    context: Determines scope of potential database attack campaign targeting multiple systems.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          dst_ip: '{network.public_ip}'
        filter:
          src_ip: '{source.ip}'
        condition: selection and not filter
      fields:
        - src_ip
        - dst_port
        - network.transport
        - connection.state_description
  - question: What external connections were established from the Oracle database server?
    context: Identifies potential data exfiltration or reverse shell connections from compromised database.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{destination.ip}'
        private_filter:
          dst_ip|cidr:
            - "10.0.0.0/8"
            - "172.16.0.0/12"
            - "192.168.0.0/16"
        condition: selection and not private_filter
      fields:
        - dst_ip
        - dst_port
        - network.protocol
        - connection.state
  - question: Were any Oracle database administrative processes executed on the target server?
    context: Identifies process execution that may indicate successful exploitation of the database service.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: process_creation
      detection:
        selection:
          host.ip: '{destination.ip}'
          Image|contains:
            - "oracle"
            - "sqlplus"
            - "oradim"
            - "lsnrctl"
        condition: selection
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User
  - question: Did any file creation or modification occur on the Oracle database server?
    context: Reveals files that may have been created through successful database exploitation.
    range: +1h
    query: |
      aggregation: false
      logsource:
        category: file_event
      detection:
        selection:
          host.ip: '{network.private_ip}'
          file.name|endswith:
          - .exe
          - .dll
          - .bat
          - .cmd
          - .ps1
          - .vbs
          - .js
          - .scr
          - .com
          - .pif
        condition: selection
      fields:
        - file.path
        - file.name
        - Image
        - ProcessGuid
        - User
  - question: Are there related alerts involving the same client or Oracle database infrastructure?
    context: Identifies coordinated attacks against database infrastructure or related security events.
    range: +/-24h
    query: |
      aggregation: false
      logsource:
        category: alert
      detection:
        selection:
          related_ip: '{related.ip}'
        filter:
          document_id: '{soc_id}'
        condition: selection and not filter
      fields:
        - rule.name
        - rule.category
        - src_ip
        - dst_ip
  - question: What is the pattern of database connections to this Oracle server?
    context: Analyzes timing and frequency of connections to identify automated attack tools.
    range: +/-2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{related.ip}'
          dst_ip: '{related.ip}'
        condition: selection
      fields:
        - src_ip
        - dst_ip
        - dst_port
        - network.protocol
        - event.duration
        - client.ip_bytes
        - server.ip_bytes
        - connection.state_description
  - question: Were there any authentication failures on Oracle database services from this client?
    context: Identifies brute force attempts or authentication bypass activities targeting the database.
    range: +/-1h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{source.ip}'
          dst_port: [1521, 1522, 1523, 1524, 1525, 1526, 1527, 1528, 1529, 1530]
          connection.state: "REJ"
        condition: selection
      fields:
        - dst_ip
        - dst_port
        - connection.state_description
  - question: Did lateral movement occur from the Oracle database server to other internal systems?
    context: Determines if successful database compromise led to further network penetration.
    range: +2h
    query: |
      aggregation: false
      logsource:
        category: network
        service: connection
      detection:
        selection:
          src_ip: '{network.private_ip}'
          dst_port:
          - 445    # SMB
          - 139    # NetBIOS
          - 3389   # RDP
          - 5985   # WinRM HTTP
          - 5986   # WinRM HTTPS
          - 22     # SSH
          - 23     # Telnet
          - 135    # RPC
          - 5900   # VNC
        condition: selection
      fields:
        - src_ip
        - src_port
        - dst_ip
        - dst_port
        - network.transport
